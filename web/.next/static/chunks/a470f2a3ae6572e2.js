(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,60572,e=>{"use strict";var t=e.i(43476),r=e.i(71645),s=e.i(14863),a=e.i(88129),i=e.i(68834),l=e.i(79473);e.i(47167);var o=e.i(48831);let n=new class{basePath="/users";async getProfile(e){return await o.apiClient.get(`${this.basePath}/${e}`)}async uploadProfilePhoto(e,t){let r=new FormData;r.append("image",t);let s=`https://lankaconnect-api-staging.politebay-79d6e8a2.eastus2.azurecontainerapps.io/api${this.basePath}/${e}/profile-photo`,a=o.apiClient.authToken,i=await fetch(s,{method:"POST",body:r,credentials:"include",headers:{...a?{Authorization:`Bearer ${a}`}:{}}});if(!i.ok){let e=await i.text(),t=`Upload failed with status ${i.status}`;try{let r=JSON.parse(e);t=r.message||r.error||t}catch{}throw Error(t)}return await i.json()}async deleteProfilePhoto(e){return await o.apiClient.delete(`${this.basePath}/${e}/profile-photo`)}async updateLocation(e,t){return await o.apiClient.put(`${this.basePath}/${e}/location`,t)}async updateCulturalInterests(e,t){return await o.apiClient.put(`${this.basePath}/${e}/cultural-interests`,t),await this.getProfile(e)}async updateLanguages(e,t){return await o.apiClient.put(`${this.basePath}/${e}/languages`,t)}async updateBasicInfo(e,t){return await o.apiClient.put(`${this.basePath}/${e}`,t)}async updatePreferredMetroAreas(e,t){return await o.apiClient.put(`${this.basePath}/${e}/preferred-metro-areas`,t),await this.getProfile(e)}async getPreferredMetroAreas(e){return await o.apiClient.get(`${this.basePath}/${e}/preferred-metro-areas`)}},c={photo:"idle",basicInfo:"idle",location:"idle",culturalInterests:"idle",languages:"idle",preferredMetroAreas:"idle"},d=(0,i.create)()((0,l.devtools)((e,t)=>({profile:null,originalProfile:null,isLoading:!1,error:null,sectionStates:{...c},setProfile:t=>{e({profile:t,originalProfile:JSON.parse(JSON.stringify(t)),error:null})},loadProfile:async r=>{e({isLoading:!0,error:null});try{let e=await n.getProfile(r);t().setProfile(e)}catch(t){e({error:t instanceof Error?t.message:"Failed to load profile",profile:null,originalProfile:null})}finally{e({isLoading:!1})}},clearProfile:()=>{e({profile:null,originalProfile:null,isLoading:!1,error:null,sectionStates:{...c}})},uploadPhoto:async(t,r)=>{e(e=>({sectionStates:{...e.sectionStates,photo:"saving"},error:null}));try{let s=await n.uploadProfilePhoto(t,r);e(e=>({profile:e.profile?{...e.profile,profilePhotoUrl:s.profilePhotoUrl}:null,originalProfile:e.originalProfile?{...e.originalProfile,profilePhotoUrl:s.profilePhotoUrl}:null,sectionStates:{...e.sectionStates,photo:"success"}})),setTimeout(()=>{e(e=>({sectionStates:{...e.sectionStates,photo:"idle"}}))},2e3)}catch(r){let t=r instanceof Error?r.message:"Failed to upload photo";e(e=>({error:t,sectionStates:{...e.sectionStates,photo:"error"}}))}},deletePhoto:async t=>{e(e=>({sectionStates:{...e.sectionStates,photo:"saving"},error:null}));try{await n.deleteProfilePhoto(t),e(e=>({profile:e.profile?{...e.profile,profilePhotoUrl:null}:null,originalProfile:e.originalProfile?{...e.originalProfile,profilePhotoUrl:null}:null,sectionStates:{...e.sectionStates,photo:"success"}})),setTimeout(()=>{e(e=>({sectionStates:{...e.sectionStates,photo:"idle"}}))},2e3)}catch(r){let t=r instanceof Error?r.message:"Failed to delete photo";e(e=>({error:t,sectionStates:{...e.sectionStates,photo:"error"}}))}},updateBasicInfo:async(r,s)=>{e(e=>({sectionStates:{...e.sectionStates,basicInfo:"saving"},error:null}));try{let a=await n.updateBasicInfo(r,s);t().setProfile(a),e(e=>({sectionStates:{...e.sectionStates,basicInfo:"success"}})),setTimeout(()=>{e(e=>({sectionStates:{...e.sectionStates,basicInfo:"idle"}}))},2e3)}catch(r){let t=r instanceof Error?r.message:"Failed to update basic info";e(e=>({error:t,sectionStates:{...e.sectionStates,basicInfo:"error"}}))}},updateLocation:async(r,s)=>{e(e=>({sectionStates:{...e.sectionStates,location:"saving"},error:null}));try{let a=await n.updateLocation(r,s);t().setProfile(a),e(e=>({sectionStates:{...e.sectionStates,location:"success"}})),setTimeout(()=>{e(e=>({sectionStates:{...e.sectionStates,location:"idle"}}))},2e3)}catch(r){let t=r instanceof Error?r.message:"Failed to update location";e(e=>({error:t,sectionStates:{...e.sectionStates,location:"error"}}))}},updateCulturalInterests:async(r,s)=>{e(e=>({sectionStates:{...e.sectionStates,culturalInterests:"saving"},error:null}));try{let a=await n.updateCulturalInterests(r,s);t().setProfile(a),e(e=>({sectionStates:{...e.sectionStates,culturalInterests:"success"}})),setTimeout(()=>{e(e=>({sectionStates:{...e.sectionStates,culturalInterests:"idle"}}))},2e3)}catch(r){let t=r instanceof Error?r.message:"Failed to update cultural interests";e(e=>({error:t,sectionStates:{...e.sectionStates,culturalInterests:"error"}}))}},updateLanguages:async(r,s)=>{e(e=>({sectionStates:{...e.sectionStates,languages:"saving"},error:null}));try{let a=await n.updateLanguages(r,s);t().setProfile(a),e(e=>({sectionStates:{...e.sectionStates,languages:"success"}})),setTimeout(()=>{e(e=>({sectionStates:{...e.sectionStates,languages:"idle"}}))},2e3)}catch(r){let t=r instanceof Error?r.message:"Failed to update languages";e(e=>({error:t,sectionStates:{...e.sectionStates,languages:"error"}}))}},updatePreferredMetroAreas:async(r,s)=>{if(s.MetroAreaIds.length>20)return void e(e=>({error:"Cannot select more than 20 metro areas",sectionStates:{...e.sectionStates,preferredMetroAreas:"error"}}));e(e=>({sectionStates:{...e.sectionStates,preferredMetroAreas:"saving"},error:null}));try{let a=await n.updatePreferredMetroAreas(r,s);t().setProfile(a),e(e=>({sectionStates:{...e.sectionStates,preferredMetroAreas:"success"}})),setTimeout(()=>{e(e=>({sectionStates:{...e.sectionStates,preferredMetroAreas:"idle"}}))},2e3)}catch(r){let t=r instanceof Error?r.message:"Failed to update preferred metro areas";e(e=>({error:t,sectionStates:{...e.sectionStates,preferredMetroAreas:"error"}}))}},markSectionDirty:t=>{e(e=>({sectionStates:{...e.sectionStates,[t]:"dirty"}}))},markSectionClean:t=>{e(e=>({sectionStates:{...e.sectionStates,[t]:"idle"}}))},resetSectionState:t=>{e(e=>({sectionStates:{...e.sectionStates,[t]:"idle"}}))},isSectionDirty:e=>"dirty"===t().sectionStates[e]}),{name:"ProfileStore"}));var u=e.i(57688),h=e.i(75254);let m=(0,h.default)("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]);var p=e.i(37727);let x=(0,h.default)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);var f=e.i(44212),g=e.i(57022);let y=["image/jpeg","image/jpg","image/png","image/webp"],j=5,v=({currentPhotoUrl:e,onUpload:s,onDelete:a,maxSizeMB:i=j,acceptedFormats:l=y,isLoading:o=!1,error:n})=>{let c=(0,r.useRef)(null),[d,h]=(0,r.useState)(!1),[v,b]=(0,r.useState)(""),C=()=>l.map(e=>e.replace("image/","").toUpperCase()).join(", "),S=(0,r.useCallback)(async e=>{e&&(((b(""),l.includes(e.type))?e.size/1048576>i&&(b(`File size exceeds ${i}MB`),1):(b(`Only ${C()} images are allowed`),1))||await s(e))},[s,i,l]),N=()=>{c.current?.click()},w=async()=>{o||await a()},P=n||v;return(0,t.jsxs)("div",{className:"space-y-4",children:[e&&(0,t.jsxs)("div",{className:"relative flex flex-col items-center space-y-4",children:[(0,t.jsx)("div",{className:"relative h-32 w-32 overflow-hidden rounded-full border-4 border-border",children:(0,t.jsx)(u.default,{src:e,alt:"Current profile photo",fill:!0,className:"object-cover",sizes:"128px"})}),(0,t.jsxs)(f.Button,{type:"button",variant:"destructive",size:"sm",onClick:w,disabled:o,"aria-label":"Delete photo",children:[(0,t.jsx)(p.X,{className:"mr-2 h-4 w-4"}),"Delete Photo"]})]}),!e&&(0,t.jsxs)("div",{className:(0,g.cn)("relative flex flex-col items-center justify-center rounded-lg border-2 border-dashed p-8 transition-colors",d&&"border-primary bg-primary/5",!d&&"border-border hover:border-primary/50",o&&"pointer-events-none opacity-50"),onDragOver:e=>{e.preventDefault(),e.stopPropagation(),h(!0)},onDragLeave:e=>{e.preventDefault(),e.stopPropagation(),h(!1)},onDrop:e=>{e.preventDefault(),e.stopPropagation(),h(!1);let t=e.dataTransfer.files?.[0];t&&S(t)},onClick:N,role:"button",tabIndex:0,onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&N()},children:[(0,t.jsx)("input",{ref:c,type:"file",accept:l.join(","),onChange:e=>{let t=e.target.files?.[0];t&&S(t),c.current&&(c.current.value="")},className:"hidden",disabled:o,"aria-label":"Upload profile photo"}),o?(0,t.jsxs)("div",{className:"flex flex-col items-center space-y-2",role:"status","aria-live":"polite",children:[(0,t.jsx)(x,{className:"h-12 w-12 animate-spin text-primary"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Uploading..."})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(m,{className:"mb-4 h-12 w-12 text-muted-foreground"}),(0,t.jsx)("p",{className:"mb-2 text-sm font-medium text-foreground",children:"Upload Photo"}),(0,t.jsx)("p",{className:"mb-1 text-xs text-muted-foreground",children:"Drag and drop or click to select"}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:[C()," (Max ",i,"MB)"]})]})]}),P&&(0,t.jsx)("div",{className:"rounded-md bg-destructive/10 p-3",children:(0,t.jsx)("p",{className:"text-sm text-destructive",children:P})})]})};var b=e.i(21065);function C(){let{user:e,isAuthenticated:r}=(0,a.useAuthStore)(),{profile:s,error:i,sectionStates:l,uploadPhoto:o,deletePhoto:n}=d();if(!r||!e)return null;let c=s?.profilePhotoUrl||null,u="saving"===l.photo,h="error"===l.photo?i:null,m=async t=>{await o(e.userId,t)},p=async()=>{await n(e.userId)};return(0,t.jsx)("section",{role:"region","aria-labelledby":"profile-photo-heading",children:(0,t.jsxs)(b.Card,{children:[(0,t.jsxs)(b.CardHeader,{children:[(0,t.jsx)(b.CardTitle,{id:"profile-photo-heading",style:{color:"#8B1538"},children:"Profile Photo"}),(0,t.jsx)(b.CardDescription,{children:"Upload a photo to personalize your profile and help others recognize you"})]}),(0,t.jsx)(b.CardContent,{children:(0,t.jsx)(v,{currentPhotoUrl:c,onUpload:m,onDelete:p,isLoading:u,error:h||void 0,maxSizeMB:5,acceptedFormats:["image/jpeg","image/jpg","image/png","image/webp"]})})]})})}var S=e.i(75244);let N=[{code:"SL_CUISINE",name:"Sri Lankan Cuisine"},{code:"BUDDHIST_FEST",name:"Buddhist Festivals & Traditions"},{code:"HINDU_FEST",name:"Hindu Festivals & Traditions"},{code:"ISLAMIC_FEST",name:"Islamic Festivals & Traditions"},{code:"CHRISTIAN_FEST",name:"Christian Festivals & Traditions"},{code:"TRAD_DANCE",name:"Traditional Dance (Kandyan, Sabaragamuwa, Low Country)"},{code:"CRICKET",name:"Cricket & Sports"},{code:"AYURVEDA",name:"Ayurvedic Medicine & Wellness"},{code:"SINHALA_MUSIC",name:"Sinhala Music & Arts"},{code:"TAMIL_MUSIC",name:"Tamil Music & Arts"},{code:"VESAK",name:"Vesak & Poson Celebrations"},{code:"SINHALA_NY",name:"Sinhala & Tamil New Year (Aluth Avurudda)"},{code:"TEA_CULTURE",name:"Ceylon Tea Culture"},{code:"TRAD_ARTS",name:"Traditional Arts & Crafts (Masks, Batik, Pottery)"},{code:"SL_WEDDINGS",name:"Sri Lankan Wedding Traditions"},{code:"TEMPLE_ARCH",name:"Temple Architecture & Heritage Sites"},{code:"SL_LITERATURE",name:"Sinhala/Tamil Literature & Poetry"},{code:"TRAD_GAMES",name:"Traditional Games (Elle, Ankeliya)"},{code:"SL_FASHION",name:"Traditional Dress & Fashion (Saree, Sarong)"},{code:"DIASPORA_NET",name:"Diaspora Community & Networking"}],w=100,P=100,A=20,F=100,k=10,I={min:0,max:20};var T=e.i(43531),B=e.i(46897);function L(){let{user:e,isAuthenticated:s}=(0,a.useAuthStore)(),{profile:i,error:l,sectionStates:o,updateLocation:n}=d(),[c,u]=(0,r.useState)(!1),[h,m]=(0,r.useState)({city:"",state:"",zipCode:"",country:""}),[p,x]=(0,r.useState)({});if(!s||!e)return null;let g=i?.location,y="saving"===o.location,j="success"===o.location,v="error"===o.location,C=async()=>{let t;if(t={},h.city.trim()?h.city.length>w&&(t.city=`City cannot exceed ${w} characters`):t.city="City is required",h.state.trim()?h.state.length>P&&(t.state=`State cannot exceed ${P} characters`):t.state="State is required",h.zipCode.trim()?h.zipCode.length>A&&(t.zipCode=`Zip code cannot exceed ${A} characters`):t.zipCode="Zip code is required",h.country.trim()?h.country.length>F&&(t.country=`Country cannot exceed ${F} characters`):t.country="Country is required",x(t),0===Object.keys(t).length)try{await n(e.userId,{city:h.city.trim(),state:h.state.trim(),zipCode:h.zipCode.trim(),country:h.country.trim()}),u(!1)}catch(e){}},N=(e,t)=>{m(r=>({...r,[e]:t})),p[e]&&x(t=>{let r={...t};return delete r[e],r})};return(0,t.jsx)("section",{role:"region","aria-labelledby":"location-heading",children:(0,t.jsxs)(b.Card,{children:[(0,t.jsxs)(b.CardHeader,{children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(B.MapPin,{className:"h-5 w-5",style:{color:"#FF7900"}}),(0,t.jsx)(b.CardTitle,{id:"location-heading",style:{color:"#8B1538"},children:"Location"})]}),!c&&(0,t.jsx)(f.Button,{onClick:()=>{m({city:g?.city||"",state:g?.state||"",zipCode:g?.zipCode||"",country:g?.country||""}),x({}),u(!0)},variant:"outline",size:"sm",disabled:y,style:{borderColor:"#FF7900",color:"#8B1538"},children:"Edit"})]}),(0,t.jsx)(b.CardDescription,{children:"Help others in the community find you by sharing your location"})]}),(0,t.jsx)(b.CardContent,{children:c?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"city",className:"block text-sm font-medium mb-1",children:"City *"}),(0,t.jsx)(S.Input,{id:"city",type:"text",value:h.city,onChange:e=>N("city",e.target.value),placeholder:"e.g., Toronto",disabled:y,error:!!p.city,"aria-label":"City","aria-invalid":!!p.city,"aria-describedby":p.city?"city-error":void 0,maxLength:w}),p.city&&(0,t.jsx)("p",{id:"city-error",className:"text-sm text-destructive mt-1",role:"alert",children:p.city})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"state",className:"block text-sm font-medium mb-1",children:"State/Province *"}),(0,t.jsx)(S.Input,{id:"state",type:"text",value:h.state,onChange:e=>N("state",e.target.value),placeholder:"e.g., Ontario",disabled:y,error:!!p.state,"aria-label":"State/Province","aria-invalid":!!p.state,"aria-describedby":p.state?"state-error":void 0,maxLength:P}),p.state&&(0,t.jsx)("p",{id:"state-error",className:"text-sm text-destructive mt-1",role:"alert",children:p.state})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"zipCode",className:"block text-sm font-medium mb-1",children:"Zip/Postal Code *"}),(0,t.jsx)(S.Input,{id:"zipCode",type:"text",value:h.zipCode,onChange:e=>N("zipCode",e.target.value),placeholder:"e.g., M5H 2N2",disabled:y,error:!!p.zipCode,"aria-label":"Zip/Postal Code","aria-invalid":!!p.zipCode,"aria-describedby":p.zipCode?"zipCode-error":void 0,maxLength:A}),p.zipCode&&(0,t.jsx)("p",{id:"zipCode-error",className:"text-sm text-destructive mt-1",role:"alert",children:p.zipCode})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"country",className:"block text-sm font-medium mb-1",children:"Country *"}),(0,t.jsx)(S.Input,{id:"country",type:"text",value:h.country,onChange:e=>N("country",e.target.value),placeholder:"e.g., Canada",disabled:y,error:!!p.country,"aria-label":"Country","aria-invalid":!!p.country,"aria-describedby":p.country?"country-error":void 0,maxLength:F}),p.country&&(0,t.jsx)("p",{id:"country-error",className:"text-sm text-destructive mt-1",role:"alert",children:p.country})]}),v&&l&&(0,t.jsx)("p",{className:"text-sm text-destructive",role:"alert",children:l}),(0,t.jsxs)("div",{className:"flex gap-3 pt-2",children:[(0,t.jsx)(f.Button,{onClick:C,disabled:y,className:"flex-1 text-white",style:{background:"#FF7900"},children:y?"Saving...":"Save Location"}),(0,t.jsx)(f.Button,{onClick:()=>{u(!1),x({})},variant:"outline",disabled:y,className:"flex-1",style:{borderColor:"#8B1538",color:"#8B1538"},children:"Cancel"})]})]}):(0,t.jsxs)("div",{className:"space-y-2",children:[g?(0,t.jsxs)("div",{className:"text-sm",children:[(0,t.jsxs)("p",{className:"font-medium text-foreground",children:[g.city,", ",g.state," ",g.zipCode]}),(0,t.jsx)("p",{className:"text-muted-foreground",children:g.country})]}):(0,t.jsx)("p",{className:"text-sm text-muted-foreground italic",children:"Not set - Click Edit to add your location"}),j&&(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm",style:{color:"#006400"},children:[(0,t.jsx)(T.Check,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:"Location saved successfully!"})]}),v&&l&&(0,t.jsx)("p",{className:"text-sm text-destructive",role:"alert",children:l})]})})]})})}let M=(0,h.default)("heart",[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]]);function E(){let{user:e,isAuthenticated:s}=(0,a.useAuthStore)(),{profile:i,error:l,sectionStates:o,updateCulturalInterests:n}=d(),[c,u]=(0,r.useState)(!1),[h,m]=(0,r.useState)([]),[p,x]=(0,r.useState)("");if(!s||!e)return null;let g=i?.culturalInterests||[],y="saving"===o.culturalInterests,j="success"===o.culturalInterests,v="error"===o.culturalInterests,C=async()=>{if(h.length>k)return void x(`Maximum ${k} interests allowed`);try{await n(e.userId,{InterestCodes:h}),u(!1)}catch(e){}};return(0,t.jsx)("section",{role:"region","aria-labelledby":"cultural-interests-heading",children:(0,t.jsxs)(b.Card,{children:[(0,t.jsxs)(b.CardHeader,{children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(M,{className:"h-5 w-5",style:{color:"#FF7900"}}),(0,t.jsx)(b.CardTitle,{id:"cultural-interests-heading",style:{color:"#8B1538"},children:"Cultural Interests"})]}),!c&&(0,t.jsx)(f.Button,{onClick:()=>{m([...g]),x(""),u(!0)},variant:"outline",size:"sm",disabled:y,style:{borderColor:"#FF7900",color:"#8B1538"},children:"Edit"})]}),(0,t.jsxs)(b.CardDescription,{children:["Share your cultural interests to connect with others (select 0-",k,")"]})]}),(0,t.jsx)(b.CardContent,{children:c?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:N.map(e=>{let r=h.includes(e.code);return(0,t.jsxs)("label",{className:`flex items-start gap-3 p-3 rounded-lg border cursor-pointer transition-colors ${y?"opacity-50 cursor-not-allowed":""}`,style:{background:r?"#FFE8CC":"white",borderColor:r?"#FF7900":"#e2e8f0"},children:[(0,t.jsx)("input",{type:"checkbox",checked:r,onChange:()=>{var t;return t=e.code,void m(e=>e.includes(t)?e.filter(e=>e!==t):e.length>=k?(x(`You can select up to ${k} interests`),e):(x(""),[...e,t]))},disabled:y,className:"mt-1 h-4 w-4 rounded border-gray-300 text-primary focus:ring-primary","aria-label":e.name}),(0,t.jsx)("span",{className:"text-sm flex-1",children:e.name})]},e.code)})}),(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:[h.length," of ",k," selected"]}),p&&(0,t.jsx)("p",{className:"text-sm text-destructive",role:"alert",children:p}),v&&l&&(0,t.jsx)("p",{className:"text-sm text-destructive",role:"alert",children:l}),(0,t.jsxs)("div",{className:"flex gap-3 pt-2",children:[(0,t.jsx)(f.Button,{onClick:C,disabled:y,className:"flex-1 text-white",style:{background:"#FF7900"},children:y?"Saving...":"Save Interests"}),(0,t.jsx)(f.Button,{onClick:()=>{u(!1),x("")},variant:"outline",disabled:y,className:"flex-1",style:{borderColor:"#8B1538",color:"#8B1538"},children:"Cancel"})]})]}):(0,t.jsxs)("div",{className:"space-y-2",children:[g.length>0?(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:g.map(e=>{let r=N.find(t=>t.code===e);return r?(0,t.jsx)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium",style:{background:"#FFE8CC",color:"#8B1538"},children:r.name},e):null})}):(0,t.jsx)("p",{className:"text-sm text-muted-foreground italic",children:"No interests selected - Click Edit to add your cultural interests"}),j&&(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm",style:{color:"#006400"},children:[(0,t.jsx)(T.Check,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:"Cultural interests saved successfully!"})]}),v&&l&&(0,t.jsx)("p",{className:"text-sm text-destructive",role:"alert",children:l})]})})]})})}var z=e.i(71547),D=e.i(74736),$=e.i(24877),U=e.i(12598),H=e.i(97353);function R(){let{user:e}=(0,a.useAuthStore)(),{profile:s,updatePreferredMetroAreas:i,sectionStates:l,error:o,isLoading:n}=d(),c=(0,U.useQueryClient)(),{metroAreas:u,metroAreasByState:h,stateLevelMetros:m,isLoading:p,error:x}=(0,D.useMetroAreas)(),[g,y]=(0,r.useState)(!1),[j,v]=(0,r.useState)([]),[C,S]=(0,r.useState)(""),N=l.preferredMetroAreas,w=n||"saving"===N,P=s?.preferredMetroAreas||[],{max:A}=I,F=(0,r.useMemo)(()=>{let e=[];return $.US_STATES.forEach(t=>{let r=h.get(t.code)||[];if(0===r.length)return;let s=r.find(e=>e.isStateLevelArea),a=r.filter(e=>!e.isStateLevelArea),i=[];s&&i.push({id:s.id,label:s.name,checked:j.includes(s.id)}),a.forEach(e=>{i.push({id:e.id,label:e.name,checked:j.includes(e.id)})}),e.push({id:t.code,label:t.name,checked:!1,children:i})}),e},[h,m,j]);if(!e)return null;if(p)return(0,t.jsxs)(b.Card,{role:"region","aria-label":"Preferred Metro Areas",children:[(0,t.jsxs)(b.CardHeader,{children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(B.MapPin,{className:"h-5 w-5",style:{color:"#FF7900"}}),(0,t.jsx)(b.CardTitle,{style:{color:"#8B1538"},children:"Preferred Metro Areas"})]}),(0,t.jsx)(b.CardDescription,{children:"Loading metro areas..."})]}),(0,t.jsx)(b.CardContent,{children:(0,t.jsx)("div",{className:"flex items-center justify-center p-4",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2",style:{borderColor:"#FF7900"}})})})]});if(x)return(0,t.jsxs)(b.Card,{role:"region","aria-label":"Preferred Metro Areas",children:[(0,t.jsx)(b.CardHeader,{children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(B.MapPin,{className:"h-5 w-5",style:{color:"#FF7900"}}),(0,t.jsx)(b.CardTitle,{style:{color:"#8B1538"},children:"Preferred Metro Areas"})]})}),(0,t.jsx)(b.CardContent,{children:(0,t.jsxs)("p",{className:"text-sm text-destructive",role:"alert",children:["Failed to load metro areas: ",x]})})]});let k=async()=>{if(e?.userId){console.log("=== DEBUG: Attempting to save metro areas ==="),console.log("Selected IDs:",j),console.log("Selected Count:",j.length),j.forEach(e=>{let t=L(e);console.log(`  - ${e}: ${t?`${t.name}, ${t.state}`:"NOT FOUND IN LOCAL DATA"}`)});try{await i(e.userId,{MetroAreaIds:j}),console.log("✅ Save successful"),c.invalidateQueries({queryKey:H.eventKeys.featured(e.userId)}),console.log("✅ Featured events cache invalidated"),y(!1),S("")}catch(e){console.error("❌ Save failed:",e)}}},L=e=>u.find(t=>t.id===e);return(0,t.jsxs)(b.Card,{role:"region","aria-label":"Preferred Metro Areas",children:[(0,t.jsxs)(b.CardHeader,{children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(B.MapPin,{className:"h-5 w-5",style:{color:"#FF7900"}}),(0,t.jsx)(b.CardTitle,{style:{color:"#8B1538"},children:"Preferred Metro Areas"})]}),!g&&(0,t.jsx)(f.Button,{variant:"outline",size:"sm",onClick:()=>{y(!0),v([...P]),S("")},disabled:w,style:{borderColor:"#FF7900",color:"#8B1538"},children:"Edit"})]}),(0,t.jsxs)(b.CardDescription,{children:["Select up to ",A," metro areas for personalized event and content filtering. You can opt out by leaving this empty."]})]}),(0,t.jsx)(b.CardContent,{children:g?(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground mb-2",children:"Select metro areas by expanding states and checking your preferred locations"}),(0,t.jsx)(z.TreeDropdown,{nodes:F,selectedIds:j,onSelectionChange:e=>{e.length>A?S(`You cannot select more than ${A} metro areas`):(S(""),v(e))},placeholder:`Select up to ${A} metro areas`,maxSelections:A,disabled:w,className:"w-full"}),(0,t.jsxs)("div",{className:"flex items-center justify-between pt-2 border-t",style:{borderColor:"#e2e8f0"},children:[(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:[j.length," of ",A," selected"]}),C&&(0,t.jsx)("p",{className:"text-sm text-destructive",role:"alert",children:C})]}),(0,t.jsxs)("div",{className:"flex gap-3 pt-2",children:[(0,t.jsx)(f.Button,{onClick:k,disabled:w||!!C,className:"flex-1 text-white",style:{background:"#FF7900"},children:w?"Saving...":"Save Changes"}),(0,t.jsx)(f.Button,{onClick:()=>{y(!1),v([]),S("")},variant:"outline",disabled:w,className:"flex-1",style:{borderColor:"#8B1538",color:"#8B1538"},children:"Cancel"})]})]}):(0,t.jsxs)("div",{className:"space-y-2",children:[P.length>0?(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:P.map(e=>{let r,s=L(e);return s?(0,t.jsxs)("div",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium",style:{background:"#FFE8CC",color:"#8B1538"},children:[s.name,(r=L(e),!r?.isStateLevelArea&&`, ${s.state}`)]},e):null})}):(0,t.jsx)("p",{className:"text-sm text-muted-foreground italic",children:"No metro areas selected - Click Edit to add your preferred locations"}),"success"===N&&(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm",style:{color:"#006400"},children:[(0,t.jsx)(T.Check,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:"Preferred metro areas saved successfully!"})]}),"error"===N&&o&&(0,t.jsx)("p",{className:"text-sm text-destructive",role:"alert",children:o})]})})]})}var _=e.i(74063),O=e.i(18566),K=e.i(42490),q=e.i(71689),Y=e.i(79574);function G(){let e=(0,O.useRouter)(),{user:i,clearAuth:l,isAuthenticated:o,isLoading:n}=(0,a.useAuthStore)(),{loadProfile:c,profile:u,isLoading:h}=d();(0,r.useEffect)(()=>{o&&i?.userId&&!u&&!h&&c(i.userId)},[o,i?.userId,u,h,c]);let m=async()=>{try{await K.authRepository.logout()}catch(e){}finally{l(),e.push("/login")}};return(0,t.jsx)(s.ProtectedRoute,{children:(0,t.jsxs)("div",{className:"min-h-screen",style:{background:"#f7fafc"},children:[(0,t.jsx)("header",{className:"bg-white border-b sticky top-0 z-40",style:{background:"rgba(255, 255, 255, 0.95)",backdropFilter:"blur(10px)",boxShadow:"0 2px 20px rgba(0,0,0,0.1)"},children:(0,t.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)(_.OfficialLogo,{size:"md"}),(0,t.jsx)("div",{className:"h-6 w-px bg-gray-300"}),(0,t.jsx)("h1",{className:"text-2xl font-bold",style:{color:"#8B1538"},children:"My Profile"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsxs)(f.Button,{onClick:()=>{e.push("/dashboard")},variant:"outline",size:"sm",style:{borderColor:"#FF7900",color:"#8B1538"},children:[(0,t.jsx)(q.ArrowLeft,{className:"w-4 h-4 mr-2"}),"Dashboard"]}),(0,t.jsx)(f.Button,{onClick:m,variant:"outline",size:"sm",style:{borderColor:"#8B1538",color:"#8B1538"},children:"Logout"})]})]})})}),(0,t.jsx)("main",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)("div",{className:"rounded-xl overflow-hidden",style:{background:"white",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.05)"},children:(0,t.jsx)("div",{className:"p-6",style:{background:"linear-gradient(135deg, #FF7900 0%, #8B1538 50%, #006400 100%)",color:"white"},children:(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("div",{className:"w-16 h-16 rounded-full flex items-center justify-center text-white font-bold text-xl",style:{background:"rgba(255, 255, 255, 0.2)"},children:(i?.fullName||"U").split(" ").map(e=>e[0]).join("").toUpperCase()}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("h2",{className:"text-2xl font-semibold mb-1",children:["Welcome, ",i?.fullName,"!"]}),(0,t.jsx)("p",{className:"text-white/90",children:"Manage your profile information to help others in the Sri Lankan community connect with you."})]})]})})}),(0,t.jsx)(C,{}),(0,t.jsx)(L,{}),(0,t.jsx)(E,{}),(0,t.jsx)(R,{}),h&&(0,t.jsx)("div",{className:"bg-white rounded-xl shadow p-6 text-center",children:(0,t.jsxs)("div",{className:"flex items-center justify-center gap-3",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2",style:{borderColor:"#FF7900"}}),(0,t.jsx)("p",{style:{color:"#8B1538"},children:"Loading profile..."})]})})]})}),(0,t.jsx)(Y.default,{})]})})}e.s(["default",()=>G],60572)}]);