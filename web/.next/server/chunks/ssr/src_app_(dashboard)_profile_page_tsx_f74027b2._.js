module.exports=[43827,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(72493),e=a.i(72988),f=a.i(20226),g=a.i(62435),h=a.i(64668);let i=new class{basePath="/users";async getProfile(a){return await h.apiClient.get(`${this.basePath}/${a}`)}async uploadProfilePhoto(a,b){let c=new FormData;return c.append("file",b),await h.apiClient.postMultipart(`${this.basePath}/${a}/profile-photo`,c)}async deleteProfilePhoto(a){return await h.apiClient.delete(`${this.basePath}/${a}/profile-photo`)}async updateLocation(a,b){return await h.apiClient.put(`${this.basePath}/${a}/location`,b)}async updateCulturalInterests(a,b){return await h.apiClient.put(`${this.basePath}/${a}/cultural-interests`,b)}async updateLanguages(a,b){return await h.apiClient.put(`${this.basePath}/${a}/languages`,b)}async updateBasicInfo(a,b){return await h.apiClient.put(`${this.basePath}/${a}`,b)}},j={photo:"idle",basicInfo:"idle",location:"idle",culturalInterests:"idle",languages:"idle"},k=(0,f.create)()((0,g.devtools)((a,b)=>({profile:null,originalProfile:null,isLoading:!1,error:null,sectionStates:{...j},setProfile:b=>{a({profile:b,originalProfile:JSON.parse(JSON.stringify(b)),error:null})},loadProfile:async c=>{a({isLoading:!0,error:null});try{let a=await i.getProfile(c);b().setProfile(a)}catch(b){a({error:b instanceof Error?b.message:"Failed to load profile",profile:null,originalProfile:null})}finally{a({isLoading:!1})}},clearProfile:()=>{a({profile:null,originalProfile:null,isLoading:!1,error:null,sectionStates:{...j}})},uploadPhoto:async(b,c)=>{a(a=>({sectionStates:{...a.sectionStates,photo:"saving"},error:null}));try{let d=await i.uploadProfilePhoto(b,c);a(a=>({profile:a.profile?{...a.profile,profilePhotoUrl:d.profilePhotoUrl}:null,originalProfile:a.originalProfile?{...a.originalProfile,profilePhotoUrl:d.profilePhotoUrl}:null,sectionStates:{...a.sectionStates,photo:"success"}})),setTimeout(()=>{a(a=>({sectionStates:{...a.sectionStates,photo:"idle"}}))},2e3)}catch(c){let b=c instanceof Error?c.message:"Failed to upload photo";a(a=>({error:b,sectionStates:{...a.sectionStates,photo:"error"}}))}},deletePhoto:async b=>{a(a=>({sectionStates:{...a.sectionStates,photo:"saving"},error:null}));try{await i.deleteProfilePhoto(b),a(a=>({profile:a.profile?{...a.profile,profilePhotoUrl:null}:null,originalProfile:a.originalProfile?{...a.originalProfile,profilePhotoUrl:null}:null,sectionStates:{...a.sectionStates,photo:"success"}})),setTimeout(()=>{a(a=>({sectionStates:{...a.sectionStates,photo:"idle"}}))},2e3)}catch(c){let b=c instanceof Error?c.message:"Failed to delete photo";a(a=>({error:b,sectionStates:{...a.sectionStates,photo:"error"}}))}},updateBasicInfo:async(c,d)=>{a(a=>({sectionStates:{...a.sectionStates,basicInfo:"saving"},error:null}));try{let e=await i.updateBasicInfo(c,d);b().setProfile(e),a(a=>({sectionStates:{...a.sectionStates,basicInfo:"success"}})),setTimeout(()=>{a(a=>({sectionStates:{...a.sectionStates,basicInfo:"idle"}}))},2e3)}catch(c){let b=c instanceof Error?c.message:"Failed to update basic info";a(a=>({error:b,sectionStates:{...a.sectionStates,basicInfo:"error"}}))}},updateLocation:async(c,d)=>{a(a=>({sectionStates:{...a.sectionStates,location:"saving"},error:null}));try{let e=await i.updateLocation(c,d);b().setProfile(e),a(a=>({sectionStates:{...a.sectionStates,location:"success"}})),setTimeout(()=>{a(a=>({sectionStates:{...a.sectionStates,location:"idle"}}))},2e3)}catch(c){let b=c instanceof Error?c.message:"Failed to update location";a(a=>({error:b,sectionStates:{...a.sectionStates,location:"error"}}))}},updateCulturalInterests:async(c,d)=>{a(a=>({sectionStates:{...a.sectionStates,culturalInterests:"saving"},error:null}));try{let e=await i.updateCulturalInterests(c,d);b().setProfile(e),a(a=>({sectionStates:{...a.sectionStates,culturalInterests:"success"}})),setTimeout(()=>{a(a=>({sectionStates:{...a.sectionStates,culturalInterests:"idle"}}))},2e3)}catch(c){let b=c instanceof Error?c.message:"Failed to update cultural interests";a(a=>({error:b,sectionStates:{...a.sectionStates,culturalInterests:"error"}}))}},updateLanguages:async(c,d)=>{a(a=>({sectionStates:{...a.sectionStates,languages:"saving"},error:null}));try{let e=await i.updateLanguages(c,d);b().setProfile(e),a(a=>({sectionStates:{...a.sectionStates,languages:"success"}})),setTimeout(()=>{a(a=>({sectionStates:{...a.sectionStates,languages:"idle"}}))},2e3)}catch(c){let b=c instanceof Error?c.message:"Failed to update languages";a(a=>({error:b,sectionStates:{...a.sectionStates,languages:"error"}}))}},markSectionDirty:b=>{a(a=>({sectionStates:{...a.sectionStates,[b]:"dirty"}}))},markSectionClean:b=>{a(a=>({sectionStates:{...a.sectionStates,[b]:"idle"}}))},resetSectionState:b=>{a(a=>({sectionStates:{...a.sectionStates,[b]:"idle"}}))},isSectionDirty:a=>"dirty"===b().sectionStates[a]}),{name:"ProfileStore"}));var l=a.i(71987);let m=a=>{let b=a.replace(/^([A-Z])|[\s-_]+(\w)/g,(a,b,c)=>c?c.toUpperCase():b.toLowerCase());return b.charAt(0).toUpperCase()+b.slice(1)},n=(...a)=>a.filter((a,b,c)=>!!a&&""!==a.trim()&&c.indexOf(a)===b).join(" ").trim();var o={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let p=(0,c.forwardRef)(({color:a="currentColor",size:b=24,strokeWidth:d=2,absoluteStrokeWidth:e,className:f="",children:g,iconNode:h,...i},j)=>(0,c.createElement)("svg",{ref:j,...o,width:b,height:b,stroke:a,strokeWidth:e?24*Number(d)/Number(b):d,className:n("lucide",f),...!g&&!(a=>{for(let b in a)if(b.startsWith("aria-")||"role"===b||"title"===b)return!0})(i)&&{"aria-hidden":"true"},...i},[...h.map(([a,b])=>(0,c.createElement)(a,b)),...Array.isArray(g)?g:[g]])),q=(a,b)=>{let d=(0,c.forwardRef)(({className:d,...e},f)=>(0,c.createElement)(p,{ref:f,iconNode:b,className:n(`lucide-${m(a).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${a}`,d),...e}));return d.displayName=m(a),d},r=q("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]),s=q("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),t=q("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);var u=a.i(42043),v=a.i(18203);let w=["image/jpeg","image/jpg","image/png","image/webp"],x=5,y=({currentPhotoUrl:a,onUpload:d,onDelete:e,maxSizeMB:f=x,acceptedFormats:g=w,isLoading:h=!1,error:i})=>{let j=(0,c.useRef)(null),[k,m]=(0,c.useState)(!1),[n,o]=(0,c.useState)(""),p=()=>g.map(a=>a.replace("image/","").toUpperCase()).join(", "),q=(0,c.useCallback)(async a=>{a&&(((o(""),g.includes(a.type))?a.size/1048576>f&&(o(`File size exceeds ${f}MB`),1):(o(`Only ${p()} images are allowed`),1))||await d(a))},[d,f,g]),y=()=>{j.current?.click()},z=async()=>{h||await e()},A=i||n;return(0,b.jsxs)("div",{className:"space-y-4",children:[a&&(0,b.jsxs)("div",{className:"relative flex flex-col items-center space-y-4",children:[(0,b.jsx)("div",{className:"relative h-32 w-32 overflow-hidden rounded-full border-4 border-border",children:(0,b.jsx)(l.default,{src:a,alt:"Current profile photo",fill:!0,className:"object-cover",sizes:"128px"})}),(0,b.jsxs)(u.Button,{type:"button",variant:"destructive",size:"sm",onClick:z,disabled:h,"aria-label":"Delete photo",children:[(0,b.jsx)(s,{className:"mr-2 h-4 w-4"}),"Delete Photo"]})]}),!a&&(0,b.jsxs)("div",{className:(0,v.cn)("relative flex flex-col items-center justify-center rounded-lg border-2 border-dashed p-8 transition-colors",k&&"border-primary bg-primary/5",!k&&"border-border hover:border-primary/50",h&&"pointer-events-none opacity-50"),onDragOver:a=>{a.preventDefault(),a.stopPropagation(),m(!0)},onDragLeave:a=>{a.preventDefault(),a.stopPropagation(),m(!1)},onDrop:a=>{a.preventDefault(),a.stopPropagation(),m(!1);let b=a.dataTransfer.files?.[0];b&&q(b)},onClick:y,role:"button",tabIndex:0,onKeyDown:a=>{("Enter"===a.key||" "===a.key)&&y()},children:[(0,b.jsx)("input",{ref:j,type:"file",accept:g.join(","),onChange:a=>{let b=a.target.files?.[0];b&&q(b),j.current&&(j.current.value="")},className:"hidden",disabled:h,"aria-label":"Upload profile photo"}),h?(0,b.jsxs)("div",{className:"flex flex-col items-center space-y-2",role:"status","aria-live":"polite",children:[(0,b.jsx)(t,{className:"h-12 w-12 animate-spin text-primary"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Uploading..."})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(r,{className:"mb-4 h-12 w-12 text-muted-foreground"}),(0,b.jsx)("p",{className:"mb-2 text-sm font-medium text-foreground",children:"Upload Photo"}),(0,b.jsx)("p",{className:"mb-1 text-xs text-muted-foreground",children:"Drag and drop or click to select"}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:[p()," (Max ",f,"MB)"]})]})]}),A&&(0,b.jsx)("div",{className:"rounded-md bg-destructive/10 p-3",children:(0,b.jsx)("p",{className:"text-sm text-destructive",children:A})})]})};var z=a.i(50253);function A(){let{user:a,isAuthenticated:c}=(0,e.useAuthStore)(),{profile:d,error:f,sectionStates:g,uploadPhoto:h,deletePhoto:i}=k();if(!c||!a)return null;let j=d?.profilePhotoUrl||null,l="saving"===g.photo,m="error"===g.photo?f:null,n=async b=>{await h(a.userId,b)},o=async()=>{await i(a.userId)};return(0,b.jsx)("section",{role:"region","aria-labelledby":"profile-photo-heading",children:(0,b.jsxs)(z.Card,{children:[(0,b.jsxs)(z.CardHeader,{children:[(0,b.jsx)(z.CardTitle,{id:"profile-photo-heading",children:"Profile Photo"}),(0,b.jsx)(z.CardDescription,{children:"Upload a photo to personalize your profile and help others recognize you"})]}),(0,b.jsx)(z.CardContent,{children:(0,b.jsx)(y,{currentPhotoUrl:j,onUpload:n,onDelete:o,isLoading:l,error:m||void 0,maxSizeMB:5,acceptedFormats:["image/jpeg","image/jpg","image/png","image/webp"]})})]})})}var B=a.i(50944),C=a.i(43061);function D(){let a=(0,B.useRouter)(),{user:f,clearAuth:g}=(0,e.useAuthStore)(),{loadProfile:h,profile:i,isLoading:j}=k();(0,c.useEffect)(()=>{f?.userId&&!i&&h(f.userId)},[f?.userId,i,h]);let l=async()=>{try{await C.authRepository.logout()}catch(a){console.error("Logout error:",a)}finally{g(),a.push("/login")}};return(0,b.jsx)(d.ProtectedRoute,{children:(0,b.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,b.jsx)("header",{className:"bg-white shadow",children:(0,b.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 flex justify-between items-center",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)(u.Button,{onClick:()=>{a.push("/dashboard")},variant:"outline",size:"sm",children:"â† Back to Dashboard"}),(0,b.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"My Profile"})]}),(0,b.jsx)(u.Button,{onClick:l,variant:"outline",children:"Logout"})]})}),(0,b.jsx)("main",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,b.jsxs)("h2",{className:"text-2xl font-semibold mb-2",children:["Welcome, ",f?.firstName," ",f?.lastName,"!"]}),(0,b.jsx)("p",{className:"text-gray-600",children:"Manage your profile information to help others in the Sri Lankan community connect with you."})]}),(0,b.jsx)(A,{}),j&&(0,b.jsx)("div",{className:"bg-white rounded-lg shadow p-6 text-center",children:(0,b.jsx)("p",{className:"text-gray-600",children:"Loading profile..."})})]})})]})})}a.s(["default",()=>D],43827)}];

//# sourceMappingURL=src_app_%28dashboard%29_profile_page_tsx_f74027b2._.js.map