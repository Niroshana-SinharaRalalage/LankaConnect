Build started 1/18/2026 7:57:50 PM.
     1>Project "c:\Work\LankaConnect\LankaConnect.sln" on node 1 (VSTest target(s)).
     1>ValidateSolutionConfiguration:
         Building solution configuration "Debug|Any CPU".
Test run for c:\Work\LankaConnect\tests\LankaConnect.Application.Tests\bin\Debug\net8.0\LankaConnect.Application.Tests.dll (.NETCoreApp,Version=v8.0)
Test run for c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\bin\Debug\net8.0\LankaConnect.IntegrationTests.dll (.NETCoreApp,Version=v8.0)
VSTest version 17.11.1 (x64)
VSTest version 17.11.1 (x64)


Starting test execution, please wait...Starting test execution, please wait...

A total of 1 test files matched the specified pattern.
A total of 1 test files matched the specified pattern.
[xUnit.net 00:00:00.01] xUnit.net VSTest Adapter v2.5.3.1+6b60a9e56a (64-bit .NET 8.0.23)
[xUnit.net 00:00:00.01] xUnit.net VSTest Adapter v2.5.3.1+6b60a9e56a (64-bit .NET 8.0.23)
[xUnit.net 00:00:00.52]   Discovering: LankaConnect.IntegrationTests
[xUnit.net 00:00:00.80]   Discovering: LankaConnect.Application.Tests
[xUnit.net 00:00:01.15]   Discovered:  LankaConnect.IntegrationTests
[xUnit.net 00:00:01.16]   Starting:    LankaConnect.IntegrationTests
[xUnit.net 00:00:01.85]   Discovered:  LankaConnect.Application.Tests
[xUnit.net 00:00:01.87]   Starting:    LankaConnect.Application.Tests
[CancelRegistration] EventId: 5bc7db65-37c1-400e-b37c-cd31c2a9a25c, UserId: b2f192bc-8ea9-4a91-a169-bf0baad2cf64
[CancelRegistration] Total registrations count: 5
[CancelRegistration] Registration: UserId=b2f192bc-8ea9-4a91-a169-bf0baad2cf64, Status=Confirmed, Match=True
[CancelRegistration] Registration: UserId=774166bf-68f3-4a36-801a-69723d3ced3a, Status=Confirmed, Match=False
[CancelRegistration] Registration: UserId=c03b59b0-4169-4db3-b31e-e242e1ecee99, Status=Confirmed, Match=False
[CancelRegistration] Registration: UserId=e3a0963d-8439-4a51-9b50-c01866aebfc7, Status=Confirmed, Match=False
[CancelRegistration] Registration: UserId=2eda97cb-1ecc-4164-8759-279ce5ca96f3, Status=Confirmed, Match=False
[CancelRegistration] Found registration: True
  Passed LankaConnect.Application.Tests.Events.Domain.EventWaitingListTests.RemoveFromWaitingList_WhenUserNotOnWaitingList_ShouldFail [95 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.RevenueBreakdownTests.Create_WithVariousPrices_ShouldCalculateCorrectPayout(price: 100, taxRate: 0.0725, expectedPayout: 88.37) [96 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.RevenueBreakdownTests.Create_WithVariousPrices_ShouldCalculateCorrectPayout(price: 25, taxRate: 0.08, expectedPayout: 21.71) [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.RevenueBreakdownTests.Create_WithVariousPrices_ShouldCalculateCorrectPayout(price: 10, taxRate: 0.07, expectedPayout: 8.59) [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.RevenueBreakdownTests.Create_WithVariousPrices_ShouldCalculateCorrectPayout(price: 50, taxRate: 0.065, expectedPayout: 44.35) [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventWaitingListTests.IsAtCapacity_WhenRegistrationsEqualCapacity_ShouldReturnTrue [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventWaitingListTests.AddToWaitingList_WhenUserAlreadyRegistered_ShouldFail [1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventWaitingListTests.AddToWaitingList_WhenEventHasCapacity_ShouldFail [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.RevenueBreakdownTests.Create_WithPriceTooLowForFees_ShouldFail [6 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.RevenueBreakdownTests.ValueObjectEquality_WithSameValues_ShouldBeEqual [12 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.RevenueBreakdownTests.Create_WithVariousRateCombinations_ShouldCalculateCorrectly(platformRate: 0.02, stripeFeeRate: 0.029, stripeFeeFixed: 0.3, expectedPayoutNoTax: 94.8) [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.RevenueBreakdownTests.Create_WithVariousRateCombinations_ShouldCalculateCorrectly(platformRate: 0.05, stripeFeeRate: 0.035, stripeFeeFixed: 0.5, expectedPayoutNoTax: 91) [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.RevenueBreakdownTests.Create_WithVariousRateCombinations_ShouldCalculateCorrectly(platformRate: 0, stripeFeeRate: 0, stripeFeeFixed: 0, expectedPayoutNoTax: 100) [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.RevenueBreakdownTests.Create_WithZeroPrice_ShouldReturnZeroBreakdown [2 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.RevenueBreakdownTests.Create_WithTaxRateOver50Percent_ShouldFail [< 1 ms]
[xUnit.net 00:00:02.51]     LankaConnect.IntegrationTests.Repositories.EmailRepositoryIntegrationTests.AllEmailRepositories_DependencyInjection_ShouldResolveWithoutErrors [FAIL]
[xUnit.net 00:00:02.51]       System.InvalidOperationException : Unable to resolve service for type 'MediatR.IPublisher' while attempting to activate 'LankaConnect.Infrastructure.Data.AppDbContext'.
[xUnit.net 00:00:02.51]       Stack Trace:
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.RevenueBreakdownTests.Create_WithNullGrossAmount_ShouldFail [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.RevenueBreakdownTests.ValueObjectEquality_WithDifferentValues_ShouldNotBeEqual [1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.RevenueBreakdownTests.Create_ShouldCalculate_TaxInclusivePricing_Correctly [1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.RevenueBreakdownTests.Create_WithDifferentCurrencies_ShouldPreserveCurrency [3 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.RevenueBreakdownTests.Create_WithCustomCommissionRates_ShouldUseProvidedRates [< 1 ms]
[xUnit.net 00:00:02.51]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateArgumentCallSites(ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain, ParameterInfo[] parameters, Boolean throwIfCallSiteNotFound)
[xUnit.net 00:00:02.51]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateConstructorCallSite(ResultCache lifetime, ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain)
[xUnit.net 00:00:02.51]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceDescriptor descriptor, ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain, Int32 slot)
[xUnit.net 00:00:02.52]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
[xUnit.net 00:00:02.52]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateCallSite(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
[xUnit.net 00:00:02.52]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.GetCallSite(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
[xUnit.net 00:00:02.52]            at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
[xUnit.net 00:00:02.52]            at System.Collections.Concurrent.ConcurrentDictionary`2.GetOrAdd(TKey key, Func`2 valueFactory)
[xUnit.net 00:00:02.52]            at Microsoft.Extensions.DependencyInjection.ServiceProvider.GetService(ServiceIdentifier serviceIdentifier, ServiceProviderEngineScope serviceProviderEngineScope)
[xUnit.net 00:00:02.52]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.GetService(Type serviceType)
[xUnit.net 00:00:02.52]            at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
[xUnit.net 00:00:02.52]            at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
[xUnit.net 00:00:02.52]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs(151,0): at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.EnsureDatabaseCreatedAsync()
[xUnit.net 00:00:02.52]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs(105,0): at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.InitializeAsync()
[xUnit.net 00:00:02.52]     LankaConnect.IntegrationTests.Repositories.EmailRepositoryIntegrationTests.EmailStatusRepository_CreateAndRetrieve_ShouldWork [FAIL]
[xUnit.net 00:00:02.52]       System.InvalidOperationException : Unable to resolve service for type 'MediatR.IPublisher' while attempting to activate 'LankaConnect.Infrastructure.Data.AppDbContext'.
[xUnit.net 00:00:02.52]       Stack Trace:
[xUnit.net 00:00:02.52]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateArgumentCallSites(ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain, ParameterInfo[] parameters, Boolean throwIfCallSiteNotFound)
[xUnit.net 00:00:02.52]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateConstructorCallSite(ResultCache lifetime, ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain)
[xUnit.net 00:00:02.52]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceDescriptor descriptor, ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain, Int32 slot)
[xUnit.net 00:00:02.52]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
[xUnit.net 00:00:02.52]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateCallSite(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
[xUnit.net 00:00:02.52]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.GetCallSite(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
[xUnit.net 00:00:02.52]            at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
[xUnit.net 00:00:02.52]            at System.Collections.Concurrent.ConcurrentDictionary`2.GetOrAdd(TKey key, Func`2 valueFactory)
[xUnit.net 00:00:02.52]            at Microsoft.Extensions.DependencyInjection.ServiceProvider.GetService(ServiceIdentifier serviceIdentifier, ServiceProviderEngineScope serviceProviderEngineScope)
[xUnit.net 00:00:02.52]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.GetService(Type serviceType)
[xUnit.net 00:00:02.52]            at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
[xUnit.net 00:00:02.52]            at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
[xUnit.net 00:00:02.52]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs(151,0): at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.EnsureDatabaseCreatedAsync()
[xUnit.net 00:00:02.52]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs(105,0): at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.InitializeAsync()
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.RevenueBreakdownTests.Create_WithNegativeTaxRate_ShouldFail [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.RevenueBreakdownTests.Create_WithValidInputs_ShouldCalculateBreakdownCorrectly [1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.RevenueBreakdownTests.Create_WithVeryLowPrice_ShouldNotProduceNegativePayout [1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.RevenueBreakdownTests.Create_WithZeroTaxRate_ShouldCalculateWithoutTax [1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventWaitingListTests.CancelRegistration_WhenWaitingListHasUsers_ShouldPromoteNextInLine [37 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventWaitingListTests.PromoteFromWaitingList_WhenNoCapacity_ShouldFail [2 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventWaitingListTests.AddToWaitingList_WhenEventAtCapacity_ShouldSucceed [3 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventWaitingListTests.RemoveFromWaitingList_WhenUserOnWaitingList_ShouldSucceed [50 ms]
[CancelRegistration] EventId: 9c7d001e-028e-4e12-8727-ff9ea57943bd, UserId: 8121f322-c328-45ef-8f08-a142c6bd3fa9
[CancelRegistration] Total registrations count: 5
[CancelRegistration] Registration: UserId=8121f322-c328-45ef-8f08-a142c6bd3fa9, Status=Confirmed, Match=True
[CancelRegistration] Registration: UserId=2b5d2ad6-db32-4c7b-b4ec-b145554e0870, Status=Confirmed, Match=False
[CancelRegistration] Registration: UserId=b7889577-30fe-4ed8-8d7e-89f034d20236, Status=Confirmed, Match=False
[CancelRegistration] Registration: UserId=d1d2accc-3f5e-4e33-a5bb-cf00c9b97a8f, Status=Confirmed, Match=False
[CancelRegistration] Registration: UserId=427f3f0c-b41e-49ac-b7ac-580c381cfbd3, Status=Confirmed, Match=False
[CancelRegistration] Found registration: True
  Passed LankaConnect.Application.Tests.Users.Domain.ExternalLoginTests.TwoExternalLoginsWithSameValues_ShouldBeEqual [61 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventWaitingListTests.AddToWaitingList_MultipleUsers_ShouldMaintainCorrectPositions [8 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.ExternalLoginTests.TwoExternalLoginsWithDifferentExternalIds_ShouldNotBeEqual [3 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventWaitingListTests.RemoveFromWaitingList_ShouldResequencePositions [3 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.ExternalLoginTests.Create_WithInvalidProviderEmail_ShouldReturnFailure(invalidEmail: "") [1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventWaitingListTests.AddToWaitingList_WhenUserAlreadyOnWaitingList_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.ExternalLoginTests.Create_WithInvalidProviderEmail_ShouldReturnFailure(invalidEmail: "   ") [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.ExternalLoginTests.Create_WithInvalidProviderEmail_ShouldReturnFailure(invalidEmail: null) [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventWaitingListTests.IsAtCapacity_WhenRegistrationsLessThanCapacity_ShouldReturnFalse [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventWaitingListTests.GetWaitingListPosition_WhenUserOnWaitingList_ShouldReturnPosition [1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.ExternalLoginTests.Create_ShouldTrimWhitespace [1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventWaitingListTests.GetWaitingListPosition_WhenUserNotOnWaitingList_ShouldReturnZero [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.ExternalLoginTests.GetHashCode_ForSameExternalLogins_ShouldBeSame [12 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.ExternalLoginTests.ExternalLogin_ShouldBeImmutable [6 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.ExternalLoginTests.Create_WithInvalidExternalProviderId_ShouldReturnFailure(invalidId: null) [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.ExternalLoginTests.Create_WithInvalidExternalProviderId_ShouldReturnFailure(invalidId: "") [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.ExternalLoginTests.Create_WithInvalidExternalProviderId_ShouldReturnFailure(invalidId: "   ") [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.ExternalLoginTests.TwoExternalLoginsWithDifferentProviders_ShouldNotBeEqual [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.ExternalLoginTests.GetHashCode_ForDifferentExternalLogins_ShouldBeDifferent [3 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.ExternalLoginTests.ToString_ShouldReturnMeaningfulString [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.ExternalLoginTests.Create_WithValidParameters_ShouldSucceed [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventWaitingListTests.PromoteFromWaitingList_WhenUserNotified_ShouldMoveToConfirmed [34 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventImageReplaceTests.ReplaceImage_WithNullImageUrl_ShouldFail [4 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventImageReplaceTests.ReplaceImage_WithValidImageAndNewUrl_ShouldSucceed [10 ms]
  Passed LankaConnect.IntegrationTests.UnitTest1.Test1 [5 ms]
  Failed LankaConnect.IntegrationTests.Repositories.EmailRepositoryIntegrationTests.AllEmailRepositories_DependencyInjection_ShouldResolveWithoutErrors [1 ms]
  Error Message:
   System.InvalidOperationException : Unable to resolve service for type 'MediatR.IPublisher' while attempting to activate 'LankaConnect.Infrastructure.Data.AppDbContext'.
  Stack Trace:
     at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateArgumentCallSites(ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain, ParameterInfo[] parameters, Boolean throwIfCallSiteNotFound)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateConstructorCallSite(ResultCache lifetime, ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceDescriptor descriptor, ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain, Int32 slot)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateCallSite(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.GetCallSite(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
   at System.Collections.Concurrent.ConcurrentDictionary`2.GetOrAdd(TKey key, Func`2 valueFactory)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.GetService(ServiceIdentifier serviceIdentifier, ServiceProviderEngineScope serviceProviderEngineScope)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.GetService(Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.EnsureDatabaseCreatedAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs:line 151
   at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs:line 105
  Failed LankaConnect.IntegrationTests.Repositories.EmailRepositoryIntegrationTests.EmailStatusRepository_CreateAndRetrieve_ShouldWork [1 ms]
  Error Message:
   System.InvalidOperationException : Unable to resolve service for type 'MediatR.IPublisher' while attempting to activate 'LankaConnect.Infrastructure.Data.AppDbContext'.
  Stack Trace:
     at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateArgumentCallSites(ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain, ParameterInfo[] parameters, Boolean throwIfCallSiteNotFound)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateConstructorCallSite(ResultCache lifetime, ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceDescriptor descriptor, ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain, Int32 slot)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateCallSite(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.GetCallSite(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
   at System.Collections.Concurrent.ConcurrentDictionary`2.GetOrAdd(TKey key, Func`2 valueFactory)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.GetService(ServiceIdentifier serviceIdentifier, ServiceProviderEngineScope serviceProviderEngineScope)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.GetService(Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.EnsureDatabaseCreatedAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs:line 151
   at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs:line 105
[xUnit.net 00:00:02.58]     LankaConnect.IntegrationTests.Repositories.EmailRepositoryIntegrationTests.EmailTemplateRepository_CreateAndRetrieve_ShouldWork [FAIL]
[xUnit.net 00:00:02.58]       System.InvalidOperationException : Unable to resolve service for type 'MediatR.IPublisher' while attempting to activate 'LankaConnect.Infrastructure.Data.AppDbContext'.
[xUnit.net 00:00:02.58]       Stack Trace:
[xUnit.net 00:00:02.58]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateArgumentCallSites(ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain, ParameterInfo[] parameters, Boolean throwIfCallSiteNotFound)
[xUnit.net 00:00:02.58]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateConstructorCallSite(ResultCache lifetime, ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain)
[xUnit.net 00:00:02.58]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceDescriptor descriptor, ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain, Int32 slot)
[xUnit.net 00:00:02.58]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
[xUnit.net 00:00:02.58]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateCallSite(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
[xUnit.net 00:00:02.58]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.GetCallSite(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
[xUnit.net 00:00:02.58]            at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
[xUnit.net 00:00:02.58]            at System.Collections.Concurrent.ConcurrentDictionary`2.GetOrAdd(TKey key, Func`2 valueFactory)
[xUnit.net 00:00:02.58]            at Microsoft.Extensions.DependencyInjection.ServiceProvider.GetService(ServiceIdentifier serviceIdentifier, ServiceProviderEngineScope serviceProviderEngineScope)
[xUnit.net 00:00:02.58]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.GetService(Type serviceType)
[xUnit.net 00:00:02.58]            at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
[xUnit.net 00:00:02.58]            at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
[xUnit.net 00:00:02.58]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs(151,0): at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.EnsureDatabaseCreatedAsync()
[xUnit.net 00:00:02.58]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs(105,0): at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.InitializeAsync()
[xUnit.net 00:00:02.59]     LankaConnect.IntegrationTests.Repositories.EmailRepositoryIntegrationTests.UserEmailPreferencesRepository_CreateAndRetrieve_ShouldWork [FAIL]
[xUnit.net 00:00:02.59]       System.InvalidOperationException : Unable to resolve service for type 'MediatR.IPublisher' while attempting to activate 'LankaConnect.Infrastructure.Data.AppDbContext'.
[xUnit.net 00:00:02.59]       Stack Trace:
[xUnit.net 00:00:02.59]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateArgumentCallSites(ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain, ParameterInfo[] parameters, Boolean throwIfCallSiteNotFound)
[xUnit.net 00:00:02.59]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateConstructorCallSite(ResultCache lifetime, ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain)
[xUnit.net 00:00:02.59]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceDescriptor descriptor, ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain, Int32 slot)
[xUnit.net 00:00:02.59]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
[xUnit.net 00:00:02.59]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateCallSite(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
[xUnit.net 00:00:02.59]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.GetCallSite(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
[xUnit.net 00:00:02.59]            at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
[xUnit.net 00:00:02.59]            at System.Collections.Concurrent.ConcurrentDictionary`2.GetOrAdd(TKey key, Func`2 valueFactory)
[xUnit.net 00:00:02.59]            at Microsoft.Extensions.DependencyInjection.ServiceProvider.GetService(ServiceIdentifier serviceIdentifier, ServiceProviderEngineScope serviceProviderEngineScope)
[xUnit.net 00:00:02.59]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.GetService(Type serviceType)
[xUnit.net 00:00:02.59]            at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
[xUnit.net 00:00:02.59]            at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
[xUnit.net 00:00:02.59]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs(151,0): at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.EnsureDatabaseCreatedAsync()
[xUnit.net 00:00:02.59]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs(105,0): at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.InitializeAsync()
[xUnit.net 00:00:02.59]     LankaConnect.IntegrationTests.Repositories.EmailRepositoryIntegrationTests.EmailMessageRepository_CreateAndRetrieve_ShouldWork [FAIL]
[xUnit.net 00:00:02.59]       System.InvalidOperationException : Unable to resolve service for type 'MediatR.IPublisher' while attempting to activate 'LankaConnect.Infrastructure.Data.AppDbContext'.
[xUnit.net 00:00:02.59]       Stack Trace:
[xUnit.net 00:00:02.59]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateArgumentCallSites(ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain, ParameterInfo[] parameters, Boolean throwIfCallSiteNotFound)
[xUnit.net 00:00:02.59]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateConstructorCallSite(ResultCache lifetime, ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain)
[xUnit.net 00:00:02.59]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceDescriptor descriptor, ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain, Int32 slot)
[xUnit.net 00:00:02.59]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
[xUnit.net 00:00:02.59]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateCallSite(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
[xUnit.net 00:00:02.59]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.GetCallSite(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
[xUnit.net 00:00:02.59]            at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
[xUnit.net 00:00:02.59]            at System.Collections.Concurrent.ConcurrentDictionary`2.GetOrAdd(TKey key, Func`2 valueFactory)
[xUnit.net 00:00:02.59]            at Microsoft.Extensions.DependencyInjection.ServiceProvider.GetService(ServiceIdentifier serviceIdentifier, ServiceProviderEngineScope serviceProviderEngineScope)
[xUnit.net 00:00:02.59]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.GetService(Type serviceType)
[xUnit.net 00:00:02.59]            at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
[xUnit.net 00:00:02.59]            at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
[xUnit.net 00:00:02.59]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs(151,0): at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.EnsureDatabaseCreatedAsync()
[xUnit.net 00:00:02.59]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs(105,0): at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.InitializeAsync()
  Passed LankaConnect.Application.Tests.Events.Domain.EventImageReplaceTests.ReplaceImage_WithNullBlobName_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventImageReplaceTests.ReplaceImage_WhenEventHasNoImages_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventImageReplaceTests.ReplaceImage_WithEmptyBlobName_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventImageReplaceTests.ReplaceImage_ShouldRaiseDomainEvent [4 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventImageReplaceTests.ReplaceImage_WithNonExistentImageId_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventImageReplaceTests.ReplaceImage_ShouldNotAffectOtherImages [8 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventImageReplaceTests.ReplaceImage_WithEmptyImageUrl_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventImageReplaceTests.ReplaceImage_ShouldMaintainDisplayOrder [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserUpdateLanguagesTests.UpdateLanguages_Should_Fail_When_Empty [67 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserUpdateLanguagesTests.UpdateLanguages_Event_Should_Contain_User_Id_And_Languages [9 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserUpdateLanguagesTests.UpdateLanguages_Should_Fail_When_More_Than_5 [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserUpdateLanguagesTests.UpdateLanguages_Should_Allow_Same_Language_Different_Proficiency [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserUpdateLanguagesTests.UpdateLanguages_Should_Allow_Exactly_5 [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserUpdateLanguagesTests.UpdateLanguages_Should_Add_Languages_Successfully [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserUpdateLanguagesTests.UpdateLanguages_Should_Remove_Duplicate_Languages [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserUpdateLanguagesTests.UpdateLanguages_Should_Replace_Existing_Languages [3 ms]
  Passed LankaConnect.Application.Tests.Events.EventHandlers.EventRejectedEventHandlerTests.Handle_OrganizerNotFound_ShouldNotSendEmail [396 ms]
  Passed LankaConnect.Application.Tests.Users.Commands.UpdateUserLocationCommandHandlerTests.Handle_WithValidLocation_ShouldUpdateUserAndReturnSuccess [397 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.UpdateSignUpItemCommandHandlerTests.Handle_WhenSignUpListNotFound_ShouldReturnFailure [393 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.ReplaceEventImageCommandTests.Handle_WithNonExistentImageId_ShouldReturnFailure [398 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserUpdateLanguagesTests.UpdateLanguages_Should_Raise_Domain_Event [18 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.ReplaceEventImageCommandTests.Handle_WithInvalidImageData_ShouldReturnFailure [7 ms]
  Passed LankaConnect.Application.Tests.Users.Commands.UpdateUserLocationCommandHandlerTests.Handle_WhenUserNotFound_ShouldReturnFailure [9 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.ReplaceEventImageCommandTests.Handle_WithNonExistentEvent_ShouldReturnFailure [5 ms]
  Passed LankaConnect.Application.Tests.Events.Queries.SearchEventsQueryHandlerTests.Handle_NoResults_ReturnsEmptyPagedResult [157 ms]
  Passed LankaConnect.Application.Tests.Users.Commands.UpdateUserLocationCommandHandlerTests.Handle_WithInvalidCity_ShouldReturnFailure [7 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.UpdateSignUpItemCommandHandlerTests.Handle_WithNullNotes_ShouldClearNotes [17 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.UpdateSignUpItemCommandHandlerTests.Handle_WhenSignUpItemNotFound_ShouldReturnFailure [4 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.ReplaceEventImageCommandTests.Handle_WhenReplacingImage_ShouldDeleteOldBlobAfterSuccess [11 ms]
2026-01-18 19:57:58.797 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:57:58.797 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:57:58.797 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:57:58.797 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:57:58.797 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:57:58.797 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:57:58.797 -05:00 [INF]  : Starting LankaConnect API
  Passed LankaConnect.Application.Tests.Events.EventHandlers.EventRejectedEventHandlerTests.Handle_WithValidEvent_ShouldSendEmailToOrganizer [26 ms]
  Passed LankaConnect.Application.Tests.Users.Commands.UpdateUserLocationCommandHandlerTests.Handle_WithInternationalLocation_ShouldSucceed [12 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.UpdateSignUpItemCommandHandlerTests.Handle_ReducingQuantityBelowCommitted_ShouldReturnFailure [8 ms]
  Passed LankaConnect.Application.Tests.Events.Queries.SearchEventsQueryHandlerTests.Handle_TotalCountExceedsPageSize_CalculatesCorrectTotalPages [17 ms]
  Passed LankaConnect.Application.Tests.Users.Commands.UpdateUserLocationCommandHandlerTests.Handle_WithNullLocation_ShouldClearLocationAndReturnSuccess [9 ms]
  Passed LankaConnect.Application.Tests.Events.Queries.SearchEventsQueryHandlerTests.Handle_ValidSearchTerm_ReturnsMatchingEvents [14 ms]
  Passed LankaConnect.Application.Tests.Users.Commands.UpdateUserLocationCommandHandlerTests.Handle_ShouldUpdateExistingLocation [7 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.UpdateSignUpItemCommandHandlerTests.Handle_WithEmptyDescription_ShouldReturnFailure [16 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.ReplaceEventImageCommandTests.Handle_WithValidRequest_ShouldReplaceImageSuccessfully [25 ms]
  Passed LankaConnect.Application.Tests.Events.EventHandlers.EventRejectedEventHandlerTests.Handle_EmailServiceFailure_ShouldNotThrow [28 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.UpdateSignUpItemCommandHandlerTests.Handle_IncreasingQuantityWithCommitments_ShouldSucceed [25 ms]
  Passed LankaConnect.Application.Tests.Events.EventHandlers.EventRejectedEventHandlerTests.Handle_ExceptionDuringProcessing_ShouldNotThrow [24 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.ReplaceEventImageCommandTests.Handle_WhenDomainOperationFails_ShouldRollbackUploadedBlob [27 ms]
  Passed LankaConnect.Application.Tests.Events.Queries.SearchEventsQueryHandlerTests.Handle_WithCategoryFilter_PassesFilterToRepository [32 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.UpdateSignUpItemCommandHandlerTests.Handle_WithInvalidQuantity_ShouldReturnFailure [5 ms]
  Passed LankaConnect.Application.Tests.Events.EventHandlers.EventRejectedEventHandlerTests.Handle_EventNotFound_ShouldNotSendEmail [5 ms]
  Passed LankaConnect.Application.Tests.Events.EventHandlers.EventRejectedEventHandlerTests.Handle_EmailContainsRejectionReason_ShouldIncludeReasonInBody [9 ms]
  Passed LankaConnect.Application.Tests.Users.Commands.UploadProfilePhotoCommandHandlerTests.Handle_WhenImageUploadFails_ShouldReturnFailure [89 ms]
  Passed LankaConnect.Application.Tests.Events.Queries.SearchEventsQueryHandlerTests.Handle_WithStartDateFromFilter_PassesFilterToRepository [17 ms]
  Passed LankaConnect.Application.Tests.Auth.RegisterUserHandlerTests.Handle_WithEventOrganizerRole_ShouldCreateUserAsGeneralUserWithPendingUpgrade [494 ms]
  Passed LankaConnect.Application.Tests.Users.Commands.UploadProfilePhotoCommandHandlerTests.Handle_WithNullFile_ShouldReturnFailure [3 ms]
  Passed LankaConnect.Domain.Tests.Users.ValueObjects.CulturalInterestTests.FromCode_Should_Accept_Any_Case_For_Dynamic_Codes [4 ms]
  Passed LankaConnect.Domain.Tests.Users.ValueObjects.CulturalInterestTests.CulturalInterest_All_Should_Have_Unique_Codes [2 ms]
  Passed LankaConnect.Domain.Tests.Users.ValueObjects.CulturalInterestTests.FromCode_Should_Return_Success_For_Valid_Code [< 1 ms]
  Passed LankaConnect.Domain.Tests.Users.ValueObjects.CulturalInterestTests.CulturalInterest_Should_Support_Equality_By_Code [2 ms]
  Passed LankaConnect.Domain.Tests.Users.ValueObjects.CulturalInterestTests.CulturalInterest_Should_Support_Inequality_For_Different_Codes [< 1 ms]
  Passed LankaConnect.Domain.Tests.Users.ValueObjects.CulturalInterestTests.FromCode_Should_Return_Failure_For_Null_Code [< 1 ms]
  Passed LankaConnect.Domain.Tests.Users.ValueObjects.CulturalInterestTests.CulturalInterest_ToString_Should_Return_Name [< 1 ms]
  Passed LankaConnect.Domain.Tests.Users.ValueObjects.CulturalInterestTests.FromCode_Should_Accept_Dynamic_EventCategory_Codes [< 1 ms]
  Passed LankaConnect.Domain.Tests.Users.ValueObjects.CulturalInterestTests.CulturalInterest_Should_Include_Christian_Festivals [< 1 ms]
  Passed LankaConnect.Application.Tests.Auth.RegisterUserHandlerTests.Handle_WithValidRequest_ShouldSendVerificationEmail [13 ms]
  Passed LankaConnect.Application.Tests.Communications.Queries.GetEmailStatusQueryHandlerTests.Handle_WithInvalidUserId_ShouldReturnFailure [64 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.UpdateSignUpItemCommandHandlerTests.Handle_WhenEventNotFound_ShouldReturnFailure [32 ms]
  Passed LankaConnect.Domain.Tests.Users.ValueObjects.CulturalInterestTests.CulturalInterest_Should_Map_Code_To_Correct_Name(code: "VESAK", expectedNamePart: "Vesak") [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.ReplaceEventImageCommandTests.Handle_WhenUploadFails_ShouldNotModifyEvent [35 ms]
  Passed LankaConnect.Application.Tests.Events.Queries.SearchEventsQueryHandlerTests.Handle_Page2_CalculatesCorrectOffsetAndLimit [18 ms]
  Passed LankaConnect.Domain.Tests.Users.ValueObjects.CulturalInterestTests.CulturalInterest_Should_Map_Code_To_Correct_Name(code: "SL_CUISINE", expectedNamePart: "Sri Lankan Cuisine") [< 1 ms]
  Passed LankaConnect.Domain.Tests.Users.ValueObjects.CulturalInterestTests.CulturalInterest_Should_Map_Code_To_Correct_Name(code: "CRICKET", expectedNamePart: "Cricket") [< 1 ms]
  Passed LankaConnect.Domain.Tests.Users.ValueObjects.CulturalInterestTests.CulturalInterest_Should_Include_Hindu_Festivals [< 1 ms]
  Passed LankaConnect.Domain.Tests.Users.ValueObjects.CulturalInterestTests.CulturalInterest_Should_Have_Code_And_Name [< 1 ms]
  Passed LankaConnect.Domain.Tests.Users.ValueObjects.CulturalInterestTests.FromCode_Should_Return_Failure_For_Empty_Code [< 1 ms]
  Passed LankaConnect.Domain.Tests.Users.ValueObjects.CulturalInterestTests.CulturalInterest_Should_Provide_All_Predefined_Interests [1 ms]
  Passed LankaConnect.Domain.Tests.Users.ValueObjects.CulturalInterestTests.CulturalInterest_Should_Include_Buddhist_Festivals [< 1 ms]
  Passed LankaConnect.Application.Tests.Auth.RegisterUserHandlerTests.Handle_WithInvalidEmail_ShouldReturnFailure [10 ms]
  Passed LankaConnect.Domain.Tests.Users.ValueObjects.CulturalInterestTests.CulturalInterest_All_Should_Include_Essential_Categories [< 1 ms]
  Passed LankaConnect.Domain.Tests.Users.ValueObjects.CulturalInterestTests.CulturalInterest_Should_Include_Islamic_Festivals [< 1 ms]
  Passed LankaConnect.Domain.Tests.Users.ValueObjects.CulturalInterestTests.CulturalInterest_Should_Be_Immutable [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.UpdateSignUpItemCommandHandlerTests.Handle_WithValidCommand_ShouldUpdateSignUpItem [17 ms]
  Passed LankaConnect.Application.Tests.Events.Queries.SearchEventsQueryHandlerTests.Handle_WithIsFreeOnlyFilter_PassesFilterToRepository [17 ms]
  Passed LankaConnect.Application.Tests.Auth.RegisterUserHandlerTests.Handle_ShouldSetEmailVerificationToken [15 ms]
  Passed LankaConnect.Application.Tests.Users.Commands.UploadProfilePhotoCommandHandlerTests.Handle_WithValidImageAndExistingUser_ShouldUploadAndUpdateUser [41 ms]
  Passed LankaConnect.Application.Tests.Events.Queries.SearchEventsQueryHandlerTests.Handle_MultipleFilters_PassesAllFiltersToRepository [11 ms]
  Passed LankaConnect.Application.Tests.Auth.RegisterUserHandlerTests.Handle_WhenEmailFails_ShouldStillSucceedRegistration [9 ms]
  Passed LankaConnect.Application.Tests.Auth.RegisterUserHandlerTests.Handle_WithEmptyRequiredFields_ShouldReturnFailure(email: "test@example.com", password: "ValidPassword123!", firstName: "John", lastName: "") [2 ms]
  Passed LankaConnect.Application.Tests.Auth.RegisterUserHandlerTests.Handle_WithEmptyRequiredFields_ShouldReturnFailure(email: "test@example.com", password: "ValidPassword123!", firstName: "", lastName: "Doe") [1 ms]
  Passed LankaConnect.Application.Tests.Communications.Queries.GetEmailStatusQueryHandlerTests.Handle_WithoutUserId_ShouldReturnResults [38 ms]
  Passed LankaConnect.Application.Tests.Auth.RegisterUserHandlerTests.Handle_WithEmptyRequiredFields_ShouldReturnFailure(email: "", password: "ValidPassword123!", firstName: "John", lastName: "Doe") [1 ms]
  Passed LankaConnect.Application.Tests.Communications.Queries.GetEmailStatusQueryHandlerTests.Handle_WithInvalidDateRange_ShouldReturnFailure [47 ms]
  Passed LankaConnect.Application.Tests.Auth.RegisterUserHandlerTests.Handle_WithEmptyRequiredFields_ShouldReturnFailure(email: "test@example.com", password: "", firstName: "John", lastName: "Doe") [46 ms]
  Passed LankaConnect.Application.Tests.Users.Commands.UploadProfilePhotoCommandHandlerTests.Handle_WhenUserHasExistingPhoto_ShouldDeleteOldPhotoFirst [62 ms]
  Passed LankaConnect.Application.Tests.Communications.Queries.GetEmailStatusQueryHandlerTests.Handle_WithCancellationToken_ShouldRespectCancellation [6 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventGroupPricingTests.CalculatePriceForAttendees_WithGroupTieredPricing_ShouldCalculateCorrectly(attendeeCount: 1, expectedAmount: 15) [73 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventGroupPricingTests.CalculatePriceForAttendees_WithGroupTieredPricing_ShouldCalculateCorrectly(attendeeCount: 2, expectedAmount: 30) [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventGroupPricingTests.CalculatePriceForAttendees_WithGroupTieredPricing_ShouldCalculateCorrectly(attendeeCount: 10, expectedAmount: 100) [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventGroupPricingTests.CalculatePriceForAttendees_WithGroupTieredPricing_ShouldCalculateCorrectly(attendeeCount: 3, expectedAmount: 36) [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventGroupPricingTests.CalculatePriceForAttendees_WithGroupTieredPricing_ShouldCalculateCorrectly(attendeeCount: 6, expectedAmount: 60) [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventGroupPricingTests.CalculatePriceForAttendees_WithGroupTieredPricing_ShouldCalculateCorrectly(attendeeCount: 4, expectedAmount: 48) [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventGroupPricingTests.CalculatePriceForAttendees_WithGroupTieredPricing_ShouldCalculateCorrectly(attendeeCount: 5, expectedAmount: 60) [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventGroupPricingTests.CalculatePriceForAttendees_WithLegacySinglePrice_ShouldStillWork [1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventGroupPricingTests.IsFree_WithNoGroupTieredPricing_ShouldReturnTrue [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Commands.UploadProfilePhotoCommandHandlerTests.Handle_WithEmptyFile_ShouldReturnFailure [4 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventGroupPricingTests.CalculatePriceForAttendees_WithGroupTieredAndEmptyList_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Auth.RegisterUserHandlerTests.Handle_WithDifferentRoles_ShouldCreateUserWithCorrectRole(role: AdminManager) [11 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventGroupPricingTests.SetGroupPricing_WithNullPricing_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Auth.RegisterUserHandlerTests.Handle_WithDifferentRoles_ShouldCreateUserWithCorrectRole(role: Admin) [5 ms]
  Passed LankaConnect.Application.Tests.Communications.Queries.GetEmailStatusQueryHandlerTests.Handle_WithValidQuery_ShouldReturnEmailStatus [10 ms]
  Passed LankaConnect.Application.Tests.Communications.Queries.GetEmailStatusQueryHandlerTests.Handle_WithPageSizeTooLarge_ShouldReturnFailure [1 ms]
  Passed LankaConnect.Application.Tests.Communications.Queries.GetEmailStatusQueryHandlerTests.Handle_WithInvalidPageNumber_ShouldReturnFailure [1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventGroupPricingTests.CalculatePriceForAttendees_WithDualPricing_ShouldStillWork [9 ms]
  Passed LankaConnect.Application.Tests.Auth.RegisterUserHandlerTests.Handle_WithDifferentRoles_ShouldCreateUserWithCorrectRole(role: GeneralUser) [4 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventGroupPricingTests.SetGroupPricing_WithNonGroupTieredPricing_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Communications.Queries.GetEmailStatusQueryHandlerTests.Handle_WithInvalidPageSize_ShouldReturnFailure [1 ms]
  Passed LankaConnect.Application.Tests.Users.Commands.UploadProfilePhotoCommandHandlerTests.Handle_WhenUserNotFound_ShouldReturnFailure [11 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventGroupPricingTests.IsFree_WithGroupTieredPricing_ShouldReturnFalse [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventGroupPricingTests.SetGroupPricing_ShouldNotBreakExistingDualPricingEvents [4 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventGroupPricingTests.CalculatePriceForAttendees_WithGroupTieredFreeEvent_ShouldReturnZero [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventGroupPricingTests.SetGroupPricing_ShouldRaiseEventPricingUpdatedEvent [1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventGroupPricingTests.SetGroupPricing_WithValidTiers_ShouldSucceed [1 ms]
  Passed LankaConnect.Application.Tests.Auth.RegisterUserHandlerTests.Handle_WithValidRequest_ShouldReturnSuccessWithUserResponse [10 ms]
  Passed LankaConnect.Application.Tests.Auth.RegisterUserHandlerTests.Handle_WithDatabaseError_ShouldRethrowException [13 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventVideoTests.Create_WithEmptyBlobName_ShouldThrow [131 ms]
  Passed LankaConnect.Application.Tests.Auth.RegisterUserHandlerTests.Handle_WithExistingUser_ShouldReturnFailure [5 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventVideoTests.Create_WithZeroDisplayOrder_ShouldThrow [1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventVideoTests.Create_WithEmptyThumbnailUrl_ShouldThrow [1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventVideoTests.Create_WithNullVideoUrl_ShouldThrow [1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventVideoTests.Create_WithEmptyFormat_ShouldThrow [1 ms]
  Passed LankaConnect.Application.Tests.Auth.RegisterUserHandlerTests.Handle_WithPasswordHashingFailure_ShouldReturnFailure [8 ms]
  Passed LankaConnect.Application.Tests.Businesses.Commands.CreateBusinessCommandHandlerTests.Handle_WithUsPhoneNumber_ShouldCreateBusinessWithCorrectContactInfo [137 ms]
  Passed LankaConnect.Application.Tests.Businesses.Commands.CreateBusinessCommandHandlerTests.Handle_WithDifferentUsBusinessCategories_ShouldCreateSuccessfully(category: Healthcare) [2 ms]
  Passed LankaConnect.Application.Tests.Businesses.Commands.CreateBusinessCommandHandlerTests.Handle_WithDifferentUsBusinessCategories_ShouldCreateSuccessfully(category: Services) [< 1 ms]
  Passed LankaConnect.Application.Tests.Businesses.Commands.CreateBusinessCommandHandlerTests.Handle_WithDifferentUsBusinessCategories_ShouldCreateSuccessfully(category: Restaurant) [< 1 ms]
  Passed LankaConnect.Application.Tests.Auth.RegisterUserHandlerTests.Handle_WithWeakPassword_ShouldReturnFailure [6 ms]
  Passed LankaConnect.Application.Tests.Businesses.Commands.CreateBusinessCommandHandlerTests.Handle_WithDifferentUsBusinessCategories_ShouldCreateSuccessfully(category: Transportation) [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.UpdateEventOrganizerContactCommandHandlerTests.Handle_UnpublishContact_ShouldClearAllDetails [35 ms]
  Passed LankaConnect.Application.Tests.Businesses.Commands.AddServiceCommandHandlerTests.Handle_WithVariousUsRestaurantServices_ShouldAddSuccessfully(serviceName: "Private Dining", description: "Exclusive private dining experience for special oc", price: 75) [120 ms]
  Passed LankaConnect.Application.Tests.Businesses.Commands.CreateBusinessCommandHandlerTests.Handle_WithDifferentUsBusinessCategories_ShouldCreateSuccessfully(category: Retail) [< 1 ms]
  Passed LankaConnect.Application.Tests.Businesses.Commands.AddServiceCommandHandlerTests.Handle_WithVariousUsRestaurantServices_ShouldAddSuccessfully(serviceName: "Lunch Special", description: "Daily lunch special with rice, curry, and beverage", price: 12.99) [3 ms]
  Passed LankaConnect.Application.Tests.Businesses.Commands.CreateBusinessCommandHandlerTests.Handle_WithUsRestaurantCategory_ShouldSetCorrectCategory [5 ms]
  Passed LankaConnect.Application.Tests.Businesses.Commands.AddServiceCommandHandlerTests.Handle_WithVariousUsRestaurantServices_ShouldAddSuccessfully(serviceName: "Takeout Service", description: "Quick takeout for busy professionals", price: 15.5) [2 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventLocationPropertyTests.Create_WithLocation_ShouldSucceed [52 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.UpdateEventOrganizerContactCommandHandlerTests.Handle_PublishWithoutName_ShouldReturnFailure [9 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventLocationPropertyTests.RemoveLocation_WhenLocationDoesNotExist_ShouldFail [1 ms]
  Passed LankaConnect.Application.Tests.Businesses.Commands.CreateBusinessCommandHandlerTests.Handle_WithUsCoordinates_ShouldCreateBusinessWithCorrectLocation [3 ms]
  Passed LankaConnect.Application.Tests.Businesses.Commands.AddServiceCommandHandlerTests.Handle_WithVariousUsRestaurantServices_ShouldAddSuccessfully(serviceName: "Catering Package", description: "Full-service catering for events up to 50 people", price: 450) [3 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventLocationPropertyTests.Create_WithoutLocation_ShouldSucceed [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventLocationPropertyTests.HasLocation_WhenLocationSet_ShouldReturnTrue [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventLocationPropertyTests.SetLocation_WithNullLocation_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventLocationPropertyTests.Create_WithNullLocation_ShouldSucceed [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventLocationPropertyTests.SetLocation_OnPublishedEvent_ShouldSucceed [< 1 ms]
  Passed LankaConnect.Application.Tests.Businesses.Commands.CreateBusinessCommandHandlerTests.Handle_WithUsAddress_ShouldCreateBusinessWithCorrectLocation [4 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventLocationPropertyTests.SetLocation_WithValidLocation_ShouldSucceed [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventLocationPropertyTests.RemoveLocation_ConvertingToVirtualEvent_ShouldSucceed [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventLocationPropertyTests.HasLocation_WhenLocationNotSet_ShouldReturnFalse [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventLocationPropertyTests.SetLocation_OnDraftEvent_ShouldSucceed [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventLocationPropertyTests.RemoveLocation_WhenLocationExists_ShouldSucceed [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventLocationPropertyTests.SetLocation_WhenLocationAlreadySet_ShouldUpdateLocation [< 1 ms]
  Passed LankaConnect.Application.Tests.Businesses.Commands.CreateBusinessCommandHandlerTests.Handle_WithCancellationToken_ShouldPassTokenToRepository [5 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.UpdateEventOrganizerContactCommandHandlerTests.Handle_ValidRequest_WithAllContactDetails_ShouldSucceed [11 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventVideoTests.Create_WithNegativeDisplayOrder_ShouldThrow [49 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventVideoTests.Create_WithEmptyVideoUrl_ShouldThrow [3 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventVideoTests.Create_WithNegativeFileSize_ShouldThrow [3 ms]
  Passed LankaConnect.Application.Tests.Users.Commands.DeleteProfilePhotoCommandHandlerTests.Handle_WhenUserNotFound_ShouldReturnFailure [58 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventVideoTests.Create_WithValidData_ShouldSucceed [11 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventVideoTests.Create_WithNullDuration_ShouldSucceed [1 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.UpdateEventOrganizerContactCommandHandlerTests.Handle_PublishWithInvalidEmail_ShouldReturnFailure [42 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.UpdateEventOrganizerContactCommandHandlerTests.Handle_ValidRequest_WithOnlyPhone_ShouldSucceed [4 ms]
  Passed LankaConnect.Application.Tests.Users.Commands.DeleteProfilePhotoCommandHandlerTests.Handle_WhenImageDeletionFails_ShouldReturnFailure [10 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventLocationTests.WithCoordinates_WhenNoCoordinatesExist_ShouldAddCoordinates [1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventLocationTests.Equality_DifferentCoordinates_ShouldNotBeEqual [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventLocationTests.Create_WithValidAddressAndCoordinates_ShouldSucceed [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventLocationTests.HasCoordinates_WhenCoordinatesDoNotExist_ShouldReturnFalse [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Commands.DeleteProfilePhotoCommandHandlerTests.Handle_WhenUserHasNoPhoto_ShouldReturnFailure [8 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventLocationTests.HasCoordinates_WhenCoordinatesExist_ShouldReturnTrue [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventLocationTests.Create_WithValidAddress_ShouldSucceed [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventLocationTests.Equality_DifferentAddresses_ShouldNotBeEqual [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventLocationTests.WithCoordinates_WithNullCoordinates_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventLocationTests.ToString_WithoutCoordinates_ShouldShowAddressOnly [1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventLocationTests.Create_WithNullAddress_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.UpdateEventOrganizerContactCommandHandlerTests.Handle_ValidRequest_WithOnlyEmail_ShouldSucceed [13 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventLocationTests.EventLocation_ShouldBeImmutable [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventLocationTests.Equality_SameAddressAndCoordinates_ShouldBeEqual [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventLocationTests.WithCoordinates_WhenCoordinatesAlreadyExist_ShouldUpdateCoordinates [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventLocationTests.Equality_OneWithCoordinatesOneWithout_ShouldNotBeEqual [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventLocationTests.ToString_WithCoordinates_ShouldIncludeAddressAndCoordinates [1 ms]
  Passed LankaConnect.Application.Tests.Businesses.Commands.AddServiceCommandHandlerTests.Handle_WithInvalidPrice_ShouldThrowInvalidOperationException(invalidPrice: -0.01) [81 ms]
  Passed LankaConnect.Application.Tests.Businesses.Commands.AddServiceCommandHandlerTests.Handle_WithInvalidPrice_ShouldThrowInvalidOperationException(invalidPrice: -1) [3 ms]
  Passed LankaConnect.Application.Tests.Users.Commands.DeleteProfilePhotoCommandHandlerTests.Handle_WithExistingPhoto_ShouldDeletePhotoAndUpdateUser [21 ms]
  Passed LankaConnect.Application.Tests.Businesses.Commands.AddServiceCommandHandlerTests.Handle_WithInvalidPrice_ShouldThrowInvalidOperationException(invalidPrice: -100) [3 ms]
  Passed LankaConnect.Application.Tests.Businesses.Commands.AddServiceCommandHandlerTests.Handle_WithInactiveService_ShouldAddInactiveService [20 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.UpdateEventOrganizerContactCommandHandlerTests.Handle_UpdateExistingContact_ShouldOverwritePreviousData [39 ms]
  Passed LankaConnect.Application.Tests.Users.Commands.UpdateCulturalInterestsCommandHandlerTests.Handle_Should_Fail_When_User_Not_Found [35 ms]
  Passed LankaConnect.Application.Tests.Businesses.Commands.CreateBusinessCommandHandlerTests.Handle_WhenUnitOfWorkFails_ShouldPropagateException [103 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.UpdateEventOrganizerContactCommandHandlerTests.Handle_PublishWithoutContactMethod_ShouldReturnFailure [6 ms]
  Passed LankaConnect.Application.Tests.Businesses.Commands.AddServiceCommandHandlerTests.Handle_WithInvalidServiceName_ShouldReturnFailureResult(invalidName: "   ") [11 ms]
  Passed LankaConnect.Application.Tests.Businesses.Commands.CreateBusinessCommandHandlerTests.Handle_WhenRepositoryThrowsException_ShouldPropagateException [8 ms]
  Passed LankaConnect.Application.Tests.Businesses.Commands.CreateBusinessCommandHandlerTests.Handle_WithMinimumValidData_ShouldCreateBusinessSuccessfully [2 ms]
  Passed LankaConnect.Application.Tests.Businesses.Commands.AddServiceCommandHandlerTests.Handle_WithInvalidServiceName_ShouldReturnFailureResult(invalidName: "") [3 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.UpdateEventOrganizerContactCommandHandlerTests.Handle_EventNotFound_ShouldReturnFailure [8 ms]
  Passed LankaConnect.Application.Tests.Businesses.Commands.AddServiceCommandHandlerTests.Handle_WithInvalidServiceName_ShouldReturnFailureResult(invalidName: null) [2 ms]
  Passed LankaConnect.Application.Tests.Businesses.Commands.CreateBusinessCommandHandlerTests.Handle_WithComplexUsBusinessData_ShouldHandleAllProperties [5 ms]
  Passed LankaConnect.Application.Tests.Users.Commands.UpdateCulturalInterestsCommandHandlerTests.Handle_Should_Accept_Dynamic_EventCategory_Codes [17 ms]
  Passed LankaConnect.Application.Tests.Users.Commands.UpdateCulturalInterestsCommandHandlerTests.Handle_Should_Accept_More_Than_10_Interests [5 ms]
  Passed LankaConnect.Application.Tests.Businesses.Commands.AddServiceCommandHandlerTests.Handle_WithUsRestaurantService_ShouldAddServiceWithUsdPricing [7 ms]
  Passed LankaConnect.Application.Tests.Businesses.Commands.CreateBusinessCommandHandlerTests.Handle_WithValidUsBusinessCommand_ShouldCreateBusinessSuccessfully [8 ms]
  Passed LankaConnect.Application.Tests.Auth.Commands.LoginWithEntraCommandHandlerTests.Handle_WithInvalidToken_ShouldReturnFailure [194 ms]
  Passed LankaConnect.Application.Tests.Businesses.Commands.AddServiceCommandHandlerTests.Handle_WithValidServiceCommand_ShouldAddServiceSuccessfully [5 ms]
  Passed LankaConnect.Application.Tests.Users.Commands.UpdateCulturalInterestsCommandHandlerTests.Handle_Should_Update_Cultural_Interests_Successfully [6 ms]
  Passed LankaConnect.Application.Tests.Users.Commands.UpdateCulturalInterestsCommandHandlerTests.Handle_Should_Clear_Interests_When_Empty_List [4 ms]
  Passed LankaConnect.Application.Tests.Businesses.Commands.AddServiceCommandHandlerTests.Handle_WithFreeService_ShouldAddSuccessfully [5 ms]
  Passed LankaConnect.Application.Tests.Common.Models.BackupScheduleResultTests.BackupScheduleResult_Should_Be_Instantiable [< 1 ms]
  Passed LankaConnect.Application.Tests.Common.Models.BackupScheduleResultTests.BackupScheduleResult_Should_Have_Required_Properties [2 ms]
  Passed LankaConnect.Application.Tests.Auth.Commands.LoginWithEntraCommandHandlerTests.Handle_WithValidToken_ShouldAddRefreshTokenWithCorrectExpiry [20 ms]
  Passed LankaConnect.Application.Tests.Auth.Commands.LoginWithEntraCommandHandlerTests.Handle_WhenEntraDisabled_ShouldReturnFailure [3 ms]
  Passed LankaConnect.Application.Tests.Businesses.Commands.AddServiceCommandHandlerTests.Handle_WithNonExistentBusiness_ShouldThrowBusinessNotFoundException [33 ms]
  Passed LankaConnect.Application.Tests.Auth.Commands.LoginWithEntraCommandHandlerTests.Handle_WithIpAddress_ShouldStoreIpInRefreshToken [18 ms]
  Passed LankaConnect.Application.Tests.Common.Models.Performance.PerformanceAlertTests.PerformanceAlert_WithInvalidAlertType_ShouldThrowException(invalidAlertType: null) [40 ms]
  Passed LankaConnect.Application.Tests.Common.Models.Performance.PerformanceAlertTests.PerformanceAlert_WithInvalidAlertType_ShouldThrowException(invalidAlertType: "") [1 ms]
  Passed LankaConnect.Application.Tests.Common.Models.Performance.PerformanceAlertTests.PerformanceAlert_Creation_ShouldInitializeWithValidProperties [1 ms]
  Passed LankaConnect.Application.Tests.Common.Models.Performance.PerformanceAlertTests.PerformanceAlert_WithCulturalContext_ShouldStoreCulturalInformation [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserProfilePhotoTests.UpdateProfilePhoto_WithValidUrlAndBlobName_ShouldSucceed [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserProfilePhotoTests.UpdateProfilePhoto_WithNullUrl_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Auth.Commands.LoginWithEntraCommandHandlerTests.Handle_WithValidToken_ExistingUser_ShouldReturnSuccessWithTokens [15 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserProfilePhotoTests.RemoveProfilePhoto_WhenAlreadyRemoved_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserProfilePhotoTests.ProfilePhotoBlobName_InitialState_ShouldBeNull [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Queries.GetUserByIdQueryHandlerTests.Handle_WithUserWithoutPhoneNumber_ShouldReturnUserDtoWithNullPhone [20 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserProfilePhotoTests.RemoveProfilePhoto_WhenPhotoExists_ShouldRaiseDomainEvent [3 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserProfilePhotoTests.RemoveProfilePhoto_WhenPhotoExists_ShouldSucceed [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserProfilePhotoTests.UpdateProfilePhoto_ReplacingExistingPhoto_ShouldSucceed [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserProfilePhotoTests.UpdateProfilePhoto_ReplacingExistingPhoto_ShouldRaiseNewEvent [1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserProfilePhotoTests.UpdateProfilePhoto_WithWhitespaceBlobName_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserProfilePhotoTests.UpdateProfilePhoto_WithNullBlobName_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserProfilePhotoTests.UpdateProfilePhoto_WithValidUrlAndBlobName_ShouldRaiseDomainEvent [1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserProfilePhotoTests.RemoveProfilePhoto_WhenNoPhotoExists_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserProfilePhotoTests.ProfilePhotoUrl_InitialState_ShouldBeNull [< 1 ms]
  Passed LankaConnect.Application.Tests.Auth.Commands.LoginWithEntraCommandHandlerTests.Handle_WithValidToken_NewUser_ShouldAutoProvisionAndReturnSuccess [12 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserProfilePhotoTests.UpdateProfilePhoto_WithEmptyBlobName_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserProfilePhotoTests.UpdateProfilePhoto_WithEmptyUrl_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserProfilePhotoTests.ProfilePhotoUrl_AfterUpdate_ShouldReturnCorrectValue [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserProfilePhotoTests.ProfilePhotoBlobName_AfterUpdate_ShouldReturnCorrectValue [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserProfilePhotoTests.UpdateProfilePhoto_WithWhitespaceUrl_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Analytics.Commands.RecordEventViewCommandHandlerTests.Handle_WithValidAnonymousView_ShouldRecordViewWithoutUserId [125 ms]
  Passed LankaConnect.Application.Tests.Analytics.Commands.RecordEventViewCommandHandlerTests.Handle_WithNullIpAddress_ShouldReturnFailure [4 ms]
  Passed LankaConnect.Application.Tests.Users.Queries.GetUserByIdQueryHandlerTests.Handle_WithUserWithCulturalInterests_ShouldReturnInterestCodes [19 ms]
  Passed LankaConnect.Application.Tests.Analytics.Commands.RecordEventViewCommandHandlerTests.Handle_WithEmptyEventId_ShouldReturnFailure [3 ms]
  Passed LankaConnect.Application.Tests.Users.Queries.GetUserByIdQueryHandlerTests.Handle_WithUserWithoutEpic1Phase3Fields_ShouldReturnEmptyOrNullValues [7 ms]
  Passed LankaConnect.Application.Tests.Auth.Commands.LoginWithEntraCommandHandlerTests.Handle_WhenEmailAlreadyExistsWithDifferentProvider_ShouldReturnFailure [21 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeLocationConfigTests.Constructor_InvalidRotation_ThrowsValidationException(invalidRotation: -10) [5 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeLocationConfigTests.Constructor_InvalidRotation_ThrowsValidationException(invalidRotation: 400) [1 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeLocationConfigTests.Constructor_InvalidRotation_ThrowsValidationException(invalidRotation: -1) [< 1 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeLocationConfigTests.Constructor_InvalidRotation_ThrowsValidationException(invalidRotation: 361) [< 1 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeLocationConfigTests.DefaultDetail_ReturnsCorrectDefaults [2 ms]
  Passed LankaConnect.Application.Tests.Users.Queries.GetUserByIdQueryHandlerTests.Handle_WithValidRequest_ShouldCallRepositoryOnce [16 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeLocationConfigTests.DefaultFeatured_ReturnsCorrectDefaults [1 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeLocationConfigTests.Constructor_InvalidSizeHeight_ThrowsValidationException(invalidHeight: 0.04) [1 ms]
  Passed LankaConnect.Application.Tests.Analytics.Commands.RecordEventViewCommandHandlerTests.Handle_WithValidAuthenticatedView_ShouldCreateAnalyticsAndRecordView [23 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeLocationConfigTests.Constructor_InvalidSizeHeight_ThrowsValidationException(invalidHeight: -0.1) [1 ms]
  Passed LankaConnect.Application.Tests.Users.Queries.GetUserByIdQueryHandlerTests.Handle_WithUserWithProfilePhoto_ShouldReturnProfilePhotoUrl [11 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeLocationConfigTests.Constructor_InvalidSizeHeight_ThrowsValidationException(invalidHeight: 1.1) [7 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeLocationConfigTests.Constructor_InvalidSizeHeight_ThrowsValidationException(invalidHeight: 0) [< 1 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeLocationConfigTests.Constructor_InvalidPositionX_ThrowsDomainException(invalidPositionX: -1) [1 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeLocationConfigTests.Constructor_InvalidPositionX_ThrowsDomainException(invalidPositionX: 1.1) [1 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeLocationConfigTests.Constructor_InvalidPositionX_ThrowsDomainException(invalidPositionX: -0.1) [< 1 ms]
  Passed LankaConnect.Application.Tests.Analytics.Commands.RecordEventViewCommandHandlerTests.Handle_WithDuplicateViewInWindow_ShouldNotCountView [14 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeLocationConfigTests.Constructor_InvalidPositionX_ThrowsDomainException(invalidPositionX: 2) [1 ms]
  Passed LankaConnect.Application.Tests.Users.Queries.GetUserByIdQueryHandlerTests.Handle_WithEmptyGuid_ShouldReturnFailure [6 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeLocationConfigTests.Constructor_InvalidSizeWidth_ThrowsValidationException(invalidWidth: 0.04) [2 ms]
  Passed LankaConnect.Application.Tests.Users.Queries.GetUserByIdQueryHandlerTests.Handle_WithNonExistentUser_ShouldReturnFailure [6 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeLocationConfigTests.Constructor_InvalidSizeWidth_ThrowsValidationException(invalidWidth: 0) [5 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeLocationConfigTests.Constructor_InvalidSizeWidth_ThrowsValidationException(invalidWidth: 1.1) [15 ms]
  Passed LankaConnect.Application.Tests.Analytics.Commands.RecordEventViewCommandHandlerTests.Handle_WhenRecordingView_ShouldRaiseDomainEvent [24 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeLocationConfigTests.Constructor_InvalidSizeWidth_ThrowsValidationException(invalidWidth: -0.1) [< 1 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeLocationConfigTests.Constructor_InvalidPositionY_ThrowsValidationException(invalidPositionY: 1.1) [1 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeLocationConfigTests.Constructor_InvalidPositionY_ThrowsValidationException(invalidPositionY: -1) [1 ms]
  Passed LankaConnect.Application.Tests.Analytics.Commands.RecordEventViewCommandHandlerTests.Handle_WithExistingAnalytics_ShouldIncrementViewCount [9 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeLocationConfigTests.Constructor_InvalidPositionY_ThrowsValidationException(invalidPositionY: 2) [9 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeLocationConfigTests.Constructor_InvalidPositionY_ThrowsValidationException(invalidPositionY: -0.1) [< 1 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeLocationConfigTests.ValueObjectEquality_SameValues_AreEqual [4 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeLocationConfigTests.ValueObjectEquality_DifferentValues_AreNotEqual [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Queries.GetUserByIdQueryHandlerTests.Handle_WhenRepositoryThrows_ShouldPropagateException [37 ms]
  Passed LankaConnect.Application.Tests.Analytics.Commands.RecordEventViewCommandHandlerTests.Handle_WithEmptyIpAddress_ShouldReturnFailure [11 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeLocationConfigTests.DefaultListing_ReturnsCorrectDefaults [1 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeLocationConfigTests.Constructor_ValidValues_CreatesInstance [< 1 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeLocationConfigTests.Constructor_BoundaryValues_AcceptsValidBoundaries [1 ms]
  Passed LankaConnect.Application.Tests.Common.Models.ScalingPredictionResultTests.ScalingPredictionResult_Should_Have_Required_Properties [3 ms]
  Passed LankaConnect.Application.Tests.Common.Models.ScalingPredictionResultTests.ScalingPredictionResult_Should_Exist_And_Be_Instantiable [< 1 ms]
  Passed LankaConnect.Application.Tests.Common.Models.EngineLifecycleOperationTests.EngineLifecycleOperation_Should_Exist_And_Be_Instantiable [1 ms]
  Passed LankaConnect.Application.Tests.Common.Models.EngineLifecycleOperationTests.EngineLifecycleOperation_Should_Have_Required_Properties [1 ms]
  Passed LankaConnect.Application.Tests.Auth.LoginUserHandlerTests.Handle_WithWrongPassword_ShouldReturnFailureAndRecordFailedAttempt [193 ms]
  Passed LankaConnect.Application.Tests.Common.ExceptionHandlingTests.NotFoundException_WithDifferentEntityTypes_ShouldFormatCorrectly(entityName: "Order", key: "789") [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.SendEventNotificationCommandHandlerTests.Handle_UnauthorizedUser_ShouldReturnFailure [182 ms]
  Passed LankaConnect.Application.Tests.Common.ExceptionHandlingTests.NotFoundException_WithDifferentEntityTypes_ShouldFormatCorrectly(entityName: "Business", key: "456") [< 1 ms]
  Passed LankaConnect.Application.Tests.Common.ExceptionHandlingTests.NotFoundException_WithDifferentEntityTypes_ShouldFormatCorrectly(entityName: "User", key: "123") [< 1 ms]
  Passed LankaConnect.Application.Tests.Common.ExceptionHandlingTests.NotFoundException_WithNullEntityName_ShouldHandleGracefully [< 1 ms]
  Passed LankaConnect.Application.Tests.Common.ExceptionHandlingTests.NotFoundException_ShouldInheritFromException [1 ms]
  Passed LankaConnect.Application.Tests.Common.ExceptionHandlingTests.NotFoundException_WithIntegerKey_ShouldFormatCorrectly [< 1 ms]
  Passed LankaConnect.Application.Tests.Common.ExceptionHandlingTests.NotFoundException_WithGuidKey_ShouldFormatCorrectly [< 1 ms]
  Passed LankaConnect.Application.Tests.Businesses.Commands.DeleteBusinessCommandHandlerTests.Handle_WithUsBusinessData_ShouldDeleteSuccessfully [14 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.SendEventNotificationCommandHandlerTests.Handle_EventNotFound_ShouldReturnFailure [5 ms]
  Passed LankaConnect.Application.Tests.Businesses.Commands.DeleteBusinessCommandHandlerTests.Handle_WithValidBusinessId_ShouldDeleteBusinessSuccessfully [9 ms]
  Passed LankaConnect.Application.Tests.Users.Queries.GetUserByIdQueryHandlerTests.Handle_WithUserWithLocation_ShouldReturnLocationDetails [31 ms]
  Passed LankaConnect.Application.Tests.Common.ExceptionHandlingTests.NotFoundException_WithNullOrWhitespaceMessage_ShouldHandleGracefully(message: null) [< 1 ms]
  Passed LankaConnect.Application.Tests.Common.ExceptionHandlingTests.NotFoundException_WithNullOrWhitespaceMessage_ShouldHandleGracefully(message: "   ") [< 1 ms]
  Passed LankaConnect.Application.Tests.Common.ExceptionHandlingTests.NotFoundException_WithNullOrWhitespaceMessage_ShouldHandleGracefully(message: "") [< 1 ms]
  Passed LankaConnect.Application.Tests.Common.ExceptionHandlingTests.NotFoundException_WithEmptyKey_ShouldHandleGracefully [< 1 ms]
  Passed LankaConnect.Application.Tests.Common.ExceptionHandlingTests.NotFoundException_WithSpecialCharacters_ShouldPreserveMessage [< 1 ms]
  Passed LankaConnect.Application.Tests.Common.ExceptionHandlingTests.NotFoundException_WithInnerException_ShouldPreserveInnerException [< 1 ms]
  Passed LankaConnect.Application.Tests.Common.ExceptionHandlingTests.NotFoundException_ToString_ShouldIncludeExceptionType [< 1 ms]
  Passed LankaConnect.Application.Tests.Common.ExceptionHandlingTests.NotFoundException_ShouldBeSerializable [< 1 ms]
  Passed LankaConnect.Application.Tests.Common.ExceptionHandlingTests.NotFoundException_WithVeryLongMessage_ShouldPreserveMessage [2 ms]
  Passed LankaConnect.Application.Tests.Common.ExceptionHandlingTests.NotFoundException_WithCustomMessage_ShouldSetMessage [< 1 ms]
  Passed LankaConnect.Application.Tests.Common.ExceptionHandlingTests.NotFoundException_WithEntityNameAndKey_ShouldSetCorrectMessage [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Queries.GetUserByIdQueryHandlerTests.Handle_WithCancellationRequested_ShouldThrowOperationCancelledException [9 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.SendEventNotificationCommandHandlerTests.Handle_DraftEvent_ShouldReturnFailure [22 ms]
  Passed LankaConnect.Application.Tests.Users.Queries.GetUserByIdQueryHandlerTests.Handle_WithExistingUser_ShouldReturnUserDto [10 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.DeleteEventVideoCommandTests.Handle_WithValidVideoId_ShouldSucceed [15 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.DeleteEventVideoCommandTests.Handle_WithNonExistentVideo_ShouldReturnFailure [4 ms]
  Passed LankaConnect.Application.Tests.Users.Queries.GetUserByIdQueryHandlerTests.Handle_WithUserWithLanguages_ShouldReturnLanguagesWithProficiency [10 ms]
  Passed LankaConnect.Domain.Tests.Users.ValueObjects.LanguagePreferenceTests.LanguagePreference_Should_Support_All_ProficiencyLevels [< 1 ms]
  Passed LankaConnect.Domain.Tests.Users.ValueObjects.LanguagePreferenceTests.LanguagePreference_Should_Support_Multiple_Languages [< 1 ms]
  Passed LankaConnect.Domain.Tests.Users.ValueObjects.LanguagePreferenceTests.LanguagePreference_Should_Work_With_All_Proficiency_Levels(level: Native) [< 1 ms]
  Passed LankaConnect.Domain.Tests.Users.ValueObjects.LanguagePreferenceTests.LanguagePreference_Should_Work_With_All_Proficiency_Levels(level: Intermediate) [< 1 ms]
  Passed LankaConnect.Domain.Tests.Users.ValueObjects.LanguagePreferenceTests.LanguagePreference_Should_Work_With_All_Proficiency_Levels(level: Advanced) [< 1 ms]
  Passed LankaConnect.Domain.Tests.Users.ValueObjects.LanguagePreferenceTests.LanguagePreference_Should_Work_With_All_Proficiency_Levels(level: Basic) [< 1 ms]
  Passed LankaConnect.Application.Tests.Businesses.Commands.DeleteBusinessCommandHandlerTests.Handle_WhenUnitOfWorkFails_ShouldPropagateException [41 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.DeleteEventVideoCommandTests.Handle_WithNonExistentEvent_ShouldReturnFailure [15 ms]
  Passed LankaConnect.Domain.Tests.Users.ValueObjects.LanguagePreferenceTests.LanguagePreference_ToString_Should_Return_Meaningful_String [13 ms]
  Passed LankaConnect.Application.Tests.Auth.LoginUserHandlerTests.Handle_WithUnverifiedEmail_ShouldReturnFailure [67 ms]
  Passed LankaConnect.Domain.Tests.Users.ValueObjects.LanguagePreferenceTests.LanguagePreference_Equality_Should_Be_Case_Sensitive_For_Language [< 1 ms]
  Passed LankaConnect.Domain.Tests.Users.ValueObjects.LanguagePreferenceTests.LanguagePreference_Should_Support_Equality_By_Language_And_Proficiency [< 1 ms]
  Passed LankaConnect.Domain.Tests.Users.ValueObjects.LanguagePreferenceTests.Create_Should_Return_Success_For_Valid_Inputs [< 1 ms]
  Passed LankaConnect.Application.Tests.Businesses.Commands.DeleteBusinessCommandHandlerTests.Handle_WithCancellationToken_ShouldPassTokenToRepository [14 ms]
  Passed LankaConnect.Domain.Tests.Users.ValueObjects.LanguagePreferenceTests.LanguagePreference_Should_Be_Immutable [1 ms]
  Passed LankaConnect.Domain.Tests.Users.ValueObjects.LanguagePreferenceTests.Create_Should_Return_Failure_For_Null_LanguageCode [< 1 ms]
  Passed LankaConnect.Domain.Tests.Users.ValueObjects.LanguagePreferenceTests.LanguagePreference_Should_Have_LanguageCode_And_ProficiencyLevel [1 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.DeleteEventVideoCommandTests.Handle_ShouldRaiseDomainEvent [15 ms]
  Passed LankaConnect.Application.Tests.Businesses.Commands.DeleteBusinessCommandHandlerTests.Handle_WithValidGuids_ShouldProcessCorrectly(guidString: "d290f1ee-6c54-4b01-90e6-d701748f0851") [8 ms]
  Passed LankaConnect.Application.Tests.Users.Enums.IdentityProviderTests.RequiresPasswordHash_ShouldReturnCorrectValue(provider: EntraExternal, expectedRequiresPassword: False) [11 ms]
  Passed LankaConnect.Application.Tests.Businesses.Commands.DeleteBusinessCommandHandlerTests.Handle_WithValidGuids_ShouldProcessCorrectly(guidString: "123e4567-e89b-12d3-a456-426614174000") [7 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.AddVideoToEventCommandTests.Handle_WithValidVideo_ShouldSucceed [357 ms]
  Passed LankaConnect.Application.Tests.Users.Enums.IdentityProviderTests.RequiresPasswordHash_ShouldReturnCorrectValue(provider: Local, expectedRequiresPassword: True) [1 ms]
  Passed LankaConnect.Application.Tests.Users.Enums.IdentityProviderTests.IdentityProvider_ShouldHaveEntraExternalValue [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Enums.IdentityProviderTests.EmailPreVerified_ShouldReturnCorrectValue(provider: Local, expectedEmailPreVerified: False) [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Enums.IdentityProviderTests.EmailPreVerified_ShouldReturnCorrectValue(provider: EntraExternal, expectedEmailPreVerified: True) [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Enums.IdentityProviderTests.IsExternalProvider_ShouldReturnCorrectValue(provider: EntraExternal, expectedIsExternal: True) [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Enums.IdentityProviderTests.IsExternalProvider_ShouldReturnCorrectValue(provider: Local, expectedIsExternal: False) [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Enums.IdentityProviderTests.RequiresExternalProviderId_ShouldReturnCorrectValue(provider: EntraExternal, expectedRequiresExternalId: True) [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Enums.IdentityProviderTests.RequiresExternalProviderId_ShouldReturnCorrectValue(provider: Local, expectedRequiresExternalId: False) [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Enums.IdentityProviderTests.ToDisplayName_ShouldReturnCorrectDisplayName(provider: EntraExternal, expectedDisplayName: "Microsoft Entra External ID") [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Enums.IdentityProviderTests.ToDisplayName_ShouldReturnCorrectDisplayName(provider: Local, expectedDisplayName: "Local") [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Enums.IdentityProviderTests.IdentityProvider_ShouldHaveLocalValue [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.DeleteEventVideoCommandTests.Handle_WithMultipleVideos_ShouldRemoveCorrectOne [21 ms]
  Passed LankaConnect.Application.Tests.Businesses.Commands.DeleteBusinessCommandHandlerTests.Handle_WhenBusinessNotFound_ShouldThrowBusinessNotFoundException [14 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.AddVideoToEventCommandTests.Handle_WithNonExistentEvent_ShouldReturnFailure [14 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserUpdatePreferredMetroAreasTests.UpdatePreferredMetroAreas_Should_Allow_Exactly_10_Metro_Areas [10 ms]
  Passed LankaConnect.Application.Tests.Businesses.Commands.DeleteBusinessCommandHandlerTests.Handle_WithEmptyGuid_ShouldThrowBusinessNotFoundException [7 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventRemoveVideoTests.RemoveVideo_ShouldRaiseDomainEvent [3 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventRemoveVideoTests.RemoveVideo_WithValidVideoId_ShouldSucceed [1 ms]
  Passed LankaConnect.Application.Tests.Businesses.Commands.DeleteBusinessCommandHandlerTests.Handle_WhenRepositoryThrowsException_ShouldPropagateException [8 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventRemoveVideoTests.RemoveVideo_ShouldResequenceRemainingVideos [2 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserUpdatePreferredMetroAreasTests.UpdatePreferredMetroAreas_Event_Should_Contain_User_Id_And_Metro_Area_Ids [15 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventRemoveVideoTests.RemoveVideo_WithNonExistentVideoId_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Communications.Commands.SendPasswordResetCommandHandlerTests.Handle_WhenDatabaseThrowsException_ShouldReturnFailure [227 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.AddVideoToEventCommandTests.Handle_WhenMaxVideosReached_ShouldReturnFailure [18 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.SignUpManagementTests.UpdateDetails_EnablingNewCategory_ShouldSucceed [2 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventRemoveVideoTests.RemoveVideo_WhenNoVideos_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.SignUpManagementTests.UpdateDetails_WithWhitespaceInCategoryAndDescription_ShouldTrim [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventRemoveVideoTests.RemoveVideo_LastVideo_ShouldSucceed [1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.SignUpManagementTests.UpdateDetails_DisablingCategoryWithItems_ShouldFail [1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventRemoveVideoTests.RemoveVideo_DomainEventShouldIncludeBlobNames [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.SignUpManagementTests.UpdateDetails_WithEmptyDescription_ShouldFail [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.AttendeeDetailsTests.Create_WithInvalidAgeCategory_ShouldFail(invalidCategory: 0) [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.AttendeeDetailsTests.Create_WithInvalidAgeCategory_ShouldFail(invalidCategory: 99) [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.AttendeeDetailsTests.Create_ShouldTrimWhitespaceFromName [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserUpdatePreferredMetroAreasTests.UpdatePreferredMetroAreas_Should_Replace_Existing_Metro_Areas [4 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.AttendeeDetailsTests.ValueObjectEquality_WithSameValues_ShouldBeEqual(name: "Jane Smith", ageCategory: Child) [2 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.AttendeeDetailsTests.ValueObjectEquality_WithSameValues_ShouldBeEqual(name: "John Doe", ageCategory: Adult) [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.AttendeeDetailsTests.Create_WithInvalidName_ShouldFail(invalidName: "   ") [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.AttendeeDetailsTests.Create_WithInvalidName_ShouldFail(invalidName: null) [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.AttendeeDetailsTests.Create_WithInvalidName_ShouldFail(invalidName: "") [< 1 ms]
  Passed LankaConnect.Application.Tests.Communications.Commands.SendPasswordResetCommandHandlerTests.Handle_WithForceResend_ShouldBypassRateLimiting [11 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserUpdatePreferredMetroAreasTests.UpdatePreferredMetroAreas_Should_Fail_When_More_Than_20_Metro_Areas [4 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.AttendeeDetailsTests.Create_WithValidAgeCategories_ShouldSucceed(name: "Jane Smith", ageCategory: Child) [1 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.SendEventNotificationCommandHandlerTests.Handle_WithValidCommand_ShouldSucceed [103 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.AttendeeDetailsTests.Create_WithValidAgeCategories_ShouldSucceed(name: "Alice Williams", ageCategory: Child) [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.AttendeeDetailsTests.Create_WithValidAgeCategories_ShouldSucceed(name: "John Doe", ageCategory: Adult) [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.AttendeeDetailsTests.Create_WithValidAgeCategories_ShouldSucceed(name: "Bob Johnson", ageCategory: Adult) [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.AttendeeDetailsTests.Create_WithValidNameAndAgeCategory_ShouldSucceed [< 1 ms]
  Passed LankaConnect.Application.Tests.Auth.LoginUserHandlerTests.Handle_WithInactiveUser_ShouldReturnFailure [65 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventCategoryAndPricingTests.Create_WithDifferentCurrencies_ShouldSucceed(amount: 1500, currency: LKR) [1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.AttendeeDetailsTests.ValueObjectEquality_WithDifferentAgeCategories_ShouldNotBeEqual [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventCategoryAndPricingTests.Create_WithDifferentCurrencies_ShouldSucceed(amount: 20, currency: EUR) [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.AttendeeDetailsTests.ValueObjectEquality_WithDifferentNames_ShouldNotBeEqual [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventCategoryAndPricingTests.Create_WithDifferentCurrencies_ShouldSucceed(amount: 15, currency: GBP) [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventCategoryAndPricingTests.Create_WithDifferentCurrencies_ShouldSucceed(amount: 30, currency: AUD) [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.SignUpManagementTests.CreateSignUpList_WithPredefinedItems_ShouldSucceed [12 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserUpdatePreferredMetroAreasTests.UpdatePreferredMetroAreas_Should_Add_Metro_Areas_Successfully [3 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.SignUpManagementTests.UpdateDetails_WithValidData_ShouldSucceed [< 1 ms]
  Passed LankaConnect.Application.Tests.Communications.Commands.SendPasswordResetCommandHandlerTests.Handle_WithInvalidEmail_ShouldReturnFailure [4 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.AttendeeDetailsTests.ToString_ShouldReturnFormattedString [2 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventCategoryAndPricingTests.Create_WithDifferentCurrencies_ShouldSucceed(amount: 25, currency: CAD) [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventCategoryAndPricingTests.Create_WithDifferentCurrencies_ShouldSucceed(amount: 10, currency: USD) [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.SignUpManagementTests.AddMultipleSignUpLists_ToEvent_ShouldSucceed [13 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserUpdatePreferredMetroAreasTests.UpdatePreferredMetroAreas_Should_Allow_Empty_Collection [14 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.AddVideoToEventCommandTests.Handle_WithEmptyVideo_ShouldReturnFailure [30 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.TicketPricingTests.Create_WithNullAdultPrice_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.SignUpManagementTests.UpdateDetails_DisablingSuggestedCategoryWithItems_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventCategoryAndPricingTests.IsFree_WithNullTicketPrice_ShouldReturnTrue [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserUpdatePreferredMetroAreasTests.UpdatePreferredMetroAreas_Should_Remove_Duplicates [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserUpdatePreferredMetroAreasTests.UpdatePreferredMetroAreas_Should_Not_Raise_Event_When_Clearing_Preferences [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserUpdatePreferredMetroAreasTests.UpdatePreferredMetroAreas_Should_Raise_Domain_Event [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventCategoryAndPricingTests.Create_WithAllEventCategories_ShouldSucceed(category: Charity) [1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserUpdatePreferredMetroAreasTests.UpdatePreferredMetroAreas_Should_Allow_Null_Collection [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventCategoryAndPricingTests.Create_WithAllEventCategories_ShouldSucceed(category: Community) [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventCategoryAndPricingTests.Create_WithAllEventCategories_ShouldSucceed(category: Religious) [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventCategoryAndPricingTests.Create_WithAllEventCategories_ShouldSucceed(category: Social) [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventCategoryAndPricingTests.Create_WithAllEventCategories_ShouldSucceed(category: Cultural) [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventCategoryAndPricingTests.Create_WithAllEventCategories_ShouldSucceed(category: Entertainment) [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventCategoryAndPricingTests.Create_WithAllEventCategories_ShouldSucceed(category: Business) [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventCategoryAndPricingTests.Create_WithAllEventCategories_ShouldSucceed(category: Educational) [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventCategoryAndPricingTests.Create_WithDefaultCategory_ShouldSetCommunityCategory [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserUpdatePreferredMetroAreasTests.UpdatePreferredMetroAreas_Should_Allow_Single_Metro_Area [1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.TicketPricingTests.Create_WithAgeLimitButNoChildPrice_ShouldFail [6 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.TicketPricingTests.Create_WithChildPriceButNoAgeLimit_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventCategoryAndPricingTests.Create_WithCategoryAndPrice_ShouldSetBothProperties [4 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventCategoryAndPricingTests.IsFree_WithZeroTicketPrice_ShouldReturnTrue [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.TicketPricingTests.IsChildAge_WithVariousAges_ShouldReturnCorrectResult(age: 12, expected: True) [1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.TicketPricingTests.IsChildAge_WithVariousAges_ShouldReturnCorrectResult(age: 5, expected: True) [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventCategoryAndPricingTests.Create_FreeCharityEvent_ShouldHaveCorrectProperties [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.TicketPricingTests.IsChildAge_WithVariousAges_ShouldReturnCorrectResult(age: 13, expected: False) [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.TicketPricingTests.IsChildAge_WithVariousAges_ShouldReturnCorrectResult(age: 0, expected: False) [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventCategoryAndPricingTests.IsFree_WithNonZeroTicketPrice_ShouldReturnFalse [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventCategoryAndPricingTests.Create_PaidEntertainmentEvent_ShouldHaveCorrectProperties [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.SignUpManagementTests.CancelCommitment_ShouldRaiseDomainEvent [11 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventCategoryAndPricingTests.Create_WithValidCategory_ShouldSetCategory [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventCategoryAndPricingTests.Create_WithZeroTicketPrice_ShouldCreateFreeEvent [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventCategoryAndPricingTests.Create_WithValidTicketPrice_ShouldSetTicketPrice [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.TicketPricingTests.ValueObjectEquality_WithSameValues_ShouldBeEqual [2 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventCategoryAndPricingTests.Create_WithNullTicketPrice_ShouldCreateFreeEvent [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.TicketPricingTests.Create_WithChildPriceGreaterThanAdultPrice_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.SignUpManagementTests.GetUserCommitment_WhenExists_ShouldReturnCommitment [1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.TicketPricingTests.ValueObjectEquality_WithDifferentValues_ShouldNotBeEqual [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.TicketPricingTests.IsChildAge_WhenNoChildPricing_ShouldAlwaysReturnFalse [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.TicketPricingTests.Create_WithDifferentCurrencies_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.SignUpManagementTests.RemoveSignUpList_FromEvent_ShouldSucceed [2 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.TicketPricingTests.Create_WithValidAdultAndChildPrices_ShouldSucceed [2 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.TicketPricingTests.CalculateForCategory_ForAdult_ShouldReturnAdultPrice [< 1 ms]
  Passed LankaConnect.Application.Tests.Communications.Commands.VerifyEmailCommandHandlerTests.Handle_WithUserNotFound_ShouldReturnFailure [13 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.SignUpManagementTests.RemoveSignUpList_WithCommitments_ShouldFail [2 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.TicketPricingTests.Create_WithInvalidChildAgeLimit_ShouldFail(invalidAge: -1) [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.TicketPricingTests.Create_WithInvalidChildAgeLimit_ShouldFail(invalidAge: 0) [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.SignUpManagementTests.UpdateDetails_ShouldRaiseSignUpListUpdatedEvent [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.TicketPricingTests.Create_WithInvalidChildAgeLimit_ShouldFail(invalidAge: 100) [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.TicketPricingTests.Create_WithInvalidChildAgeLimit_ShouldFail(invalidAge: 19) [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.TicketPricingTests.CalculateForCategory_WithNoChildPricing_ShouldReturnAdultPrice [< 1 ms]
  Passed LankaConnect.Application.Tests.Communications.Commands.VerifyEmailCommandHandlerTests.Handle_WithCancellationToken_ShouldRespectCancellation [2 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.SignUpManagementTests.UserCommitsToPredefinedSignUp_WithValidItem_ShouldSucceed [1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.TicketPricingTests.Create_WithAdultPriceOnly_ShouldSucceed [1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.SignUpManagementTests.UserCancelsCommitment_ShouldSucceed [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.TicketPricingTests.CalculateForCategory_ForChild_ShouldReturnChildPrice [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.SignUpManagementTests.AddSignUpList_ToEvent_ShouldSucceed [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.SignUpManagementTests.AddCommitment_ShouldRaiseDomainEvent [1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.SignUpManagementTests.CreateSignUpList_WithValidData_ShouldSucceed [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.SignUpManagementTests.UpdateDetails_WithNoCategoryFlags_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeTests.Update_WithNameExceeding50Characters_ShouldFail [3 ms]
  Passed LankaConnect.Application.Tests.Communications.Commands.VerifyEmailCommandHandlerTests.Handle_WithAlreadyVerifiedUser_ShouldReturnSuccess [5 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeTests.Create_WithEmptyBlobName_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeTests.UpdateDefaultDuration_ShouldSetNewDuration [< 1 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeTests.CanDelete_CustomBadge_ShouldReturnTrue [< 1 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeTests.Update_WithEmptyName_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeTests.Deactivate_SystemBadge_ShouldSucceed [1 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeTests.CreateSystemBadge_ShouldTrimName [< 1 ms]
  Passed LankaConnect.Application.Tests.Communications.Commands.VerifyEmailCommandHandlerTests.Handle_WithInvalidToken_ShouldReturnFailure [4 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeTests.Create_WithDifferentPositions_ShouldSucceed(position: BottomRight) [1 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeTests.Create_WithDifferentPositions_ShouldSucceed(position: TopLeft) [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Commands.UnlinkExternalProviderCommandHandlerTests.Handle_ShouldRaiseDomainEvent [19 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeTests.Create_WithDifferentPositions_ShouldSucceed(position: TopRight) [< 1 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeTests.Create_WithDifferentPositions_ShouldSucceed(position: BottomLeft) [< 1 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeTests.CreateSystemBadge_WithEmptyName_ShouldThrowException [1 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeTests.CanDelete_SystemBadge_ShouldReturnFalse [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.AddVideoToEventCommandTests.Handle_WhenDomainOperationFails_ShouldRollbackUploads [36 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeTests.CreateSystemBadge_WithValidData_ShouldSucceed [2 ms]
  Passed LankaConnect.Application.Tests.Communications.Commands.VerifyEmailCommandHandlerTests.Handle_WithValidToken_ShouldVerifyEmailAndSendWelcomeEmail [6 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeTests.Deactivate_InactiveBadge_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeTests.Create_WithoutDuration_ShouldHaveNullDefaultDurationDays [< 1 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeTests.Create_WithZeroOrNegativeDuration_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeTests.Create_WithDefaultDuration_ShouldSetDefaultDurationDays [< 1 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeTests.Create_WithEmptyCreatorUserId_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.SignUpManagementTests.HasUserCommitted_WhenCommitted_ShouldReturnTrue [14 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeTests.Create_ShouldTrimName [< 1 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeTests.CreateSystemBadge_WithDuration_ShouldSetDefaultDurationDays [< 1 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeTests.Update_SystemBadge_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeTests.Create_WithEmptyName_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeTests.Create_WithEmptyImageUrl_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeTests.Update_WithNegativeDisplayOrder_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeTests.Deactivate_ActiveBadge_ShouldSucceed [< 1 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeTests.Create_WithNameExceeding50Characters_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeTests.Create_WithWhitespaceName_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeTests.UpdateDefaultDuration_WithNull_ShouldRemoveDuration [< 1 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeTests.CreateSystemBadge_WithoutDuration_ShouldHaveNullDefaultDurationDays [< 1 ms]
  Passed LankaConnect.Application.Tests.Auth.LoginUserHandlerTests.Handle_WithValidCredentials_ShouldReturnSuccessWithTokens [63 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeTests.Create_WithNegativeDisplayOrder_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeTests.Create_WithValidData_ShouldSucceed [1 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeTests.Activate_InactiveBadge_ShouldSucceed [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Commands.UnlinkExternalProviderCommandHandlerTests.Handle_WhenUserHasOtherProviders_ShouldUnlinkSuccessfully [16 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeTests.UpdateImage_WithEmptyBlobName_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeTests.UpdateDefaultDuration_WithZeroOrNegative_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Queries.GetNearbyEventsQueryHandlerTests.Handle_WithInvalidCoordinates_ShouldReturnFailure(latitude: 91, longitude: 79.8612) [13 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeTests.Update_CustomBadge_WithValidData_ShouldSucceed [< 1 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeTests.UpdateImage_WithEmptyUrl_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeTests.Activate_ActiveBadge_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Queries.GetNearbyEventsQueryHandlerTests.Handle_WithInvalidCoordinates_ShouldReturnFailure(latitude: 6.9271, longitude: 181) [1 ms]
  Passed LankaConnect.Application.Tests.Events.Queries.GetNearbyEventsQueryHandlerTests.Handle_WithInvalidCoordinates_ShouldReturnFailure(latitude: 6.9271, longitude: -181) [< 1 ms]
  Passed LankaConnect.Application.Tests.Badges.Domain.BadgeTests.UpdateImage_WithValidData_ShouldSucceed [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Queries.GetNearbyEventsQueryHandlerTests.Handle_WithInvalidCoordinates_ShouldReturnFailure(latitude: -91, longitude: 79.8612) [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Queries.GetNearbyEventsQueryHandlerTests.Handle_WithInvalidRadius_ShouldReturnFailure(radiusKm: 0) [1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.SignUpManagementTests.UpdateDetails_DisablingSuggestedCategoryWithItems_AnotherScenario_ShouldFail [13 ms]
  Passed LankaConnect.Application.Tests.Auth.LoginUserHandlerTests.Handle_ShouldRecordSuccessfulLogin [9 ms]
  Passed LankaConnect.Application.Tests.Users.Commands.UnlinkExternalProviderCommandHandlerTests.Handle_ShouldCallUnitOfWorkCommit [7 ms]
  Passed LankaConnect.Application.Tests.Users.Commands.UnlinkExternalProviderCommandHandlerTests.Handle_WhenUserNotFound_ShouldReturnFailure [7 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.RegistrationUpdateDetailsTests.UpdateDetails_WithMoreThan10Attendees_ShouldFail [12 ms]
  Passed LankaConnect.Application.Tests.Communications.Commands.SendPasswordResetCommandHandlerTests.Handle_WhenRecentlySent_ShouldReturnWasRecentlySentFlag [79 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.RegistrationUpdateDetailsTests.UpdateDetails_WithNullAttendeeList_ShouldFail [1 ms]
  Passed LankaConnect.Application.Tests.Communications.Commands.SendPasswordResetCommandHandlerTests.Handle_WithLockedAccount_ShouldReturnFailure [4 ms]
  Passed LankaConnect.Application.Tests.Users.Commands.UnlinkExternalProviderCommandHandlerTests.Handle_WhenProviderNotLinked_ShouldReturnFailure [7 ms]
  Passed LankaConnect.Application.Tests.Communications.Commands.SendPasswordResetCommandHandlerTests.Handle_ShouldSetTokenWithOneHourExpiry [8 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.RegistrationUpdateDetailsTests.UpdateDetails_WithSameAttendeeCount_OnPaidRegistration_ShouldSucceed [13 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.RegistrationUpdateDetailsTests.UpdateDetails_OnPaidRegistration_RemovingAttendees_ShouldFail [1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.RegistrationUpdateDetailsTests.UpdateDetails_OnFreeEvent_WithMoreAttendees_ShouldSucceed [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.SignUpManagementTests.UserCommitsTwice_ShouldFail [28 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.SignUpManagementTests.UserCancelsNonExistentCommitment_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.SignUpManagementTests.CreateSignUpList_WithEmptyCategory_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.RegistrationUpdateDetailsTests.UpdateDetails_WithNullContact_ShouldFail [1 ms]
  Passed LankaConnect.Application.Tests.Events.Queries.GetNearbyEventsQueryHandlerTests.Handle_WithInvalidRadius_ShouldReturnFailure(radiusKm: 1001) [30 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.SignUpManagementTests.GetUserCommitment_WhenNotExists_ShouldReturnNull [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Queries.GetNearbyEventsQueryHandlerTests.Handle_WithInvalidRadius_ShouldReturnFailure(radiusKm: -5) [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.SignUpManagementTests.UserCommitsToOpenSignUp_WithValidData_ShouldSucceed [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.RegistrationUpdateDetailsTests.UpdateDetails_OnRefundedRegistration_ShouldFail [1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.SignUpManagementTests.UpdateDetails_WithEmptyCategory_ShouldFail [1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.SignUpManagementTests.CreateSignUpList_WithEmptyPredefinedItems_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.RegistrationUpdateDetailsTests.UpdateDetails_OnCancelledRegistration_ShouldFail [1 ms]
[xUnit.net 00:00:03.50]     LankaConnect.Application.Tests.Communications.Commands.SendPasswordResetCommandHandlerTests.Handle_WhenSetTokenFails_ShouldReturnFailure [SKIP]
[xUnit.net 00:00:03.51]       TODO: User.SetPasswordResetToken needs stricter validation to properly test failure scenario. Currently accepts all valid tokens.
  Passed LankaConnect.Application.Tests.Events.Domain.SignUpManagementTests.UserCommitsToPredefinedSignUp_WithInvalidItem_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.RegistrationUpdateDetailsTests.UpdateDetails_OnPaidRegistration_AddingAttendees_ShouldFail [1 ms]
  Passed LankaConnect.Application.Tests.Communications.Commands.SendPasswordResetCommandHandlerTests.Handle_WithValidEmail_ShouldSendPasswordResetEmail [11 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.RegistrationUpdateDetailsTests.UpdateDetails_With10Attendees_ShouldSucceed [< 1 ms]
  Skipped LankaConnect.Application.Tests.Communications.Commands.SendPasswordResetCommandHandlerTests.Handle_WhenSetTokenFails_ShouldReturnFailure [1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.RegistrationUpdateDetailsTests.UpdateDetails_WithValidAttendeesAndContact_ShouldSucceed [1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.RegistrationUpdateDetailsTests.UpdateDetails_ShouldUpdateTimestamp [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.RegistrationUpdateDetailsTests.UpdateDetails_ShouldUpdateContactEmail [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Commands.UnlinkExternalProviderCommandHandlerTests.Handle_WithValidData_ShouldUnlinkProviderAndReturnSuccess [21 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.RegistrationUpdateDetailsTests.UpdateDetails_WithEmptyAttendeeList_ShouldFail [1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.RegistrationUpdateDetailsTests.UpdateDetails_OnFreeEvent_WithFewerAttendees_ShouldSucceed [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Commands.CreateUserCommandHandlerTests.Handle_WithEmptyLastName_ShouldReturnFailure [7 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.RegistrationUpdateDetailsTests.UpdateDetails_OnPendingRegistration_ShouldSucceed [< 1 ms]
  Passed LankaConnect.Application.Tests.Communications.Commands.SendPasswordResetCommandHandlerTests.Handle_WhenEmailServiceFails_ShouldReturnFailure [6 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.RegistrationUpdateDetailsTests.UpdateDetails_ShouldUpdateContactPhone [3 ms]
  Passed LankaConnect.Application.Tests.Users.Commands.CreateUserCommandHandlerTests.Handle_WhenUnitOfWorkFails_ShouldPropagateException [5 ms]
  Passed LankaConnect.Application.Tests.Users.Commands.UnlinkExternalProviderCommandHandlerTests.Handle_WhenLastAuthMethod_ShouldReturnFailure [9 ms]
  Passed LankaConnect.Application.Tests.Auth.LoginUserHandlerTests.Handle_WithInvalidEmail_ShouldReturnFailure [73 ms]
  Passed LankaConnect.Application.Tests.Users.Commands.UnlinkExternalProviderCommandHandlerTests.Handle_WhenCommitFails_ShouldReturnFailure [26 ms]
  Passed LankaConnect.Application.Tests.Users.Commands.CreateUserCommandHandlerTests.Handle_WithInvalidPhoneNumber_ShouldReturnFailure [28 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserExternalLoginsTests.LinkExternalProvider_MultipleProviders_ShouldSucceed [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserExternalLoginsTests.LinkExternalProvider_WithInvalidProviderEmail_ShouldReturnFailure(invalidEmail: "") [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserExternalLoginsTests.LinkExternalProvider_WithInvalidProviderEmail_ShouldReturnFailure(invalidEmail: null) [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserExternalLoginsTests.LinkExternalProvider_WithInvalidProviderEmail_ShouldReturnFailure(invalidEmail: "   ") [< 1 ms]
  Passed LankaConnect.Application.Tests.Auth.LoginUserHandlerTests.Handle_WithLockedAccount_ShouldReturnFailure [5 ms]
  Passed LankaConnect.Application.Tests.Users.Commands.CreateUserCommandHandlerTests.Handle_WithCancellationRequested_ShouldThrowOperationCancelledException [8 ms]
  Passed LankaConnect.Application.Tests.Auth.LoginUserHandlerTests.Handle_WithTokenGenerationFailure_ShouldReturnFailure [7 ms]
  Passed LankaConnect.Application.Tests.Users.Commands.CreateUserCommandHandlerTests.Handle_WithEmptyFirstName_ShouldReturnFailure [4 ms]
  Passed LankaConnect.Application.Tests.Auth.LoginUserHandlerTests.Handle_WithNonExistentUser_ShouldReturnFailure [3 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserExternalLoginsTests.UnlinkExternalProvider_WithExistingProvider_ShouldSucceed [17 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserExternalLoginsTests.LinkExternalProvider_WithInvalidExternalId_ShouldReturnFailure(invalidId: "") [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Commands.CreateUserCommandHandlerTests.Handle_WhenRepositoryThrows_ShouldPropagateException [6 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserExternalLoginsTests.LinkExternalProvider_WithInvalidExternalId_ShouldReturnFailure(invalidId: null) [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserExternalLoginsTests.LinkExternalProvider_WithInvalidExternalId_ShouldReturnFailure(invalidId: "   ") [< 1 ms]
  Passed LankaConnect.Application.Tests.Communications.Commands.SendEmailVerificationCommandHandlerTests.Handle_WithValidEmail_ShouldSendVerificationEmail [51 ms]
  Passed LankaConnect.Application.Tests.Auth.LoginUserHandlerTests.Handle_WithRefreshTokenGenerationFailure_ShouldReturnFailure [7 ms]
  Passed LankaConnect.Application.Tests.Users.Commands.CreateUserCommandHandlerTests.Handle_WithValidCommand_ShouldCreateUserAndReturnId [5 ms]
  Passed LankaConnect.Application.Tests.Communications.Commands.SendEmailVerificationCommandHandlerTests.Handle_WithNonExistentUser_ShouldReturnFailure [5 ms]
  Passed LankaConnect.Application.Tests.Auth.LoginUserHandlerTests.Handle_WithUserWithoutPasswordHash_ShouldReturnFailure [5 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserExternalLoginsTests.UnlinkExternalProvider_WhenUserHasOtherProviders_ShouldSucceed [9 ms]
  Passed LankaConnect.Application.Tests.Communications.Commands.SendEmailVerificationCommandHandlerTests.Handle_WithInvalidEmail_ShouldReturnFailure [2 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserExternalLoginsTests.GetExternalLogin_WhenNotLinked_ShouldReturnNull [< 1 ms]
  Passed LankaConnect.Application.Tests.Common.Models.ConfigurationImportParametersTests.ConfigurationImportParameters_Should_Exist_And_Be_Instantiable [< 1 ms]
  Passed LankaConnect.Application.Tests.Common.Models.ConfigurationImportParametersTests.ConfigurationImportParameters_Should_Have_Required_Properties [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserExternalLoginsTests.LinkExternalProvider_WhenAlreadyLinked_ShouldReturnFailure [1 ms]
  Passed LankaConnect.Application.Tests.Users.Commands.CreateUserCommandHandlerTests.Handle_WhenEmailAlreadyExists_ShouldReturnFailure [8 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserExternalLoginsTests.LinkExternalProvider_ShouldRaiseDomainEvent [10 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserExternalLoginsTests.UnlinkExternalProvider_WhenNotLinked_ShouldReturnFailure [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserExternalLoginsTests.UnlinkExternalProvider_WhenUserHasPassword_ShouldSucceed [< 1 ms]
  Passed LankaConnect.Application.Tests.Communications.Commands.SendPasswordResetCommandHandlerTests.Handle_WithNonExistentUser_ShouldReturnSuccessWithUserNotFoundFlag [79 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserExternalLoginsTests.HasExternalLogin_WhenLinked_ShouldReturnTrue [1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserExternalLoginsTests.NewUser_ShouldHaveEmptyExternalLogins [< 1 ms]
  Passed LankaConnect.Domain.Tests.Users.Enums.ProficiencyLevelTests.ProficiencyLevel_Should_Cast_From_Integer(value: 4, expected: Native) [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserExternalLoginsTests.LinkExternalProvider_WithValidData_ShouldSucceed [< 1 ms]
  Passed LankaConnect.Domain.Tests.Users.Enums.ProficiencyLevelTests.ProficiencyLevel_Should_Cast_From_Integer(value: 2, expected: Intermediate) [< 1 ms]
  Passed LankaConnect.Domain.Tests.Users.Enums.ProficiencyLevelTests.ProficiencyLevel_Should_Cast_From_Integer(value: 1, expected: Basic) [< 1 ms]
  Passed LankaConnect.Domain.Tests.Users.Enums.ProficiencyLevelTests.ProficiencyLevel_Should_Cast_From_Integer(value: 3, expected: Advanced) [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Commands.CreateUserCommandHandlerTests.Handle_WithInvalidEmail_ShouldReturnFailure [13 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserExternalLoginsTests.GetExternalLogin_WhenLinked_ShouldReturnLogin [< 1 ms]
  Passed LankaConnect.Domain.Tests.Users.Enums.ProficiencyLevelTests.ProficiencyLevel_Should_Have_Correct_Integer_Value(level: Basic, expectedValue: 1) [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserExternalLoginsTests.UnlinkExternalProvider_WhenLastAuthMethod_ShouldReturnFailure [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Queries.GetNearbyEventsQueryHandlerTests.Handle_WhenNoEventsInRadius_ShouldReturnEmptyList [94 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserExternalLoginsTests.UnlinkExternalProvider_ShouldRaiseDomainEvent [1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.RegistrationContactTests.Create_WithValidEmailFormats_ShouldSucceed(validEmail: "user_name@test-domain.com") [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.RegistrationContactTests.Create_WithValidEmailFormats_ShouldSucceed(validEmail: "test@example.com") [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.RegistrationContactTests.Create_WithValidEmailFormats_ShouldSucceed(validEmail: "user.name@domain.co.uk") [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.RegistrationContactTests.Create_WithValidEmailFormats_ShouldSucceed(validEmail: "test+tag@example.com") [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.RegistrationContactTests.Create_WithValidPhoneFormats_ShouldSucceed(validPhone: "5551234567") [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.RegistrationContactTests.Create_WithValidPhoneFormats_ShouldSucceed(validPhone: "+1 (555) 123-4567") [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.RegistrationContactTests.Create_WithValidPhoneFormats_ShouldSucceed(validPhone: "+1-555-123-4567") [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.RegistrationContactTests.Create_WithValidPhoneFormats_ShouldSucceed(validPhone: "+44 20 1234 5678") [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.RegistrationContactTests.Create_WithValidPhoneFormats_ShouldSucceed(validPhone: "(555) 123-4567") [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.RegistrationContactTests.Create_WithValidPhoneFormats_ShouldSucceed(validPhone: "555-123-4567") [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.RegistrationContactTests.Create_WithInvalidPhoneNumber_ShouldFail(invalidPhone: "   ") [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.BackgroundJobs.EventReminderJobTests.ExecuteAsync_WithNoEventsInTimeWindow_ShouldNotSendAnyEmails [146 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.RegistrationContactTests.Create_WithInvalidPhoneNumber_ShouldFail(invalidPhone: "") [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.RegistrationContactTests.Create_WithInvalidPhoneNumber_ShouldFail(invalidPhone: null) [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Queries.GetNearbyEventsQueryHandlerTests.Handle_WithOptionalFilters_ShouldApplyFilters [7 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.RegistrationContactTests.ValueObjectEquality_WithDifferentEmails_ShouldNotBeEqual [19 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.RegistrationContactTests.Create_WithInvalidEmailFormat_ShouldFail(invalidEmail: "missing@domain") [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.RegistrationContactTests.Create_WithInvalidEmailFormat_ShouldFail(invalidEmail: "notanemail") [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.RegistrationContactTests.Create_WithInvalidEmailFormat_ShouldFail(invalidEmail: "@example.com") [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.RegistrationContactTests.Create_WithInvalidEmailFormat_ShouldFail(invalidEmail: "test @example.com") [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.RegistrationContactTests.Create_WithInvalidEmailFormat_ShouldFail(invalidEmail: "test@") [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.RegistrationContactTests.Create_WithInvalidEmail_ShouldFail(invalidEmail: "") [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.RegistrationContactTests.Create_WithInvalidEmail_ShouldFail(invalidEmail: null) [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.RegistrationContactTests.Create_WithInvalidEmail_ShouldFail(invalidEmail: "   ") [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.RegistrationContactTests.ToString_WithoutAddress_ShouldReturnFormattedStringWithoutAddress [1 ms]
  Passed LankaConnect.Application.Tests.Auth.LoginUserHandlerTests.Handle_WithDatabaseException_ShouldRethrowException [47 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.RegistrationContactTests.ValueObjectEquality_WithNullAndEmptyAddress_ShouldBeEqual [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.RegistrationContactTests.Create_WithEmptyAddressAfterTrim_ShouldStoreAsNull [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.RegistrationContactTests.Create_ShouldTrimWhitespaceFromAllFields [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.RegistrationContactTests.ValueObjectEquality_WithSameValues_ShouldBeEqual [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Queries.GetNearbyEventsQueryHandlerTests.Handle_WithValidCoordinatesAndRadius_ShouldReturnNearbyEvents [31 ms]
  Passed LankaConnect.Domain.Tests.Users.Enums.ProficiencyLevelTests.ProficiencyLevel_Should_Have_Correct_Integer_Value(level: Intermediate, expectedValue: 2) [43 ms]
  Passed LankaConnect.Domain.Tests.Users.Enums.ProficiencyLevelTests.ProficiencyLevel_Should_Have_Correct_Integer_Value(level: Advanced, expectedValue: 3) [< 1 ms]
  Passed LankaConnect.Domain.Tests.Users.Enums.ProficiencyLevelTests.ProficiencyLevel_Should_Have_Correct_Integer_Value(level: Native, expectedValue: 4) [< 1 ms]
  Passed LankaConnect.Domain.Tests.Users.Enums.ProficiencyLevelTests.ProficiencyLevel_Should_Support_IsDefined [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.RegistrationContactTests.Create_WithoutAddress_ShouldSucceed [13 ms]
  Passed LankaConnect.Domain.Tests.Users.Enums.ProficiencyLevelTests.ProficiencyLevel_Equality_Should_Work [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Commands.CreateUserCommandHandlerTests.Handle_WithoutOptionalFields_ShouldCreateUser [6 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.RegistrationContactTests.Create_WithAllValidFields_ShouldSucceed [4 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.RegistrationContactTests.ToString_WithAllFields_ShouldReturnFormattedString [< 1 ms]
  Passed LankaConnect.Application.Tests.Businesses.Commands.UpdateBusinessCommandHandlerTests.Handle_WithEmptyFields_ShouldHandleGracefully [67 ms]
  Passed LankaConnect.Application.Tests.Events.Services.GeoLocationServiceTests.CalculateDistanceKm_SmallDistance_ReturnsAccurateResult [3 ms]
  Passed LankaConnect.Application.Tests.Events.Services.GeoLocationServiceTests.CalculateDistanceKm_NewYorkToLondon_ReturnsAccurateDistance [< 1 ms]
  Passed LankaConnect.Application.Tests.Auth.LoginUserHandlerTests.Handle_ShouldAddRefreshTokenToUser [23 ms]
  Passed LankaConnect.Application.Tests.Events.Services.GeoLocationServiceTests.CalculateDistanceKm_SamePoint_ReturnsZero [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.GroupPricingTierTests.CoversAttendeeCount_WithInvalidAttendeeCount_ShouldReturnFalse(invalidCount: -1) [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Services.GeoLocationServiceTests.CalculateDistanceKm_NorthToSouth_ReturnsPositiveDistance [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.GroupPricingTierTests.CoversAttendeeCount_WithInvalidAttendeeCount_ShouldReturnFalse(invalidCount: 0) [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Services.GeoLocationServiceTests.CalculateDistanceKm_IsSymmetric [< 1 ms]
  Passed LankaConnect.Domain.Tests.Users.Enums.ProficiencyLevelTests.ProficiencyLevel_Basic_Should_Be_Lowest [11 ms]
  Passed LankaConnect.Application.Tests.Events.Services.GeoLocationServiceTests.CalculateDistanceKm_ValidCoordinates_ReturnsPositiveNonZeroDistance(lat1: 40.712800000000001, lon1: -74.006, lat2: 37.774900000000002, lon2: -122.4194) [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Services.GeoLocationServiceTests.CalculateDistanceKm_ValidCoordinates_ReturnsPositiveNonZeroDistance(lat1: 34.052199999999999, lon1: -118.2437, lat2: 34.053199999999997, lon2: -118.2437) [< 1 ms]
  Passed LankaConnect.Domain.Tests.Users.Enums.ProficiencyLevelTests.ProficiencyLevel_Should_Be_Ordered_By_Proficiency [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Services.GeoLocationServiceTests.CalculateDistanceKm_ValidCoordinates_ReturnsPositiveNonZeroDistance(lat1: 0, lon1: 0, lat2: 0, lon2: 1) [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Services.GeoLocationServiceTests.CalculateDistanceKm_ValidCoordinates_ReturnsPositiveNonZeroDistance(lat1: 6.9271000000000003, lon1: 79.861199999999997, lat2: 7.2906000000000004, lon2: 80.633700000000005) [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Services.GeoLocationServiceTests.CalculateDistanceKm_EquatorPoints_CalculatesCorrectly [< 1 ms]
  Passed LankaConnect.Domain.Tests.Users.Enums.ProficiencyLevelTests.ProficiencyLevel_Should_Include_Advanced [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Services.GeoLocationServiceTests.CalculateDistanceKm_ColombToKandy_ReturnsAccurateDistance [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Services.GeoLocationServiceTests.CalculateDistanceKm_CrossingDateLine_CalculatesCorrectly [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Services.GeoLocationServiceTests.CalculateDistanceKm_PolarRegions_HandlesHighLatitudes [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.GroupPricingTierTests.ToString_WithUnlimitedTier_ShouldFormatCorrectly [2 ms]
  Passed LankaConnect.Application.Tests.Events.Services.GeoLocationServiceTests.CalculateDistanceKm_LosAngelesToSanFrancisco_ReturnsAccurateDistance [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.GroupPricingTierTests.Create_WithNegativePricePerPerson_ShouldFail [< 1 ms]
  Passed LankaConnect.Domain.Tests.Users.Enums.ProficiencyLevelTests.ProficiencyLevel_Should_Include_Native [1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.GroupPricingTierTests.Create_WithInvalidMinAttendees_ShouldFail(invalidMin: -10) [22 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserLocationTests.Create_WithCountryExceedingMaxLength_ShouldReturnFailure [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.GroupPricingTierTests.Create_WithInvalidMinAttendees_ShouldFail(invalidMin: 0) [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.GroupPricingTierTests.Create_WithInvalidMinAttendees_ShouldFail(invalidMin: -1) [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserLocationTests.Create_WithInvalidState_ShouldReturnFailure(city: "Los Angeles", state: "", zipCode: "90001", country: "United States") [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserLocationTests.Create_WithInvalidState_ShouldReturnFailure(city: "Los Angeles", state: "   ", zipCode: "90001", country: "United States") [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserLocationTests.Create_WithInvalidState_ShouldReturnFailure(city: "Los Angeles", state: null, zipCode: "90001", country: "United States") [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserLocationTests.ToString_ShouldReturnFormattedString [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.GroupPricingTierTests.ValueObjectEquality_WithSameValues_ShouldBeEqual [1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserLocationTests.Create_WithInvalidCountry_ShouldReturnFailure(city: "Los Angeles", state: "California", zipCode: "90001", country: null) [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserLocationTests.Create_WithInvalidCountry_ShouldReturnFailure(city: "Los Angeles", state: "California", zipCode: "90001", country: "   ") [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserLocationTests.Create_WithInvalidCountry_ShouldReturnFailure(city: "Los Angeles", state: "California", zipCode: "90001", country: "") [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserLocationTests.Create_WithInvalidZipCode_ShouldReturnFailure(city: "Los Angeles", state: "California", zipCode: "   ", country: "United States") [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.GroupPricingTierTests.OverlapsWith_WithUnlimitedTierAndDefinedTier_ShouldDetectOverlap [1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserLocationTests.Create_WithInvalidZipCode_ShouldReturnFailure(city: "Los Angeles", state: "California", zipCode: null, country: "United States") [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserLocationTests.Create_WithInvalidZipCode_ShouldReturnFailure(city: "Los Angeles", state: "California", zipCode: "", country: "United States") [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.BackgroundJobs.EventReminderJobTests.ExecuteAsync_WithAuthenticatedUserRegistration_ShouldSendEmailToUserEmail [80 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.GroupPricingTierTests.Create_WithNullPricePerPerson_ShouldFail [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.GroupPricingTierTests.Create_WithValidMinMaxAndPrice_ShouldSucceed [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.GroupPricingTierTests.OverlapsWith_WithAdjacentRanges_ShouldReturnFalse [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.GroupPricingTierTests.Create_WithMaxAttendeesLessThanMin_ShouldFail [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.GroupPricingTierTests.CoversAttendeeCount_WithDefinedMaxAttendees_ShouldReturnCorrectResult(attendeeCount: 3, expected: False) [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.GroupPricingTierTests.CoversAttendeeCount_WithDefinedMaxAttendees_ShouldReturnCorrectResult(attendeeCount: 1, expected: True) [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.GroupPricingTierTests.CoversAttendeeCount_WithDefinedMaxAttendees_ShouldReturnCorrectResult(attendeeCount: 2, expected: True) [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.GroupPricingTierTests.Create_WithNullMaxAttendees_ShouldSucceed [< 1 ms]
  Passed LankaConnect.Application.Tests.Businesses.Commands.UpdateBusinessCommandHandlerTests.Handle_WithCancellationToken_ShouldPassTokenToRepository [37 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.GroupPricingTierTests.OverlapsWith_WithOverlappingRanges_ShouldReturnTrue [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.GroupPricingTierTests.CoversAttendeeCount_WithUnlimitedTier_ShouldReturnCorrectResult(attendeeCount: 2, expected: False) [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.GroupPricingTierTests.CoversAttendeeCount_WithUnlimitedTier_ShouldReturnCorrectResult(attendeeCount: 5, expected: True) [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.GroupPricingTierTests.CoversAttendeeCount_WithUnlimitedTier_ShouldReturnCorrectResult(attendeeCount: 100, expected: True) [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.GroupPricingTierTests.CoversAttendeeCount_WithUnlimitedTier_ShouldReturnCorrectResult(attendeeCount: 3, expected: True) [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.GroupPricingTierTests.ToString_WithDefinedMaxAttendees_ShouldFormatCorrectly [1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.GroupPricingTierTests.OverlapsWith_WithTwoUnlimitedTiers_ShouldReturnTrue [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.GroupPricingTierTests.ValueObjectEquality_WithDifferentPrices_ShouldNotBeEqual [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.GroupPricingTierTests.Create_WithMinAttendeesEqualToMax_ShouldSucceed [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.GroupPricingTierTests.ValueObjectEquality_WithDifferentMinAttendees_ShouldNotBeEqual [< 1 ms]
  Passed LankaConnect.Application.Tests.Businesses.Commands.UpdateBusinessCommandHandlerTests.Handle_WithVariousUsPhoneFormats_ShouldUpdateSuccessfully(phoneNumber: "+1-212-555-1234") [5 ms]
  Passed LankaConnect.Application.Tests.Events.BackgroundJobs.EventReminderJobTests.ExecuteAsync_UserNotFound_ShouldSkipRegistrationAndContinue [10 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventOrganizerContactDetailsTests.SetOrganizerContactDetails_VeryLongName_ShouldSucceed [< 1 ms]
  Passed LankaConnect.Application.Tests.Businesses.Commands.UpdateBusinessCommandHandlerTests.Handle_WithVariousUsPhoneFormats_ShouldUpdateSuccessfully(phoneNumber: "+1-555-123-4567") [3 ms]
  Passed LankaConnect.Application.Tests.Businesses.Commands.UpdateBusinessCommandHandlerTests.Handle_WithVariousUsPhoneFormats_ShouldUpdateSuccessfully(phoneNumber: "+1-800-555-0199") [2 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserLocationTests.Create_WithInvalidCity_ShouldReturnFailure(city: "   ", state: "California", zipCode: "90001", country: "United States") [4 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserLocationTests.Create_WithInvalidCity_ShouldReturnFailure(city: "", state: "California", zipCode: "90001", country: "United States") [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserLocationTests.Create_WithInvalidCity_ShouldReturnFailure(city: null, state: "California", zipCode: "90001", country: "United States") [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserLocationTests.Create_WithCityExceedingMaxLength_ShouldReturnFailure [< 1 ms]
  Passed LankaConnect.Application.Tests.Businesses.Commands.UpdateBusinessCommandHandlerTests.Handle_WhenRepositoryThrowsException_ShouldPropagateException [7 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserLocationTests.TwoLocationsWithSameValues_ShouldBeEqual [1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserLocationTests.Create_ShouldTrimWhitespace [1 ms]
  Passed LankaConnect.Application.Tests.Events.BackgroundJobs.EventReminderJobTests.ExecuteAsync_ExceptionDuringProcessing_ShouldThrowForHangfireRetry [17 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserLocationTests.Create_WithInternationalAddress_ShouldSucceed [1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserLocationTests.Create_WithStateExceedingMaxLength_ShouldReturnFailure [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserLocationTests.Create_WithValidParameters_ShouldSucceed [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserLocationTests.TwoLocationsWithDifferentValues_ShouldNotBeEqual [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserLocationTests.Create_WithUKAddress_ShouldSucceed [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserLocationTests.Create_WithZipCodeExceedingMaxLength_ShouldReturnFailure [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventOrganizerContactDetailsTests.SetOrganizerContactDetails_WithValidDataAllFields_ShouldSucceed [22 ms]
  Passed LankaConnect.Application.Tests.Businesses.Commands.UpdateBusinessCommandHandlerTests.Handle_WithUsPhoneNumberUpdate_ShouldUpdateContactInfo [19 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventOrganizerContactDetailsTests.SetOrganizerContactDetails_ValidEmailFormats_ShouldSucceed(validEmail: "test123@subdomain.example.com") [24 ms]
  Passed LankaConnect.Domain.Tests.Users.Enums.ProficiencyLevelTests.ProficiencyLevel_Values_Should_Be_Sequential [91 ms]
  Passed LankaConnect.Domain.Tests.Users.Enums.ProficiencyLevelTests.ProficiencyLevel_Should_Include_Intermediate [< 1 ms]
  Passed LankaConnect.Domain.Tests.Users.Enums.ProficiencyLevelTests.ProficiencyLevel_ToString_Should_Return_Name [< 1 ms]
  Passed LankaConnect.Domain.Tests.Users.Enums.ProficiencyLevelTests.ProficiencyLevel_Should_Include_Basic [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventOrganizerContactDetailsTests.SetOrganizerContactDetails_ValidEmailFormats_ShouldSucceed(validEmail: "user.name@example.com") [8 ms]
  Passed LankaConnect.Application.Tests.Events.BackgroundJobs.EventReminderJobTests.ExecuteAsync_WithAnonymousRegistrationUsingContact_ShouldSendEmailToContactEmail [41 ms]
  Passed LankaConnect.Domain.Tests.Users.Enums.ProficiencyLevelTests.ProficiencyLevel_Should_Not_Have_Zero_Value [2 ms]
  Passed LankaConnect.Domain.Tests.Users.Enums.ProficiencyLevelTests.ProficiencyLevel_Should_Have_Four_Levels [2 ms]
  Passed LankaConnect.Application.Tests.Businesses.Commands.UpdateBusinessCommandHandlerTests.Handle_WhenBusinessNotFound_ShouldThrowBusinessNotFoundException [30 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventOrganizerContactDetailsTests.SetOrganizerContactDetails_ValidEmailFormats_ShouldSucceed(validEmail: "user+tag@example.co.uk") [6 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.UpdateRegistrationDetailsCommandHandlerTests.Handle_PaidRegistration_ChangingAttendeeCount_ShouldFail [46 ms]
  Passed LankaConnect.Domain.Tests.Users.Enums.ProficiencyLevelTests.ProficiencyLevel_Native_Should_Be_Highest [8 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.FederatedProviderTests.ToIdpClaimValue_ShouldReturnCorrectClaimValue(provider: Apple, expectedClaim: "appleid.apple.com") [< 1 ms]
  Passed LankaConnect.Application.Tests.Businesses.Commands.UpdateBusinessCommandHandlerTests.Handle_WithValidUpdateCommand_ShouldUpdateBusinessSuccessfully [8 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.FederatedProviderTests.ToIdpClaimValue_ShouldReturnCorrectClaimValue(provider: Facebook, expectedClaim: "facebook.com") [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.FederatedProviderTests.ToIdpClaimValue_ShouldReturnCorrectClaimValue(provider: Google, expectedClaim: "google.com") [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.FederatedProviderTests.ToIdpClaimValue_ShouldReturnCorrectClaimValue(provider: Microsoft, expectedClaim: "login.microsoftonline.com") [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.FederatedProviderTests.FromIdpClaimValue_WithValidClaim_ShouldReturnCorrectProvider(idpClaim: "facebook.com", expectedProvider: Facebook) [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.FederatedProviderTests.FromIdpClaimValue_WithValidClaim_ShouldReturnCorrectProvider(idpClaim: "appleid.apple.com", expectedProvider: Apple) [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.FederatedProviderTests.FromIdpClaimValue_WithValidClaim_ShouldReturnCorrectProvider(idpClaim: "login.microsoftonline.com", expectedProvider: Microsoft) [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.FederatedProviderTests.FromIdpClaimValue_WithValidClaim_ShouldReturnCorrectProvider(idpClaim: "google.com", expectedProvider: Google) [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.FederatedProviderTests.ToDisplayName_ShouldReturnCorrectName(provider: Facebook, expectedName: "Facebook") [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.FederatedProviderTests.ToDisplayName_ShouldReturnCorrectName(provider: Microsoft, expectedName: "Microsoft") [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.FederatedProviderTests.ToDisplayName_ShouldReturnCorrectName(provider: Google, expectedName: "Google") [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.FederatedProviderTests.ToDisplayName_ShouldReturnCorrectName(provider: Apple, expectedName: "Apple") [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.FederatedProviderTests.FromIdpClaimValue_WithInvalidClaim_ShouldReturnFailure(invalidClaim: null) [< 1 ms]
  Passed LankaConnect.Domain.Tests.Users.ValueObjects.LanguageCodeTests.FromCode_Should_Return_Success_For_Valid_ISO_Code [2 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.FederatedProviderTests.FromIdpClaimValue_WithInvalidClaim_ShouldReturnFailure(invalidClaim: "   ") [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.FederatedProviderTests.FromIdpClaimValue_WithInvalidClaim_ShouldReturnFailure(invalidClaim: "invalid.provider.com") [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.FederatedProviderTests.FromIdpClaimValue_WithInvalidClaim_ShouldReturnFailure(invalidClaim: "") [< 1 ms]
  Passed LankaConnect.Domain.Tests.Users.ValueObjects.LanguageCodeTests.LanguageCode_Should_Support_At_Least_15_Languages [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.UpdateRegistrationDetailsCommandHandlerTests.Handle_PaidRegistration_SameAttendeeCount_ShouldSucceed [7 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.FederatedProviderTests.Microsoft_ShouldBeDefaultProvider [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.BackgroundJobs.EventReminderJobTests.ExecuteAsync_EmailServiceFailure_ShouldContinueWithOtherRegistrations [16 ms]
  Passed LankaConnect.Domain.Tests.Users.ValueObjects.LanguageCodeTests.FromCode_Should_Return_Failure_For_Invalid_Code [1 ms]
  Passed LankaConnect.Domain.Tests.Users.ValueObjects.LanguageCodeTests.LanguageCode_Should_Support_Inequality_For_Different_Codes [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventAddVideoTests.AddVideo_ShouldAssignSequentialDisplayOrders [1 ms]
  Passed LankaConnect.Domain.Tests.Users.ValueObjects.LanguageCodeTests.LanguageCode_Should_Map_Code_To_Correct_Name(code: "en", expectedNamePart: "English") [< 1 ms]
  Passed LankaConnect.Domain.Tests.Users.ValueObjects.LanguageCodeTests.LanguageCode_Should_Map_Code_To_Correct_Name(code: "hi", expectedNamePart: "Hindi") [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventAddVideoTests.AddVideo_WithEmptyVideoUrl_ShouldFail [< 1 ms]
  Passed LankaConnect.Domain.Tests.Users.ValueObjects.LanguageCodeTests.LanguageCode_Should_Map_Code_To_Correct_Name(code: "si", expectedNamePart: "Sinhala") [< 1 ms]
  Passed LankaConnect.Domain.Tests.Users.ValueObjects.LanguageCodeTests.LanguageCode_Should_Map_Code_To_Correct_Name(code: "ta", expectedNamePart: "Tamil") [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventAddVideoTests.AddVideo_WithEmptyBlobName_ShouldFail [< 1 ms]
  Passed LankaConnect.Domain.Tests.Users.ValueObjects.LanguageCodeTests.LanguageCode_All_Should_Include_Sri_Lankan_Primary_Languages [1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventAddVideoTests.AddVideo_WithValidVideo_ShouldSucceed [1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventAddVideoTests.AddVideo_WithNullDuration_ShouldSucceed [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventAddVideoTests.AddVideo_ShouldRaiseDomainEvent [1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventAddVideoTests.AddVideo_WhenMaxVideosReached_ShouldFail [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.TicketPricingGroupTiersTests.FindTierForAttendeeCount_OnNonGroupTieredPricing_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Mappings.BusinessMappingProfileTests.Map_BusinessCollectionToBusinessDtoCollection_ShouldMapAll [824 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.TicketPricingGroupTiersTests.FindTierForAttendeeCount_WithValidCount_ShouldReturnCorrectTier(attendeeCount: 3, expectedTierIndex: 1) [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.TicketPricingGroupTiersTests.FindTierForAttendeeCount_WithValidCount_ShouldReturnCorrectTier(attendeeCount: 2, expectedTierIndex: 0) [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.TicketPricingGroupTiersTests.FindTierForAttendeeCount_WithValidCount_ShouldReturnCorrectTier(attendeeCount: 5, expectedTierIndex: 1) [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.TicketPricingGroupTiersTests.FindTierForAttendeeCount_WithValidCount_ShouldReturnCorrectTier(attendeeCount: 100, expectedTierIndex: 2) [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.TicketPricingGroupTiersTests.FindTierForAttendeeCount_WithValidCount_ShouldReturnCorrectTier(attendeeCount: 1, expectedTierIndex: 0) [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.TicketPricingGroupTiersTests.FindTierForAttendeeCount_WithValidCount_ShouldReturnCorrectTier(attendeeCount: 6, expectedTierIndex: 2) [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.TicketPricingGroupTiersTests.CalculateGroupPrice_WithValidCount_ShouldReturnCorrectPrice(attendeeCount: 2, expectedAmount: 30) [1 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.UpdateRegistrationDetailsCommandHandlerTests.Handle_FreeEvent_AddingAttendees_WithCapacity_ShouldSucceed [15 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventOrganizerContactDetailsTests.SetOrganizerContactDetails_ValidEmailFormats_ShouldSucceed(validEmail: "DoNotReply@7689582e-73cc-4552-b2ff-8afd9d1a6814.az") [30 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.UpdateRegistrationDetailsCommandHandlerTests.Handle_WithEmptyAttendees_ShouldReturnFailure [15 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.TicketPricingGroupTiersTests.CalculateGroupPrice_WithValidCount_ShouldReturnCorrectPrice(attendeeCount: 10, expectedAmount: 100) [20 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.TicketPricingGroupTiersTests.CalculateGroupPrice_WithValidCount_ShouldReturnCorrectPrice(attendeeCount: 3, expectedAmount: 36) [2 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.TicketPricingGroupTiersTests.CalculateGroupPrice_WithValidCount_ShouldReturnCorrectPrice(attendeeCount: 5, expectedAmount: 60) [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.TicketPricingGroupTiersTests.CalculateGroupPrice_WithValidCount_ShouldReturnCorrectPrice(attendeeCount: 6, expectedAmount: 60) [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.TicketPricingGroupTiersTests.CalculateGroupPrice_WithValidCount_ShouldReturnCorrectPrice(attendeeCount: 1, expectedAmount: 15) [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.TicketPricingGroupTiersTests.CreateGroupTiered_NotStartingAtOne_ShouldFail [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.TicketPricingGroupTiersTests.CreateGroupTiered_WithEmptyTiers_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventOrganizerContactDetailsTests.SetOrganizerContactDetails_ValidEmailFormats_ShouldSucceed(validEmail: "test@example.com") [24 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.TicketPricingGroupTiersTests.CreateGroupTiered_WithNullTiers_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Behaviors.ValidationPipelineBehaviorTests.Handle_WhenValidatorThrows_ShouldPropagateException [176 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.TicketPricingGroupTiersTests.CreateGroupTiered_WithGapInTiers_ShouldFail [8 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.TicketPricingGroupTiersTests.FindTierForAttendeeCount_WithInvalidCount_ShouldFail(invalidCount: -1) [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.TicketPricingGroupTiersTests.FindTierForAttendeeCount_WithInvalidCount_ShouldFail(invalidCount: 0) [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.UpdateRegistrationDetailsCommandHandlerTests.Handle_WithInvalidEmail_ShouldReturnFailure [23 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.TicketPricingGroupTiersTests.ValueObjectEquality_GroupTieredWithDifferentTiers_ShouldNotBeEqual [1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.TicketPricingGroupTiersTests.ToString_ForGroupTiered_ShouldFormatCorrectly [2 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.TicketPricingGroupTiersTests.ValueObjectEquality_GroupTieredWithSameTiers_ShouldBeEqual [1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventOrganizerContactDetailsTests.SetOrganizerContactDetails_VariousInvalidEmails_ShouldFail(invalidEmail: "notanemail") [15 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.TicketPricingGroupTiersTests.CreateGroupTiered_WithMixedCurrencies_ShouldFail [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.TicketPricingGroupTiersTests.CalculateGroupPrice_OnNonGroupTieredPricing_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventOrganizerContactDetailsTests.SetOrganizerContactDetails_VariousInvalidEmails_ShouldFail(invalidEmail: "test@") [1 ms]
  Passed LankaConnect.Application.Tests.Events.BackgroundJobs.EventNotificationEmailJobTests.ExecuteAsync_HistoryNotFound_ShouldLogErrorAndReturn [183 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.TicketPricingGroupTiersTests.CreateSinglePrice_WithValidPrice_ShouldSucceed [1 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.UpdateRegistrationDetailsCommandHandlerTests.Handle_WithValidCommand_ShouldUpdateRegistration [7 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.FederatedProviderTests.FederatedProvider_ShouldHave_FourProviders [63 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.TicketPricingGroupTiersTests.CreateDualPrice_WithValidPrices_ShouldSucceed [1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.FederatedProviderTests.FromIdpClaimValue_ShouldBeCaseInsensitive [< 1 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.TicketPricingGroupTiersTests.CreateGroupTiered_WithOverlappingTiers_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserUpdateCulturalInterestsTests.UpdateCulturalInterests_Should_Raise_Domain_Event [1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserUpdateCulturalInterestsTests.UpdateCulturalInterests_Should_Allow_Empty_Collection [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserUpdateCulturalInterestsTests.UpdateCulturalInterests_Should_Not_Raise_Event_When_Clearing_Interests [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventOrganizerContactDetailsTests.SetOrganizerContactDetails_VariousInvalidEmails_ShouldFail(invalidEmail: "@example.com") [7 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.TicketPricingGroupTiersTests.CreateGroupTiered_WithValidTiers_ShouldSucceed [4 ms]
  Passed LankaConnect.Domain.UnitTests.Events.ValueObjects.TicketPricingGroupTiersTests.CreateSinglePrice_WithNullPrice_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.UpdateRegistrationDetailsCommandHandlerTests.Handle_WhenRegistrationCancelled_ShouldReturnFailure [56 ms]
  Passed LankaConnect.Application.Tests.Behaviors.ValidationPipelineBehaviorTests.Handle_WithMixedValidationResults_ShouldOnlyReturnErrors [76 ms]
  Passed LankaConnect.Domain.Tests.Users.ValueObjects.LanguageCodeTests.LanguageCode_Should_Support_South_Asian_Languages [118 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.UpdateRegistrationDetailsCommandHandlerTests.Handle_WhenUserNotRegistered_ShouldReturnFailure [6 ms]
  Passed LankaConnect.Application.Tests.Behaviors.ValidationPipelineBehaviorTests.Handle_WithMultipleValidatorsHavingErrors_ShouldCombineAllErrors [9 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.UpdateRegistrationDetailsCommandHandlerTests.Handle_WithMoreThan10Attendees_ShouldReturnFailure [6 ms]
  Passed LankaConnect.Domain.Tests.Users.ValueObjects.LanguageCodeTests.LanguageCode_Should_Have_Code_And_Name [11 ms]
  Passed LankaConnect.Application.Tests.Behaviors.ValidationPipelineBehaviorTests.Handle_WithNoValidators_ShouldCallNext [2 ms]
  Passed LankaConnect.Domain.Tests.Users.ValueObjects.LanguageCodeTests.FromCode_Should_Be_Case_Insensitive [< 1 ms]
  Passed LankaConnect.Domain.Tests.Users.ValueObjects.LanguageCodeTests.LanguageCode_All_Should_Be_Ordered_Logically [< 1 ms]
  Passed LankaConnect.Domain.Tests.Users.ValueObjects.LanguageCodeTests.LanguageCode_Should_Include_Tamil [< 1 ms]
  Passed LankaConnect.Domain.Tests.Users.ValueObjects.LanguageCodeTests.FromCode_Should_Return_Failure_For_Null_Code [< 1 ms]
  Passed LankaConnect.Domain.Tests.Users.ValueObjects.LanguageCodeTests.LanguageCode_Should_Include_Sinhala [< 1 ms]
  Passed LankaConnect.Domain.Tests.Users.ValueObjects.LanguageCodeTests.FromCode_Should_Return_Failure_For_Empty_Code [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.UpdateRegistrationDetailsCommandHandlerTests.Handle_WithInvalidAttendeeName_ShouldReturnFailure [5 ms]
  Passed LankaConnect.Domain.Tests.Users.ValueObjects.LanguageCodeTests.LanguageCode_ToString_Should_Return_Name [< 1 ms]
  Passed LankaConnect.Application.Tests.Behaviors.ValidationPipelineBehaviorTests.Handle_WithValidationErrors_ShouldReturnFailureWithoutCallingNext [4 ms]
  Passed LankaConnect.Domain.Tests.Users.ValueObjects.LanguageCodeTests.LanguageCode_Should_Support_Equality_By_Code [< 1 ms]
  Passed LankaConnect.Domain.Tests.Users.ValueObjects.LanguageCodeTests.LanguageCode_Should_Provide_All_Supported_Languages [< 1 ms]
  Passed LankaConnect.Domain.Tests.Users.ValueObjects.LanguageCodeTests.LanguageCode_All_Should_Have_Unique_Codes [< 1 ms]
  Passed LankaConnect.Domain.Tests.Users.ValueObjects.LanguageCodeTests.LanguageCode_Should_Be_Immutable [< 1 ms]
  Passed LankaConnect.Domain.Tests.Users.ValueObjects.LanguageCodeTests.LanguageCode_Should_Include_English [< 1 ms]
  Passed LankaConnect.Domain.Tests.Users.ValueObjects.LanguageCodeTests.LanguageCode_Should_Have_Native_Name [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.UpdateRegistrationDetailsCommandHandlerTests.Handle_WhenEventNotFound_ShouldReturnFailure [5 ms]
  Passed LankaConnect.Application.Tests.Users.UserEntraIntegrationTests.CreateFromExternalProvider_ShouldSetEmailAsVerified [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.UserEntraIntegrationTests.ChangePassword_OnExternalProviderUser_ShouldFail [1 ms]
  Passed LankaConnect.Application.Tests.Users.UserEntraIntegrationTests.CreateFromExternalProvider_WithEmptyExternalProviderId_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Behaviors.ValidationPipelineBehaviorTests.Handle_WithCancellationRequested_ShouldThrowOperationCancelledException [6 ms]
  Passed LankaConnect.Application.Tests.Users.UserEntraIntegrationTests.CreateFromExternalProvider_ShouldNotRequirePasswordHash [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.UserEntraIntegrationTests.IsLocalProvider_ShouldReturnFalseForExternalUsers [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.UserEntraIntegrationTests.SetPassword_OnLocalProviderUser_ShouldSucceed [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.UserEntraIntegrationTests.CreateFromExternalProvider_ShouldRaiseUserCreatedFromExternalProviderEvent [2 ms]
  Passed LankaConnect.Application.Tests.Users.UserEntraIntegrationTests.SetPassword_OnExternalProviderUser_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.UserEntraIntegrationTests.IsLocalProvider_ShouldReturnTrueForLocalUsers [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.BackgroundJobs.EventNotificationEmailJobTests.ExecuteAsync_WithValidHistory_ShouldSendEmailsAndUpdateStatistics [89 ms]
  Passed LankaConnect.Application.Tests.Behaviors.ValidationPipelineBehaviorTests.Handle_WithMultipleValidators_ShouldValidateAll [7 ms]
  Passed LankaConnect.Application.Tests.Users.UserEntraIntegrationTests.CreateFromExternalProvider_WithValidData_ShouldSucceed [2 ms]
  Passed LankaConnect.Application.Tests.Users.UserEntraIntegrationTests.IsExternalProvider_ShouldReturnTrueForExternalUsers [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.UserEntraIntegrationTests.CreateFromExternalProvider_WithLocalProvider_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.UserEntraIntegrationTests.CreateFromExternalProvider_WithNullExternalProviderId_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.UserEntraIntegrationTests.CreateFromExternalProvider_WithNullEmail_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Mappings.BusinessMappingProfileTests.Map_BusinessToBusinessDto_ShouldPreserveContactInformation [146 ms]
  Passed LankaConnect.Application.Tests.Users.UserEntraIntegrationTests.Create_LocalUser_ShouldNotHaveExternalProviderId [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.UserEntraIntegrationTests.Create_LocalUser_ShouldDefaultToLocalProvider [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventOrganizerContactDetailsTests.SetOrganizerContactDetails_VariousInvalidEmails_ShouldFail(invalidEmail: "test@.com") [103 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserUpdateCulturalInterestsTests.UpdateCulturalInterests_Should_Replace_Existing_Interests [106 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserUpdateCulturalInterestsTests.UpdateCulturalInterests_Should_Allow_Exactly_10_Interests [7 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserUpdateCulturalInterestsTests.UpdateCulturalInterests_Event_Should_Contain_User_Id_And_Interests [3 ms]
  Passed LankaConnect.Application.Tests.Domain.Communications.EmailGroupTests.Update_WithInvalidEmails_ShouldFail [30 ms]
  Passed LankaConnect.Application.Tests.Events.BackgroundJobs.EventNotificationEmailJobTests.ExecuteAsync_WithFailedEmails_ShouldTrackFailureCount [40 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserUpdateCulturalInterestsTests.UpdateCulturalInterests_Should_Accept_More_Than_10_Interests [3 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserUpdateCulturalInterestsTests.UpdateCulturalInterests_Should_Remove_Duplicates [1 ms]
  Passed LankaConnect.Application.Tests.Domain.Communications.EmailGroupTests.Create_WithMixedValidAndInvalidEmails_ShouldFail [7 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserUpdateCulturalInterestsTests.UpdateCulturalInterests_Should_Add_Interests_Successfully [1 ms]
  Passed LankaConnect.Application.Tests.Mappings.BusinessMappingProfileTests.Map_BusinessToBusinessDto_ShouldHandleAllBusinessCategories [43 ms]
  Passed LankaConnect.Application.Tests.Domain.Communications.EmailGroupTests.Create_WithInvalidEmailFormats_ShouldFail(email: "invalid") [5 ms]
  Passed LankaConnect.Application.Tests.Events.BackgroundJobs.EventNotificationEmailJobTests.ExecuteAsync_EventNotFound_ShouldLogErrorAndReturn [9 ms]
  Passed LankaConnect.Application.Tests.Common.Models.ConfigurationImportResultTests.ConfigurationImportResult_Should_Exist_And_Be_Instantiable [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventOrganizerContactDetailsTests.SetOrganizerContactDetails_VariousInvalidEmails_ShouldFail(invalidEmail: "test @example.com") [9 ms]
  Passed LankaConnect.Application.Tests.Common.Models.ConfigurationImportResultTests.ConfigurationImportResult_Should_Have_Required_Properties [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventOrganizerContactDetailsTests.HasOrganizerContact_WhenPublishedButNameIsNull_ShouldReturnFalse [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventOrganizerContactDetailsTests.HasOrganizerContact_WhenNeverSet_ShouldReturnFalse [< 1 ms]
  Passed LankaConnect.Application.Tests.Domain.Communications.EmailGroupTests.Create_WithInvalidEmailFormats_ShouldFail(email: "@domain.com") [5 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserUpdateLocationTests.NewUser_ShouldHaveNullLocation [1 ms]
  Passed LankaConnect.Application.Tests.Domain.Communications.EmailGroupTests.Create_WithInvalidEmailFormats_ShouldFail(email: "user@") [1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserUpdateLocationTests.UpdateLocation_WithValidLocation_ShouldSucceed [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserUpdateLocationTests.UpdateLocation_WithNullLocation_ShouldSucceed [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserUpdateLocationTests.UpdateLocation_WithValidLocation_ShouldRaiseDomainEvent [3 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserUpdateLocationTests.UpdateLocation_WithNullLocation_ShouldNotRaiseDomainEvent [1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserUpdateLocationTests.UpdateLocation_ShouldUpdateExistingLocation [1 ms]
  Failed LankaConnect.IntegrationTests.Repositories.EmailRepositoryIntegrationTests.EmailTemplateRepository_CreateAndRetrieve_ShouldWork [1 ms]
  Error Message:
   System.InvalidOperationException : Unable to resolve service for type 'MediatR.IPublisher' while attempting to activate 'LankaConnect.Infrastructure.Data.AppDbContext'.
  Stack Trace:
     at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateArgumentCallSites(ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain, ParameterInfo[] parameters, Boolean throwIfCallSiteNotFound)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateConstructorCallSite(ResultCache lifetime, ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceDescriptor descriptor, ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain, Int32 slot)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateCallSite(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.GetCallSite(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
   at System.Collections.Concurrent.ConcurrentDictionary`2.GetOrAdd(TKey key, Func`2 valueFactory)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.GetService(ServiceIdentifier serviceIdentifier, ServiceProviderEngineScope serviceProviderEngineScope)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.GetService(Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.EnsureDatabaseCreatedAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs:line 151
   at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs:line 105
  Failed LankaConnect.IntegrationTests.Repositories.EmailRepositoryIntegrationTests.UserEmailPreferencesRepository_CreateAndRetrieve_ShouldWork [1 ms]
  Error Message:
   System.InvalidOperationException : Unable to resolve service for type 'MediatR.IPublisher' while attempting to activate 'LankaConnect.Infrastructure.Data.AppDbContext'.
  Stack Trace:
     at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateArgumentCallSites(ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain, ParameterInfo[] parameters, Boolean throwIfCallSiteNotFound)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateConstructorCallSite(ResultCache lifetime, ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceDescriptor descriptor, ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain, Int32 slot)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateCallSite(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.GetCallSite(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
   at System.Collections.Concurrent.ConcurrentDictionary`2.GetOrAdd(TKey key, Func`2 valueFactory)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.GetService(ServiceIdentifier serviceIdentifier, ServiceProviderEngineScope serviceProviderEngineScope)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.GetService(Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.EnsureDatabaseCreatedAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs:line 151
   at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs:line 105
  Failed LankaConnect.IntegrationTests.Repositories.EmailRepositoryIntegrationTests.EmailMessageRepository_CreateAndRetrieve_ShouldWork [1 ms]
  Error Message:
   System.InvalidOperationException : Unable to resolve service for type 'MediatR.IPublisher' while attempting to activate 'LankaConnect.Infrastructure.Data.AppDbContext'.
  Stack Trace:
     at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateArgumentCallSites(ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain, ParameterInfo[] parameters, Boolean throwIfCallSiteNotFound)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateConstructorCallSite(ResultCache lifetime, ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceDescriptor descriptor, ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain, Int32 slot)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateCallSite(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.GetCallSite(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
   at System.Collections.Concurrent.ConcurrentDictionary`2.GetOrAdd(TKey key, Func`2 valueFactory)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.GetService(ServiceIdentifier serviceIdentifier, ServiceProviderEngineScope serviceProviderEngineScope)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.GetService(Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.EnsureDatabaseCreatedAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs:line 151
   at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs:line 105
  Passed LankaConnect.Application.Tests.Domain.Communications.EmailGroupTests.Create_WithInvalidEmailFormats_ShouldFail(email: "user domain@test.com") [10 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.SetPrimaryImageCommandTests.Handle_WhenImageIsAlreadyPrimary_ShouldReturnSuccessWithoutChanges [21 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.SetPrimaryImageCommandTests.Handle_WithValidRequest_ShouldSetImageAsPrimarySuccessfully [10 ms]
  Passed LankaConnect.Application.Tests.Domain.Communications.EmailGroupTests.Create_WithInvalidEmailFormats_ShouldFail(email: "user@domain") [11 ms]
  Passed LankaConnect.Application.Tests.Domain.Communications.EmailGroupTests.Create_WithEmptyEmails_ShouldFail [1 ms]
  Passed LankaConnect.Application.Tests.Behaviors.ValidationPipelineBehaviorTests.Handle_WithValidRequest_ShouldCallNext [83 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserUpdateLocationTests.UpdateLocation_ShouldMarkEntityAsUpdated [19 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserUpdateLocationTests.UpdateLocation_WithInternationalLocation_ShouldSucceed [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Domain.UserUpdateLocationTests.UpdateLocation_MultipleUpdates_ShouldRaiseMultipleEvents [4 ms]
  Passed LankaConnect.Application.Tests.Domain.Communications.EmailGroupTests.GetEmailList_ShouldReturnReadOnlyList [11 ms]
  Passed LankaConnect.Application.Tests.Domain.Communications.EmailGroupTests.Create_WithEmptyName_ShouldFail [1 ms]
  Passed LankaConnect.Application.Tests.Domain.Communications.EmailGroupTests.Update_WithValidData_ShouldSucceed [20 ms]
  Passed LankaConnect.Application.Tests.Domain.Communications.EmailGroupTests.Deactivate_ShouldSetIsActiveToFalse [6 ms]
  Passed LankaConnect.Application.Tests.Domain.Communications.EmailGroupTests.Create_WithValidEmailFormats_ShouldSucceed(email: "user_name123@sub.domain.com") [6 ms]
  Passed LankaConnect.Application.Tests.Domain.Communications.EmailGroupTests.Create_WithValidEmailFormats_ShouldSucceed(email: "test@example.com") [5 ms]
  Passed LankaConnect.Application.Tests.Domain.Communications.EmailGroupTests.Create_WithValidEmailFormats_ShouldSucceed(email: "user+tag@example.co.uk") [4 ms]
  Passed LankaConnect.Application.Tests.Domain.Communications.EmailGroupTests.Create_WithValidEmailFormats_ShouldSucceed(email: "user.name@domain.org") [4 ms]
  Passed LankaConnect.Application.Tests.Domain.Communications.EmailGroupTests.Create_WithInvalidEmail_ShouldFail [5 ms]
  Passed LankaConnect.Application.Tests.Domain.Communications.EmailGroupTests.Create_WithOnlyCommasAndWhitespace_ShouldFail [4 ms]
  Passed LankaConnect.Application.Tests.Domain.Communications.EmailGroupTests.Create_WithNullDescription_ShouldSucceed [5 ms]
  Passed LankaConnect.Application.Tests.Domain.Communications.EmailGroupTests.Create_WithWhitespaceName_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Mappings.BusinessMappingProfileTests.Map_BusinessToBusinessDto_ShouldMapAllProperties [114 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.SetPrimaryImageCommandTests.Handle_WithEventWithNoImages_ShouldReturnFailure [90 ms]
  Passed LankaConnect.Application.Tests.Domain.Communications.EmailGroupTests.Create_ShouldNormalizeEmailsToLowerCase [14 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventOrganizerContactDetailsTests.SetOrganizerContactDetails_CanUpdateExistingContact_ShouldSucceed [123 ms]
  Passed LankaConnect.Application.Tests.Domain.Communications.EmailGroupTests.Create_WithValidData_ShouldSucceed [7 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventOrganizerContactDetailsTests.SetOrganizerContactDetails_EmailCaseInsensitive_ShouldNormalize [6 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventOrganizerContactDetailsTests.NewEvent_OrganizerContactFieldsDefaultToNull_ShouldBeNull [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventOrganizerContactDetailsTests.SetOrganizerContactDetails_PublishWithEmptyName_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Domain.Communications.EmailGroupTests.Create_WithExtraWhitespace_ShouldTrim [5 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.SetPrimaryImageCommandTests.Handle_WithNonExistentImage_ShouldReturnFailure [23 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventOrganizerContactDetailsTests.SetOrganizerContactDetails_CanSwitchContactMethod_ShouldSucceed [7 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.SetPrimaryImageCommandTests.Handle_WithSingleImage_ShouldSetItAsPrimary [8 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventOrganizerContactDetailsTests.SetOrganizerContactDetails_PublishFalse_ShouldClearAllFields [7 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventOrganizerContactDetailsTests.SetOrganizerContactDetails_PublishWithEmptyEmailAndPhone_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventOrganizerContactDetailsTests.SetOrganizerContactDetails_InternationalPhoneNumber_ShouldSucceed [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventOrganizerContactDetailsTests.SetOrganizerContactDetails_PublishWithoutEmailAndPhone_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventOrganizerContactDetailsTests.HasOrganizerContact_WhenNotPublished_ShouldReturnFalse [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventOrganizerContactDetailsTests.SetOrganizerContactDetails_TrimsWhitespace_ShouldSucceed [8 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventOrganizerContactDetailsTests.SetOrganizerContactDetails_PublishWithoutName_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Businesses.Queries.SearchBusinessesQueryHandlerTests.Handle_WithValidPageSize_ShouldRespectPagination [223 ms]
  Passed LankaConnect.Application.Tests.Businesses.Queries.SearchBusinessesQueryHandlerTests.Handle_WithNullSearchTerm_ShouldSearchAllBusinesses [7 ms]
  Passed LankaConnect.Application.Tests.Domain.Communications.EmailGroupTests.Update_WithEmptyName_ShouldFail [34 ms]
  Passed LankaConnect.Application.Tests.Domain.Communications.EmailGroupTests.Create_WithDuplicateEmails_ShouldDeduplicate [7 ms]
  Passed LankaConnect.Application.Tests.Businesses.Queries.SearchBusinessesQueryHandlerTests.Handle_WithValidQuery_ShouldReturnPaginatedBusinesses [10 ms]
  Passed LankaConnect.Application.Tests.Businesses.Queries.SearchBusinessesQueryHandlerTests.Handle_WithEmptyResults_ShouldReturnEmptyPaginatedList [6 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.UpdateSignUpListCommandHandlerTests.Handle_WhenSignUpListNotFound_ShouldReturnFailure [149 ms]
  Passed LankaConnect.Application.Tests.Businesses.Queries.GetBusinessQueryHandlerTests.Handle_WithValidRequest_ShouldCallRepositoryOnce [16 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.UpdateSignUpListCommandHandlerTests.Handle_DisablingCategoryWithItems_ShouldReturnFailure [5 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.UpdateSignUpListCommandHandlerTests.Handle_WhenEventNotFound_ShouldReturnFailure [18 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.SetPrimaryImageCommandTests.Handle_WhenSettingNewPrimary_ShouldUnmarkPreviousPrimary [64 ms]
  Passed LankaConnect.Application.Tests.Businesses.Queries.GetBusinessQueryHandlerTests.Handle_WhenMapperThrows_ShouldPropagateException [19 ms]
  Passed LankaConnect.Application.Tests.Businesses.Queries.GetBusinessQueryHandlerTests.Handle_WithNonExistentBusiness_ShouldReturnSuccessWithNull [4 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventOrganizerContactDetailsTests.SetOrganizerContactDetails_WithEmailOnly_ShouldSucceed [57 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.UpdateSignUpListCommandHandlerTests.Handle_WithValidCommand_ShouldUpdateSignUpList [21 ms]
  Passed LankaConnect.Application.Tests.Mappings.BusinessMappingProfileTests.Configuration_ShouldBeValid [127 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.UpdateSignUpListCommandHandlerTests.Handle_WithEmptyCategory_ShouldReturnFailure [4 ms]
  Passed 2026-01-18 19:58:00.368 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
LankaConnect.Application.Tests.Events.Domain.EventOrganizerContactDetailsTests.SetOrganizerContactDetails_InvalidEmailFormat_ShouldFail [21 ms]
2026-01-18 19:58:00.372 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
  Passed LankaConnect.Application.Tests.Events.Domain.EventOrganizerContactDetailsTests.SetOrganizerContactDetails_WithPhoneOnly_ShouldSucceed [< 1 ms]
2026-01-18 19:58:00.372 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
  Passed LankaConnect.Application.Tests.Events.Domain.EventOrganizerContactDetailsTests.HasOrganizerContact_WhenPublishedWithName_ShouldReturnTrue [< 1 ms]
2026-01-18 19:58:00.369 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
  Passed LankaConnect.Application.Tests.Events.Commands.UpdateSignUpListCommandHandlerTests.Handle_EnablingNewCategory_ShouldSucceed [5 ms]
  Passed LankaConnect.Application.Tests.Users.EventHandlers.MemberVerificationRequestedEventHandlerTests.Handle_ExceptionDuringProcessing_ShouldNotThrow [63 ms]
  Passed LankaConnect.Application.Tests.Communications.ValueObjects.VerificationTokenTests.IsValid_WithCorrectToken_ReturnsTrue [14 ms]
  Passed LankaConnect.Application.Tests.Communications.ValueObjects.VerificationTokenTests.Create_WithInvalidValidityHours_ReturnsFailure(validityHours: 0) [< 1 ms]
  Passed LankaConnect.Application.Tests.Communications.ValueObjects.VerificationTokenTests.Create_WithInvalidValidityHours_ReturnsFailure(validityHours: -1) [< 1 ms]
  Passed LankaConnect.Application.Tests.Communications.ValueObjects.VerificationTokenTests.Create_WithInvalidValidityHours_ReturnsFailure(validityHours: 169) [< 1 ms]
  Passed LankaConnect.Application.Tests.Businesses.Queries.GetBusinessQueryHandlerTests.Handle_WithEmptyGuid_ShouldReturnSuccessWithNull [39 ms]
  Passed LankaConnect.Application.Tests.Communications.ValueObjects.VerificationTokenTests.FromExisting_WithInvalidToken_ReturnsFailure(tokenValue: "   ") [< 1 ms]
  Passed LankaConnect.Application.Tests.Communications.ValueObjects.VerificationTokenTests.FromExisting_WithInvalidToken_ReturnsFailure(tokenValue: null) [< 1 ms]
  Passed LankaConnect.Application.Tests.Communications.ValueObjects.VerificationTokenTests.FromExisting_WithInvalidToken_ReturnsFailure(tokenValue: "") [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.EventHandlers.MemberVerificationRequestedEventHandlerTests.Handle_WithValidEvent_ShouldSendEmailWithUserName [12 ms]
2026-01-18 19:58:00.372 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:58:00.372 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:58:00.378 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:58:00.383 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:58:00.383 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:58:00.383 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:58:00.383 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:58:00.383 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:58:00.383 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
  Passed LankaConnect.Application.Tests.Businesses.Queries.GetBusinessQueryHandlerTests.Handle_WithHighRatedUsBusiness_ShouldReturnRatingData [9 ms]
  Passed LankaConnect.Application.Tests.Users.EventHandlers.MemberVerificationRequestedEventHandlerTests.Handle_EmailServiceFailure_ShouldNotThrow [5 ms]
  Passed LankaConnect.Application.Tests.Communications.ValueObjects.VerificationTokenTests.Equality_WithSameTokenValue_ReturnsTrue [10 ms]
  Passed LankaConnect.Application.Tests.Businesses.Queries.GetBusinessQueryHandlerTests.Handle_WhenRepositoryThrows_ShouldPropagateException [4 ms]
  Passed LankaConnect.Application.Tests.Communications.Commands.ResetPasswordCommandHandlerTests.Handle_WithWeakPassword_ShouldReturnFailure [38 ms]
  Passed LankaConnect.Application.Tests.Events.Commands.SetPrimaryImageCommandTests.Handle_WithNonExistentEvent_ShouldReturnFailure [71 ms]
2026-01-18 19:58:00.396 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:58:00.398 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:58:00.398 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:58:00.398 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:58:00.398 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:58:00.398 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:58:00.398 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:58:00.400 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:58:00.400 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:58:00.400 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:58:00.400 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:58:00.400 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:58:00.400 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:58:00.400 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:58:00.398 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:58:00.399 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:58:00.400 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:58:00.400 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:58:00.401 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:58:00.401 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:58:00.402 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:58:00.402 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
  Passed LankaConnect.Application.Tests.Users.EventHandlers.MemberVerificationRequestedEventHandlerTests.Handle_WithFirstNameOnly_ShouldUseFirstNameAsUserName [15 ms]
  Passed LankaConnect.Application.Tests.Communications.Commands.ResetPasswordCommandHandlerTests.Handle_ShouldResetFailedLoginAttempts [8 ms]
  Passed LankaConnect.Application.Tests.Users.EventHandlers.MemberVerificationRequestedEventHandlerTests.Handle_WithNoNames_ShouldUseFriendAsUserName [12 ms]
  Passed LankaConnect.Application.Tests.Communications.Commands.ResetPasswordCommandHandlerTests.Handle_ShouldClearPasswordResetToken [15 ms]
  Passed LankaConnect.Application.Tests.Mappings.UserMappingProfileTests.Map_EmptyUserCollection_ShouldReturnEmptyCollection [281 ms]
  Passed LankaConnect.Application.Tests.Businesses.Queries.GetBusinessQueryHandlerTests.Handle_WithExistingBusiness_ShouldReturnBusinessDto [46 ms]
  Passed LankaConnect.Application.Tests.Businesses.Queries.GetBusinessQueryHandlerTests.Handle_WithUsBusinessData_ShouldReturnUsFormattedData [7 ms]
  Passed LankaConnect.Application.Tests.Businesses.Queries.GetBusinessQueryHandlerTests.Handle_WithCancellationRequested_ShouldThrowOperationCancelledException [3 ms]
  Passed LankaConnect.Application.Tests.Users.Commands.UpdateLanguagesCommandHandlerTests.Handle_Should_Update_Languages_Successfully [11 ms]
  Passed LankaConnect.Application.Tests.Users.Commands.UpdateLanguagesCommandHandlerTests.Handle_Should_Fail_When_User_Not_Found [4 ms]
  Passed LankaConnect.Application.Tests.Businesses.Queries.GetBusinessQueryHandlerTests.Handle_WithVerifiedUsBusiness_ShouldReturnVerificationStatus [6 ms]
  Passed LankaConnect.Application.Tests.Users.Commands.UpdateLanguagesCommandHandlerTests.Handle_Should_Fail_When_Invalid_Language_Code [4 ms]
  Passed LankaConnect.Application.Tests.Businesses.Queries.GetBusinessQueryHandlerTests.Handle_WithUsBusinessCategories_ShouldReturnCategoryData [7 ms]
  Passed LankaConnect.Application.Tests.Users.Commands.UpdateLanguagesCommandHandlerTests.Handle_Should_Fail_When_More_Than_5_Languages [9 ms]
  Passed LankaConnect.Application.Tests.Users.Commands.UpdateLanguagesCommandHandlerTests.Handle_Should_Fail_When_Empty_Languages [3 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventPassTests.ConfirmPurchase_AlreadyConfirmed_ShouldFail [5 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventPassTests.CreatePassConfiguration_WithValidData_ShouldSucceed [1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventPassTests.AddPass_ToEvent_ShouldSucceed [5 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventPassTests.ReservePass_ExceedingAvailableQuantity_ShouldFail [1 ms]
  Passed LankaConnect.Application.Tests.Mappings.UserMappingProfileTests.Map_UserToUserDto_ShouldPreserveIsActiveStatus(isActive: True) [64 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventPassTests.CancelPurchase_FromPendingStatus_ShouldSucceed [8 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventPassTests.CancelPurchase_FromConfirmedStatus_ShouldSucceed [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventPassTests.RemovePass_FromEvent_ShouldSucceed [2 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventPassTests.Create_WithNegativeQuantity_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventPassTests.ReservePass_MultipleReservations_ShouldTrackCorrectly [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventPassTests.CancelPassPurchase_ShouldRaisePassCancelledEvent [1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventPassTests.RemovePass_WithExistingPurchases_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventPassTests.ConfirmPurchase_FromPendingStatus_ShouldSucceed [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventPassTests.ConfirmPassPurchase_ShouldRaisePassPurchasedEvent [1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventPassTests.CreatePassPurchase_WithValidData_ShouldSucceed [1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventPassTests.Create_WithNullName_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventPassTests.Create_WithValidData_ShouldSucceed [3 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventPassTests.PassConfiguration_WithZeroMaxPasses_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventPassTests.ReservePass_WithAvailableQuantity_ShouldDecreaseAvailability [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventPassTests.Create_WithZeroQuantity_ShouldFail [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventPassTests.CreatePassPurchase_ShouldGenerateUniqueQRCode [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.Domain.EventPassTests.AddMultiplePasses_ToEvent_ShouldTrackAll [1 ms]
  Passed LankaConnect.Application.Tests.Communications.ValueObjects.VerificationTokenTests.IsExpired_WithPastExpiration_ReturnsTrue [128 ms]
  Passed LankaConnect.Application.Tests.Communications.ValueObjects.VerificationTokenTests.Create_GeneratesSecureRandomToken [1 ms]
  Passed LankaConnect.Application.Tests.Communications.ValueObjects.VerificationTokenTests.FromExisting_WithValidData_ReturnsSuccess [1 ms]
  Passed LankaConnect.Application.Tests.Communications.ValueObjects.VerificationTokenTests.IsValid_WithNullOrEmptyToken_ReturnsFalse(tokenToVerify: null) [< 1 ms]
  Passed LankaConnect.Application.Tests.Communications.ValueObjects.VerificationTokenTests.IsValid_WithNullOrEmptyToken_ReturnsFalse(tokenToVerify: "") [< 1 ms]
  Passed LankaConnect.Application.Tests.Communications.ValueObjects.VerificationTokenTests.Equality_WithDifferentTokenValues_ReturnsFalse [< 1 ms]
  Passed LankaConnect.Application.Tests.Communications.ValueObjects.VerificationTokenTests.FromExisting_WithExpiredDate_ReturnsFailure [< 1 ms]
  Passed LankaConnect.Application.Tests.Communications.ValueObjects.VerificationTokenTests.Create_WithCustomValidityHours_ReturnsSuccess [< 1 ms]
  Passed LankaConnect.Application.Tests.Communications.ValueObjects.VerificationTokenTests.Create_WithDefaultValidityHours_ReturnsSuccess [< 1 ms]
  Passed LankaConnect.Application.Tests.Communications.ValueObjects.VerificationTokenTests.IsValid_WithIncorrectToken_ReturnsFalse [< 1 ms]
  Passed LankaConnect.Application.Tests.Communications.ValueObjects.VerificationTokenTests.IsExpired_WithFutureExpiration_ReturnsFalse [< 1 ms]
  Passed LankaConnect.Application.Tests.Businesses.Commands.UploadBusinessImageCommandTests.Handle_WhenBusinessImageCreationFails_ShouldCleanupUploadedImages [129 ms]
  Passed LankaConnect.Application.Tests.Mappings.UserMappingProfileTests.Map_UserToUserDto_ShouldPreserveIsActiveStatus(isActive: False) [37 ms]
  Passed LankaConnect.Application.Tests.Businesses.Commands.UploadBusinessImageCommandTests.Handle_WithNonExistentBusiness_ShouldReturnFailure [9 ms]
  Passed LankaConnect.Application.Tests.Users.Commands.LinkExternalProviderCommandHandlerTests.Handle_ShouldCallUnitOfWorkCommit [23 ms]
  Passed LankaConnect.Application.Tests.Mappings.UserMappingProfileTests.Map_UserToUserDto_ShouldMapAllProperties [47 ms]
  Passed LankaConnect.Application.Tests.Businesses.Commands.UploadBusinessImageCommandTests.Handle_WhenAddingImageToBusinessFails_ShouldCleanupUploadedImages [39 ms]
  Passed LankaConnect.Application.Tests.Mappings.UserMappingProfileTests.Configuration_ShouldBeValid [4 ms]
  Passed LankaConnect.Application.Tests.Businesses.Commands.UploadBusinessImageCommandTests.Handle_WhenImageServiceFails_ShouldReturnFailure [9 ms]
  Passed LankaConnect.Application.Tests.Validators.CreateUserCommandValidatorTests.Validate_WithInvalidPhoneNumber_ShouldHavePhoneNumberError(phoneNumber: "94771234567") [185 ms]
  Passed LankaConnect.Application.Tests.Validators.CreateUserCommandValidatorTests.Validate_WithInvalidPhoneNumber_ShouldHavePhoneNumberError(phoneNumber: "invalid-phone") [2 ms]
  Passed LankaConnect.Application.Tests.Validators.CreateUserCommandValidatorTests.Validate_WithInvalidPhoneNumber_ShouldHavePhoneNumberError(phoneNumber: "++94771234567") [< 1 ms]
  Passed LankaConnect.Application.Tests.Mappings.UserMappingProfileTests.Map_UserWithPhoneNumber_ShouldMapPhoneNumber [18 ms]
  Passed LankaConnect.Application.Tests.Validators.CreateUserCommandValidatorTests.Validate_WithInvalidPhoneNumber_ShouldHavePhoneNumberError(phoneNumber: "123") [< 1 ms]
  Passed LankaConnect.Application.Tests.Businesses.Commands.UploadBusinessImageCommandTests.Handle_WithValidCommand_ShouldReturnSuccessResult [16 ms]
  Passed LankaConnect.Application.Tests.ReferenceData.ReferenceDataServiceTests.GetByTypesAsync_ShouldRespectActiveOnlyFilter [147 ms]
  Passed LankaConnect.Application.Tests.Validators.CreateUserCommandValidatorTests.Validate_WithNullPhoneNumber_ShouldNotHaveError [5 ms]
  Passed LankaConnect.Application.Tests.Validators.CreateUserCommandValidatorTests.Validate_WithInvalidEmailFormat_ShouldHaveEmailFormatError(email: "test") [2 ms]
  Passed LankaConnect.Application.Tests.Validators.CreateUserCommandValidatorTests.Validate_WithInvalidEmailFormat_ShouldHaveEmailFormatError(email: "test@") [1 ms]
  Passed LankaConnect.Application.Tests.Validators.CreateUserCommandValidatorTests.Validate_WithInvalidEmailFormat_ShouldHaveEmailFormatError(email: "invalid-email") [6 ms]
  Passed LankaConnect.Application.Tests.Validators.CreateUserCommandValidatorTests.Validate_WithInvalidEmailFormat_ShouldHaveEmailFormatError(email: "@test.com") [< 1 ms]
  Passed LankaConnect.Application.Tests.ReferenceData.ReferenceDataServiceTests.GetByTypesAsync_ShouldMapMetadataCorrectly [12 ms]
  Passed LankaConnect.Application.Tests.Validators.CreateUserCommandValidatorTests.Validate_WithInvalidEmail_ShouldHaveEmailError(email: null) [1 ms]
  Passed LankaConnect.Application.Tests.Validators.CreateUserCommandValidatorTests.Validate_WithInvalidEmail_ShouldHaveEmailError(email: "") [1 ms]
  Passed LankaConnect.Application.Tests.Validators.CreateUserCommandValidatorTests.Validate_WithInvalidEmail_ShouldHaveEmailError(email: " ") [< 1 ms]
  Passed LankaConnect.Application.Tests.Validators.CreateUserCommandValidatorTests.Validate_WithValidEmails_ShouldNotHaveError(email: "test@example.com") [1 ms]
  Passed LankaConnect.Application.Tests.Validators.CreateUserCommandValidatorTests.Validate_WithValidEmails_ShouldNotHaveError(email: "user+tag@domain.co.uk") [< 1 ms]
  Passed LankaConnect.Application.Tests.Validators.CreateUserCommandValidatorTests.Validate_WithValidEmails_ShouldNotHaveError(email: "valid.email@subdomain.example.org") [< 1 ms]
  Passed LankaConnect.Application.Tests.Validators.CreateUserCommandValidatorTests.Validate_WithInvalidLastName_ShouldHaveLastNameError(lastName: "") [3 ms]
  Passed LankaConnect.Application.Tests.Validators.CreateUserCommandValidatorTests.Validate_WithInvalidLastName_ShouldHaveLastNameError(lastName: " ") [4 ms]
  Passed LankaConnect.Application.Tests.ReferenceData.ReferenceDataServiceTests.GetByTypesAsync_ShouldReturnReferenceValues_WhenTypesExist [15 ms]
  Passed LankaConnect.Application.Tests.Validators.CreateUserCommandValidatorTests.Validate_WithInvalidLastName_ShouldHaveLastNameError(lastName: null) [< 1 ms]
  Passed LankaConnect.Application.Tests.Users.Commands.LinkExternalProviderCommandHandlerTests.Handle_WhenUserNotFound_ShouldReturnFailure [82 ms]
  Passed LankaConnect.Application.Tests.Validators.CreateUserCommandValidatorTests.Validate_WithValidCommand_ShouldNotHaveErrors [< 1 ms]
  Passed LankaConnect.Application.Tests.Validators.CreateUserCommandValidatorTests.Validate_WithValidFirstNames_ShouldNotHaveError(firstName: "john") [1 ms]
  Passed LankaConnect.Application.Tests.Validators.CreateUserCommandValidatorTests.Validate_WithValidFirstNames_ShouldNotHaveError(firstName: "John123") [< 1 ms]
  Passed LankaConnect.Application.Tests.Validators.CreateUserCommandValidatorTests.Validate_WithValidFirstNames_ShouldNotHaveError(firstName: "John O'Connor") [1 ms]
  Passed LankaConnect.Application.Tests.Validators.CreateUserCommandValidatorTests.Validate_WithValidFirstNames_ShouldNotHaveError(firstName: "John-Paul") [2 ms]
  Passed LankaConnect.Application.Tests.Validators.CreateUserCommandValidatorTests.Validate_WithValidFirstNames_ShouldNotHaveError(firstName: "JOHN") [< 1 ms]
  Passed LankaConnect.Application.Tests.Validators.CreateUserCommandValidatorTests.Validate_WithValidBio_ShouldNotHaveError [1 ms]
  Passed LankaConnect.Application.Tests.Validators.CreateUserCommandValidatorTests.Validate_WithNullBio_ShouldNotHaveError [1 ms]
  Passed LankaConnect.Application.Tests.Validators.CreateUserCommandValidatorTests.Validate_WithInvalidFirstName_ShouldHaveFirstNameError(firstName: " ") [1 ms]
  Passed LankaConnect.Application.Tests.Validators.CreateUserCommandValidatorTests.Validate_WithInvalidFirstName_ShouldHaveFirstNameError(firstName: "") [< 1 ms]
  Passed LankaConnect.Application.Tests.Validators.CreateUserCommandValidatorTests.Validate_WithInvalidFirstName_ShouldHaveFirstNameError(firstName: null) [< 1 ms]
  Passed LankaConnect.Application.Tests.Validators.CreateUserCommandValidatorTests.Validate_WithLastNameTooLong_ShouldHaveLastNameLengthError [1 ms]
  Passed LankaConnect.Application.Tests.Users.Commands.LinkExternalProviderCommandHandlerTests.Handle_WithMultipleProviders_ShouldLinkSuccessfully [16 ms]
  Passed LankaConnect.Application.Tests.Mappings.UserMappingProfileTests.Map_UserWithLongValues_ShouldMapCorrectly [50 ms]
  Passed LankaConnect.Application.Tests.Validators.CreateUserCommandValidatorTests.Validate_WithEmailTooLong_ShouldHaveEmailLengthError [1 ms]
  Passed LankaConnect.Application.Tests.Validators.CreateUserCommandValidatorTests.Validate_WithEmptyBio_ShouldNotHaveError [5 ms]
  Passed LankaConnect.Application.Tests.Validators.CreateUserCommandValidatorTests.Validate_WithBioTooLong_ShouldHaveBioLengthError [1 ms]
  Passed LankaConnect.Application.Tests.Validators.CreateUserCommandValidatorTests.Validate_WithFirstNameTooLong_ShouldHaveFirstNameLengthError [3 ms]
  Passed LankaConnect.Application.Tests.Validators.CreateUserCommandValidatorTests.Validate_WithValidPhoneNumber_ShouldNotHavePhoneNumberError [2 ms]
  Passed LankaConnect.Application.Tests.Users.Commands.LinkExternalProviderCommandHandlerTests.Handle_WhenProviderAlreadyLinked_ShouldReturnFailure [17 ms]
  Passed LankaConnect.Application.Tests.Mappings.BusinessMappingProfileTests.Map_BusinessToBusinessDto_ShouldBeConsistent [329 ms]
2026-01-18 19:58:00.695 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:58:00.695 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:58:00.695 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:58:00.696 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 19:58:00.696 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 19:58:00.696 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 19:58:00.696 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:58:00.696 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 19:58:00.696 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:58:00.697 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 19:58:00.696 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:58:00.697 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 19:58:00.697 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:58:00.697 -05:00 [INF]  Program: Applying database migrations...
  Passed LankaConnect.Application.Tests.ReferenceData.ReferenceDataServiceTests.InvalidateCacheAsync_ShouldClearCache_ForSpecificType [47 ms]
  Passed LankaConnect.Application.Tests.Mappings.UserMappingProfileTests.Map_MultipleUsers_ShouldMaintainOrder [40 ms]
  Passed LankaConnect.Application.Tests.ReferenceData.ReferenceDataServiceTests.GetByTypesAsync_ShouldUseCachedData_OnSecondCall [13 ms]
  Passed LankaConnect.Application.Tests.Mappings.BusinessMappingProfileTests.Map_BusinessToBusinessDto_ShouldHandleWebsiteCorrectly [15 ms]
  Passed LankaConnect.Application.Tests.ReferenceData.ReferenceDataServiceTests.GetByTypesAsync_ShouldReturnEmptyList_WhenNoDataExists [3 ms]
  Passed LankaConnect.Application.Tests.Users.Commands.LinkExternalProviderCommandHandlerTests.Handle_ShouldRaiseDomainEvent [37 ms]
  Passed LankaConnect.Application.Tests.Mappings.UserMappingProfileTests.Map_UserWithoutOptionalFields_ShouldMapWithNulls [18 ms]
  Passed LankaConnect.Application.Tests.ReferenceData.ReferenceDataServiceTests.InvalidateAllCachesAsync_ShouldClearAllCaches [13 ms]
  Passed LankaConnect.Domain.Tests.Analytics.EventAnalyticsTests.UpdateUniqueViewers_WithNegativeValue_ShouldFail [4 ms]
  Passed LankaConnect.Domain.Tests.Analytics.EventAnalyticsTests.RecordView_WithNullIpAddress_ShouldFail [2 ms]
  Passed LankaConnect.Domain.Tests.Analytics.EventAnalyticsTests.UpdateRegistrationCount_ShouldUpdateCount [4 ms]
  Passed LankaConnect.Application.Tests.Events.EventHandlers.EventApprovedEventHandlerTests.Handle_EventNotFound_ShouldNotSendEmail [122 ms]
  Passed LankaConnect.Domain.Tests.Analytics.EventAnalyticsTests.RecordView_WithEmptyIpAddress_ShouldFail [2 ms]
  Passed LankaConnect.Domain.Tests.Analytics.EventAnalyticsTests.UpdateUniqueViewers_ShouldUpdateCount [< 1 ms]
  Passed LankaConnect.Domain.Tests.Analytics.EventAnalyticsTests.RecordView_MultipleTimes_ShouldIncrementCount [< 1 ms]
  Passed LankaConnect.Domain.Tests.Analytics.EventAnalyticsTests.Create_WithEmptyEventId_ShouldFail [1 ms]
  Passed LankaConnect.Domain.Tests.Analytics.EventAnalyticsTests.ConversionRate_WithNoViews_ShouldBeZero [< 1 ms]
  Passed LankaConnect.Domain.Tests.Analytics.EventAnalyticsTests.ConversionRate_ShouldCalculateCorrectly [< 1 ms]
  Passed LankaConnect.Domain.Tests.Analytics.EventAnalyticsTests.UpdateRegistrationCount_WithNegativeValue_ShouldFail [1 ms]
  Passed LankaConnect.Domain.Tests.Analytics.EventAnalyticsTests.RecordView_ShouldIncrementTotalViews [< 1 ms]
  Passed LankaConnect.Domain.Tests.Analytics.EventAnalyticsTests.ConversionRate_With100PercentConversion_ShouldBe100 [< 1 ms]
  Passed LankaConnect.Domain.Tests.Analytics.EventAnalyticsTests.RecordView_ShouldRaiseDomainEvent [1 ms]
  Passed LankaConnect.Domain.Tests.Analytics.EventAnalyticsTests.RecordView_WithNullUserId_ShouldAcceptAnonymousView [< 1 ms]
  Passed LankaConnect.Domain.Tests.Analytics.EventAnalyticsTests.Create_ShouldInitializeWithZeroCounts [< 1 ms]
  Passed LankaConnect.Domain.Tests.Analytics.EventAnalyticsTests.ConversionRate_WithHalfRegistrations_ShouldBeFiftyPercent [< 1 ms]
  Passed LankaConnect.Application.Tests.Events.EventHandlers.EventApprovedEventHandlerTests.Handle_WithValidEvent_ShouldSendEmailToOrganizer [42 ms]
  Passed LankaConnect.Application.Tests.Mappings.BusinessMappingProfileTests.Map_BusinessToBusinessDto_ShouldPreserveCoordinates [75 ms]
  Passed LankaConnect.Application.Tests.Users.Queries.GetLinkedProvidersQueryHandlerTests.Handle_ShouldIncludeAllProviderDetails [107 ms]
  Passed LankaConnect.Application.Tests.Users.Commands.LinkExternalProviderCommandHandlerTests.Handle_ShouldLogInformationOnSuccess [70 ms]
  Passed LankaConnect.Application.Tests.Users.Queries.GetLinkedProvidersQueryHandlerTests.Handle_WhenUserNotFound_ShouldReturnFailure [6 ms]
  Passed LankaConnect.Application.Tests.Communications.Commands.ResetPasswordCommandHandlerTests.Handle_ShouldSendConfirmationEmailAsynchronously [357 ms]
  Passed LankaConnect.Application.Tests.Events.EventHandlers.EventApprovedEventHandlerTests.Handle_OrganizerNotFound_ShouldNotSendEmail [19 ms]
  Passed LankaConnect.Application.Tests.Mappings.UserMappingProfileTests.Map_UserCollectionToUserDtoCollection_ShouldMapAll [78 ms]
  Passed LankaConnect.Application.Tests.Users.Queries.GetLinkedProvidersQueryHandlerTests.Handle_WhenUserHasLinkedProviders_ShouldReturnAllProviders [9 ms]
  Passed LankaConnect.Application.Tests.Mappings.BusinessMappingProfileTests.Map_BusinessToBusinessDto_ShouldPreserveDateTimeKind [18 ms]
  Passed LankaConnect.Application.Tests.Users.Commands.LinkExternalProviderCommandHandlerTests.Handle_WithValidData_ShouldLinkProviderAndReturnSuccess [12 ms]
  Passed LankaConnect.Application.Tests.Events.EventHandlers.EventApprovedEventHandlerTests.Handle_EmailServiceFailure_ShouldNotThrow [7 ms]
  Passed LankaConnect.Application.Tests.Users.Queries.GetLinkedProvidersQueryHandlerTests.Handle_WhenUserHasNoLinkedProviders_ShouldReturnEmptyList [6 ms]
  Passed LankaConnect.Application.Tests.Mappings.UserMappingProfileTests.Map_NullUser_ShouldReturnNull [8 ms]
  Passed LankaConnect.Application.Tests.Communications.Commands.ResetPasswordCommandHandlerTests.Handle_WithValidTokenAndPassword_ShouldResetPassword [11 ms]
  Passed LankaConnect.Application.Tests.Users.Commands.LinkExternalProviderCommandHandlerTests.Handle_WhenCommitFails_ShouldReturnFailure [8 ms]
  Passed LankaConnect.Application.Tests.Behaviors.LoggingPipelineBehaviorTests.Handle_ShouldMeasureExecutionTime [2 s]
  Passed LankaConnect.Application.Tests.Events.EventHandlers.EventApprovedEventHandlerTests.Handle_ExceptionDuringProcessing_ShouldNotThrow [4 ms]
  Passed LankaConnect.Application.Tests.Mappings.BusinessMappingProfileTests.Map_NullBusiness_ShouldReturnNull [11 ms]
  Passed LankaConnect.Application.Tests.Communications.Commands.ResetPasswordCommandHandlerTests.Handle_WithInvalidToken_ShouldReturnFailure [3 ms]
  Passed LankaConnect.Application.Tests.Users.Queries.GetLinkedProvidersQueryHandlerTests.Handle_ShouldIncludeProviderDisplayNames [10 ms]
  Passed LankaConnect.Application.Tests.Communications.Commands.ResetPasswordCommandHandlerTests.Handle_WhenDatabaseThrowsException_ShouldReturnFailure [6 ms]
  Passed LankaConnect.Application.Tests.Behaviors.LoggingPipelineBehaviorTests.Handle_WithCancellationRequested_ShouldLogCancellation [13 ms]
  Passed LankaConnect.Application.Tests.Communications.Commands.ResetPasswordCommandHandlerTests.Handle_WhenPasswordHashingFails_ShouldReturnFailure [6 ms]
  Passed LankaConnect.Application.Tests.Mappings.BusinessMappingProfileTests.Map_BusinessToBusinessDto_ShouldPreserveStatus [27 ms]
  Passed LankaConnect.Application.Tests.Communications.Commands.ResetPasswordCommandHandlerTests.Handle_WithNonExistentUser_ShouldReturnFailure [17 ms]
  Passed LankaConnect.Application.Tests.Users.Queries.GetLinkedProvidersQueryHandlerTests.Handle_WithMultipleProviders_ShouldOrderByProvider [27 ms]
  Passed LankaConnect.Application.Tests.Communications.Commands.ResetPasswordCommandHandlerTests.Handle_WithInvalidEmail_ShouldReturnFailure [4 ms]
  Passed LankaConnect.Application.Tests.Mappings.UserMappingProfileTests.Map_UserToUserDto_ShouldPreserveDateTimeKind [42 ms]
  Passed LankaConnect.Application.Tests.Behaviors.LoggingPipelineBehaviorTests.Handle_WithMultipleErrors_ShouldLogAllErrors [27 ms]
  Passed LankaConnect.Application.Tests.Mappings.BusinessMappingProfileTests.Map_EmptyBusinessCollection_ShouldReturnEmptyCollection [19 ms]
  Passed LankaConnect.Application.Tests.Communications.Commands.ResetPasswordCommandHandlerTests.Handle_ShouldRevokeAllRefreshTokens [10 ms]
  Passed LankaConnect.Application.Tests.Behaviors.LoggingPipelineBehaviorTests.Handle_ShouldIncludeRequestNameInLogs [11 ms]
  Passed LankaConnect.Application.Tests.Communications.Commands.ResetPasswordCommandHandlerTests.Handle_WithExpiredToken_ShouldReturnFailure [4 ms]
  Passed LankaConnect.Application.Tests.Behaviors.LoggingPipelineBehaviorTests.Handle_WithSuccessfulRequest_ShouldLogStartAndComplete [13 ms]
  Passed LankaConnect.Application.Tests.Mappings.UserMappingProfileTests.Map_UserToUserDto_ShouldBeReversible [38 ms]
  Passed LankaConnect.Application.Tests.Mappings.BusinessMappingProfileTests.Map_MultipleBusinesses_ShouldMaintainOrder [63 ms]
  Passed LankaConnect.Application.Tests.Mappings.UserMappingProfileTests.Map_UserToUserDto_ShouldHandleEmailValueObjectCorrectly [41 ms]
  Passed LankaConnect.Application.Tests.Behaviors.LoggingPipelineBehaviorTests.Handle_WhenExceptionThrown_ShouldLogException [59 ms]
  Passed LankaConnect.Application.Tests.Mappings.BusinessMappingProfileTests.Map_BusinessToBusinessDto_ShouldPreserveAddressComponents [16 ms]
  Passed LankaConnect.Application.Tests.Behaviors.LoggingPipelineBehaviorTests.Handle_WithFailedRequest_ShouldLogStartCompleteAndError [17 ms]
  Passed LankaConnect.Application.Tests.Mappings.BusinessMappingProfileTests.Map_BusinessWithSpecialCharacters_ShouldMapCorrectly [22 ms]
  Passed LankaConnect.Application.Tests.Events.Queries.GetEventRegistrationByEmailQueryHandlerTests.Handle_EmailIsNotRegistered_ReturnsFalse [526 ms]
  Passed LankaConnect.Application.Tests.Events.Queries.GetEventRegistrationByEmailQueryHandlerTests.Handle_DifferentEventWithSameEmail_ReturnsFalse [16 ms]
  Passed LankaConnect.Application.Tests.Events.Queries.GetEventRegistrationByEmailQueryHandlerTests.Handle_NoRegistrationsForEvent_ReturnsFalse [11 ms]
  Passed LankaConnect.Application.Tests.Events.Queries.GetEventRegistrationByEmailQueryHandlerTests.Handle_EmailIsRegistered_ReturnsTrue [8 ms]
2026-01-18 19:58:04.184 -05:00 [WRN]  Microsoft.EntityFrameworkCore.Model: The entity type 'EventCategoryRef' was first mapped explicitly and then ignored. Consider not mapping the entity type in the first place.
warn: 1/18/2026 19:58:04.192 CoreEventId.MappedEntityTypeIgnoredWarning[10626] (Microsoft.EntityFrameworkCore.Model) 
      The entity type 'EventCategoryRef' was first mapped explicitly and then ignored. Consider not mapping the entity type in the first place.
2026-01-18 19:58:04.194 -05:00 [WRN]  Microsoft.EntityFrameworkCore.Model: The entity type 'EventStatusRef' was first mapped explicitly and then ignored. Consider not mapping the entity type in the first place.
warn: 1/18/2026 19:58:04.194 CoreEventId.MappedEntityTypeIgnoredWarning[10626] (Microsoft.EntityFrameworkCore.Model) 
      The entity type 'EventStatusRef' was first mapped explicitly and then ignored. Consider not mapping the entity type in the first place.
2026-01-18 19:58:04.195 -05:00 [WRN]  Microsoft.EntityFrameworkCore.Model: The entity type 'UserRoleRef' was first mapped explicitly and then ignored. Consider not mapping the entity type in the first place.
warn: 1/18/2026 19:58:04.195 CoreEventId.MappedEntityTypeIgnoredWarning[10626] (Microsoft.EntityFrameworkCore.Model) 
      The entity type 'UserRoleRef' was first mapped explicitly and then ignored. Consider not mapping the entity type in the first place.
2026-01-18 19:58:04.820 -05:00 [WRN]  Microsoft.EntityFrameworkCore.Model.Validation: The property 'ReviewContent.Cons' is a collection or enumeration type with a value converter but with no value comparer. Set a value comparer to ensure the collection/enumeration elements are compared correctly.
warn: 1/18/2026 19:58:04.822 CoreEventId.CollectionWithoutComparer[10620] (Microsoft.EntityFrameworkCore.Model.Validation) 
      The property 'ReviewContent.Cons' is a collection or enumeration type with a value converter but with no value comparer. Set a value comparer to ensure the collection/enumeration elements are compared correctly.
2026-01-18 19:58:04.822 -05:00 [WRN]  Microsoft.EntityFrameworkCore.Model.Validation: The property 'ReviewContent.Pros' is a collection or enumeration type with a value converter but with no value comparer. Set a value comparer to ensure the collection/enumeration elements are compared correctly.
warn: 1/18/2026 19:58:04.822 CoreEventId.CollectionWithoutComparer[10620] (Microsoft.EntityFrameworkCore.Model.Validation) 
      The property 'ReviewContent.Pros' is a collection or enumeration type with a value converter but with no value comparer. Set a value comparer to ensure the collection/enumeration elements are compared correctly.
2026-01-18 19:58:04.827 -05:00 [WRN]  Microsoft.EntityFrameworkCore.Model.Validation: The property 'EmailMessage.RecipientStatuses' is a collection or enumeration type with a value converter but with no value comparer. Set a value comparer to ensure the collection/enumeration elements are compared correctly.
warn: 1/18/2026 19:58:04.828 CoreEventId.CollectionWithoutComparer[10620] (Microsoft.EntityFrameworkCore.Model.Validation) 
      The property 'EmailMessage.RecipientStatuses' is a collection or enumeration type with a value converter but with no value comparer. Set a value comparer to ensure the collection/enumeration elements are compared correctly.
2026-01-18 19:58:04.828 -05:00 [WRN]  Microsoft.EntityFrameworkCore.Model.Validation: The property 'EmailMessage.TemplateData' is a collection or enumeration type with a value converter but with no value comparer. Set a value comparer to ensure the collection/enumeration elements are compared correctly.
warn: 1/18/2026 19:58:04.828 CoreEventId.CollectionWithoutComparer[10620] (Microsoft.EntityFrameworkCore.Model.Validation) 
      The property 'EmailMessage.TemplateData' is a collection or enumeration type with a value converter but with no value comparer. Set a value comparer to ensure the collection/enumeration elements are compared correctly.
2026-01-18 19:58:05.148 -05:00 [WRN]  Microsoft.EntityFrameworkCore.Model.Validation: The 'EventCategory' property 'Category' on entity type 'Event' is configured with a database-generated default, but has no configured sentinel value. The database-generated default will always be used for inserts when the property has the value 'Religious', since this is the CLR default for the 'EventCategory' type. Consider using a nullable type, using a nullable backing field, or setting the sentinel value for the property to ensure the database default is used when, and only when, appropriate. See https://aka.ms/efcore-docs-default-values for more information.
warn: 1/18/2026 19:58:05.150 RelationalEventId.BoolWithDefaultWarning[20601] (Microsoft.EntityFrameworkCore.Model.Validation) 
      The 'EventCategory' property 'Category' on entity type 'Event' is configured with a database-generated default, but has no configured sentinel value. The database-generated default will always be used for inserts when the property has the value 'Religious', since this is the CLR default for the 'EventCategory' type. Consider using a nullable type, using a nullable backing field, or setting the sentinel value for the property to ensure the database default is used when, and only when, appropriate. See https://aka.ms/efcore-docs-default-values for more information.
2026-01-18 19:58:05.150 -05:00 [WRN]  Microsoft.EntityFrameworkCore.Model.Validation: The 'RegistrationStatus' property 'Status' on entity type 'Registration' is configured with a database-generated default, but has no configured sentinel value. The database-generated default will always be used for inserts when the property has the value 'Pending', since this is the CLR default for the 'RegistrationStatus' type. Consider using a nullable type, using a nullable backing field, or setting the sentinel value for the property to ensure the database default is used when, and only when, appropriate. See https://aka.ms/efcore-docs-default-values for more information.
warn: 1/18/2026 19:58:05.151 RelationalEventId.BoolWithDefaultWarning[20601] (Microsoft.EntityFrameworkCore.Model.Validation) 
      The 'RegistrationStatus' property 'Status' on entity type 'Registration' is configured with a database-generated default, but has no configured sentinel value. The database-generated default will always be used for inserts when the property has the value 'Pending', since this is the CLR default for the 'RegistrationStatus' type. Consider using a nullable type, using a nullable backing field, or setting the sentinel value for the property to ensure the database default is used when, and only when, appropriate. See https://aka.ms/efcore-docs-default-values for more information.
2026-01-18 19:58:05.151 -05:00 [WRN]  Microsoft.EntityFrameworkCore.Model.Validation: The 'UserRole' property 'Role' on entity type 'User' is configured with a database-generated default, but has no configured sentinel value. The database-generated default will always be used for inserts when the property has the value '0', since this is the CLR default for the 'UserRole' type. Consider using a nullable type, using a nullable backing field, or setting the sentinel value for the property to ensure the database default is used when, and only when, appropriate. See https://aka.ms/efcore-docs-default-values for more information.
warn: 1/18/2026 19:58:05.152 RelationalEventId.BoolWithDefaultWarning[20601] (Microsoft.EntityFrameworkCore.Model.Validation) 
      The 'UserRole' property 'Role' on entity type 'User' is configured with a database-generated default, but has no configured sentinel value. The database-generated default will always be used for inserts when the property has the value '0', since this is the CLR default for the 'UserRole' type. Consider using a nullable type, using a nullable backing field, or setting the sentinel value for the property to ensure the database default is used when, and only when, appropriate. See https://aka.ms/efcore-docs-default-values for more information.
[xUnit.net 00:00:10.22]     LankaConnect.IntegrationTests.Infrastructure.DockerConnectivityTests.Redis_Container_IsAccessible [FAIL]
[xUnit.net 00:00:10.22]       StackExchange.Redis.RedisConnectionException : It was not possible to connect to the redis server(s). Error connecting right now. To allow this multiplexer to continue retrying until it's able to connect, use abortConnect=false in your connection string or AbortOnConnectFail=false; in your code.
[xUnit.net 00:00:10.22]       Stack Trace:
[xUnit.net 00:00:10.22]         /_/src/StackExchange.Redis/ConnectionMultiplexer.cs(716,0): at StackExchange.Redis.ConnectionMultiplexer.ConnectImpl(ConfigurationOptions configuration, TextWriter writer, Nullable`1 serverType, EndPointCollection endpoints)
[xUnit.net 00:00:10.22]         /_/src/StackExchange.Redis/ConnectionMultiplexer.cs(678,0): at StackExchange.Redis.ConnectionMultiplexer.Connect(ConfigurationOptions configuration, TextWriter log)
[xUnit.net 00:00:10.22]         /_/src/StackExchange.Redis/ConnectionMultiplexer.cs(656,0): at StackExchange.Redis.ConnectionMultiplexer.Connect(String configuration, TextWriter log)
[xUnit.net 00:00:10.22]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Infrastructure\DockerConnectivityTests.cs(56,0): at LankaConnect.IntegrationTests.Infrastructure.DockerConnectivityTests.Redis_Container_IsAccessible()
[xUnit.net 00:00:10.22]         --- End of stack trace from previous location ---
  Failed LankaConnect.IntegrationTests.Infrastructure.DockerConnectivityTests.Redis_Container_IsAccessible [8 s]
  Error Message:
   StackExchange.Redis.RedisConnectionException : It was not possible to connect to the redis server(s). Error connecting right now. To allow this multiplexer to continue retrying until it's able to connect, use abortConnect=false in your connection string or AbortOnConnectFail=false; in your code.
  Stack Trace:
     at StackExchange.Redis.ConnectionMultiplexer.ConnectImpl(ConfigurationOptions configuration, TextWriter writer, Nullable`1 serverType, EndPointCollection endpoints) in /_/src/StackExchange.Redis/ConnectionMultiplexer.cs:line 716
   at StackExchange.Redis.ConnectionMultiplexer.Connect(ConfigurationOptions configuration, TextWriter log) in /_/src/StackExchange.Redis/ConnectionMultiplexer.cs:line 678
   at StackExchange.Redis.ConnectionMultiplexer.Connect(String configuration, TextWriter log) in /_/src/StackExchange.Redis/ConnectionMultiplexer.cs:line 656
   at LankaConnect.IntegrationTests.Infrastructure.DockerConnectivityTests.Redis_Container_IsAccessible() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Infrastructure\DockerConnectivityTests.cs:line 56
--- End of stack trace from previous location ---
2026-01-18 19:58:06.483 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:58:06.799 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:58:06.799 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:58:06.800 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:58:06.800 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:58:06.800 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:58:06.801 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:58:06.801 -05:00 [INF]  Program: Applying database migrations...
[xUnit.net 00:00:13.97]   Finished:    LankaConnect.Application.Tests
  Passed LankaConnect.Application.Tests.Common.ImportResolution.UserIdImportTests.Application_Should_Resolve_UserId_From_Domain_Layer [10 s]

Test Run Successful.
Total tests: 1190
     Passed: 1189
    Skipped: 1
 Total time: 15.7049 Seconds
2026-01-18 19:58:10.516 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:58:10.516 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:58:10.516 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:58:10.516 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:58:10.516 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:58:10.516 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:58:10.516 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:58:10.591 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:58:10.591 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:58:10.601 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:58:10.611 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:00:14.54]     LankaConnect.IntegrationTests.Email.MailHogIntegrationTests.SearchMailHogMessages_ShouldFindSpecificEmails [FAIL]
[xUnit.net 00:00:14.54]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:00:14.54]       Stack Trace:
[xUnit.net 00:00:14.54]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:00:14.54]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:00:14.54]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:00:14.54]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:00:14.54]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:00:14.54]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:00:14.54]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
  Failed LankaConnect.IntegrationTests.Email.MailHogIntegrationTests.SearchMailHogMessages_ShouldFindSpecificEmails [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
[xUnit.net 00:00:14.56]     LankaConnect.IntegrationTests.Repositories.ServiceRepositoryTests.GetActiveByBusinessIdAsync_Should_Return_Only_Active_Services [FAIL]
[xUnit.net 00:00:14.56]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:00:14.56]       Stack Trace:
[xUnit.net 00:00:14.56]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:00:14.56]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:00:14.56]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:00:14.56]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:00:14.56]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:00:14.56]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:00:14.56]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
[xUnit.net 00:00:14.56]     LankaConnect.IntegrationTests.Email.EmailApiTests.VerifyEmail_WithValidToken_ShouldReturnSuccess [FAIL]
[xUnit.net 00:00:14.56]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:00:14.56]       Stack Trace:
[xUnit.net 00:00:14.56]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:00:14.56]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:00:14.56]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:00:14.56]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:00:14.56]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:00:14.56]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:00:14.56]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
[xUnit.net 00:00:14.56]     LankaConnect.IntegrationTests.Controllers.ExternalProviderManagementTests.UnlinkExternalProvider_WhenNotLinked_ShouldReturn400 [FAIL]
[xUnit.net 00:00:14.56]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:00:14.56]       Stack Trace:
[xUnit.net 00:00:14.56]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:00:14.56]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:00:14.56]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:00:14.56]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:00:14.56]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:00:14.56]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:00:14.56]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
[xUnit.net 00:00:14.56]     LankaConnect.IntegrationTests.Controllers.BusinessesControllerTests.CreateBusiness_Should_Return_Created_With_Valid_Data [FAIL]
[xUnit.net 00:00:14.57]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:00:14.57]       Stack Trace:
[xUnit.net 00:00:14.57]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:00:14.57]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:00:14.57]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:00:14.57]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:00:14.57]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:00:14.57]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:00:14.57]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
[xUnit.net 00:00:14.57]     LankaConnect.IntegrationTests.Controllers.EntraAuthControllerTests.LoginWithEntra_WithValidToken_ExistingUser_ShouldReturn200AndNotCreateDuplicate [FAIL]
[xUnit.net 00:00:14.57]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:00:14.57]       Stack Trace:
[xUnit.net 00:00:14.57]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:00:14.57]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:00:14.57]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:00:14.57]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:00:14.57]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:00:14.57]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:00:14.57]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
  Failed LankaConnect.IntegrationTests.Repositories.ServiceRepositoryTests.GetActiveByBusinessIdAsync_Should_Return_Only_Active_Services [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
  Failed LankaConnect.IntegrationTests.Email.EmailApiTests.VerifyEmail_WithValidToken_ShouldReturnSuccess [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
  Failed LankaConnect.IntegrationTests.Controllers.ExternalProviderManagementTests.UnlinkExternalProvider_WhenNotLinked_ShouldReturn400 [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
  Failed LankaConnect.IntegrationTests.Controllers.BusinessesControllerTests.CreateBusiness_Should_Return_Created_With_Valid_Data [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
  Failed LankaConnect.IntegrationTests.Controllers.EntraAuthControllerTests.LoginWithEntra_WithValidToken_ExistingUser_ShouldReturn200AndNotCreateDuplicate [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
2026-01-18 19:58:10.676 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:58:10.705 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:58:10.705 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:58:10.711 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:58:10.711 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:58:10.720 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:58:11.128 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:58:11.137 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:58:11.191 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:58:11.200 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:58:11.201 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:58:11.201 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:58:11.201 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:58:11.202 -05:00 [INF]  Program: Applying database migrations...
[xUnit.net 00:00:18.78]     LankaConnect.IntegrationTests.Controllers.AuthControllerTests.Login_MultipleFailedAttempts_ShouldLockAccount [FAIL]
[xUnit.net 00:00:18.78]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:00:18.78]       Stack Trace:
[xUnit.net 00:00:18.78]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:00:18.78]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:00:18.78]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:00:18.78]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:00:18.78]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:00:18.78]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:00:18.78]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
  Failed LankaConnect.IntegrationTests.Controllers.AuthControllerTests.Login_MultipleFailedAttempts_ShouldLockAccount [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
2026-01-18 19:58:14.884 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:58:15.096 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:58:15.096 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:58:15.096 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:58:15.097 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:58:15.097 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:58:15.098 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:58:15.098 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 19:58:15.261 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:58:15.266 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:58:15.280 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:00:19.21]     LankaConnect.IntegrationTests.Repositories.ServiceRepositoryTests.GetByBusinessIdAndNameAsync_Should_Return_Matching_Service [FAIL]
[xUnit.net 00:00:19.21]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:00:19.21]       Stack Trace:
[xUnit.net 00:00:19.21]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:00:19.21]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:00:19.21]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:00:19.21]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:00:19.21]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:00:19.21]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:00:19.21]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
[xUnit.net 00:00:19.21]     LankaConnect.IntegrationTests.Email.EmailApiTests.EmailWebhook_ShouldHandleMailHogWebhooks [FAIL]
[xUnit.net 00:00:19.21]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:00:19.21]       Stack Trace:
[xUnit.net 00:00:19.21]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:00:19.21]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:00:19.21]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:00:19.21]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:00:19.21]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:00:19.21]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:00:19.21]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 19:58:15.316 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:58:15.325 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:58:15.343 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:58:15.369 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:58:15.371 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:00:19.29]     LankaConnect.IntegrationTests.Email.MailHogIntegrationTests.LargeEmailContent_ShouldBeHandledCorrectly [FAIL]
[xUnit.net 00:00:19.29]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:00:19.31]       Stack Trace:
[xUnit.net 00:00:19.31]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:00:19.31]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:00:19.31]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:00:19.31]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:00:19.31]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:00:19.31]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:00:19.31]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
[xUnit.net 00:00:19.31]     LankaConnect.IntegrationTests.Controllers.BusinessesControllerTests.GetBusinesses_Should_Return_Paginated_List [FAIL]
[xUnit.net 00:00:19.31]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:00:19.31]       Stack Trace:
[xUnit.net 00:00:19.31]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:00:19.31]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:00:19.31]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:00:19.31]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:00:19.31]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:00:19.31]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:00:19.31]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 19:58:15.425 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:58:15.440 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:58:15.611 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:58:15.612 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:58:15.612 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:58:15.612 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:58:15.612 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:58:15.613 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:58:15.613 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 19:58:15.645 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:58:15.645 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:58:15.646 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:58:15.646 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:58:15.646 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:58:15.647 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:58:15.647 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 19:58:15.647 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:58:15.647 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:58:15.647 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:58:15.648 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:58:15.648 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:58:15.648 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:58:15.648 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 19:58:15.686 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:58:15.686 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:58:15.686 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:58:15.687 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:58:15.687 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:58:15.687 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:58:15.688 -05:00 [INF]  Program: Applying database migrations...
  Failed LankaConnect.IntegrationTests.Repositories.ServiceRepositoryTests.GetByBusinessIdAndNameAsync_Should_Return_Matching_Service [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
  Failed LankaConnect.IntegrationTests.Email.EmailApiTests.EmailWebhook_ShouldHandleMailHogWebhooks [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
  Failed LankaConnect.IntegrationTests.Email.MailHogIntegrationTests.LargeEmailContent_ShouldBeHandledCorrectly [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
  Failed LankaConnect.IntegrationTests.Controllers.BusinessesControllerTests.GetBusinesses_Should_Return_Paginated_List [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
[xUnit.net 00:00:22.80]     LankaConnect.IntegrationTests.Controllers.BusinessImagesControllerTests.SetPrimaryBusinessImage_WithExistingImage_ShouldReturnNoContent [FAIL]
[xUnit.net 00:00:22.80]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:00:22.81]       Stack Trace:
[xUnit.net 00:00:22.81]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:00:22.81]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:00:22.81]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:00:22.81]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:00:22.81]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:00:22.81]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:00:22.81]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
  Failed LankaConnect.IntegrationTests.Controllers.BusinessImagesControllerTests.SetPrimaryBusinessImage_WithExistingImage_ShouldReturnNoContent [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
2026-01-18 19:58:18.910 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:58:19.047 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:58:19.047 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:58:19.048 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:58:19.048 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:58:19.048 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:58:19.049 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:58:19.049 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 19:58:19.174 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:58:19.179 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:58:19.716 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:58:19.716 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:58:19.720 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:00:23.64]     LankaConnect.IntegrationTests.Repositories.ServiceRepositoryTests.GetFreeServicesAsync_Should_Return_Services_Without_Price [FAIL]
[xUnit.net 00:00:23.64]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:00:23.64]       Stack Trace:
[xUnit.net 00:00:23.64]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:00:23.64]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:00:23.64]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:00:23.64]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:00:23.64]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:00:23.64]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:00:23.64]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
[xUnit.net 00:00:23.64]     LankaConnect.IntegrationTests.Email.EmailApiTests.SendEmailVerification_WithValidEmail_ShouldReturnSuccess [FAIL]
[xUnit.net 00:00:23.64]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:00:23.64]       Stack Trace:
[xUnit.net 00:00:23.64]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:00:23.64]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:00:23.64]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:00:23.64]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:00:23.64]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:00:23.64]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:00:23.64]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
[xUnit.net 00:00:23.65]     LankaConnect.IntegrationTests.Email.MailHogIntegrationTests.VerifyEmailHeaders_ShouldContainCorrectMetadata [FAIL]
[xUnit.net 00:00:23.65]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:00:23.65]       Stack Trace:
[xUnit.net 00:00:23.65]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:00:23.65]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:00:23.65]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:00:23.65]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:00:23.65]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:00:23.65]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:00:23.65]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 19:58:19.731 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:58:19.740 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:58:19.744 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:58:19.749 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:58:19.775 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:58:19.927 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:58:19.928 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:58:19.928 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:58:19.928 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:58:19.928 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:58:19.928 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:58:19.929 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:58:19.929 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:58:19.929 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:58:19.929 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:58:19.929 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:58:19.929 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:58:19.929 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 19:58:19.929 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 19:58:19.934 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:58:19.934 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:58:19.934 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:58:19.935 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:58:19.935 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:58:19.935 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:58:19.935 -05:00 [INF]  Program: Applying database migrations...
  Failed LankaConnect.IntegrationTests.Repositories.ServiceRepositoryTests.GetFreeServicesAsync_Should_Return_Services_Without_Price [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
  Failed LankaConnect.IntegrationTests.Email.EmailApiTests.SendEmailVerification_WithValidEmail_ShouldReturnSuccess [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
  Failed LankaConnect.IntegrationTests.Email.MailHogIntegrationTests.VerifyEmailHeaders_ShouldContainCorrectMetadata [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
[xUnit.net 00:00:27.00]     LankaConnect.IntegrationTests.Controllers.ExternalProviderManagementTests.UnlinkExternalProvider_WhenLastAuthMethod_ShouldReturn400 [FAIL]
[xUnit.net 00:00:27.00]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:00:27.00]       Stack Trace:
[xUnit.net 00:00:27.00]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:00:27.00]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:00:27.00]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:00:27.00]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:00:27.00]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:00:27.00]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:00:27.00]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
  Failed LankaConnect.IntegrationTests.Controllers.ExternalProviderManagementTests.UnlinkExternalProvider_WhenLastAuthMethod_ShouldReturn400 [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
2026-01-18 19:58:23.100 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:58:23.122 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:58:23.134 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:00:27.39]     LankaConnect.IntegrationTests.Controllers.EntraAuthControllerTests.LoginWithEntra_WhenEntraDisabled_ShouldReturn400BadRequest [FAIL]
[xUnit.net 00:00:27.39]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:00:27.39]       Stack Trace:
[xUnit.net 00:00:27.39]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:00:27.39]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:00:27.39]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:00:27.39]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:00:27.39]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:00:27.39]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:00:27.39]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 19:58:23.483 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:58:23.554 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:58:23.554 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:58:23.554 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:58:23.554 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:58:23.554 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:58:23.554 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:58:23.554 -05:00 [INF]  Program: Applying database migrations...
[xUnit.net 00:00:27.74]     LankaConnect.IntegrationTests.Controllers.BusinessesControllerTests.GetBusiness_Should_Return_NotFound_For_Invalid_Id [FAIL]
[xUnit.net 00:00:27.74]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:00:27.74]       Stack Trace:
[xUnit.net 00:00:27.74]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:00:27.74]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:00:27.74]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:00:27.74]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:00:27.74]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:00:27.74]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:00:27.74]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
[xUnit.net 00:00:27.74]     LankaConnect.IntegrationTests.Repositories.PostgreSQLRepositoryTests.UserRepository_CRUD_Operations_ShouldWork [FAIL]
[xUnit.net 00:00:27.74]       System.InvalidOperationException : Unable to resolve service for type 'MediatR.IPublisher' while attempting to activate 'LankaConnect.Infrastructure.Data.AppDbContext'.
[xUnit.net 00:00:27.74]       Stack Trace:
[xUnit.net 00:00:27.74]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateConstructorCallSite(ResultCache lifetime, ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain)
[xUnit.net 00:00:27.74]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceDescriptor descriptor, ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain, Int32 slot)
[xUnit.net 00:00:27.74]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateCallSite(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
[xUnit.net 00:00:27.74]            at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
[xUnit.net 00:00:27.74]            at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
[xUnit.net 00:00:27.74]            at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
[xUnit.net 00:00:27.74]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs(151,0): at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.EnsureDatabaseCreatedAsync()
[xUnit.net 00:00:27.74]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs(105,0): at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.InitializeAsync()
[xUnit.net 00:00:27.74]     LankaConnect.IntegrationTests.Repositories.PostgreSQLRepositoryTests.UserRepository_DatabaseConnection_ShouldWork [FAIL]
[xUnit.net 00:00:27.74]       System.InvalidOperationException : Unable to resolve service for type 'MediatR.IPublisher' while attempting to activate 'LankaConnect.Infrastructure.Data.AppDbContext'.
[xUnit.net 00:00:27.74]       Stack Trace:
[xUnit.net 00:00:27.74]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateConstructorCallSite(ResultCache lifetime, ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain)
[xUnit.net 00:00:27.74]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceDescriptor descriptor, ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain, Int32 slot)
[xUnit.net 00:00:27.74]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateCallSite(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
[xUnit.net 00:00:27.74]            at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
[xUnit.net 00:00:27.74]            at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
[xUnit.net 00:00:27.74]            at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
[xUnit.net 00:00:27.74]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs(151,0): at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.EnsureDatabaseCreatedAsync()
[xUnit.net 00:00:27.74]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs(105,0): at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.InitializeAsync()
[xUnit.net 00:00:27.74]     LankaConnect.IntegrationTests.Repositories.PostgreSQLRepositoryTests.AllRepositories_DependencyInjection_ShouldResolveCorrectly [FAIL]
[xUnit.net 00:00:27.74]       System.InvalidOperationException : Unable to resolve service for type 'MediatR.IPublisher' while attempting to activate 'LankaConnect.Infrastructure.Data.AppDbContext'.
[xUnit.net 00:00:27.74]       Stack Trace:
[xUnit.net 00:00:27.74]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateConstructorCallSite(ResultCache lifetime, ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain)
[xUnit.net 00:00:27.74]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceDescriptor descriptor, ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain, Int32 slot)
[xUnit.net 00:00:27.74]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateCallSite(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
[xUnit.net 00:00:27.74]            at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
[xUnit.net 00:00:27.74]            at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
[xUnit.net 00:00:27.74]            at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
[xUnit.net 00:00:27.74]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs(151,0): at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.EnsureDatabaseCreatedAsync()
[xUnit.net 00:00:27.74]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs(105,0): at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.InitializeAsync()
[xUnit.net 00:00:27.74]     LankaConnect.IntegrationTests.Repositories.PostgreSQLRepositoryTests.CreateAndRetrieveUser_AgainstPostgreSQL_ShouldWork [FAIL]
[xUnit.net 00:00:27.74]       System.InvalidOperationException : Unable to resolve service for type 'MediatR.IPublisher' while attempting to activate 'LankaConnect.Infrastructure.Data.AppDbContext'.
[xUnit.net 00:00:27.74]       Stack Trace:
[xUnit.net 00:00:27.74]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateConstructorCallSite(ResultCache lifetime, ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain)
[xUnit.net 00:00:27.74]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceDescriptor descriptor, ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain, Int32 slot)
[xUnit.net 00:00:27.74]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateCallSite(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
[xUnit.net 00:00:27.74]            at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
[xUnit.net 00:00:27.74]            at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
[xUnit.net 00:00:27.74]            at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
[xUnit.net 00:00:27.74]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs(151,0): at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.EnsureDatabaseCreatedAsync()
[xUnit.net 00:00:27.74]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs(105,0): at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.InitializeAsync()
[xUnit.net 00:00:27.74]     LankaConnect.IntegrationTests.Repositories.PostgreSQLRepositoryTests.EmailTemplateRepository_BasicOperations_ShouldWork [FAIL]
[xUnit.net 00:00:27.74]       System.InvalidOperationException : Unable to resolve service for type 'MediatR.IPublisher' while attempting to activate 'LankaConnect.Infrastructure.Data.AppDbContext'.
[xUnit.net 00:00:27.74]       Stack Trace:
[xUnit.net 00:00:27.74]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateConstructorCallSite(ResultCache lifetime, ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain)
[xUnit.net 00:00:27.74]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceDescriptor descriptor, ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain, Int32 slot)
[xUnit.net 00:00:27.74]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateCallSite(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
[xUnit.net 00:00:27.74]            at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
[xUnit.net 00:00:27.74]            at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
[xUnit.net 00:00:27.74]            at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
[xUnit.net 00:00:27.74]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs(151,0): at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.EnsureDatabaseCreatedAsync()
[xUnit.net 00:00:27.74]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs(105,0): at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.InitializeAsync()
2026-01-18 19:58:23.963 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:58:23.974 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:58:23.974 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:58:23.979 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:58:23.982 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
  Failed LankaConnect.IntegrationTests.Controllers.EntraAuthControllerTests.LoginWithEntra_WhenEntraDisabled_ShouldReturn400BadRequest [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
  Failed LankaConnect.IntegrationTests.Controllers.BusinessesControllerTests.GetBusiness_Should_Return_NotFound_For_Invalid_Id [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
  Failed LankaConnect.IntegrationTests.Repositories.PostgreSQLRepositoryTests.UserRepository_CRUD_Operations_ShouldWork [1 ms]
  Error Message:
   System.InvalidOperationException : Unable to resolve service for type 'MediatR.IPublisher' while attempting to activate 'LankaConnect.Infrastructure.Data.AppDbContext'.
  Stack Trace:
     at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateConstructorCallSite(ResultCache lifetime, ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceDescriptor descriptor, ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain, Int32 slot)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateCallSite(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.EnsureDatabaseCreatedAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs:line 151
   at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs:line 105
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
  Failed LankaConnect.IntegrationTests.Repositories.PostgreSQLRepositoryTests.UserRepository_DatabaseConnection_ShouldWork [1 ms]
  Error Message:
   System.InvalidOperationException : Unable to resolve service for type 'MediatR.IPublisher' while attempting to activate 'LankaConnect.Infrastructure.Data.AppDbContext'.
  Stack Trace:
     at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateConstructorCallSite(ResultCache lifetime, ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceDescriptor descriptor, ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain, Int32 slot)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateCallSite(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.EnsureDatabaseCreatedAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs:line 151
   at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs:line 105
  Failed LankaConnect.IntegrationTests.Repositories.PostgreSQLRepositoryTests.AllRepositories_DependencyInjection_ShouldResolveCorrectly [1 ms]
  Error Message:
   System.InvalidOperationException : Unable to resolve service for type 'MediatR.IPublisher' while attempting to activate 'LankaConnect.Infrastructure.Data.AppDbContext'.
  Stack Trace:
     at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateConstructorCallSite(ResultCache lifetime, ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceDescriptor descriptor, ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain, Int32 slot)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateCallSite(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.EnsureDatabaseCreatedAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs:line 151
   at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs:line 105
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
  Failed LankaConnect.IntegrationTests.Repositories.PostgreSQLRepositoryTests.CreateAndRetrieveUser_AgainstPostgreSQL_ShouldWork [1 ms]
  Error Message:
   System.InvalidOperationException : Unable to resolve service for type 'MediatR.IPublisher' while attempting to activate 'LankaConnect.Infrastructure.Data.AppDbContext'.
  Stack Trace:
     at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateConstructorCallSite(ResultCache lifetime, ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceDescriptor descriptor, ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain, Int32 slot)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateCallSite(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.EnsureDatabaseCreatedAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs:line 151
   at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs:line 105
  Failed LankaConnect.IntegrationTests.Repositories.PostgreSQLRepositoryTests.EmailTemplateRepository_BasicOperations_ShouldWork [1 ms]
  Error Message:
   System.InvalidOperationException : Unable to resolve service for type 'MediatR.IPublisher' while attempting to activate 'LankaConnect.Infrastructure.Data.AppDbContext'.
  Stack Trace:
     at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateConstructorCallSite(ResultCache lifetime, ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceDescriptor descriptor, ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain, Int32 slot)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateCallSite(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.EnsureDatabaseCreatedAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs:line 151
   at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs:line 105
  Passed LankaConnect.IntegrationTests.Controllers.EventsControllerSecurityTests.WaitingList_And_RSVP_Methods_Should_Not_Accept_UserId_Parameter(methodName: "RemoveFromWaitingList") [147 ms]
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:58:23.984 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:00:27.90]     LankaConnect.IntegrationTests.Email.MailHogIntegrationTests.SendMultipleEmails_ShouldAllAppearInMailHog [FAIL]
[xUnit.net 00:00:27.90]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:00:27.90]       Stack Trace:
[xUnit.net 00:00:27.90]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:00:27.90]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:00:27.90]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:00:27.90]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:00:27.90]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:00:27.90]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:00:27.90]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
[xUnit.net 00:00:27.90]     LankaConnect.IntegrationTests.Repositories.ServiceRepositoryTests.AddAsync_Should_Add_Service_Successfully [FAIL]
[xUnit.net 00:00:27.90]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:00:27.90]       Stack Trace:
[xUnit.net 00:00:27.90]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:00:27.90]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:00:27.90]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:00:27.90]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:00:27.90]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:00:27.90]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:00:27.90]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 19:58:23.999 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:58:24.003 -05:00 [INF]  : Starting LankaConnect API
[xUnit.net 00:00:28.02]     LankaConnect.IntegrationTests.Controllers.EventsControllerSecurityTests.GetMyRsvps_Should_Use_JWT_UserId_Not_Query_Parameter [FAIL]
[xUnit.net 00:00:28.02]       System.NullReferenceException : Object reference not set to an instance of an object.
[xUnit.net 00:00:28.02]       Stack Trace:
[xUnit.net 00:00:28.02]         c:\Work\LankaConnect\src\LankaConnect.API\Controllers\BaseController.cs(24,0): at LankaConnect.API.Controllers.BaseController`1.HandleResult[TResult](Result`1 result)
[xUnit.net 00:00:28.02]         c:\Work\LankaConnect\src\LankaConnect.API\Controllers\EventsController.cs(843,0): at LankaConnect.API.Controllers.EventsController.GetMyRsvps(String searchTerm, Nullable`1 category, Nullable`1 startDateFrom, Nullable`1 startDateTo, String state, List`1 metroAreaIds)
[xUnit.net 00:00:28.02]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Controllers\EventsControllerSecurityTests.cs(155,0): at LankaConnect.IntegrationTests.Controllers.EventsControllerSecurityTests.GetMyRsvps_Should_Use_JWT_UserId_Not_Query_Parameter()
[xUnit.net 00:00:28.02]         --- End of stack trace from previous location ---
  Passed LankaConnect.IntegrationTests.Controllers.EventsControllerSecurityTests.WaitingList_And_RSVP_Methods_Should_Not_Accept_UserId_Parameter(methodName: "CancelRsvp") [1 ms]
  Passed LankaConnect.IntegrationTests.Controllers.EventsControllerSecurityTests.WaitingList_And_RSVP_Methods_Should_Not_Accept_UserId_Parameter(methodName: "PromoteFromWaitingList") [< 1 ms]
  Failed LankaConnect.IntegrationTests.Email.MailHogIntegrationTests.SendMultipleEmails_ShouldAllAppearInMailHog [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
  Failed LankaConnect.IntegrationTests.Repositories.ServiceRepositoryTests.AddAsync_Should_Add_Service_Successfully [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
  Passed LankaConnect.IntegrationTests.Controllers.EventsControllerSecurityTests.CancelRsvp_Should_Use_JWT_UserId_Not_Query_Parameter [87 ms]
  Passed LankaConnect.IntegrationTests.Controllers.EventsControllerSecurityTests.AddToWaitingList_Should_Require_Authorization [7 ms]
  Failed LankaConnect.IntegrationTests.Controllers.EventsControllerSecurityTests.GetMyRsvps_Should_Use_JWT_UserId_Not_Query_Parameter [23 ms]
  Error Message:
   System.NullReferenceException : Object reference not set to an instance of an object.
  Stack Trace:
     at LankaConnect.API.Controllers.BaseController`1.HandleResult[TResult](Result`1 result) in c:\Work\LankaConnect\src\LankaConnect.API\Controllers\BaseController.cs:line 24
   at LankaConnect.API.Controllers.EventsController.GetMyRsvps(String searchTerm, Nullable`1 category, Nullable`1 startDateFrom, Nullable`1 startDateTo, String state, List`1 metroAreaIds) in c:\Work\LankaConnect\src\LankaConnect.API\Controllers\EventsController.cs:line 843
   at LankaConnect.IntegrationTests.Controllers.EventsControllerSecurityTests.GetMyRsvps_Should_Use_JWT_UserId_Not_Query_Parameter() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Controllers\EventsControllerSecurityTests.cs:line 155
--- End of stack trace from previous location ---
2026-01-18 19:58:24.119 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:58:24.119 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:58:24.119 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:58:24.119 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:58:24.119 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:58:24.119 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:58:24.120 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 19:58:24.122 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:58:24.123 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:58:24.123 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:58:24.123 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:58:24.123 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:58:24.123 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:58:24.123 -05:00 [INF]  Program: Applying database migrations...
[xUnit.net 00:00:28.07]     LankaConnect.IntegrationTests.Controllers.EventsControllerSecurityTests.User_Query_Methods_Should_Not_Accept_UserId_Parameter(methodName: "GetMyRsvps") [FAIL]
[xUnit.net 00:00:28.07]       Assert.Empty() Failure: Collection was not empty
[xUnit.net 00:00:28.07]       Collection: [System.String searchTerm, System.Nullable`1[LankaConnect.Domain.Events.Enums.EventCategory] category, System.Nullable`1[System.DateTime] startDateFrom, System.Nullable`1[System.DateTime] startDateTo, System.String state, ]
[xUnit.net 00:00:28.07]       Stack Trace:
[xUnit.net 00:00:28.07]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Controllers\EventsControllerSecurityTests.cs(232,0): at LankaConnect.IntegrationTests.Controllers.EventsControllerSecurityTests.User_Query_Methods_Should_Not_Accept_UserId_Parameter(String methodName)
[xUnit.net 00:00:28.07]            at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signature sig, Boolean isConstructor)
[xUnit.net 00:00:28.07]            at System.Reflection.MethodBaseInvoker.InvokeDirectByRefWithFewArgs(Object obj, Span`1 copyOfArgs, BindingFlags invokeAttr)
[xUnit.net 00:00:28.08]     LankaConnect.IntegrationTests.Repositories.UserRepositoryTests.GetByEmailAsync_WhenUserDoesNotExist_ShouldReturnNull [FAIL]
[xUnit.net 00:00:28.08]       System.InvalidOperationException : Unable to resolve service for type 'MediatR.IPublisher' while attempting to activate 'LankaConnect.Infrastructure.Data.AppDbContext'.
[xUnit.net 00:00:28.08]       Stack Trace:
[xUnit.net 00:00:28.08]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateConstructorCallSite(ResultCache lifetime, ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain)
[xUnit.net 00:00:28.08]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceDescriptor descriptor, ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain, Int32 slot)
[xUnit.net 00:00:28.08]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateCallSite(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
[xUnit.net 00:00:28.08]            at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
[xUnit.net 00:00:28.08]            at Microsoft.Extensions.DependencyInjection.ServiceProvider.GetService(ServiceIdentifier serviceIdentifier, ServiceProviderEngineScope serviceProviderEngineScope)
[xUnit.net 00:00:28.08]            at Microsoft.Extensions.DependencyInjection.ServiceProvider.GetService(Type serviceType)
[xUnit.net 00:00:28.08]            at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
[xUnit.net 00:00:28.08]            at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
[xUnit.net 00:00:28.08]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Repositories\UserRepositoryTests.cs(28,0): at LankaConnect.IntegrationTests.Repositories.UserRepositoryTests..ctor()
[xUnit.net 00:00:28.08]            at System.RuntimeType.CreateInstanceDefaultCtor(Boolean publicOnly, Boolean wrapExceptions)
[xUnit.net 00:00:28.08]     LankaConnect.IntegrationTests.Repositories.UserRepositoryTests.GetActiveUsersAsync_ShouldReturnOnlyActiveUsers [FAIL]
[xUnit.net 00:00:28.08]       System.InvalidOperationException : Unable to resolve service for type 'MediatR.IPublisher' while attempting to activate 'LankaConnect.Infrastructure.Data.AppDbContext'.
[xUnit.net 00:00:28.08]       Stack Trace:
[xUnit.net 00:00:28.08]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateConstructorCallSite(ResultCache lifetime, ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain)
[xUnit.net 00:00:28.08]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceDescriptor descriptor, ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain, Int32 slot)
[xUnit.net 00:00:28.08]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateCallSite(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
[xUnit.net 00:00:28.08]            at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
[xUnit.net 00:00:28.08]            at Microsoft.Extensions.DependencyInjection.ServiceProvider.GetService(ServiceIdentifier serviceIdentifier, ServiceProviderEngineScope serviceProviderEngineScope)
[xUnit.net 00:00:28.08]            at Microsoft.Extensions.DependencyInjection.ServiceProvider.GetService(Type serviceType)
[xUnit.net 00:00:28.08]            at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
[xUnit.net 00:00:28.08]            at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
[xUnit.net 00:00:28.08]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Repositories\UserRepositoryTests.cs(28,0): at LankaConnect.IntegrationTests.Repositories.UserRepositoryTests..ctor()
[xUnit.net 00:00:28.08]            at System.RuntimeType.CreateInstanceDefaultCtor(Boolean publicOnly, Boolean wrapExceptions)
  Passed LankaConnect.IntegrationTests.Controllers.EventsControllerSecurityTests.GetUpcomingEvents_Should_Use_JWT_UserId_Not_Query_Parameter [11 ms]
  Passed LankaConnect.IntegrationTests.Controllers.EventsControllerSecurityTests.AddToWaitingList_Should_Use_JWT_UserId_Not_Query_Parameter [7 ms]
  Passed LankaConnect.IntegrationTests.Controllers.EventsControllerSecurityTests.PromoteFromWaitingList_Should_Use_JWT_UserId_Not_Query_Parameter [5 ms]
  Passed LankaConnect.IntegrationTests.Controllers.EventsControllerSecurityTests.AddToWaitingList_Should_Not_Have_UserId_Query_Parameter [6 ms]
  Failed LankaConnect.IntegrationTests.Controllers.EventsControllerSecurityTests.User_Query_Methods_Should_Not_Accept_UserId_Parameter(methodName: "GetMyRsvps") [13 ms]
  Error Message:
   Assert.Empty() Failure: Collection was not empty
Collection: [System.String searchTerm, System.Nullable`1[LankaConnect.Domain.Events.Enums.EventCategory] category, System.Nullable`1[System.DateTime] startDateFrom, System.Nullable`1[System.DateTime] startDateTo, System.String state, ]
  Stack Trace:
     at LankaConnect.IntegrationTests.Controllers.EventsControllerSecurityTests.User_Query_Methods_Should_Not_Accept_UserId_Parameter(String methodName) in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Controllers\EventsControllerSecurityTests.cs:line 232
   at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signature sig, Boolean isConstructor)
   at System.Reflection.MethodBaseInvoker.InvokeDirectByRefWithFewArgs(Object obj, Span`1 copyOfArgs, BindingFlags invokeAttr)
  Passed LankaConnect.IntegrationTests.Controllers.EventsControllerSecurityTests.User_Query_Methods_Should_Not_Accept_UserId_Parameter(methodName: "GetUpcomingEvents") [< 1 ms]
  Passed LankaConnect.IntegrationTests.Controllers.EventsControllerSecurityTests.RemoveFromWaitingList_Should_Use_JWT_UserId_Not_Query_Parameter [5 ms]
  Failed LankaConnect.IntegrationTests.Repositories.UserRepositoryTests.GetByEmailAsync_WhenUserDoesNotExist_ShouldReturnNull [1 ms]
  Error Message:
   System.InvalidOperationException : Unable to resolve service for type 'MediatR.IPublisher' while attempting to activate 'LankaConnect.Infrastructure.Data.AppDbContext'.
  Stack Trace:
     at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateConstructorCallSite(ResultCache lifetime, ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceDescriptor descriptor, ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain, Int32 slot)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateCallSite(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.GetService(ServiceIdentifier serviceIdentifier, ServiceProviderEngineScope serviceProviderEngineScope)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.GetService(Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at LankaConnect.IntegrationTests.Repositories.UserRepositoryTests..ctor() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Repositories\UserRepositoryTests.cs:line 28
   at System.RuntimeType.CreateInstanceDefaultCtor(Boolean publicOnly, Boolean wrapExceptions)
  Failed LankaConnect.IntegrationTests.Repositories.UserRepositoryTests.GetActiveUsersAsync_ShouldReturnOnlyActiveUsers [1 ms]
  Error Message:
   System.InvalidOperationException : Unable to resolve service for type 'MediatR.IPublisher' while attempting to activate 'LankaConnect.Infrastructure.Data.AppDbContext'.
  Stack Trace:
     at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateConstructorCallSite(ResultCache lifetime, ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceDescriptor descriptor, ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain, Int32 slot)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateCallSite(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.GetService(ServiceIdentifier serviceIdentifier, ServiceProviderEngineScope serviceProviderEngineScope)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.GetService(Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at LankaConnect.IntegrationTests.Repositories.UserRepositoryTests..ctor() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Repositories\UserRepositoryTests.cs:line 28
   at System.RuntimeType.CreateInstanceDefaultCtor(Boolean publicOnly, Boolean wrapExceptions)
[xUnit.net 00:00:28.08]     LankaConnect.IntegrationTests.Repositories.UserRepositoryTests.ExistsWithEmailAsync_WhenUserExists_ShouldReturnTrue [FAIL]
[xUnit.net 00:00:28.08]       System.InvalidOperationException : Unable to resolve service for type 'MediatR.IPublisher' while attempting to activate 'LankaConnect.Infrastructure.Data.AppDbContext'.
[xUnit.net 00:00:28.08]       Stack Trace:
[xUnit.net 00:00:28.08]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateConstructorCallSite(ResultCache lifetime, ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain)
[xUnit.net 00:00:28.08]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceDescriptor descriptor, ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain, Int32 slot)
[xUnit.net 00:00:28.08]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateCallSite(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
[xUnit.net 00:00:28.08]            at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
[xUnit.net 00:00:28.08]            at Microsoft.Extensions.DependencyInjection.ServiceProvider.GetService(ServiceIdentifier serviceIdentifier, ServiceProviderEngineScope serviceProviderEngineScope)
[xUnit.net 00:00:28.08]            at Microsoft.Extensions.DependencyInjection.ServiceProvider.GetService(Type serviceType)
[xUnit.net 00:00:28.08]            at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
[xUnit.net 00:00:28.08]            at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
[xUnit.net 00:00:28.08]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Repositories\UserRepositoryTests.cs(28,0): at LankaConnect.IntegrationTests.Repositories.UserRepositoryTests..ctor()
[xUnit.net 00:00:28.08]            at System.RuntimeType.CreateInstanceDefaultCtor(Boolean publicOnly, Boolean wrapExceptions)
[xUnit.net 00:00:28.08]     LankaConnect.IntegrationTests.Repositories.UserRepositoryTests.ExistsWithEmailAsync_WhenUserDoesNotExist_ShouldReturnFalse [FAIL]
[xUnit.net 00:00:28.08]       System.InvalidOperationException : Unable to resolve service for type 'MediatR.IPublisher' while attempting to activate 'LankaConnect.Infrastructure.Data.AppDbContext'.
[xUnit.net 00:00:28.08]       Stack Trace:
[xUnit.net 00:00:28.08]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateConstructorCallSite(ResultCache lifetime, ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain)
[xUnit.net 00:00:28.08]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceDescriptor descriptor, ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain, Int32 slot)
[xUnit.net 00:00:28.08]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateCallSite(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
[xUnit.net 00:00:28.08]            at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
[xUnit.net 00:00:28.08]            at Microsoft.Extensions.DependencyInjection.ServiceProvider.GetService(ServiceIdentifier serviceIdentifier, ServiceProviderEngineScope serviceProviderEngineScope)
[xUnit.net 00:00:28.08]            at Microsoft.Extensions.DependencyInjection.ServiceProvider.GetService(Type serviceType)
[xUnit.net 00:00:28.08]            at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
[xUnit.net 00:00:28.08]            at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
[xUnit.net 00:00:28.08]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Repositories\UserRepositoryTests.cs(28,0): at LankaConnect.IntegrationTests.Repositories.UserRepositoryTests..ctor()
[xUnit.net 00:00:28.08]            at System.RuntimeType.CreateInstanceDefaultCtor(Boolean publicOnly, Boolean wrapExceptions)
[xUnit.net 00:00:28.08]     LankaConnect.IntegrationTests.Repositories.UserRepositoryTests.GetByEmailAsync_WhenUserExists_ShouldReturnUser [FAIL]
[xUnit.net 00:00:28.08]       System.InvalidOperationException : Unable to resolve service for type 'MediatR.IPublisher' while attempting to activate 'LankaConnect.Infrastructure.Data.AppDbContext'.
[xUnit.net 00:00:28.08]       Stack Trace:
[xUnit.net 00:00:28.08]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateConstructorCallSite(ResultCache lifetime, ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain)
[xUnit.net 00:00:28.08]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceDescriptor descriptor, ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain, Int32 slot)
[xUnit.net 00:00:28.08]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateCallSite(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
[xUnit.net 00:00:28.08]            at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
[xUnit.net 00:00:28.08]            at Microsoft.Extensions.DependencyInjection.ServiceProvider.GetService(ServiceIdentifier serviceIdentifier, ServiceProviderEngineScope serviceProviderEngineScope)
[xUnit.net 00:00:28.08]            at Microsoft.Extensions.DependencyInjection.ServiceProvider.GetService(Type serviceType)
[xUnit.net 00:00:28.08]            at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
[xUnit.net 00:00:28.08]            at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
[xUnit.net 00:00:28.08]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Repositories\UserRepositoryTests.cs(28,0): at LankaConnect.IntegrationTests.Repositories.UserRepositoryTests..ctor()
[xUnit.net 00:00:28.08]            at System.RuntimeType.CreateInstanceDefaultCtor(Boolean publicOnly, Boolean wrapExceptions)
[xUnit.net 00:00:28.35]     LankaConnect.IntegrationTests.Infrastructure.DatabaseConnectivityTests.Database_CanConnect_Successfully [FAIL]
[xUnit.net 00:00:28.35]       System.ArgumentException : Docker is either not running or misconfigured. Please ensure that Docker is running and that the endpoint is properly configured. You can customize your configuration using either the environment variables or the ~/.testcontainers.properties file. For more information, visit:
https://dotnet.testcontainers.org/custom_configuration/ (Parameter 'DockerEndpointAuthConfig')
[xUnit.net 00:00:28.35]       Stack Trace:
[xUnit.net 00:00:28.35]         /_/src/Testcontainers/Guard.Null.cs(62,0): at DotNet.Testcontainers.Guard.ThrowIf[TType](ArgumentInfo`1& argument, Func`2 condition, Func`2 ifClause)
[xUnit.net 00:00:28.35]         /_/src/Testcontainers/Builders/AbstractBuilder`4.cs(145,0): at DotNet.Testcontainers.Builders.AbstractBuilder`4.Validate()
[xUnit.net 00:00:28.35]         /_/src/Testcontainers/Builders/ContainerBuilder`3.cs(383,0): at DotNet.Testcontainers.Builders.ContainerBuilder`3.Validate()
[xUnit.net 00:00:28.35]         /_/src/Testcontainers.PostgreSql/PostgreSqlBuilder.cs(101,0): at Testcontainers.PostgreSql.PostgreSqlBuilder.Validate()
[xUnit.net 00:00:28.35]         /_/src/Testcontainers.PostgreSql/PostgreSqlBuilder.cs(75,0): at Testcontainers.PostgreSql.PostgreSqlBuilder.Build()
[xUnit.net 00:00:28.35]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Infrastructure\DatabaseConnectivityTests.cs(15,0): at LankaConnect.IntegrationTests.Infrastructure.DatabaseConnectivityTests..ctor()
[xUnit.net 00:00:28.35]            at System.RuntimeType.CreateInstanceDefaultCtor(Boolean publicOnly, Boolean wrapExceptions)
[xUnit.net 00:00:28.36]     LankaConnect.IntegrationTests.Infrastructure.DatabaseConnectivityTests.Database_HasCorrectTables_AfterMigration [FAIL]
[xUnit.net 00:00:28.36]       System.ArgumentException : Docker is either not running or misconfigured. Please ensure that Docker is running and that the endpoint is properly configured. You can customize your configuration using either the environment variables or the ~/.testcontainers.properties file. For more information, visit:
https://dotnet.testcontainers.org/custom_configuration/ (Parameter 'DockerEndpointAuthConfig')
[xUnit.net 00:00:28.36]       Stack Trace:
[xUnit.net 00:00:28.36]         /_/src/Testcontainers/Guard.Null.cs(62,0): at DotNet.Testcontainers.Guard.ThrowIf[TType](ArgumentInfo`1& argument, Func`2 condition, Func`2 ifClause)
[xUnit.net 00:00:28.36]         /_/src/Testcontainers/Builders/AbstractBuilder`4.cs(145,0): at DotNet.Testcontainers.Builders.AbstractBuilder`4.Validate()
[xUnit.net 00:00:28.36]         /_/src/Testcontainers/Builders/ContainerBuilder`3.cs(383,0): at DotNet.Testcontainers.Builders.ContainerBuilder`3.Validate()
[xUnit.net 00:00:28.36]         /_/src/Testcontainers.PostgreSql/PostgreSqlBuilder.cs(101,0): at Testcontainers.PostgreSql.PostgreSqlBuilder.Validate()
[xUnit.net 00:00:28.36]         /_/src/Testcontainers.PostgreSql/PostgreSqlBuilder.cs(75,0): at Testcontainers.PostgreSql.PostgreSqlBuilder.Build()
[xUnit.net 00:00:28.36]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Infrastructure\DatabaseConnectivityTests.cs(15,0): at LankaConnect.IntegrationTests.Infrastructure.DatabaseConnectivityTests..ctor()
[xUnit.net 00:00:28.36]            at System.RuntimeType.CreateInstanceDefaultCtor(Boolean publicOnly, Boolean wrapExceptions)
[xUnit.net 00:00:28.36]     LankaConnect.IntegrationTests.Infrastructure.DatabaseConnectivityTests.Database_ConnectionPool_WorksCorrectly [FAIL]
[xUnit.net 00:00:28.36]       System.ArgumentException : Docker is either not running or misconfigured. Please ensure that Docker is running and that the endpoint is properly configured. You can customize your configuration using either the environment variables or the ~/.testcontainers.properties file. For more information, visit:
https://dotnet.testcontainers.org/custom_configuration/ (Parameter 'DockerEndpointAuthConfig')
[xUnit.net 00:00:28.36]       Stack Trace:
[xUnit.net 00:00:28.36]         /_/src/Testcontainers/Guard.Null.cs(62,0): at DotNet.Testcontainers.Guard.ThrowIf[TType](ArgumentInfo`1& argument, Func`2 condition, Func`2 ifClause)
[xUnit.net 00:00:28.36]         /_/src/Testcontainers/Builders/AbstractBuilder`4.cs(145,0): at DotNet.Testcontainers.Builders.AbstractBuilder`4.Validate()
[xUnit.net 00:00:28.36]         /_/src/Testcontainers/Builders/ContainerBuilder`3.cs(383,0): at DotNet.Testcontainers.Builders.ContainerBuilder`3.Validate()
[xUnit.net 00:00:28.36]         /_/src/Testcontainers.PostgreSql/PostgreSqlBuilder.cs(101,0): at Testcontainers.PostgreSql.PostgreSqlBuilder.Validate()
[xUnit.net 00:00:28.36]         /_/src/Testcontainers.PostgreSql/PostgreSqlBuilder.cs(75,0): at Testcontainers.PostgreSql.PostgreSqlBuilder.Build()
[xUnit.net 00:00:28.36]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Infrastructure\DatabaseConnectivityTests.cs(15,0): at LankaConnect.IntegrationTests.Infrastructure.DatabaseConnectivityTests..ctor()
[xUnit.net 00:00:28.36]            at System.RuntimeType.CreateInstanceDefaultCtor(Boolean publicOnly, Boolean wrapExceptions)
[xUnit.net 00:00:28.36]     LankaConnect.IntegrationTests.Infrastructure.DatabaseConnectivityTests.Database_HandlesConnectionFailure_Gracefully [FAIL]
[xUnit.net 00:00:28.36]       System.ArgumentException : Docker is either not running or misconfigured. Please ensure that Docker is running and that the endpoint is properly configured. You can customize your configuration using either the environment variables or the ~/.testcontainers.properties file. For more information, visit:
https://dotnet.testcontainers.org/custom_configuration/ (Parameter 'DockerEndpointAuthConfig')
[xUnit.net 00:00:28.36]       Stack Trace:
[xUnit.net 00:00:28.36]         /_/src/Testcontainers/Guard.Null.cs(62,0): at DotNet.Testcontainers.Guard.ThrowIf[TType](ArgumentInfo`1& argument, Func`2 condition, Func`2 ifClause)
[xUnit.net 00:00:28.36]         /_/src/Testcontainers/Builders/AbstractBuilder`4.cs(145,0): at DotNet.Testcontainers.Builders.AbstractBuilder`4.Validate()
[xUnit.net 00:00:28.36]         /_/src/Testcontainers/Builders/ContainerBuilder`3.cs(383,0): at DotNet.Testcontainers.Builders.ContainerBuilder`3.Validate()
[xUnit.net 00:00:28.36]         /_/src/Testcontainers.PostgreSql/PostgreSqlBuilder.cs(101,0): at Testcontainers.PostgreSql.PostgreSqlBuilder.Validate()
[xUnit.net 00:00:28.36]         /_/src/Testcontainers.PostgreSql/PostgreSqlBuilder.cs(75,0): at Testcontainers.PostgreSql.PostgreSqlBuilder.Build()
[xUnit.net 00:00:28.36]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Infrastructure\DatabaseConnectivityTests.cs(15,0): at LankaConnect.IntegrationTests.Infrastructure.DatabaseConnectivityTests..ctor()
[xUnit.net 00:00:28.36]            at System.RuntimeType.CreateInstanceDefaultCtor(Boolean publicOnly, Boolean wrapExceptions)
[xUnit.net 00:00:28.36]     LankaConnect.IntegrationTests.Infrastructure.DatabaseConnectivityTests.Database_CanExecuteTransaction_Successfully [FAIL]
[xUnit.net 00:00:28.36]       System.ArgumentException : Docker is either not running or misconfigured. Please ensure that Docker is running and that the endpoint is properly configured. You can customize your configuration using either the environment variables or the ~/.testcontainers.properties file. For more information, visit:
https://dotnet.testcontainers.org/custom_configuration/ (Parameter 'DockerEndpointAuthConfig')
[xUnit.net 00:00:28.36]       Stack Trace:
[xUnit.net 00:00:28.36]         /_/src/Testcontainers/Guard.Null.cs(62,0): at DotNet.Testcontainers.Guard.ThrowIf[TType](ArgumentInfo`1& argument, Func`2 condition, Func`2 ifClause)
[xUnit.net 00:00:28.36]         /_/src/Testcontainers/Builders/AbstractBuilder`4.cs(145,0): at DotNet.Testcontainers.Builders.AbstractBuilder`4.Validate()
[xUnit.net 00:00:28.36]         /_/src/Testcontainers/Builders/ContainerBuilder`3.cs(383,0): at DotNet.Testcontainers.Builders.ContainerBuilder`3.Validate()
[xUnit.net 00:00:28.36]         /_/src/Testcontainers.PostgreSql/PostgreSqlBuilder.cs(101,0): at Testcontainers.PostgreSql.PostgreSqlBuilder.Validate()
[xUnit.net 00:00:28.36]         /_/src/Testcontainers.PostgreSql/PostgreSqlBuilder.cs(75,0): at Testcontainers.PostgreSql.PostgreSqlBuilder.Build()
[xUnit.net 00:00:28.36]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Infrastructure\DatabaseConnectivityTests.cs(15,0): at LankaConnect.IntegrationTests.Infrastructure.DatabaseConnectivityTests..ctor()
[xUnit.net 00:00:28.36]            at System.RuntimeType.CreateInstanceDefaultCtor(Boolean publicOnly, Boolean wrapExceptions)
[xUnit.net 00:00:28.36]     LankaConnect.IntegrationTests.Infrastructure.DatabaseConnectivityTests.Database_CommandTimeout_WorksCorrectly [FAIL]
[xUnit.net 00:00:28.36]       System.ArgumentException : Docker is either not running or misconfigured. Please ensure that Docker is running and that the endpoint is properly configured. You can customize your configuration using either the environment variables or the ~/.testcontainers.properties file. For more information, visit:
https://dotnet.testcontainers.org/custom_configuration/ (Parameter 'DockerEndpointAuthConfig')
[xUnit.net 00:00:28.36]       Stack Trace:
[xUnit.net 00:00:28.36]         /_/src/Testcontainers/Guard.Null.cs(62,0): at DotNet.Testcontainers.Guard.ThrowIf[TType](ArgumentInfo`1& argument, Func`2 condition, Func`2 ifClause)
[xUnit.net 00:00:28.36]         /_/src/Testcontainers/Builders/AbstractBuilder`4.cs(145,0): at DotNet.Testcontainers.Builders.AbstractBuilder`4.Validate()
[xUnit.net 00:00:28.36]         /_/src/Testcontainers/Builders/ContainerBuilder`3.cs(383,0): at DotNet.Testcontainers.Builders.ContainerBuilder`3.Validate()
[xUnit.net 00:00:28.36]         /_/src/Testcontainers.PostgreSql/PostgreSqlBuilder.cs(101,0): at Testcontainers.PostgreSql.PostgreSqlBuilder.Validate()
[xUnit.net 00:00:28.36]         /_/src/Testcontainers.PostgreSql/PostgreSqlBuilder.cs(75,0): at Testcontainers.PostgreSql.PostgreSqlBuilder.Build()
[xUnit.net 00:00:28.36]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Infrastructure\DatabaseConnectivityTests.cs(15,0): at LankaConnect.IntegrationTests.Infrastructure.DatabaseConnectivityTests..ctor()
[xUnit.net 00:00:28.36]            at System.RuntimeType.CreateInstanceDefaultCtor(Boolean publicOnly, Boolean wrapExceptions)
  Failed LankaConnect.IntegrationTests.Repositories.UserRepositoryTests.ExistsWithEmailAsync_WhenUserExists_ShouldReturnTrue [1 ms]
  Error Message:
   System.InvalidOperationException : Unable to resolve service for type 'MediatR.IPublisher' while attempting to activate 'LankaConnect.Infrastructure.Data.AppDbContext'.
  Stack Trace:
     at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateConstructorCallSite(ResultCache lifetime, ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceDescriptor descriptor, ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain, Int32 slot)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateCallSite(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.GetService(ServiceIdentifier serviceIdentifier, ServiceProviderEngineScope serviceProviderEngineScope)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.GetService(Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at LankaConnect.IntegrationTests.Repositories.UserRepositoryTests..ctor() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Repositories\UserRepositoryTests.cs:line 28
   at System.RuntimeType.CreateInstanceDefaultCtor(Boolean publicOnly, Boolean wrapExceptions)
  Failed LankaConnect.IntegrationTests.Repositories.UserRepositoryTests.ExistsWithEmailAsync_WhenUserDoesNotExist_ShouldReturnFalse [1 ms]
  Error Message:
   System.InvalidOperationException : Unable to resolve service for type 'MediatR.IPublisher' while attempting to activate 'LankaConnect.Infrastructure.Data.AppDbContext'.
  Stack Trace:
     at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateConstructorCallSite(ResultCache lifetime, ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceDescriptor descriptor, ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain, Int32 slot)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateCallSite(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.GetService(ServiceIdentifier serviceIdentifier, ServiceProviderEngineScope serviceProviderEngineScope)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.GetService(Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at LankaConnect.IntegrationTests.Repositories.UserRepositoryTests..ctor() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Repositories\UserRepositoryTests.cs:line 28
   at System.RuntimeType.CreateInstanceDefaultCtor(Boolean publicOnly, Boolean wrapExceptions)
  Failed LankaConnect.IntegrationTests.Repositories.UserRepositoryTests.GetByEmailAsync_WhenUserExists_ShouldReturnUser [1 ms]
  Error Message:
   System.InvalidOperationException : Unable to resolve service for type 'MediatR.IPublisher' while attempting to activate 'LankaConnect.Infrastructure.Data.AppDbContext'.
  Stack Trace:
     at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateConstructorCallSite(ResultCache lifetime, ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceDescriptor descriptor, ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain, Int32 slot)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateCallSite(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.GetService(ServiceIdentifier serviceIdentifier, ServiceProviderEngineScope serviceProviderEngineScope)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.GetService(Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at LankaConnect.IntegrationTests.Repositories.UserRepositoryTests..ctor() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Repositories\UserRepositoryTests.cs:line 28
   at System.RuntimeType.CreateInstanceDefaultCtor(Boolean publicOnly, Boolean wrapExceptions)
  Failed LankaConnect.IntegrationTests.Infrastructure.DatabaseConnectivityTests.Database_CanConnect_Successfully [1 ms]
  Error Message:
   System.ArgumentException : Docker is either not running or misconfigured. Please ensure that Docker is running and that the endpoint is properly configured. You can customize your configuration using either the environment variables or the ~/.testcontainers.properties file. For more information, visit:
https://dotnet.testcontainers.org/custom_configuration/ (Parameter 'DockerEndpointAuthConfig')
  Stack Trace:
     at DotNet.Testcontainers.Guard.ThrowIf[TType](ArgumentInfo`1& argument, Func`2 condition, Func`2 ifClause) in /_/src/Testcontainers/Guard.Null.cs:line 62
   at DotNet.Testcontainers.Builders.AbstractBuilder`4.Validate() in /_/src/Testcontainers/Builders/AbstractBuilder`4.cs:line 145
   at DotNet.Testcontainers.Builders.ContainerBuilder`3.Validate() in /_/src/Testcontainers/Builders/ContainerBuilder`3.cs:line 383
   at Testcontainers.PostgreSql.PostgreSqlBuilder.Validate() in /_/src/Testcontainers.PostgreSql/PostgreSqlBuilder.cs:line 101
   at Testcontainers.PostgreSql.PostgreSqlBuilder.Build() in /_/src/Testcontainers.PostgreSql/PostgreSqlBuilder.cs:line 75
   at LankaConnect.IntegrationTests.Infrastructure.DatabaseConnectivityTests..ctor() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Infrastructure\DatabaseConnectivityTests.cs:line 15
   at System.RuntimeType.CreateInstanceDefaultCtor(Boolean publicOnly, Boolean wrapExceptions)
  Failed LankaConnect.IntegrationTests.Infrastructure.DatabaseConnectivityTests.Database_HasCorrectTables_AfterMigration [1 ms]
  Error Message:
   System.ArgumentException : Docker is either not running or misconfigured. Please ensure that Docker is running and that the endpoint is properly configured. You can customize your configuration using either the environment variables or the ~/.testcontainers.properties file. For more information, visit:
https://dotnet.testcontainers.org/custom_configuration/ (Parameter 'DockerEndpointAuthConfig')
  Stack Trace:
     at DotNet.Testcontainers.Guard.ThrowIf[TType](ArgumentInfo`1& argument, Func`2 condition, Func`2 ifClause) in /_/src/Testcontainers/Guard.Null.cs:line 62
   at DotNet.Testcontainers.Builders.AbstractBuilder`4.Validate() in /_/src/Testcontainers/Builders/AbstractBuilder`4.cs:line 145
   at DotNet.Testcontainers.Builders.ContainerBuilder`3.Validate() in /_/src/Testcontainers/Builders/ContainerBuilder`3.cs:line 383
   at Testcontainers.PostgreSql.PostgreSqlBuilder.Validate() in /_/src/Testcontainers.PostgreSql/PostgreSqlBuilder.cs:line 101
   at Testcontainers.PostgreSql.PostgreSqlBuilder.Build() in /_/src/Testcontainers.PostgreSql/PostgreSqlBuilder.cs:line 75
   at LankaConnect.IntegrationTests.Infrastructure.DatabaseConnectivityTests..ctor() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Infrastructure\DatabaseConnectivityTests.cs:line 15
   at System.RuntimeType.CreateInstanceDefaultCtor(Boolean publicOnly, Boolean wrapExceptions)
  Failed LankaConnect.IntegrationTests.Infrastructure.DatabaseConnectivityTests.Database_ConnectionPool_WorksCorrectly [1 ms]
  Error Message:
   System.ArgumentException : Docker is either not running or misconfigured. Please ensure that Docker is running and that the endpoint is properly configured. You can customize your configuration using either the environment variables or the ~/.testcontainers.properties file. For more information, visit:
https://dotnet.testcontainers.org/custom_configuration/ (Parameter 'DockerEndpointAuthConfig')
  Stack Trace:
     at DotNet.Testcontainers.Guard.ThrowIf[TType](ArgumentInfo`1& argument, Func`2 condition, Func`2 ifClause) in /_/src/Testcontainers/Guard.Null.cs:line 62
   at DotNet.Testcontainers.Builders.AbstractBuilder`4.Validate() in /_/src/Testcontainers/Builders/AbstractBuilder`4.cs:line 145
   at DotNet.Testcontainers.Builders.ContainerBuilder`3.Validate() in /_/src/Testcontainers/Builders/ContainerBuilder`3.cs:line 383
   at Testcontainers.PostgreSql.PostgreSqlBuilder.Validate() in /_/src/Testcontainers.PostgreSql/PostgreSqlBuilder.cs:line 101
   at Testcontainers.PostgreSql.PostgreSqlBuilder.Build() in /_/src/Testcontainers.PostgreSql/PostgreSqlBuilder.cs:line 75
   at LankaConnect.IntegrationTests.Infrastructure.DatabaseConnectivityTests..ctor() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Infrastructure\DatabaseConnectivityTests.cs:line 15
   at System.RuntimeType.CreateInstanceDefaultCtor(Boolean publicOnly, Boolean wrapExceptions)
  Failed LankaConnect.IntegrationTests.Infrastructure.DatabaseConnectivityTests.Database_HandlesConnectionFailure_Gracefully [1 ms]
  Error Message:
   System.ArgumentException : Docker is either not running or misconfigured. Please ensure that Docker is running and that the endpoint is properly configured. You can customize your configuration using either the environment variables or the ~/.testcontainers.properties file. For more information, visit:
https://dotnet.testcontainers.org/custom_configuration/ (Parameter 'DockerEndpointAuthConfig')
  Stack Trace:
     at DotNet.Testcontainers.Guard.ThrowIf[TType](ArgumentInfo`1& argument, Func`2 condition, Func`2 ifClause) in /_/src/Testcontainers/Guard.Null.cs:line 62
   at DotNet.Testcontainers.Builders.AbstractBuilder`4.Validate() in /_/src/Testcontainers/Builders/AbstractBuilder`4.cs:line 145
   at DotNet.Testcontainers.Builders.ContainerBuilder`3.Validate() in /_/src/Testcontainers/Builders/ContainerBuilder`3.cs:line 383
   at Testcontainers.PostgreSql.PostgreSqlBuilder.Validate() in /_/src/Testcontainers.PostgreSql/PostgreSqlBuilder.cs:line 101
   at Testcontainers.PostgreSql.PostgreSqlBuilder.Build() in /_/src/Testcontainers.PostgreSql/PostgreSqlBuilder.cs:line 75
   at LankaConnect.IntegrationTests.Infrastructure.DatabaseConnectivityTests..ctor() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Infrastructure\DatabaseConnectivityTests.cs:line 15
   at System.RuntimeType.CreateInstanceDefaultCtor(Boolean publicOnly, Boolean wrapExceptions)
  Failed LankaConnect.IntegrationTests.Infrastructure.DatabaseConnectivityTests.Database_CanExecuteTransaction_Successfully [1 ms]
  Error Message:
   System.ArgumentException : Docker is either not running or misconfigured. Please ensure that Docker is running and that the endpoint is properly configured. You can customize your configuration using either the environment variables or the ~/.testcontainers.properties file. For more information, visit:
https://dotnet.testcontainers.org/custom_configuration/ (Parameter 'DockerEndpointAuthConfig')
  Stack Trace:
     at DotNet.Testcontainers.Guard.ThrowIf[TType](ArgumentInfo`1& argument, Func`2 condition, Func`2 ifClause) in /_/src/Testcontainers/Guard.Null.cs:line 62
   at DotNet.Testcontainers.Builders.AbstractBuilder`4.Validate() in /_/src/Testcontainers/Builders/AbstractBuilder`4.cs:line 145
   at DotNet.Testcontainers.Builders.ContainerBuilder`3.Validate() in /_/src/Testcontainers/Builders/ContainerBuilder`3.cs:line 383
   at Testcontainers.PostgreSql.PostgreSqlBuilder.Validate() in /_/src/Testcontainers.PostgreSql/PostgreSqlBuilder.cs:line 101
   at Testcontainers.PostgreSql.PostgreSqlBuilder.Build() in /_/src/Testcontainers.PostgreSql/PostgreSqlBuilder.cs:line 75
   at LankaConnect.IntegrationTests.Infrastructure.DatabaseConnectivityTests..ctor() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Infrastructure\DatabaseConnectivityTests.cs:line 15
   at System.RuntimeType.CreateInstanceDefaultCtor(Boolean publicOnly, Boolean wrapExceptions)
  Failed LankaConnect.IntegrationTests.Infrastructure.DatabaseConnectivityTests.Database_CommandTimeout_WorksCorrectly [1 ms]
  Error Message:
   System.ArgumentException : Docker is either not running or misconfigured. Please ensure that Docker is running and that the endpoint is properly configured. You can customize your configuration using either the environment variables or the ~/.testcontainers.properties file. For more information, visit:
https://dotnet.testcontainers.org/custom_configuration/ (Parameter 'DockerEndpointAuthConfig')
  Stack Trace:
     at DotNet.Testcontainers.Guard.ThrowIf[TType](ArgumentInfo`1& argument, Func`2 condition, Func`2 ifClause) in /_/src/Testcontainers/Guard.Null.cs:line 62
   at DotNet.Testcontainers.Builders.AbstractBuilder`4.Validate() in /_/src/Testcontainers/Builders/AbstractBuilder`4.cs:line 145
   at DotNet.Testcontainers.Builders.ContainerBuilder`3.Validate() in /_/src/Testcontainers/Builders/ContainerBuilder`3.cs:line 383
   at Testcontainers.PostgreSql.PostgreSqlBuilder.Validate() in /_/src/Testcontainers.PostgreSql/PostgreSqlBuilder.cs:line 101
   at Testcontainers.PostgreSql.PostgreSqlBuilder.Build() in /_/src/Testcontainers.PostgreSql/PostgreSqlBuilder.cs:line 75
   at LankaConnect.IntegrationTests.Infrastructure.DatabaseConnectivityTests..ctor() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Infrastructure\DatabaseConnectivityTests.cs:line 15
   at System.RuntimeType.CreateInstanceDefaultCtor(Boolean publicOnly, Boolean wrapExceptions)
[xUnit.net 00:00:28.82]     LankaConnect.IntegrationTests.Infrastructure.LoggingConfigurationTests.PerformanceLogging_MeasuresDuration [FAIL]
[xUnit.net 00:00:28.82]       Expected timedEvent not to be <null>.
[xUnit.net 00:00:28.82]       Stack Trace:
[xUnit.net 00:00:28.82]            at FluentAssertions.Execution.XUnit2TestFramework.Throw(String message)
[xUnit.net 00:00:28.82]            at FluentAssertions.Execution.TestFrameworkProvider.Throw(String message)
[xUnit.net 00:00:28.82]            at FluentAssertions.Execution.DefaultAssertionStrategy.HandleFailure(String message)
[xUnit.net 00:00:28.82]            at FluentAssertions.Execution.AssertionScope.FailWith(Func`1 failReasonFunc)
[xUnit.net 00:00:28.82]            at FluentAssertions.Execution.AssertionScope.FailWith(Func`1 failReasonFunc)
[xUnit.net 00:00:28.82]            at FluentAssertions.Execution.AssertionScope.FailWith(String message)
[xUnit.net 00:00:28.82]            at FluentAssertions.Primitives.ReferenceTypeAssertions`2.NotBeNull(String because, Object[] becauseArgs)
[xUnit.net 00:00:28.82]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Infrastructure\LoggingConfigurationTests.cs(247,0): at LankaConnect.IntegrationTests.Infrastructure.LoggingConfigurationTests.PerformanceLogging_MeasuresDuration()
[xUnit.net 00:00:28.82]            at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signature sig, Boolean isConstructor)
[xUnit.net 00:00:28.82]            at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)
[xUnit.net 00:00:29.11]     LankaConnect.IntegrationTests.Repositories.SimplifiedEmailRepositoryTests.EmailTemplate_CreateWithCategory_ShouldPersistSuccessfully [FAIL]
[xUnit.net 00:00:29.11]       System.InvalidOperationException : Unable to resolve service for type 'MediatR.IPublisher' while attempting to activate 'LankaConnect.Infrastructure.Data.AppDbContext'.
[xUnit.net 00:00:29.11]       Stack Trace:
[xUnit.net 00:00:29.11]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateConstructorCallSite(ResultCache lifetime, ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain)
[xUnit.net 00:00:29.11]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceDescriptor descriptor, ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain, Int32 slot)
[xUnit.net 00:00:29.11]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateCallSite(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
[xUnit.net 00:00:29.11]            at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
[xUnit.net 00:00:29.11]            at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
[xUnit.net 00:00:29.11]            at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
[xUnit.net 00:00:29.11]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs(151,0): at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.EnsureDatabaseCreatedAsync()
[xUnit.net 00:00:29.11]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs(105,0): at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.InitializeAsync()
[xUnit.net 00:00:29.11]     LankaConnect.IntegrationTests.Repositories.SimplifiedEmailRepositoryTests.EmailRepositories_DependencyInjection_ShouldResolveCorrectly [FAIL]
[xUnit.net 00:00:29.11]       System.InvalidOperationException : Unable to resolve service for type 'MediatR.IPublisher' while attempting to activate 'LankaConnect.Infrastructure.Data.AppDbContext'.
[xUnit.net 00:00:29.11]       Stack Trace:
[xUnit.net 00:00:29.11]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateConstructorCallSite(ResultCache lifetime, ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain)
[xUnit.net 00:00:29.11]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceDescriptor descriptor, ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain, Int32 slot)
[xUnit.net 00:00:29.11]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateCallSite(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
[xUnit.net 00:00:29.11]            at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
[xUnit.net 00:00:29.11]            at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
[xUnit.net 00:00:29.11]            at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
[xUnit.net 00:00:29.11]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs(151,0): at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.EnsureDatabaseCreatedAsync()
[xUnit.net 00:00:29.11]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs(105,0): at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.InitializeAsync()
[xUnit.net 00:00:29.12]     LankaConnect.IntegrationTests.Repositories.SimplifiedEmailRepositoryTests.EmailMessage_CreateWithEmailAddresses_ShouldPersistSuccessfully [FAIL]
[xUnit.net 00:00:29.12]       System.InvalidOperationException : Unable to resolve service for type 'MediatR.IPublisher' while attempting to activate 'LankaConnect.Infrastructure.Data.AppDbContext'.
[xUnit.net 00:00:29.12]       Stack Trace:
[xUnit.net 00:00:29.12]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateConstructorCallSite(ResultCache lifetime, ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain)
[xUnit.net 00:00:29.12]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceDescriptor descriptor, ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain, Int32 slot)
[xUnit.net 00:00:29.12]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateCallSite(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
[xUnit.net 00:00:29.12]            at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
[xUnit.net 00:00:29.12]            at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
[xUnit.net 00:00:29.12]            at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
[xUnit.net 00:00:29.12]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs(151,0): at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.EnsureDatabaseCreatedAsync()
[xUnit.net 00:00:29.12]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs(105,0): at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.InitializeAsync()
  Passed LankaConnect.IntegrationTests.Infrastructure.LoggingConfigurationTests.LogLevel_Filtering_WorksCorrectly [94 ms]
  Failed LankaConnect.IntegrationTests.Infrastructure.LoggingConfigurationTests.PerformanceLogging_MeasuresDuration [360 ms]
  Error Message:
   Expected timedEvent not to be <null>.
  Stack Trace:
     at FluentAssertions.Execution.XUnit2TestFramework.Throw(String message)
   at FluentAssertions.Execution.TestFrameworkProvider.Throw(String message)
   at FluentAssertions.Execution.DefaultAssertionStrategy.HandleFailure(String message)
   at FluentAssertions.Execution.AssertionScope.FailWith(Func`1 failReasonFunc)
   at FluentAssertions.Execution.AssertionScope.FailWith(Func`1 failReasonFunc)
   at FluentAssertions.Execution.AssertionScope.FailWith(String message)
   at FluentAssertions.Primitives.ReferenceTypeAssertions`2.NotBeNull(String because, Object[] becauseArgs)
   at LankaConnect.IntegrationTests.Infrastructure.LoggingConfigurationTests.PerformanceLogging_MeasuresDuration() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Infrastructure\LoggingConfigurationTests.cs:line 247
   at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signature sig, Boolean isConstructor)
   at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)
  Passed LankaConnect.IntegrationTests.Infrastructure.LoggingConfigurationTests.LogContext_PreservesScope [83 ms]
  Passed LankaConnect.IntegrationTests.Infrastructure.LoggingConfigurationTests.StructuredLogging_WorksCorrectly [90 ms]
  Passed LankaConnect.IntegrationTests.DummyTest.DummyTest_Should_Pass [1 ms]
  Failed LankaConnect.IntegrationTests.Repositories.SimplifiedEmailRepositoryTests.EmailTemplate_CreateWithCategory_ShouldPersistSuccessfully [1 ms]
  Error Message:
   System.InvalidOperationException : Unable to resolve service for type 'MediatR.IPublisher' while attempting to activate 'LankaConnect.Infrastructure.Data.AppDbContext'.
  Stack Trace:
     at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateConstructorCallSite(ResultCache lifetime, ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceDescriptor descriptor, ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain, Int32 slot)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateCallSite(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.EnsureDatabaseCreatedAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs:line 151
   at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs:line 105
  Failed LankaConnect.IntegrationTests.Repositories.SimplifiedEmailRepositoryTests.EmailRepositories_DependencyInjection_ShouldResolveCorrectly [1 ms]
  Error Message:
   System.InvalidOperationException : Unable to resolve service for type 'MediatR.IPublisher' while attempting to activate 'LankaConnect.Infrastructure.Data.AppDbContext'.
  Stack Trace:
     at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateConstructorCallSite(ResultCache lifetime, ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceDescriptor descriptor, ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain, Int32 slot)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateCallSite(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.EnsureDatabaseCreatedAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs:line 151
   at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs:line 105
  Failed LankaConnect.IntegrationTests.Repositories.SimplifiedEmailRepositoryTests.EmailMessage_CreateWithEmailAddresses_ShouldPersistSuccessfully [1 ms]
  Error Message:
   System.InvalidOperationException : Unable to resolve service for type 'MediatR.IPublisher' while attempting to activate 'LankaConnect.Infrastructure.Data.AppDbContext'.
  Stack Trace:
     at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateConstructorCallSite(ResultCache lifetime, ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceDescriptor descriptor, ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain, Int32 slot)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateCallSite(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.EnsureDatabaseCreatedAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs:line 151
   at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs:line 105
[xUnit.net 00:00:29.12]     LankaConnect.IntegrationTests.Repositories.SimplifiedEmailRepositoryTests.EmailMessage_CompleteWorkflow_ShouldUpdateStatusCorrectly [FAIL]
[xUnit.net 00:00:29.12]       System.InvalidOperationException : Unable to resolve service for type 'MediatR.IPublisher' while attempting to activate 'LankaConnect.Infrastructure.Data.AppDbContext'.
[xUnit.net 00:00:29.12]       Stack Trace:
[xUnit.net 00:00:29.12]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateConstructorCallSite(ResultCache lifetime, ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain)
[xUnit.net 00:00:29.12]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceDescriptor descriptor, ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain, Int32 slot)
[xUnit.net 00:00:29.12]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateCallSite(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
[xUnit.net 00:00:29.12]            at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
[xUnit.net 00:00:29.12]            at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
[xUnit.net 00:00:29.12]            at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
[xUnit.net 00:00:29.12]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs(151,0): at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.EnsureDatabaseCreatedAsync()
[xUnit.net 00:00:29.12]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs(105,0): at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.InitializeAsync()
[xUnit.net 00:00:29.13]     LankaConnect.IntegrationTests.Repositories.SimplifiedEmailRepositoryTests.EmailMessage_WithMultipleRecipients_ShouldPersistCorrectly [FAIL]
[xUnit.net 00:00:29.13]       System.InvalidOperationException : Unable to resolve service for type 'MediatR.IPublisher' while attempting to activate 'LankaConnect.Infrastructure.Data.AppDbContext'.
[xUnit.net 00:00:29.13]       Stack Trace:
[xUnit.net 00:00:29.13]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateConstructorCallSite(ResultCache lifetime, ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain)
[xUnit.net 00:00:29.13]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceDescriptor descriptor, ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain, Int32 slot)
[xUnit.net 00:00:29.13]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateCallSite(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
[xUnit.net 00:00:29.13]            at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
[xUnit.net 00:00:29.13]            at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
[xUnit.net 00:00:29.13]            at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
[xUnit.net 00:00:29.13]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs(151,0): at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.EnsureDatabaseCreatedAsync()
[xUnit.net 00:00:29.13]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs(105,0): at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.InitializeAsync()
[xUnit.net 00:00:29.13]     LankaConnect.IntegrationTests.Repositories.SimplifiedEmailRepositoryTests.EmailTemplate_CategoryMapping_ShouldWorkCorrectly [FAIL]
[xUnit.net 00:00:29.13]       System.InvalidOperationException : Unable to resolve service for type 'MediatR.IPublisher' while attempting to activate 'LankaConnect.Infrastructure.Data.AppDbContext'.
[xUnit.net 00:00:29.13]       Stack Trace:
[xUnit.net 00:00:29.13]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateConstructorCallSite(ResultCache lifetime, ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain)
[xUnit.net 00:00:29.13]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceDescriptor descriptor, ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain, Int32 slot)
[xUnit.net 00:00:29.13]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateCallSite(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
[xUnit.net 00:00:29.13]            at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
[xUnit.net 00:00:29.13]            at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
[xUnit.net 00:00:29.13]            at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
[xUnit.net 00:00:29.13]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs(151,0): at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.EnsureDatabaseCreatedAsync()
[xUnit.net 00:00:29.13]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs(105,0): at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.InitializeAsync()
[xUnit.net 00:00:29.13]     LankaConnect.IntegrationTests.Storage.AzureBlobImageServiceIntegrationTests.GetSecureUrlAsync_InDevelopmentMode_ShouldReturnOriginalUrl [SKIP]
[xUnit.net 00:00:29.13]       AzureBlobImageService implementation not complete yet
[xUnit.net 00:00:29.14]     LankaConnect.IntegrationTests.Storage.AzureBlobImageServiceIntegrationTests.UploadImageAsync_WithLargeFile_ShouldFailValidation [SKIP]
[xUnit.net 00:00:29.14]       AzureBlobImageService implementation not complete yet
[xUnit.net 00:00:29.14]     LankaConnect.IntegrationTests.Storage.AzureBlobImageServiceIntegrationTests.UploadImageAsync_WithValidImage_ShouldUploadSuccessfully [SKIP]
[xUnit.net 00:00:29.14]       AzureBlobImageService implementation not complete yet
[xUnit.net 00:00:29.14]     LankaConnect.IntegrationTests.Storage.AzureBlobImageServiceIntegrationTests.UploadImageAsync_ConcurrentUploads_ShouldHandleMultipleUploads [SKIP]
[xUnit.net 00:00:29.14]       AzureBlobImageService implementation not complete yet
[xUnit.net 00:00:29.14]     LankaConnect.IntegrationTests.Storage.AzureBlobImageServiceIntegrationTests.DeleteImageAsync_WithExistingImage_ShouldDeleteSuccessfully [SKIP]
[xUnit.net 00:00:29.14]       AzureBlobImageService implementation not complete yet
[xUnit.net 00:00:29.14]     LankaConnect.IntegrationTests.Storage.AzureBlobImageServiceIntegrationTests.ValidateImage_WithInvalidFileExtension_ShouldReturnFailure [SKIP]
[xUnit.net 00:00:29.14]       AzureBlobImageService implementation not complete yet
  Failed LankaConnect.IntegrationTests.Repositories.SimplifiedEmailRepositoryTests.EmailMessage_CompleteWorkflow_ShouldUpdateStatusCorrectly [1 ms]
  Error Message:
   System.InvalidOperationException : Unable to resolve service for type 'MediatR.IPublisher' while attempting to activate 'LankaConnect.Infrastructure.Data.AppDbContext'.
  Stack Trace:
     at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateConstructorCallSite(ResultCache lifetime, ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceDescriptor descriptor, ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain, Int32 slot)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateCallSite(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.EnsureDatabaseCreatedAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs:line 151
   at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs:line 105
  Failed LankaConnect.IntegrationTests.Repositories.SimplifiedEmailRepositoryTests.EmailMessage_WithMultipleRecipients_ShouldPersistCorrectly [1 ms]
  Error Message:
   System.InvalidOperationException : Unable to resolve service for type 'MediatR.IPublisher' while attempting to activate 'LankaConnect.Infrastructure.Data.AppDbContext'.
  Stack Trace:
     at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateConstructorCallSite(ResultCache lifetime, ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceDescriptor descriptor, ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain, Int32 slot)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateCallSite(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.EnsureDatabaseCreatedAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs:line 151
   at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs:line 105
  Failed LankaConnect.IntegrationTests.Repositories.SimplifiedEmailRepositoryTests.EmailTemplate_CategoryMapping_ShouldWorkCorrectly [1 ms]
  Error Message:
   System.InvalidOperationException : Unable to resolve service for type 'MediatR.IPublisher' while attempting to activate 'LankaConnect.Infrastructure.Data.AppDbContext'.
  Stack Trace:
     at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateConstructorCallSite(ResultCache lifetime, ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceDescriptor descriptor, ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain, Int32 slot)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateCallSite(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.EnsureDatabaseCreatedAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs:line 151
   at LankaConnect.IntegrationTests.Common.DockerComposeTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeTestBase.cs:line 105
  Skipped LankaConnect.IntegrationTests.Storage.AzureBlobImageServiceIntegrationTests.GetSecureUrlAsync_InDevelopmentMode_ShouldReturnOriginalUrl [1 ms]
  Skipped LankaConnect.IntegrationTests.Storage.AzureBlobImageServiceIntegrationTests.UploadImageAsync_WithLargeFile_ShouldFailValidation [1 ms]
  Skipped LankaConnect.IntegrationTests.Storage.AzureBlobImageServiceIntegrationTests.UploadImageAsync_WithValidImage_ShouldUploadSuccessfully [1 ms]
  Skipped LankaConnect.IntegrationTests.Storage.AzureBlobImageServiceIntegrationTests.UploadImageAsync_ConcurrentUploads_ShouldHandleMultipleUploads [1 ms]
  Skipped LankaConnect.IntegrationTests.Storage.AzureBlobImageServiceIntegrationTests.DeleteImageAsync_WithExistingImage_ShouldDeleteSuccessfully [1 ms]
  Skipped LankaConnect.IntegrationTests.Storage.AzureBlobImageServiceIntegrationTests.ValidateImage_WithInvalidFileExtension_ShouldReturnFailure [1 ms]
[xUnit.net 00:00:29.14]     LankaConnect.IntegrationTests.Storage.AzureBlobImageServiceIntegrationTests.ValidateImage_WithValidJpegBytes_ShouldReturnSuccess [SKIP]
[xUnit.net 00:00:29.14]       AzureBlobImageService implementation not complete yet
[xUnit.net 00:00:29.14]     LankaConnect.IntegrationTests.Storage.AzureBlobImageServiceIntegrationTests.ValidateImage_WithCorruptedImageData_ShouldReturnFailure [SKIP]
[xUnit.net 00:00:29.14]       AzureBlobImageService implementation not complete yet
[xUnit.net 00:00:29.14]     LankaConnect.IntegrationTests.Storage.AzureBlobImageServiceIntegrationTests.ResizeAndUploadAsync_WithValidImage_ShouldCreateMultipleSizes [SKIP]
[xUnit.net 00:00:29.14]       AzureBlobImageService implementation not complete yet
2026-01-18 19:58:25.240 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:58:25.306 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:58:25.307 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:58:25.308 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:58:25.308 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:58:25.308 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:58:25.308 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:58:25.308 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 19:58:25.322 -05:00 [INF]  LankaConnect.IntegrationTests.Infrastructure.LoggingConfigurationTests: Test log message from endpoint
2026-01-18 19:58:25.327 -05:00 [INF]  Microsoft.AspNetCore.Http.Result.OkObjectResult: Setting HTTP status code 200.
2026-01-18 19:58:25.330 -05:00 [INF]  Microsoft.AspNetCore.Http.Result.OkObjectResult: Writing value of type 'String' as Json.
  Skipped LankaConnect.IntegrationTests.Storage.AzureBlobImageServiceIntegrationTests.ValidateImage_WithValidJpegBytes_ShouldReturnSuccess [1 ms]
  Skipped LankaConnect.IntegrationTests.Storage.AzureBlobImageServiceIntegrationTests.ValidateImage_WithCorruptedImageData_ShouldReturnFailure [1 ms]
  Skipped LankaConnect.IntegrationTests.Storage.AzureBlobImageServiceIntegrationTests.ResizeAndUploadAsync_WithValidImage_ShouldCreateMultipleSizes [1 ms]
[xUnit.net 00:00:30.94]     LankaConnect.IntegrationTests.Controllers.AuthControllerTests.Register_WithDifferentRoles_ShouldCreateUserWithCorrectRole(role: GeneralUser) [FAIL]
[xUnit.net 00:00:30.94]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:00:30.94]       Stack Trace:
[xUnit.net 00:00:30.94]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:00:30.94]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:00:30.94]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:00:30.94]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:00:30.94]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:00:30.94]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:00:30.94]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 19:58:27.077 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:58:27.236 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:58:27.236 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:58:27.237 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:58:27.237 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:58:27.237 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:58:27.237 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:58:27.237 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 19:58:27.249 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:58:27.635 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:00:31.55]     LankaConnect.IntegrationTests.Controllers.EntraAuthControllerTests.LoginWithEntra_ShouldReturnRefreshTokenInResponse [FAIL]
[xUnit.net 00:00:31.55]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:00:31.55]       Stack Trace:
[xUnit.net 00:00:31.55]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:00:31.55]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:00:31.55]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:00:31.55]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:00:31.55]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:00:31.55]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:00:31.55]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 19:58:27.651 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:58:27.704 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:58:27.704 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:58:27.704 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:58:27.704 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:58:27.704 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:58:27.705 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:58:27.705 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 19:58:28.192 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:58:28.202 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:58:28.209 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:58:28.221 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:00:32.16]     LankaConnect.IntegrationTests.Email.MailHogIntegrationTests.DeleteMailHogMessages_ShouldClearInbox [FAIL]
[xUnit.net 00:00:32.16]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:00:32.16]       Stack Trace:
[xUnit.net 00:00:32.16]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:00:32.16]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:00:32.16]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:00:32.16]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:00:32.16]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:00:32.16]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:00:32.16]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
  Failed LankaConnect.IntegrationTests.Controllers.AuthControllerTests.Register_WithDifferentRoles_ShouldCreateUserWithCorrectRole(role: GeneralUser) [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
  Failed LankaConnect.IntegrationTests.Controllers.EntraAuthControllerTests.LoginWithEntra_ShouldReturnRefreshTokenInResponse [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
  Failed LankaConnect.IntegrationTests.Email.MailHogIntegrationTests.DeleteMailHogMessages_ShouldClearInbox [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
2026-01-18 19:58:28.259 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:58:28.320 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:58:28.320 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:58:28.321 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:58:28.321 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:58:28.321 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:58:28.321 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:58:28.321 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 19:58:29.383 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:58:29.390 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:00:35.17]     LankaConnect.IntegrationTests.Controllers.BusinessImagesControllerTests.GetBusinessImages_WithExistingImages_ShouldReturnImages [FAIL]
[xUnit.net 00:00:35.17]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:00:35.17]       Stack Trace:
[xUnit.net 00:00:35.17]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:00:35.17]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:00:35.17]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:00:35.17]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:00:35.17]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:00:35.17]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:00:35.17]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
  Failed LankaConnect.IntegrationTests.Controllers.BusinessImagesControllerTests.GetBusinessImages_WithExistingImages_ShouldReturnImages [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
2026-01-18 19:58:31.291 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:58:31.325 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:58:31.331 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:00:35.50]     LankaConnect.IntegrationTests.Email.EmailApiTests.EmailApiEndpoints_ShouldRequireAuthentication [FAIL]
[xUnit.net 00:00:35.50]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:00:35.51]       Stack Trace:
[xUnit.net 00:00:35.51]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:00:35.51]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:00:35.51]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:00:35.51]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:00:35.51]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:00:35.51]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:00:35.51]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 19:58:31.645 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:58:31.758 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:58:31.758 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:58:31.758 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:58:31.758 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:58:31.758 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:58:31.758 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:58:31.758 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 19:58:31.782 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:58:31.785 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:58:32.403 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:00:36.32]     LankaConnect.IntegrationTests.Email.MailHogIntegrationTests.SendHtmlEmail_ShouldPreserveBothTextAndHtmlContent [FAIL]
[xUnit.net 00:00:36.32]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:00:36.32]       Stack Trace:
[xUnit.net 00:00:36.32]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:00:36.32]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:00:36.32]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:00:36.32]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:00:36.32]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:00:36.32]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:00:36.32]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 19:58:32.413 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:58:32.481 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:58:32.481 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:58:32.481 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:58:32.481 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:58:32.481 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:58:32.481 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:58:32.481 -05:00 [INF]  Program: Applying database migrations...
  Failed LankaConnect.IntegrationTests.Email.EmailApiTests.EmailApiEndpoints_ShouldRequireAuthentication [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
  Failed LankaConnect.IntegrationTests.Email.MailHogIntegrationTests.SendHtmlEmail_ShouldPreserveBothTextAndHtmlContent [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
[xUnit.net 00:00:39.20]     LankaConnect.IntegrationTests.Controllers.ExternalProviderManagementTests.UnlinkExternalProvider_WhenUserHasOtherProviders_ShouldUnlinkSuccessfully [FAIL]
[xUnit.net 00:00:39.20]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:00:39.21]       Stack Trace:
[xUnit.net 00:00:39.21]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:00:39.21]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:00:39.21]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:00:39.21]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:00:39.21]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:00:39.21]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:00:39.21]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
  Failed LankaConnect.IntegrationTests.Controllers.ExternalProviderManagementTests.UnlinkExternalProvider_WhenUserHasOtherProviders_ShouldUnlinkSuccessfully [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
2026-01-18 19:58:35.312 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:58:35.413 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:58:35.413 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:58:35.413 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:58:35.413 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:58:35.413 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:58:35.414 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:58:35.414 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 19:58:35.454 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:00:39.72]     LankaConnect.IntegrationTests.Repositories.ServiceRepositoryTests.GetActiveServiceCountByBusinessIdAsync_Should_Return_Active_Count_Only [FAIL]
[xUnit.net 00:00:39.72]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:00:39.72]       Stack Trace:
[xUnit.net 00:00:39.72]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:00:39.72]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:00:39.72]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:00:39.72]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:00:39.72]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:00:39.72]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:00:39.72]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 19:58:35.815 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:58:35.824 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:58:35.827 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:00:40.32]     LankaConnect.IntegrationTests.Email.EmailIntegrationTests.ConcurrentEmailProcessing_ShouldHandleMultipleRequests [FAIL]
[xUnit.net 00:00:40.32]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:00:40.32]       Stack Trace:
[xUnit.net 00:00:40.32]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:00:40.32]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:00:40.32]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:00:40.32]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:00:40.32]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:00:40.32]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:00:40.32]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 19:58:36.414 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:58:36.485 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:58:36.485 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:58:36.485 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:58:36.485 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:58:36.485 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:58:36.485 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:58:36.485 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 19:58:36.557 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:58:36.562 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
  Failed LankaConnect.IntegrationTests.Repositories.ServiceRepositoryTests.GetActiveServiceCountByBusinessIdAsync_Should_Return_Active_Count_Only [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
  Failed LankaConnect.IntegrationTests.Email.EmailIntegrationTests.ConcurrentEmailProcessing_ShouldHandleMultipleRequests [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
2026-01-18 19:58:39.457 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:00:43.38]     LankaConnect.IntegrationTests.Controllers.ExternalProviderManagementTests.GetLinkedProviders_WithNoProviders_ShouldReturn200AndEmptyList [FAIL]
[xUnit.net 00:00:43.38]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:00:43.38]       Stack Trace:
[xUnit.net 00:00:43.38]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:00:43.38]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:00:43.38]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:00:43.38]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:00:43.38]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:00:43.38]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:00:43.38]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
  Failed LankaConnect.IntegrationTests.Controllers.ExternalProviderManagementTests.GetLinkedProviders_WithNoProviders_ShouldReturn200AndEmptyList [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
[xUnit.net 00:00:43.39]     LankaConnect.IntegrationTests.Controllers.AuthControllerTests.Register_WithDifferentRoles_ShouldCreateUserWithCorrectRole(role: EventOrganizer) [FAIL]
[xUnit.net 00:00:43.39]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:00:43.39]       Stack Trace:
[xUnit.net 00:00:43.39]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:00:43.39]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:00:43.39]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:00:43.39]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:00:43.39]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:00:43.39]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:00:43.39]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 19:58:39.523 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:58:39.534 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:58:39.634 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:58:39.635 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:58:39.635 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:58:39.635 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:58:39.635 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:58:39.635 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:58:39.635 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 19:58:39.637 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:58:39.637 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:58:39.637 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:58:39.637 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:58:39.637 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:58:39.638 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:58:39.638 -05:00 [INF]  Program: Applying database migrations...
[xUnit.net 00:00:43.72]     LankaConnect.IntegrationTests.Controllers.EntraAuthControllerTests.LoginWithEntra_WithValidToken_NewUser_ShouldReturn200AndAutoProvisionUser [FAIL]
[xUnit.net 00:00:43.72]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:00:43.72]       Stack Trace:
[xUnit.net 00:00:43.72]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:00:43.72]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:00:43.72]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:00:43.72]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:00:43.72]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:00:43.72]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:00:43.72]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 19:58:39.830 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:58:39.943 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:58:40.573 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:00:44.49]     LankaConnect.IntegrationTests.Email.EmailIntegrationTests.SendTemplatedEmailAsync_WithValidTemplate_ShouldRenderAndSend [FAIL]
[xUnit.net 00:00:44.49]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:00:44.49]       Stack Trace:
[xUnit.net 00:00:44.49]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:00:44.49]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:00:44.49]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:00:44.49]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:00:44.49]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:00:44.49]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:00:44.49]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 19:58:40.593 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:58:40.676 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:58:40.676 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:58:40.676 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:58:40.676 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:58:40.676 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:58:40.676 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:58:40.676 -05:00 [INF]  Program: Applying database migrations...
  Failed LankaConnect.IntegrationTests.Controllers.AuthControllerTests.Register_WithDifferentRoles_ShouldCreateUserWithCorrectRole(role: EventOrganizer) [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
  Failed LankaConnect.IntegrationTests.Controllers.EntraAuthControllerTests.LoginWithEntra_WithValidToken_NewUser_ShouldReturn200AndAutoProvisionUser [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
  Failed LankaConnect.IntegrationTests.Email.EmailIntegrationTests.SendTemplatedEmailAsync_WithValidTemplate_ShouldRenderAndSend [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
[xUnit.net 00:00:47.39]     LankaConnect.IntegrationTests.Controllers.BusinessImagesControllerTests.UploadBusinessImage_WithInvalidFileType_ShouldReturnBadRequest [FAIL]
[xUnit.net 00:00:47.39]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:00:47.39]       Stack Trace:
[xUnit.net 00:00:47.39]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:00:47.39]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:00:47.39]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:00:47.39]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:00:47.39]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:00:47.39]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:00:47.39]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
  Failed LankaConnect.IntegrationTests.Controllers.BusinessImagesControllerTests.UploadBusinessImage_WithInvalidFileType_ShouldReturnBadRequest [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
2026-01-18 19:58:43.513 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:58:43.649 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:58:43.650 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:58:43.650 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:58:43.650 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:58:43.650 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:58:43.651 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:58:43.651 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 19:58:43.719 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:58:43.720 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:58:43.727 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:58:43.731 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:00:47.65]     LankaConnect.IntegrationTests.Controllers.AuthControllerTests.Register_WithDifferentRoles_ShouldCreateUserWithCorrectRole(role: Admin) [FAIL]
[xUnit.net 00:00:47.65]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:00:47.65]       Stack Trace:
[xUnit.net 00:00:47.65]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:00:47.65]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:00:47.65]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:00:47.65]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:00:47.65]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:00:47.65]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:00:47.65]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 19:58:43.751 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:58:43.846 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:58:43.846 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:58:43.846 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:58:43.846 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:58:43.846 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:58:43.846 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:58:43.847 -05:00 [INF]  Program: Applying database migrations...
[xUnit.net 00:00:47.94]     LankaConnect.IntegrationTests.Email.EmailApiTests.SendPasswordResetEmail_WithValidEmail_ShouldReturnSuccess [FAIL]
[xUnit.net 00:00:47.94]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:00:47.94]       Stack Trace:
[xUnit.net 00:00:47.94]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:00:47.94]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:00:47.94]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:00:47.94]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:00:47.94]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:00:47.94]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:00:47.94]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 19:58:44.041 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:58:44.095 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:00:48.45]     LankaConnect.IntegrationTests.Email.MailHogIntegrationTests.MailHog_ShouldBeRunningAndAccessible [FAIL]
[xUnit.net 00:00:48.45]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:00:48.45]       Stack Trace:
[xUnit.net 00:00:48.45]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:00:48.45]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:00:48.45]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:00:48.45]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:00:48.45]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:00:48.45]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:00:48.45]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 19:58:44.547 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:58:44.607 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:58:44.608 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:58:44.608 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:58:44.608 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:58:44.608 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:58:44.608 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:58:44.608 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 19:58:44.735 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:58:44.741 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
  Failed LankaConnect.IntegrationTests.Controllers.AuthControllerTests.Register_WithDifferentRoles_ShouldCreateUserWithCorrectRole(role: Admin) [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
  Failed LankaConnect.IntegrationTests.Email.EmailApiTests.SendPasswordResetEmail_WithValidEmail_ShouldReturnSuccess [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
  Failed LankaConnect.IntegrationTests.Email.MailHogIntegrationTests.MailHog_ShouldBeRunningAndAccessible [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
2026-01-18 19:58:47.734 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:00:51.66]     LankaConnect.IntegrationTests.Controllers.BusinessImagesControllerTests.DeleteBusinessImage_WithExistingImage_ShouldReturnNoContent [FAIL]
[xUnit.net 00:00:51.66]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:00:51.67]       Stack Trace:
[xUnit.net 00:00:51.67]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:00:51.67]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:00:51.67]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:00:51.67]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:00:51.67]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:00:51.67]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:00:51.67]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
  Failed LankaConnect.IntegrationTests.Controllers.BusinessImagesControllerTests.DeleteBusinessImage_WithExistingImage_ShouldReturnNoContent [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
2026-01-18 19:58:47.765 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:58:47.850 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:58:47.850 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:58:47.850 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:58:47.850 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:58:47.850 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:58:47.851 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:58:47.851 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 19:58:47.916 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:58:47.925 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:00:51.89]     LankaConnect.IntegrationTests.Repositories.ServiceRepositoryTests.SearchByNameAsync_Should_Return_Services_Matching_Name [FAIL]
[xUnit.net 00:00:51.89]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:00:51.89]       Stack Trace:
[xUnit.net 00:00:51.89]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:00:51.89]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:00:51.89]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:00:51.89]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:00:51.89]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:00:51.89]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:00:51.89]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 19:58:47.993 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:58:48.089 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:58:48.089 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:58:48.089 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:58:48.089 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:58:48.089 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:58:48.090 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:58:48.090 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 19:58:48.156 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:58:48.669 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:00:52.59]     LankaConnect.IntegrationTests.Email.MailHogIntegrationTests.SendEmail_ShouldAppearInMailHog [FAIL]
[xUnit.net 00:00:52.59]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:00:52.59]       Stack Trace:
[xUnit.net 00:00:52.59]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:00:52.59]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:00:52.59]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:00:52.59]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:00:52.59]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:00:52.59]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:00:52.59]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 19:58:48.687 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:58:48.768 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:58:48.769 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:58:48.769 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:58:48.769 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:58:48.769 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:58:48.769 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:58:48.769 -05:00 [INF]  Program: Applying database migrations...
  Failed LankaConnect.IntegrationTests.Repositories.ServiceRepositoryTests.SearchByNameAsync_Should_Return_Services_Matching_Name [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
  Failed LankaConnect.IntegrationTests.Email.MailHogIntegrationTests.SendEmail_ShouldAppearInMailHog [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
[xUnit.net 00:00:55.66]     LankaConnect.IntegrationTests.Controllers.ExternalProviderManagementTests.GetLinkedProviders_WhenUserNotFound_ShouldReturn404 [FAIL]
[xUnit.net 00:00:55.66]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:00:55.66]       Stack Trace:
[xUnit.net 00:00:55.66]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:00:55.66]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:00:55.66]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:00:55.66]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:00:55.66]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:00:55.66]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:00:55.66]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
  Failed LankaConnect.IntegrationTests.Controllers.ExternalProviderManagementTests.GetLinkedProviders_WhenUserNotFound_ShouldReturn404 [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
2026-01-18 19:58:51.777 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:58:51.850 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:58:51.850 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:58:51.850 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:58:51.850 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:58:51.850 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:58:51.850 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:58:51.851 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 19:58:51.919 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:58:51.922 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:58:52.142 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:00:56.06]     LankaConnect.IntegrationTests.Repositories.ServiceRepositoryTests.GetServiceCountByBusinessIdAsync_Should_Return_Total_Count [FAIL]
[xUnit.net 00:00:56.06]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:00:56.06]       Stack Trace:
[xUnit.net 00:00:56.06]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:00:56.06]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:00:56.06]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:00:56.06]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:00:56.06]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:00:56.06]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:00:56.06]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 19:58:52.154 -05:00 [INF]  : Starting LankaConnect API
[xUnit.net 00:00:56.08]     LankaConnect.IntegrationTests.Controllers.EntraAuthControllerTests.LoginWithEntra_WithExpiredToken_ShouldReturn401Unauthorized [FAIL]
[xUnit.net 00:00:56.08]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:00:56.08]       Stack Trace:
[xUnit.net 00:00:56.08]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:00:56.08]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:00:56.08]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:00:56.08]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:00:56.08]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:00:56.08]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:00:56.08]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 19:58:52.191 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:58:52.269 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:58:52.269 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:58:52.270 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:58:52.270 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:58:52.270 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:58:52.270 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:58:52.270 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 19:58:52.341 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:58:52.341 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:58:52.342 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:58:52.342 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:58:52.342 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:58:52.342 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:58:52.342 -05:00 [INF]  Program: Applying database migrations...
[xUnit.net 00:00:56.61]     LankaConnect.IntegrationTests.Email.EmailIntegrationTests.EmailRetry_WithFailedEmails_ShouldRetryThem [FAIL]
[xUnit.net 00:00:56.61]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:00:56.61]       Stack Trace:
[xUnit.net 00:00:56.61]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:00:56.61]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:00:56.61]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:00:56.61]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:00:56.61]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:00:56.61]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:00:56.61]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 19:58:52.716 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:58:52.773 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:58:52.774 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:58:52.774 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:58:52.774 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:58:52.774 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:58:52.774 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:58:52.774 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 19:58:52.835 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:58:52.843 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
  Failed LankaConnect.IntegrationTests.Repositories.ServiceRepositoryTests.GetServiceCountByBusinessIdAsync_Should_Return_Total_Count [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
  Failed LankaConnect.IntegrationTests.Controllers.EntraAuthControllerTests.LoginWithEntra_WithExpiredToken_ShouldReturn401Unauthorized [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
  Failed LankaConnect.IntegrationTests.Email.EmailIntegrationTests.EmailRetry_WithFailedEmails_ShouldRetryThem [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
2026-01-18 19:58:55.919 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:00:59.83]     LankaConnect.IntegrationTests.Controllers.ExternalProviderManagementTests.UnlinkExternalProvider_WithValidData_ShouldReturn200AndUnlinkProvider [FAIL]
[xUnit.net 00:00:59.83]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:00:59.84]       Stack Trace:
[xUnit.net 00:00:59.84]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:00:59.84]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:00:59.84]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:00:59.84]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:00:59.84]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:00:59.84]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:00:59.84]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
  Failed LankaConnect.IntegrationTests.Controllers.ExternalProviderManagementTests.UnlinkExternalProvider_WithValidData_ShouldReturn200AndUnlinkProvider [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
2026-01-18 19:58:55.933 -05:00 [INF]  : Starting LankaConnect API
[xUnit.net 00:00:59.85]     LankaConnect.IntegrationTests.Controllers.AuthControllerTests.Register_WithDifferentRoles_ShouldCreateUserWithCorrectRole(role: AdminManager) [FAIL]
[xUnit.net 00:00:59.85]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:00:59.85]       Stack Trace:
[xUnit.net 00:00:59.85]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:00:59.85]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:00:59.85]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:00:59.85]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:00:59.85]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:00:59.85]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:00:59.85]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 19:58:55.954 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:58:56.033 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:58:56.033 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:58:56.033 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:58:56.034 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:58:56.034 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:58:56.034 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:58:56.034 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 19:58:56.050 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:58:56.050 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:58:56.050 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:58:56.050 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:58:56.050 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:58:56.051 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:58:56.051 -05:00 [INF]  Program: Applying database migrations...
[xUnit.net 00:01:00.05]     LankaConnect.IntegrationTests.Email.EmailApiTests.GetEmailStatus_WithInvalidId_ShouldReturnBadRequest [FAIL]
[xUnit.net 00:01:00.05]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:01:00.05]       Stack Trace:
[xUnit.net 00:01:00.05]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:01:00.05]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:01:00.05]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:01:00.05]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:01:00.05]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:01:00.05]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:01:00.05]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 19:58:56.154 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:58:56.212 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:58:56.212 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:58:56.212 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:58:56.212 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:58:56.212 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:58:56.212 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:58:56.212 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 19:58:56.357 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:58:56.370 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:58:56.375 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:01:00.33]     LankaConnect.IntegrationTests.Controllers.EntraAuthControllerTests.LoginWithEntra_WithMissingAccessToken_ShouldReturn400BadRequest [FAIL]
[xUnit.net 00:01:00.33]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:01:00.33]       Stack Trace:
[xUnit.net 00:01:00.33]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:01:00.33]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:01:00.33]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:01:00.33]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:01:00.33]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:01:00.33]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:01:00.33]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 19:58:56.437 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:58:56.499 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:58:56.499 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:58:56.499 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:58:56.499 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:58:56.499 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:58:56.499 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:58:56.499 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 19:58:56.856 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:58:56.863 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
  Failed LankaConnect.IntegrationTests.Controllers.AuthControllerTests.Register_WithDifferentRoles_ShouldCreateUserWithCorrectRole(role: AdminManager) [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
  Failed LankaConnect.IntegrationTests.Email.EmailApiTests.GetEmailStatus_WithInvalidId_ShouldReturnBadRequest [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
  Failed LankaConnect.IntegrationTests.Controllers.EntraAuthControllerTests.LoginWithEntra_WithMissingAccessToken_ShouldReturn400BadRequest [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
[xUnit.net 00:01:03.84]     LankaConnect.IntegrationTests.Controllers.BusinessImagesControllerTests.UploadBusinessImage_WithValidImage_ShouldReturnCreated [FAIL]
[xUnit.net 00:01:03.84]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:01:03.84]       Stack Trace:
[xUnit.net 00:01:03.84]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:01:03.84]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:01:03.84]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:01:03.84]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:01:03.85]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:01:03.85]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:01:03.85]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
  Failed LankaConnect.IntegrationTests.Controllers.BusinessImagesControllerTests.UploadBusinessImage_WithValidImage_ShouldReturnCreated [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
2026-01-18 19:58:59.940 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:58:59.993 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:58:59.993 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:58:59.993 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:58:59.994 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:58:59.994 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:58:59.994 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:58:59.994 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 19:59:00.124 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:59:00.124 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:59:00.130 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:59:00.132 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:01:04.05]     LankaConnect.IntegrationTests.Controllers.AuthControllerTests.Logout_WithoutAuthentication_ShouldReturn401Unauthorized [FAIL]
[xUnit.net 00:01:04.05]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:01:04.05]       Stack Trace:
[xUnit.net 00:01:04.05]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:01:04.05]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:01:04.05]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:01:04.05]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:01:04.05]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:01:04.05]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:01:04.05]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 19:59:00.153 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:59:00.206 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:59:00.206 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:59:00.206 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:59:00.206 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:59:00.206 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:59:00.206 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:59:00.207 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 19:59:00.299 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:59:00.302 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:59:00.559 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:01:04.51]     LankaConnect.IntegrationTests.Controllers.EntraAuthControllerTests.LoginWithEntra_WithEmailAlreadyRegisteredLocally_ShouldReturn400BadRequest [FAIL]
[xUnit.net 00:01:04.51]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:01:04.52]       Stack Trace:
[xUnit.net 00:01:04.52]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:01:04.52]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:01:04.52]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:01:04.52]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:01:04.52]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:01:04.52]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:01:04.52]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 19:59:00.638 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:59:00.743 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:59:00.743 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:59:00.744 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:59:00.744 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:59:00.744 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:59:00.744 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:59:00.744 -05:00 [INF]  Program: Applying database migrations...
[xUnit.net 00:01:04.77]     LankaConnect.IntegrationTests.Email.MailHogIntegrationTests.SendEmailWithAttachment_ShouldIncludeAttachment [FAIL]
[xUnit.net 00:01:04.77]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:01:04.77]       Stack Trace:
[xUnit.net 00:01:04.77]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:01:04.77]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:01:04.77]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:01:04.77]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:01:04.77]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:01:04.77]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:01:04.77]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 19:59:00.892 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:59:00.953 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:59:00.953 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:59:00.954 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:59:00.954 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:59:00.954 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:59:00.954 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:59:00.954 -05:00 [INF]  Program: Applying database migrations...
  Failed LankaConnect.IntegrationTests.Controllers.AuthControllerTests.Logout_WithoutAuthentication_ShouldReturn401Unauthorized [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
  Failed LankaConnect.IntegrationTests.Controllers.EntraAuthControllerTests.LoginWithEntra_WithEmailAlreadyRegisteredLocally_ShouldReturn400BadRequest [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
  Failed LankaConnect.IntegrationTests.Email.MailHogIntegrationTests.SendEmailWithAttachment_ShouldIncludeAttachment [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
2026-01-18 19:59:04.055 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:59:04.067 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:59:04.288 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:01:08.21]     LankaConnect.IntegrationTests.Controllers.AuthControllerTests.Register_WithValidData_ShouldReturn201Created [FAIL]
[xUnit.net 00:01:08.21]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:01:08.21]       Stack Trace:
[xUnit.net 00:01:08.21]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:01:08.21]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:01:08.21]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:01:08.21]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:01:08.21]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:01:08.21]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:01:08.21]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
  Failed LankaConnect.IntegrationTests.Controllers.AuthControllerTests.Register_WithValidData_ShouldReturn201Created [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
[xUnit.net 00:01:08.22]     LankaConnect.IntegrationTests.Repositories.ServiceRepositoryTests.GetByBusinessIdAsync_Should_Return_All_Services_For_Business [FAIL]
[xUnit.net 00:01:08.22]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:01:08.22]       Stack Trace:
[xUnit.net 00:01:08.22]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:01:08.22]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:01:08.22]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:01:08.22]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:01:08.22]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:01:08.22]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:01:08.22]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 19:59:04.328 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:59:04.337 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:59:04.422 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:59:04.422 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:59:04.422 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:59:04.422 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:59:04.422 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:59:04.423 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:59:04.423 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 19:59:04.423 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:59:04.423 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:59:04.423 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:59:04.423 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:59:04.423 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:59:04.424 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:59:04.424 -05:00 [INF]  Program: Applying database migrations...
[xUnit.net 00:01:08.50]     LankaConnect.IntegrationTests.Email.EmailIntegrationTests.QueueEmailAsync_ShouldPersistToDatabase [FAIL]
[xUnit.net 00:01:08.50]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:01:08.50]       Stack Trace:
[xUnit.net 00:01:08.50]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:01:08.50]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:01:08.50]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:01:08.50]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:01:08.50]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:01:08.50]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:01:08.50]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 19:59:04.650 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:59:04.715 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:59:04.715 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:59:04.715 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:59:04.715 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:59:04.715 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:59:04.716 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:59:04.716 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 19:59:04.822 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:59:04.826 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:59:05.057 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:01:08.97]     LankaConnect.IntegrationTests.Email.EmailPerformanceTests.SingleEmailSend_ShouldCompleteWithinTimeLimit [FAIL]
[xUnit.net 00:01:08.98]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:01:08.98]       Stack Trace:
[xUnit.net 00:01:08.98]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:01:08.98]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:01:08.98]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:01:08.98]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:01:08.98]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:01:08.98]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:01:08.98]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 19:59:05.076 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:59:05.124 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:59:05.124 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:59:05.124 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:59:05.124 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:59:05.124 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:59:05.124 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:59:05.124 -05:00 [INF]  Program: Applying database migrations...
  Failed LankaConnect.IntegrationTests.Repositories.ServiceRepositoryTests.GetByBusinessIdAsync_Should_Return_All_Services_For_Business [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
  Failed LankaConnect.IntegrationTests.Email.EmailIntegrationTests.QueueEmailAsync_ShouldPersistToDatabase [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
  Failed LankaConnect.IntegrationTests.Email.EmailPerformanceTests.SingleEmailSend_ShouldCompleteWithinTimeLimit [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
[xUnit.net 00:01:12.01]     LankaConnect.IntegrationTests.Controllers.ExternalProviderManagementTests.LinkExternalProvider_WhenAlreadyLinked_ShouldReturn400 [FAIL]
[xUnit.net 00:01:12.01]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:01:12.02]       Stack Trace:
[xUnit.net 00:01:12.02]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:01:12.02]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:01:12.02]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:01:12.02]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:01:12.02]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:01:12.02]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:01:12.02]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
  Failed LankaConnect.IntegrationTests.Controllers.ExternalProviderManagementTests.LinkExternalProvider_WhenAlreadyLinked_ShouldReturn400 [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
2026-01-18 19:59:08.143 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:59:08.279 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:59:08.279 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:59:08.279 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:59:08.279 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:59:08.279 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:59:08.280 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:59:08.280 -05:00 [INF]  Program: Applying database migrations...
[xUnit.net 00:01:12.21]     LankaConnect.IntegrationTests.Email.EmailApiTests.VerifyEmail_WithEmptyToken_ShouldReturnBadRequest [FAIL]
[xUnit.net 00:01:12.21]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:01:12.21]       Stack Trace:
[xUnit.net 00:01:12.21]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:01:12.21]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:01:12.21]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:01:12.21]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:01:12.21]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:01:12.21]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:01:12.21]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 19:59:08.305 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:59:08.384 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:59:08.385 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:59:08.385 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:59:08.385 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:59:08.385 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:59:08.386 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:59:08.386 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 19:59:08.485 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:59:08.485 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:59:08.491 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:59:08.504 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:01:12.42]     LankaConnect.IntegrationTests.Repositories.ServiceRepositoryTests.GetByPriceRangeAsync_Should_Return_Services_In_Price_Range [FAIL]
[xUnit.net 00:01:12.42]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:01:12.42]       Stack Trace:
[xUnit.net 00:01:12.42]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:01:12.42]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:01:12.42]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:01:12.42]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:01:12.42]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:01:12.42]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:01:12.42]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 19:59:08.520 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:59:08.586 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:59:08.586 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:59:08.586 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:59:08.587 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:59:08.587 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:59:08.587 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:59:08.587 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 19:59:08.805 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:59:08.807 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:01:12.95]     LankaConnect.IntegrationTests.Controllers.BusinessImagesControllerTests.ReorderBusinessImages_WithValidOrder_ShouldReturnNoContent [FAIL]
[xUnit.net 00:01:12.95]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:01:12.95]       Stack Trace:
[xUnit.net 00:01:12.95]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:01:12.95]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:01:12.95]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:01:12.95]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:01:12.95]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:01:12.95]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:01:12.95]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 19:59:09.048 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:59:09.112 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:59:09.112 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:59:09.112 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:59:09.112 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:59:09.112 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:59:09.113 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:59:09.113 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 19:59:09.198 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:59:09.205 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
  Failed LankaConnect.IntegrationTests.Email.EmailApiTests.VerifyEmail_WithEmptyToken_ShouldReturnBadRequest [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
  Failed LankaConnect.IntegrationTests.Repositories.ServiceRepositoryTests.GetByPriceRangeAsync_Should_Return_Services_In_Price_Range [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
  Failed LankaConnect.IntegrationTests.Controllers.BusinessImagesControllerTests.ReorderBusinessImages_WithValidOrder_ShouldReturnNoContent [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
2026-01-18 19:59:12.366 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:01:16.28]     LankaConnect.IntegrationTests.Controllers.ExternalProviderManagementTests.LinkExternalProvider_WithValidData_ShouldReturn200AndLinkProvider [FAIL]
[xUnit.net 00:01:16.28]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:01:16.29]       Stack Trace:
[xUnit.net 00:01:16.29]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:01:16.29]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:01:16.29]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:01:16.29]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:01:16.29]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:01:16.29]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:01:16.29]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
  Failed LankaConnect.IntegrationTests.Controllers.ExternalProviderManagementTests.LinkExternalProvider_WithValidData_ShouldReturn200AndLinkProvider [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
2026-01-18 19:59:12.389 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:59:12.441 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:59:12.441 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:59:12.441 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:59:12.441 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:59:12.441 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:59:12.442 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:59:12.442 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 19:59:12.478 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:59:12.482 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:59:12.651 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:01:16.56]     LankaConnect.IntegrationTests.Repositories.ServiceRepositoryTests.DeactivateAllByBusinessIdAsync_Should_Deactivate_All_Services [FAIL]
[xUnit.net 00:01:16.56]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:01:16.57]       Stack Trace:
[xUnit.net 00:01:16.57]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:01:16.57]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:01:16.57]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:01:16.57]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:01:16.57]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:01:16.57]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:01:16.57]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
[xUnit.net 00:01:16.57]     LankaConnect.IntegrationTests.RepositoryDIValidationTest.EmailTemplateRepository_WithProperDISetup_ShouldCreateWithoutDIErrors [FAIL]
[xUnit.net 00:01:16.57]       System.InvalidOperationException : Unable to resolve service for type 'MediatR.IPublisher' while attempting to activate 'LankaConnect.Infrastructure.Data.AppDbContext'.
[xUnit.net 00:01:16.57]       Stack Trace:
[xUnit.net 00:01:16.57]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateConstructorCallSite(ResultCache lifetime, ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain)
[xUnit.net 00:01:16.57]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceDescriptor descriptor, ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain, Int32 slot)
[xUnit.net 00:01:16.57]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateCallSite(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
[xUnit.net 00:01:16.57]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateConstructorCallSite(ResultCache lifetime, ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain)
[xUnit.net 00:01:16.57]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceDescriptor descriptor, ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain, Int32 slot)
[xUnit.net 00:01:16.57]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateCallSite(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
[xUnit.net 00:01:16.57]            at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
[xUnit.net 00:01:16.57]            at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
[xUnit.net 00:01:16.57]            at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
[xUnit.net 00:01:16.57]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\RepositoryDIValidationTest.cs(106,0): at LankaConnect.IntegrationTests.RepositoryDIValidationTest.EmailTemplateRepository_WithProperDISetup_ShouldCreateWithoutDIErrors()
[xUnit.net 00:01:16.57]         --- End of stack trace from previous location ---
[xUnit.net 00:01:16.57]     LankaConnect.IntegrationTests.RepositoryDIValidationTest.ServiceCollection_WithProperEFCoreSetup_ShouldResolveRepositoriesWithoutDIErrors [FAIL]
[xUnit.net 00:01:16.57]       System.InvalidOperationException : Unable to resolve service for type 'MediatR.IPublisher' while attempting to activate 'LankaConnect.Infrastructure.Data.AppDbContext'.
[xUnit.net 00:01:16.57]       Stack Trace:
[xUnit.net 00:01:16.57]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateConstructorCallSite(ResultCache lifetime, ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain)
[xUnit.net 00:01:16.57]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceDescriptor descriptor, ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain, Int32 slot)
[xUnit.net 00:01:16.57]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateCallSite(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
[xUnit.net 00:01:16.57]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateConstructorCallSite(ResultCache lifetime, ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain)
[xUnit.net 00:01:16.57]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceDescriptor descriptor, ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain, Int32 slot)
[xUnit.net 00:01:16.57]            at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateCallSite(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
[xUnit.net 00:01:16.57]            at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
[xUnit.net 00:01:16.57]            at Microsoft.Extensions.DependencyInjection.ServiceProvider.GetService(ServiceIdentifier serviceIdentifier, ServiceProviderEngineScope serviceProviderEngineScope)
[xUnit.net 00:01:16.57]            at Microsoft.Extensions.DependencyInjection.ServiceProvider.GetService(Type serviceType)
[xUnit.net 00:01:16.57]            at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
[xUnit.net 00:01:16.57]            at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
[xUnit.net 00:01:16.57]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\RepositoryDIValidationTest.cs(62,0): at LankaConnect.IntegrationTests.RepositoryDIValidationTest.ServiceCollection_WithProperEFCoreSetup_ShouldResolveRepositoriesWithoutDIErrors()
[xUnit.net 00:01:16.57]            at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signature sig, Boolean isConstructor)
[xUnit.net 00:01:16.57]            at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)
2026-01-18 19:59:12.673 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:59:12.722 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:59:12.722 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:59:12.722 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:59:12.722 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:59:12.722 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:59:12.722 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:59:12.722 -05:00 [INF]  Program: Applying database migrations...
[xUnit.net 00:01:16.71]     LankaConnect.IntegrationTests.Controllers.EntraAuthControllerTests.LoginWithEntra_WithInvalidToken_ShouldReturn401Unauthorized [FAIL]
[xUnit.net 00:01:16.71]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:01:16.71]       Stack Trace:
[xUnit.net 00:01:16.71]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:01:16.71]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:01:16.71]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:01:16.71]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:01:16.71]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:01:16.71]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:01:16.71]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 19:59:12.812 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:59:12.925 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:59:12.925 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:59:12.926 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:59:12.926 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:59:12.926 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:59:12.926 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:59:12.926 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 19:59:13.181 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:59:13.186 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
  Failed LankaConnect.IntegrationTests.Repositories.ServiceRepositoryTests.DeactivateAllByBusinessIdAsync_Should_Deactivate_All_Services [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
  Failed LankaConnect.IntegrationTests.RepositoryDIValidationTest.EmailTemplateRepository_WithProperDISetup_ShouldCreateWithoutDIErrors [2 ms]
  Error Message:
   System.InvalidOperationException : Unable to resolve service for type 'MediatR.IPublisher' while attempting to activate 'LankaConnect.Infrastructure.Data.AppDbContext'.
  Stack Trace:
     at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateConstructorCallSite(ResultCache lifetime, ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceDescriptor descriptor, ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain, Int32 slot)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateCallSite(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateConstructorCallSite(ResultCache lifetime, ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceDescriptor descriptor, ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain, Int32 slot)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateCallSite(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at LankaConnect.IntegrationTests.RepositoryDIValidationTest.EmailTemplateRepository_WithProperDISetup_ShouldCreateWithoutDIErrors() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\RepositoryDIValidationTest.cs:line 106
--- End of stack trace from previous location ---
  Failed LankaConnect.IntegrationTests.RepositoryDIValidationTest.ServiceCollection_WithProperEFCoreSetup_ShouldResolveRepositoriesWithoutDIErrors [1 ms]
  Error Message:
   System.InvalidOperationException : Unable to resolve service for type 'MediatR.IPublisher' while attempting to activate 'LankaConnect.Infrastructure.Data.AppDbContext'.
  Stack Trace:
     at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateConstructorCallSite(ResultCache lifetime, ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceDescriptor descriptor, ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain, Int32 slot)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateCallSite(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateConstructorCallSite(ResultCache lifetime, ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceDescriptor descriptor, ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain, Int32 slot)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateCallSite(ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.GetService(ServiceIdentifier serviceIdentifier, ServiceProviderEngineScope serviceProviderEngineScope)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.GetService(Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at LankaConnect.IntegrationTests.RepositoryDIValidationTest.ServiceCollection_WithProperEFCoreSetup_ShouldResolveRepositoriesWithoutDIErrors() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\RepositoryDIValidationTest.cs:line 62
   at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signature sig, Boolean isConstructor)
   at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)
  Failed LankaConnect.IntegrationTests.Controllers.EntraAuthControllerTests.LoginWithEntra_WithInvalidToken_ShouldReturn401Unauthorized [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
[xUnit.net 00:01:20.38]     LankaConnect.IntegrationTests.Controllers.AuthControllerTests.ResetPassword_WithInvalidToken_ShouldReturn400BadRequest [FAIL]
[xUnit.net 00:01:20.38]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:01:20.38]       Stack Trace:
[xUnit.net 00:01:20.38]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:01:20.38]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:01:20.38]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:01:20.38]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:01:20.38]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:01:20.38]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:01:20.38]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
  Failed LankaConnect.IntegrationTests.Controllers.AuthControllerTests.ResetPassword_WithInvalidToken_ShouldReturn400BadRequest [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
2026-01-18 19:59:16.500 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:01:20.42]     LankaConnect.IntegrationTests.Controllers.ExternalProviderManagementTests.UnlinkExternalProvider_WhenUserNotFound_ShouldReturn404 [FAIL]
[xUnit.net 00:01:20.42]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:01:20.42]       Stack Trace:
[xUnit.net 00:01:20.42]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:01:20.42]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:01:20.42]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:01:20.42]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:01:20.42]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:01:20.42]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
2026-01-18 19:59:16.510 -05:00 [INF]  : Starting LankaConnect API
[xUnit.net 00:01:20.42]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 19:59:16.527 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:59:16.593 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:59:16.594 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:59:16.594 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:59:16.594 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:59:16.594 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:59:16.594 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:59:16.594 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 19:59:16.609 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:59:16.609 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:59:16.609 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:59:16.609 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:59:16.609 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:59:16.609 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:59:16.609 -05:00 [INF]  Program: Applying database migrations...
[xUnit.net 00:01:20.57]     LankaConnect.IntegrationTests.Email.EmailIntegrationTests.SendEmailAsync_WithValidData_ShouldSendEmail [FAIL]
[xUnit.net 00:01:20.57]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:01:20.57]       Stack Trace:
[xUnit.net 00:01:20.57]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:01:20.57]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:01:20.57]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:01:20.57]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:01:20.57]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:01:20.57]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:01:20.57]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 19:59:16.663 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:59:16.716 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:59:16.716 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:59:16.717 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:59:16.717 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:59:16.717 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:59:16.717 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:59:16.717 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 19:59:16.746 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:59:16.751 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:59:16.979 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:01:20.89]     LankaConnect.IntegrationTests.Repositories.EventRepositoryLocationTests.GetEventsByRadiusAsync_Should_Return_Events_Within_100_Miles [FAIL]
[xUnit.net 00:01:20.89]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:01:20.89]       Stack Trace:
[xUnit.net 00:01:20.89]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:01:20.89]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:01:20.89]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:01:20.89]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:01:20.89]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 19:59:17.003 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:59:17.069 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:59:17.069 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:59:17.069 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:59:17.069 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:59:17.069 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:59:17.077 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:59:17.077 -05:00 [INF]  Program: Applying database migrations...
[xUnit.net 00:01:21.11]     LankaConnect.IntegrationTests.Email.EmailPerformanceTests.LargeEmailContent_ShouldHandleEfficiently [FAIL]
[xUnit.net 00:01:21.11]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:01:21.11]       Stack Trace:
[xUnit.net 00:01:21.11]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:01:21.12]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:01:21.12]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:01:21.12]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:01:21.12]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:01:21.12]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:01:21.12]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 19:59:17.227 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:59:17.395 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:59:17.395 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:59:17.396 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:59:17.397 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:59:17.397 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:59:17.397 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:59:17.398 -05:00 [INF]  Program: Applying database migrations...
  Failed LankaConnect.IntegrationTests.Controllers.ExternalProviderManagementTests.UnlinkExternalProvider_WhenUserNotFound_ShouldReturn404 [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
  Failed LankaConnect.IntegrationTests.Email.EmailIntegrationTests.SendEmailAsync_WithValidData_ShouldSendEmail [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
  Failed LankaConnect.IntegrationTests.Repositories.EventRepositoryLocationTests.GetEventsByRadiusAsync_Should_Return_Events_Within_100_Miles [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
  Failed LankaConnect.IntegrationTests.Email.EmailPerformanceTests.LargeEmailContent_ShouldHandleEfficiently [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
[xUnit.net 00:01:24.49]     LankaConnect.IntegrationTests.Email.EmailApiTests.EmailApi_ShouldValidateRequestPayload [FAIL]
[xUnit.net 00:01:24.49]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:01:24.49]       Stack Trace:
[xUnit.net 00:01:24.49]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:01:24.49]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:01:24.49]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:01:24.49]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:01:24.49]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:01:24.49]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:01:24.49]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
  Failed LankaConnect.IntegrationTests.Email.EmailApiTests.EmailApi_ShouldValidateRequestPayload [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
2026-01-18 19:59:20.595 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:59:20.658 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:59:20.659 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:59:20.674 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:59:20.679 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:01:24.64]     LankaConnect.IntegrationTests.Controllers.ExternalProviderManagementTests.LinkExternalProvider_WithMultipleProviders_ShouldLinkAll [FAIL]
[xUnit.net 00:01:24.64]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:01:24.64]       Stack Trace:
[xUnit.net 00:01:24.64]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:01:24.64]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:01:24.64]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:01:24.64]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:01:24.64]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 19:59:20.751 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:59:20.774 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:59:20.774 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:59:20.775 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:59:20.775 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:59:20.775 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:59:20.775 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:59:20.775 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 19:59:20.777 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:59:20.780 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:01:24.89]     LankaConnect.IntegrationTests.Controllers.BusinessImagesControllerTests.UploadBusinessImage_WithNonExistentBusiness_ShouldReturnBadRequest [FAIL]
[xUnit.net 00:01:24.89]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:01:24.89]       Stack Trace:
[xUnit.net 00:01:24.89]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:01:24.89]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:01:24.89]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:01:24.89]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
[xUnit.net 00:01:24.89]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:01:24.89]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
[xUnit.net 00:01:24.89]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 19:59:20.991 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:59:21.059 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:59:21.059 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:59:21.059 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:59:21.059 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:59:21.059 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:59:21.059 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:59:21.059 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 19:59:21.142 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:59:21.148 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:59:21.486 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:01:25.41]     LankaConnect.IntegrationTests.Email.EmailPerformanceTests.BulkEmailQueue_ShouldHandleLargeVolume [FAIL]
[xUnit.net 00:01:25.41]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:01:25.41]       Stack Trace:
[xUnit.net 00:01:25.41]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:01:25.41]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:01:25.41]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:01:25.41]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:01:25.41]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 19:59:21.521 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:59:21.690 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:59:21.690 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:59:21.690 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:59:21.691 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:59:21.691 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:59:21.691 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:59:21.691 -05:00 [INF]  Program: Applying database migrations...
  Failed LankaConnect.IntegrationTests.Controllers.ExternalProviderManagementTests.LinkExternalProvider_WithMultipleProviders_ShouldLinkAll [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
  Failed LankaConnect.IntegrationTests.Controllers.BusinessImagesControllerTests.UploadBusinessImage_WithNonExistentBusiness_ShouldReturnBadRequest [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(Uri baseAddress, DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient()
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
  Failed LankaConnect.IntegrationTests.Email.EmailPerformanceTests.BulkEmailQueue_ShouldHandleLargeVolume [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
[xUnit.net 00:01:28.75]     LankaConnect.IntegrationTests.Repositories.BusinessRepositoryTests.SearchByNameAsync_Should_Return_Matching_Businesses [FAIL]
[xUnit.net 00:01:28.75]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:01:28.76]       Stack Trace:
[xUnit.net 00:01:28.76]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:01:28.76]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:01:28.76]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:01:28.76]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:01:28.76]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
  Failed LankaConnect.IntegrationTests.Repositories.BusinessRepositoryTests.SearchByNameAsync_Should_Return_Matching_Businesses [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
2026-01-18 19:59:24.842 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:59:24.853 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:59:24.887 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:59:24.888 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:59:25.105 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:01:29.02]     LankaConnect.IntegrationTests.Controllers.BusinessImagesControllerTests.UploadBusinessImage_WithLargeFile_ShouldReturnBadRequest [FAIL]
[xUnit.net 00:01:29.02]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:01:29.03]       Stack Trace:
[xUnit.net 00:01:29.03]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:01:29.03]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:01:29.03]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:01:29.03]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:01:29.03]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
[xUnit.net 00:01:29.39]     LankaConnect.IntegrationTests.Infrastructure.DockerConnectivityTests.PostgreSQL_Container_IsAccessible [FAIL]
[xUnit.net 00:01:29.39]       Npgsql.NpgsqlException : Failed to connect to 127.0.0.1:5432
[xUnit.net 00:01:29.39]       ---- System.Net.Sockets.SocketException : No connection could be made because the target machine actively refused it.
[xUnit.net 00:01:29.39]       Stack Trace:
[xUnit.net 00:01:29.39]            at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
[xUnit.net 00:01:29.39]            at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
[xUnit.net 00:01:29.39]            at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
[xUnit.net 00:01:29.39]            at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
[xUnit.net 00:01:29.39]            at Npgsql.PoolingDataSource.OpenNewConnector(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
[xUnit.net 00:01:29.39]            at Npgsql.PoolingDataSource.<Get>g__RentAsync|33_0(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
[xUnit.net 00:01:29.39]            at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
[xUnit.net 00:01:29.39]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Infrastructure\DockerConnectivityTests.cs(38,0): at LankaConnect.IntegrationTests.Infrastructure.DockerConnectivityTests.PostgreSQL_Container_IsAccessible()
[xUnit.net 00:01:29.39]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Infrastructure\DockerConnectivityTests.cs(46,0): at LankaConnect.IntegrationTests.Infrastructure.DockerConnectivityTests.PostgreSQL_Container_IsAccessible()
[xUnit.net 00:01:29.39]         --- End of stack trace from previous location ---
[xUnit.net 00:01:29.39]         ----- Inner Stack Trace -----
[xUnit.net 00:01:29.39]            at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
[xUnit.net 00:01:29.39]            at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
[xUnit.net 00:01:29.39]            at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
[xUnit.net 00:01:29.39]            at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
[xUnit.net 00:01:29.39]            at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
[xUnit.net 00:01:29.41]     LankaConnect.IntegrationTests.Infrastructure.LoggingConfigurationTests.RequestLogging_WorksInWebContext [FAIL]
[xUnit.net 00:01:29.41]       Expected logEvents {empty} to have an item matching e.MessageTemplate.Text.Contains("Test log message from endpoint").
[xUnit.net 00:01:29.41]       Stack Trace:
[xUnit.net 00:01:29.41]            at FluentAssertions.Execution.XUnit2TestFramework.Throw(String message)
[xUnit.net 00:01:29.41]            at FluentAssertions.Execution.TestFrameworkProvider.Throw(String message)
[xUnit.net 00:01:29.41]            at FluentAssertions.Execution.DefaultAssertionStrategy.HandleFailure(String message)
[xUnit.net 00:01:29.41]            at FluentAssertions.Execution.AssertionScope.FailWith(Func`1 failReasonFunc)
[xUnit.net 00:01:29.41]            at FluentAssertions.Execution.AssertionScope.FailWith(Func`1 failReasonFunc)
[xUnit.net 00:01:29.41]            at FluentAssertions.Execution.AssertionScope.FailWith(String message, Object[] args)
[xUnit.net 00:01:29.41]            at FluentAssertions.Collections.GenericCollectionAssertions`3.Contain(Expression`1 predicate, String because, Object[] becauseArgs)
[xUnit.net 00:01:29.41]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Infrastructure\LoggingConfigurationTests.cs(201,0): at LankaConnect.IntegrationTests.Infrastructure.LoggingConfigurationTests.RequestLogging_WorksInWebContext()
[xUnit.net 00:01:29.41]         --- End of stack trace from previous location ---
[xUnit.net 00:01:29.51]     LankaConnect.IntegrationTests.Infrastructure.LoggingConfigurationTests.LogEnrichment_AddsExpectedProperties [FAIL]
[xUnit.net 00:01:29.51]       Expected enrichedEvent.Properties["Application"].ToString() ""LankaConnect.API"" to contain "LankaConnect.Tests".
[xUnit.net 00:01:29.51]       Stack Trace:
[xUnit.net 00:01:29.51]            at FluentAssertions.Execution.XUnit2TestFramework.Throw(String message)
[xUnit.net 00:01:29.51]            at FluentAssertions.Execution.TestFrameworkProvider.Throw(String message)
[xUnit.net 00:01:29.51]            at FluentAssertions.Execution.DefaultAssertionStrategy.HandleFailure(String message)
[xUnit.net 00:01:29.51]            at FluentAssertions.Execution.AssertionScope.FailWith(Func`1 failReasonFunc)
[xUnit.net 00:01:29.51]            at FluentAssertions.Execution.AssertionScope.FailWith(Func`1 failReasonFunc)
[xUnit.net 00:01:29.51]            at FluentAssertions.Execution.AssertionScope.FailWith(String message, Object[] args)
[xUnit.net 00:01:29.51]            at FluentAssertions.Primitives.StringAssertions`1.Contain(String expected, String because, Object[] becauseArgs)
[xUnit.net 00:01:29.51]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Infrastructure\LoggingConfigurationTests.cs(169,0): at LankaConnect.IntegrationTests.Infrastructure.LoggingConfigurationTests.LogEnrichment_AddsExpectedProperties()
[xUnit.net 00:01:29.51]            at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signature sig, Boolean isConstructor)
[xUnit.net 00:01:29.51]            at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)
[xUnit.net 00:01:29.57]     LankaConnect.IntegrationTests.Phase6A53VerificationTests.VerifyEmailTemplateMigrationApplied [FAIL]
[xUnit.net 00:01:29.57]       Npgsql.PostgresException : 42703: column "id" does not exist
[xUnit.net 00:01:29.57]       
[xUnit.net 00:01:29.57]       POSITION: 8
[xUnit.net 00:01:29.57]       Stack Trace:
[xUnit.net 00:01:29.57]            at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
[xUnit.net 00:01:29.57]            at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
[xUnit.net 00:01:29.57]            at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
[xUnit.net 00:01:29.57]            at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
[xUnit.net 00:01:29.57]            at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
[xUnit.net 00:01:29.57]            at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
[xUnit.net 00:01:29.57]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Phase6A53VerificationTests.cs(59,0): at LankaConnect.IntegrationTests.Phase6A53VerificationTests.VerifyEmailTemplateMigrationApplied()
[xUnit.net 00:01:29.57]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Phase6A53VerificationTests.cs(93,0): at LankaConnect.IntegrationTests.Phase6A53VerificationTests.VerifyEmailTemplateMigrationApplied()
[xUnit.net 00:01:29.57]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Phase6A53VerificationTests.cs(140,0): at LankaConnect.IntegrationTests.Phase6A53VerificationTests.VerifyEmailTemplateMigrationApplied()
[xUnit.net 00:01:29.57]         --- End of stack trace from previous location ---
[xUnit.net 00:01:29.57]       Output:
[xUnit.net 00:01:29.57]          Database connected successfully!
[xUnit.net 00:01:29.57]         
[xUnit.net 00:01:29.57]         === CHECK 1: Email Template Migration Status ===
[xUnit.net 00:01:29.57]          Migration Applied: 20251229231742_Phase6A53Fix3_RevertToCorrectTemplateNoLogo
[xUnit.net 00:01:29.57]            Product Version: 8.0.19
[xUnit.net 00:01:29.57]         
[xUnit.net 00:01:29.57]         === CHECK 2: Email Template Content ===
2026-01-18 19:59:25.749 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
  Failed LankaConnect.IntegrationTests.Controllers.BusinessImagesControllerTests.UploadBusinessImage_WithLargeFile_ShouldReturnBadRequest [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
  Failed LankaConnect.IntegrationTests.Infrastructure.DockerConnectivityTests.PostgreSQL_Container_IsAccessible [1 m 18 s]
  Error Message:
   Npgsql.NpgsqlException : Failed to connect to 127.0.0.1:5432
---- System.Net.Sockets.SocketException : No connection could be made because the target machine actively refused it.
  Stack Trace:
     at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.PoolingDataSource.OpenNewConnector(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.PoolingDataSource.<Get>g__RentAsync|33_0(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at LankaConnect.IntegrationTests.Infrastructure.DockerConnectivityTests.PostgreSQL_Container_IsAccessible() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Infrastructure\DockerConnectivityTests.cs:line 38
   at LankaConnect.IntegrationTests.Infrastructure.DockerConnectivityTests.PostgreSQL_Container_IsAccessible() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Infrastructure\DockerConnectivityTests.cs:line 46
--- End of stack trace from previous location ---
----- Inner Stack Trace -----
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
  Failed LankaConnect.IntegrationTests.Infrastructure.LoggingConfigurationTests.RequestLogging_WorksInWebContext [1 m]
  Error Message:
   Expected logEvents {empty} to have an item matching e.MessageTemplate.Text.Contains("Test log message from endpoint").
  Stack Trace:
     at FluentAssertions.Execution.XUnit2TestFramework.Throw(String message)
   at FluentAssertions.Execution.TestFrameworkProvider.Throw(String message)
   at FluentAssertions.Execution.DefaultAssertionStrategy.HandleFailure(String message)
   at FluentAssertions.Execution.AssertionScope.FailWith(Func`1 failReasonFunc)
   at FluentAssertions.Execution.AssertionScope.FailWith(Func`1 failReasonFunc)
   at FluentAssertions.Execution.AssertionScope.FailWith(String message, Object[] args)
   at FluentAssertions.Collections.GenericCollectionAssertions`3.Contain(Expression`1 predicate, String because, Object[] becauseArgs)
   at LankaConnect.IntegrationTests.Infrastructure.LoggingConfigurationTests.RequestLogging_WorksInWebContext() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Infrastructure\LoggingConfigurationTests.cs:line 201
--- End of stack trace from previous location ---
  Passed LankaConnect.IntegrationTests.Infrastructure.LoggingConfigurationTests.ExceptionLogging_CapturesFullDetails [65 ms]
  Failed LankaConnect.IntegrationTests.Infrastructure.LoggingConfigurationTests.LogEnrichment_AddsExpectedProperties [36 ms]
  Error Message:
   Expected enrichedEvent.Properties["Application"].ToString() ""LankaConnect.API"" to contain "LankaConnect.Tests".
  Stack Trace:
     at FluentAssertions.Execution.XUnit2TestFramework.Throw(String message)
   at FluentAssertions.Execution.TestFrameworkProvider.Throw(String message)
   at FluentAssertions.Execution.DefaultAssertionStrategy.HandleFailure(String message)
   at FluentAssertions.Execution.AssertionScope.FailWith(Func`1 failReasonFunc)
   at FluentAssertions.Execution.AssertionScope.FailWith(Func`1 failReasonFunc)
   at FluentAssertions.Execution.AssertionScope.FailWith(String message, Object[] args)
   at FluentAssertions.Primitives.StringAssertions`1.Contain(String expected, String because, Object[] becauseArgs)
   at LankaConnect.IntegrationTests.Infrastructure.LoggingConfigurationTests.LogEnrichment_AddsExpectedProperties() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Infrastructure\LoggingConfigurationTests.cs:line 169
   at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signature sig, Boolean isConstructor)
   at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)
  Passed LankaConnect.IntegrationTests.Infrastructure.LoggingConfigurationTests.SerilogConfiguration_IsSetupCorrectly [39 ms]
  Failed LankaConnect.IntegrationTests.Phase6A53VerificationTests.VerifyEmailTemplateMigrationApplied [24 s]
  Error Message:
   Npgsql.PostgresException : 42703: column "id" does not exist

POSITION: 8
  Stack Trace:
     at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at LankaConnect.IntegrationTests.Phase6A53VerificationTests.VerifyEmailTemplateMigrationApplied() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Phase6A53VerificationTests.cs:line 59
   at LankaConnect.IntegrationTests.Phase6A53VerificationTests.VerifyEmailTemplateMigrationApplied() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Phase6A53VerificationTests.cs:line 93
   at LankaConnect.IntegrationTests.Phase6A53VerificationTests.VerifyEmailTemplateMigrationApplied() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Phase6A53VerificationTests.cs:line 140
--- End of stack trace from previous location ---
  Standard Output Messages:
  Database connected successfully!
 
 === CHECK 1: Email Template Migration Status ===
  Migration Applied: 20251229231742_Phase6A53Fix3_RevertToCorrectTemplateNoLogo
    Product Version: 8.0.19
 
 === CHECK 2: Email Template Content ===


[xUnit.net 00:01:32.72]     LankaConnect.IntegrationTests.Controllers.AuthControllerTests.Login_WithValidCredentials_ShouldReturn200OK [FAIL]
[xUnit.net 00:01:32.72]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:01:32.72]       Stack Trace:
[xUnit.net 00:01:32.72]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:01:32.72]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:01:32.72]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:01:32.72]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:01:32.72]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
  Failed LankaConnect.IntegrationTests.Controllers.AuthControllerTests.Login_WithValidCredentials_ShouldReturn200OK [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
2026-01-18 19:59:28.828 -05:00 [INF]  : Starting LankaConnect API
[xUnit.net 00:01:32.82]     LankaConnect.IntegrationTests.Email.EmailIntegrationTests.QueueEmailAsync_WithHighPriority_ShouldSetCorrectPriority [FAIL]
[xUnit.net 00:01:32.82]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:01:32.82]       Stack Trace:
[xUnit.net 00:01:32.82]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:01:32.82]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:01:32.82]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:01:32.82]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:01:32.83]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 19:59:28.934 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:59:29.045 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:59:29.073 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:59:29.084 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:59:29.084 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:59:29.084 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:59:29.085 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:59:29.085 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 19:59:29.132 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:59:29.132 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:59:29.133 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:59:29.133 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:59:29.133 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:59:29.133 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:59:29.133 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 19:59:29.157 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:01:33.09]     LankaConnect.IntegrationTests.Repositories.EventRepositoryLocationTests.GetNearestEventsAsync_Should_Respect_MaxResults_Parameter [FAIL]
[xUnit.net 00:01:33.09]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:01:33.09]       Stack Trace:
[xUnit.net 00:01:33.09]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:01:33.09]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:01:33.09]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:01:33.09]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:01:33.09]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 19:59:29.196 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:59:29.360 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:59:29.360 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:59:29.360 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:59:29.360 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:59:29.360 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:59:29.361 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:59:29.361 -05:00 [INF]  Program: Applying database migrations...
[xUnit.net 00:01:33.46]     LankaConnect.IntegrationTests.Infrastructure.DockerConnectivityTests.MailHog_Container_IsAccessible [FAIL]
[xUnit.net 00:01:33.46]       System.Net.Sockets.SocketException : No connection could be made because the target machine actively refused it.
[xUnit.net 00:01:33.46]       Stack Trace:
[xUnit.net 00:01:33.46]            at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
[xUnit.net 00:01:33.46]            at System.Threading.Tasks.ValueTask.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
[xUnit.net 00:01:33.46]         --- End of stack trace from previous location ---
[xUnit.net 00:01:33.46]            at System.Net.Sockets.TcpClient.CompleteConnectAsync(Task task)
[xUnit.net 00:01:33.46]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Infrastructure\DockerConnectivityTests.cs(79,0): at LankaConnect.IntegrationTests.Infrastructure.DockerConnectivityTests.MailHog_Container_IsAccessible()
[xUnit.net 00:01:33.47]         --- End of stack trace from previous location ---
[xUnit.net 00:01:33.59]     LankaConnect.IntegrationTests.Email.EmailApiTests.EmailApi_ShouldReturnCorrectErrorResponse [FAIL]
[xUnit.net 00:01:33.59]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:01:33.59]       Stack Trace:
[xUnit.net 00:01:33.59]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:01:33.59]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:01:33.59]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:01:33.59]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:01:33.59]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 19:59:29.688 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:59:29.750 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:59:29.750 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:59:29.750 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:59:29.750 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:59:29.750 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:59:29.751 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:59:29.751 -05:00 [INF]  Program: Applying database migrations...
  Failed LankaConnect.IntegrationTests.Email.EmailIntegrationTests.QueueEmailAsync_WithHighPriority_ShouldSetCorrectPriority [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
  Failed LankaConnect.IntegrationTests.Repositories.EventRepositoryLocationTests.GetNearestEventsAsync_Should_Respect_MaxResults_Parameter [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
  Failed LankaConnect.IntegrationTests.Infrastructure.DockerConnectivityTests.MailHog_Container_IsAccessible [4 s]
  Error Message:
   System.Net.Sockets.SocketException : No connection could be made because the target machine actively refused it.
  Stack Trace:
     at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at System.Net.Sockets.TcpClient.CompleteConnectAsync(Task task)
   at LankaConnect.IntegrationTests.Infrastructure.DockerConnectivityTests.MailHog_Container_IsAccessible() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Infrastructure\DockerConnectivityTests.cs:line 79
--- End of stack trace from previous location ---
  Failed LankaConnect.IntegrationTests.Email.EmailApiTests.EmailApi_ShouldReturnCorrectErrorResponse [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
[xUnit.net 00:01:37.01]     LankaConnect.IntegrationTests.Controllers.ExternalProviderManagementTests.LinkExternalProvider_WhenUserNotFound_ShouldReturn400 [FAIL]
[xUnit.net 00:01:37.01]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:01:37.01]       Stack Trace:
[xUnit.net 00:01:37.01]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:01:37.01]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:01:37.01]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:01:37.01]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:01:37.02]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
  Failed LankaConnect.IntegrationTests.Controllers.ExternalProviderManagementTests.LinkExternalProvider_WhenUserNotFound_ShouldReturn400 [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
2026-01-18 19:59:33.126 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:59:33.135 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:59:33.166 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:59:33.198 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:01:37.12]     LankaConnect.IntegrationTests.Email.EmailIntegrationTests.EmailValidation_WithInvalidEmailAddress_ShouldHandleGracefully [FAIL]
[xUnit.net 00:01:37.12]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:01:37.12]       Stack Trace:
[xUnit.net 00:01:37.12]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:01:37.12]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:01:37.12]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:01:37.12]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:01:37.12]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 19:59:33.231 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:59:33.271 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:59:33.272 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:59:33.272 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:59:33.272 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:59:33.272 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:59:33.272 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:59:33.272 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 19:59:33.292 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:59:33.292 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:59:33.292 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:59:33.293 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:59:33.293 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:59:33.293 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:59:33.293 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 19:59:33.430 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:59:33.449 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:01:37.68]     LankaConnect.IntegrationTests.Email.EmailPerformanceTests.TemplateRendering_ShouldBePerformant [FAIL]
[xUnit.net 00:01:37.68]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:01:37.68]       Stack Trace:
[xUnit.net 00:01:37.68]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:01:37.68]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:01:37.68]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:01:37.68]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:01:37.68]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 19:59:33.789 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:59:33.836 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:59:33.855 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
  Failed LankaConnect.IntegrationTests.Email.EmailIntegrationTests.EmailValidation_WithInvalidEmailAddress_ShouldHandleGracefully [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
  Failed LankaConnect.IntegrationTests.Email.EmailPerformanceTests.TemplateRendering_ShouldBePerformant [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
[xUnit.net 00:01:41.04]     LankaConnect.IntegrationTests.Repositories.BusinessRepositoryTests.GetBusinessCountByCategoryAsync_Should_Return_Correct_Count [FAIL]
[xUnit.net 00:01:41.04]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:01:41.05]       Stack Trace:
[xUnit.net 00:01:41.05]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:01:41.05]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:01:41.05]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:01:41.05]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:01:41.05]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
  Failed LankaConnect.IntegrationTests.Repositories.BusinessRepositoryTests.GetBusinessCountByCategoryAsync_Should_Return_Correct_Count [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
2026-01-18 19:59:37.177 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:59:37.318 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:59:37.325 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:59:37.336 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:59:37.340 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:59:37.340 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:59:37.340 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:59:37.341 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:59:37.341 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 19:59:37.367 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:01:41.28]     LankaConnect.IntegrationTests.Email.EmailIntegrationTests.EmailTracking_ShouldUpdateEmailStatus [FAIL]
[xUnit.net 00:01:41.29]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:01:41.29]       Stack Trace:
[xUnit.net 00:01:41.29]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:01:41.29]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:01:41.29]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:01:41.29]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:01:41.29]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 19:59:37.417 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:59:37.577 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:59:37.577 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:59:37.578 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:59:37.578 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:59:37.578 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:59:37.578 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:59:37.578 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 19:59:38.075 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
  Failed LankaConnect.IntegrationTests.Email.EmailIntegrationTests.EmailTracking_ShouldUpdateEmailStatus [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
[xUnit.net 00:01:45.24]     LankaConnect.IntegrationTests.Controllers.AuthControllerTests.ForgotPassword_WithValidEmail_ShouldReturn200OK [FAIL]
[xUnit.net 00:01:45.24]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:01:45.24]       Stack Trace:
[xUnit.net 00:01:45.24]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:01:45.24]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:01:45.24]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:01:45.24]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:01:45.24]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
  Failed LankaConnect.IntegrationTests.Controllers.AuthControllerTests.ForgotPassword_WithValidEmail_ShouldReturn200OK [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
[xUnit.net 00:01:45.24]     LankaConnect.IntegrationTests.Repositories.EventRepositoryLocationTests.GetNearestEventsAsync_Should_Only_Return_Published_Upcoming_Events [FAIL]
[xUnit.net 00:01:45.24]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:01:45.24]       Stack Trace:
[xUnit.net 00:01:45.24]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:01:45.24]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:01:45.24]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:01:45.24]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:01:45.24]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 19:59:41.341 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:59:41.341 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:59:41.382 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:59:41.384 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:59:41.633 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:01:45.55]     LankaConnect.IntegrationTests.Email.EmailIntegrationTests.BulkEmailOperations_ShouldProcessEfficiently [FAIL]
[xUnit.net 00:01:45.55]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:01:45.55]       Stack Trace:
[xUnit.net 00:01:45.55]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:01:45.55]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:01:45.56]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:01:45.56]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:01:45.56]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 19:59:41.661 -05:00 [INF]  : Starting LankaConnect API
[xUnit.net 00:01:45.68]     LankaConnect.IntegrationTests.Infrastructure.DockerConnectivityTests.Docker_NetworkConnectivity_WorksCorrectly [FAIL]
[xUnit.net 00:01:45.68]       StackExchange.Redis.RedisConnectionException : It was not possible to connect to the redis server(s). Error connecting right now. To allow this multiplexer to continue retrying until it's able to connect, use abortConnect=false in your connection string or AbortOnConnectFail=false; in your code.
[xUnit.net 00:01:45.68]       Stack Trace:
[xUnit.net 00:01:45.68]         /_/src/StackExchange.Redis/ConnectionMultiplexer.cs(716,0): at StackExchange.Redis.ConnectionMultiplexer.ConnectImpl(ConfigurationOptions configuration, TextWriter writer, Nullable`1 serverType, EndPointCollection endpoints)
[xUnit.net 00:01:45.68]         /_/src/StackExchange.Redis/ConnectionMultiplexer.cs(678,0): at StackExchange.Redis.ConnectionMultiplexer.Connect(ConfigurationOptions configuration, TextWriter log)
[xUnit.net 00:01:45.68]         /_/src/StackExchange.Redis/ConnectionMultiplexer.cs(656,0): at StackExchange.Redis.ConnectionMultiplexer.Connect(String configuration, TextWriter log)
[xUnit.net 00:01:45.68]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Infrastructure\DockerConnectivityTests.cs(140,0): at LankaConnect.IntegrationTests.Infrastructure.DockerConnectivityTests.Docker_NetworkConnectivity_WorksCorrectly()
[xUnit.net 00:01:45.68]         --- End of stack trace from previous location ---
2026-01-18 19:59:41.826 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:59:41.826 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:59:41.826 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:59:41.826 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:59:41.827 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:59:41.827 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:59:41.827 -05:00 [INF]  Program: Applying database migrations...
[xUnit.net 00:01:45.91]     LankaConnect.IntegrationTests.Email.EmailApiTests.GetEmailStatus_WithValidId_ShouldReturnEmailStatus [FAIL]
[xUnit.net 00:01:45.91]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:01:45.91]       Stack Trace:
[xUnit.net 00:01:45.91]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:01:45.91]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:01:45.91]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:01:45.91]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:01:45.91]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 19:59:42.023 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:59:42.199 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:59:42.199 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:59:42.200 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:59:42.200 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:59:42.200 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:59:42.201 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:59:42.201 -05:00 [INF]  Program: Applying database migrations...
  Failed LankaConnect.IntegrationTests.Repositories.EventRepositoryLocationTests.GetNearestEventsAsync_Should_Only_Return_Published_Upcoming_Events [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
  Failed LankaConnect.IntegrationTests.Email.EmailIntegrationTests.BulkEmailOperations_ShouldProcessEfficiently [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
  Failed LankaConnect.IntegrationTests.Infrastructure.DockerConnectivityTests.Docker_NetworkConnectivity_WorksCorrectly [12 s]
  Error Message:
   StackExchange.Redis.RedisConnectionException : It was not possible to connect to the redis server(s). Error connecting right now. To allow this multiplexer to continue retrying until it's able to connect, use abortConnect=false in your connection string or AbortOnConnectFail=false; in your code.
  Stack Trace:
     at StackExchange.Redis.ConnectionMultiplexer.ConnectImpl(ConfigurationOptions configuration, TextWriter writer, Nullable`1 serverType, EndPointCollection endpoints) in /_/src/StackExchange.Redis/ConnectionMultiplexer.cs:line 716
   at StackExchange.Redis.ConnectionMultiplexer.Connect(ConfigurationOptions configuration, TextWriter log) in /_/src/StackExchange.Redis/ConnectionMultiplexer.cs:line 678
   at StackExchange.Redis.ConnectionMultiplexer.Connect(String configuration, TextWriter log) in /_/src/StackExchange.Redis/ConnectionMultiplexer.cs:line 656
   at LankaConnect.IntegrationTests.Infrastructure.DockerConnectivityTests.Docker_NetworkConnectivity_WorksCorrectly() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Infrastructure\DockerConnectivityTests.cs:line 140
--- End of stack trace from previous location ---
  Failed LankaConnect.IntegrationTests.Email.EmailApiTests.GetEmailStatus_WithValidId_ShouldReturnEmailStatus [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
[xUnit.net 00:01:49.24]     LankaConnect.IntegrationTests.Controllers.ExternalProviderManagementTests.ExternalProviderWorkflow_LinkGetUnlink_ShouldWorkEndToEnd [FAIL]
[xUnit.net 00:01:49.24]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:01:49.24]       Stack Trace:
[xUnit.net 00:01:49.24]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:01:49.24]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:01:49.24]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:01:49.24]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:01:49.24]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
  Failed LankaConnect.IntegrationTests.Controllers.ExternalProviderManagementTests.ExternalProviderWorkflow_LinkGetUnlink_ShouldWorkEndToEnd [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
2026-01-18 19:59:45.358 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:59:45.472 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:59:45.472 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:59:45.482 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:59:45.482 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:59:45.482 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:59:45.482 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:59:45.482 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 19:59:45.494 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:59:45.494 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:01:49.41]     LankaConnect.IntegrationTests.Controllers.AuthControllerTests.VerifyEmail_WithAlreadyVerifiedEmail_ShouldReturn200OK [FAIL]
[xUnit.net 00:01:49.41]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:01:49.41]       Stack Trace:
[xUnit.net 00:01:49.41]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:01:49.41]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:01:49.41]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:01:49.41]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:01:49.41]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 19:59:45.510 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:59:45.571 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:59:45.571 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:59:45.571 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:59:45.571 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:59:45.571 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:59:45.571 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:59:45.572 -05:00 [INF]  Program: Applying database migrations...
[xUnit.net 00:01:49.49]     LankaConnect.IntegrationTests.Email.EmailPerformanceTests.DatabaseOperations_ShouldScaleEfficiently [FAIL]
[xUnit.net 00:01:49.49]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:01:49.50]       Stack Trace:
[xUnit.net 00:01:49.50]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:01:49.50]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:01:49.50]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:01:49.50]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:01:49.50]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 19:59:45.591 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:59:45.647 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:59:45.647 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:59:45.648 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:59:45.648 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:59:45.648 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:59:45.648 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:59:45.648 -05:00 [INF]  Program: Applying database migrations...
[xUnit.net 00:01:49.79]     LankaConnect.IntegrationTests.Infrastructure.DockerConnectivityTests.RedisCommander_Container_IsAccessible [FAIL]
[xUnit.net 00:01:49.79]       System.Net.Http.HttpRequestException : No connection could be made because the target machine actively refused it. (localhost:8082)
[xUnit.net 00:01:49.79]       ---- System.Net.Sockets.SocketException : No connection could be made because the target machine actively refused it.
[xUnit.net 00:01:49.79]       Stack Trace:
[xUnit.net 00:01:49.79]            at System.Net.Http.HttpConnectionPool.ConnectToTcpHostAsync(String host, Int32 port, HttpRequestMessage initialRequest, Boolean async, CancellationToken cancellationToken)
[xUnit.net 00:01:49.79]            at System.Net.Http.HttpConnectionPool.ConnectAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
[xUnit.net 00:01:49.79]            at System.Net.Http.HttpConnectionPool.CreateHttp11ConnectionAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
[xUnit.net 00:01:49.79]            at System.Net.Http.HttpConnectionPool.AddHttp11ConnectionAsync(QueueItem queueItem)
[xUnit.net 00:01:49.79]            at System.Threading.Tasks.TaskCompletionSourceWithCancellation`1.WaitWithCancellationAsync(CancellationToken cancellationToken)
[xUnit.net 00:01:49.79]            at System.Net.Http.HttpConnectionPool.SendWithVersionDetectionAndRetryAsync(HttpRequestMessage request, Boolean async, Boolean doRequestAuth, CancellationToken cancellationToken)
[xUnit.net 00:01:49.79]            at System.Net.Http.RedirectHandler.SendAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
[xUnit.net 00:01:49.79]            at System.Net.Http.HttpClient.<SendAsync>g__Core|83_0(HttpRequestMessage request, HttpCompletionOption completionOption, CancellationTokenSource cts, Boolean disposeCts, CancellationTokenSource pendingRequestsCts, CancellationToken originalCancellationToken)
[xUnit.net 00:01:49.79]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Infrastructure\DockerConnectivityTests.cs(126,0): at LankaConnect.IntegrationTests.Infrastructure.DockerConnectivityTests.RedisCommander_Container_IsAccessible()
[xUnit.net 00:01:49.79]         --- End of stack trace from previous location ---
[xUnit.net 00:01:49.79]         ----- Inner Stack Trace -----
[xUnit.net 00:01:49.79]            at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
[xUnit.net 00:01:49.79]            at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
[xUnit.net 00:01:49.79]            at System.Net.Http.HttpConnectionPool.ConnectToTcpHostAsync(String host, Int32 port, HttpRequestMessage initialRequest, Boolean async, CancellationToken cancellationToken)
2026-01-18 19:59:45.915 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:59:45.935 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:59:46.266 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:01:50.20]     LankaConnect.IntegrationTests.Email.EmailApiTests.EmailApi_ShouldHandleRateLimiting [FAIL]
[xUnit.net 00:01:50.20]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:01:50.20]       Stack Trace:
[xUnit.net 00:01:50.20]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:01:50.20]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:01:50.20]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:01:50.20]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:01:50.20]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 19:59:46.305 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:59:46.472 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:59:46.472 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:59:46.472 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:59:46.472 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:59:46.472 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:59:46.473 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:59:46.473 -05:00 [INF]  Program: Applying database migrations...
  Failed LankaConnect.IntegrationTests.Controllers.AuthControllerTests.VerifyEmail_WithAlreadyVerifiedEmail_ShouldReturn200OK [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
  Failed LankaConnect.IntegrationTests.Email.EmailPerformanceTests.DatabaseOperations_ShouldScaleEfficiently [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
  Failed LankaConnect.IntegrationTests.Infrastructure.DockerConnectivityTests.RedisCommander_Container_IsAccessible [4 s]
  Error Message:
   System.Net.Http.HttpRequestException : No connection could be made because the target machine actively refused it. (localhost:8082)
---- System.Net.Sockets.SocketException : No connection could be made because the target machine actively refused it.
  Stack Trace:
     at System.Net.Http.HttpConnectionPool.ConnectToTcpHostAsync(String host, Int32 port, HttpRequestMessage initialRequest, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.ConnectAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.CreateHttp11ConnectionAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.AddHttp11ConnectionAsync(QueueItem queueItem)
   at System.Threading.Tasks.TaskCompletionSourceWithCancellation`1.WaitWithCancellationAsync(CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.SendWithVersionDetectionAndRetryAsync(HttpRequestMessage request, Boolean async, Boolean doRequestAuth, CancellationToken cancellationToken)
   at System.Net.Http.RedirectHandler.SendAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpClient.<SendAsync>g__Core|83_0(HttpRequestMessage request, HttpCompletionOption completionOption, CancellationTokenSource cts, Boolean disposeCts, CancellationTokenSource pendingRequestsCts, CancellationToken originalCancellationToken)
   at LankaConnect.IntegrationTests.Infrastructure.DockerConnectivityTests.RedisCommander_Container_IsAccessible() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Infrastructure\DockerConnectivityTests.cs:line 126
--- End of stack trace from previous location ---
----- Inner Stack Trace -----
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.ConnectToTcpHostAsync(String host, Int32 port, HttpRequestMessage initialRequest, Boolean async, CancellationToken cancellationToken)
  Failed LankaConnect.IntegrationTests.Email.EmailApiTests.EmailApi_ShouldHandleRateLimiting [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
[xUnit.net 00:01:53.42]     LankaConnect.IntegrationTests.Repositories.BusinessRepositoryTests.GetByCategoryAsync_Should_Return_Active_Businesses_In_Category [FAIL]
[xUnit.net 00:01:53.42]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:01:53.42]       Stack Trace:
[xUnit.net 00:01:53.42]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:01:53.42]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:01:53.42]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:01:53.43]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:01:53.43]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
  Failed LankaConnect.IntegrationTests.Repositories.BusinessRepositoryTests.GetByCategoryAsync_Should_Return_Active_Businesses_In_Category [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
2026-01-18 19:59:49.527 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:59:49.544 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:59:49.552 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:59:49.638 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:01:53.56]     LankaConnect.IntegrationTests.Controllers.AuthControllerTests.Health_ShouldReturn200OK [FAIL]
[xUnit.net 00:01:53.56]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:01:53.56]       Stack Trace:
[xUnit.net 00:01:53.56]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:01:53.56]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:01:53.56]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:01:53.56]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:01:53.56]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 19:59:49.658 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:59:49.708 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:59:49.709 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:59:49.709 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:59:49.709 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:59:49.709 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:59:49.709 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:59:49.709 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 19:59:49.710 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:59:49.715 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:01:53.87]     LankaConnect.IntegrationTests.Infrastructure.DockerConnectivityTests.Azurite_Container_IsAccessible [FAIL]
[xUnit.net 00:01:53.87]       System.Net.Http.HttpRequestException : No connection could be made because the target machine actively refused it. (localhost:10000)
[xUnit.net 00:01:53.87]       ---- System.Net.Sockets.SocketException : No connection could be made because the target machine actively refused it.
[xUnit.net 00:01:53.87]       Stack Trace:
[xUnit.net 00:01:53.87]            at System.Net.Http.HttpConnectionPool.ConnectToTcpHostAsync(String host, Int32 port, HttpRequestMessage initialRequest, Boolean async, CancellationToken cancellationToken)
[xUnit.net 00:01:53.87]            at System.Net.Http.HttpConnectionPool.ConnectAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
[xUnit.net 00:01:53.87]            at System.Net.Http.HttpConnectionPool.CreateHttp11ConnectionAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
[xUnit.net 00:01:53.87]            at System.Net.Http.HttpConnectionPool.AddHttp11ConnectionAsync(QueueItem queueItem)
[xUnit.net 00:01:53.87]            at System.Threading.Tasks.TaskCompletionSourceWithCancellation`1.WaitWithCancellationAsync(CancellationToken cancellationToken)
[xUnit.net 00:01:53.87]            at System.Net.Http.HttpConnectionPool.SendWithVersionDetectionAndRetryAsync(HttpRequestMessage request, Boolean async, Boolean doRequestAuth, CancellationToken cancellationToken)
[xUnit.net 00:01:53.87]            at System.Net.Http.RedirectHandler.SendAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
[xUnit.net 00:01:53.87]            at System.Net.Http.HttpClient.<SendAsync>g__Core|83_0(HttpRequestMessage request, HttpCompletionOption completionOption, CancellationTokenSource cts, Boolean disposeCts, CancellationTokenSource pendingRequestsCts, CancellationToken originalCancellationToken)
[xUnit.net 00:01:53.87]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Infrastructure\DockerConnectivityTests.cs(91,0): at LankaConnect.IntegrationTests.Infrastructure.DockerConnectivityTests.Azurite_Container_IsAccessible()
[xUnit.net 00:01:53.87]         --- End of stack trace from previous location ---
[xUnit.net 00:01:53.88]         ----- Inner Stack Trace -----
[xUnit.net 00:01:53.88]            at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
[xUnit.net 00:01:53.88]            at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
[xUnit.net 00:01:53.88]            at System.Net.Http.HttpConnectionPool.ConnectToTcpHostAsync(String host, Int32 port, HttpRequestMessage initialRequest, Boolean async, CancellationToken cancellationToken)
2026-01-18 19:59:50.532 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:01:54.46]     LankaConnect.IntegrationTests.Email.EmailApiTests.SendEmailVerification_WithInvalidEmail_ShouldReturnBadRequest [FAIL]
[xUnit.net 00:01:54.46]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:01:54.46]       Stack Trace:
[xUnit.net 00:01:54.46]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:01:54.46]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:01:54.46]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:01:54.46]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:01:54.46]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 19:59:50.568 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:59:50.726 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:59:50.726 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:59:50.726 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:59:50.727 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:59:50.727 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:59:50.729 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:59:50.729 -05:00 [INF]  Program: Applying database migrations...
  Failed LankaConnect.IntegrationTests.Controllers.AuthControllerTests.Health_ShouldReturn200OK [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
  Failed LankaConnect.IntegrationTests.Infrastructure.DockerConnectivityTests.Azurite_Container_IsAccessible [4 s]
  Error Message:
   System.Net.Http.HttpRequestException : No connection could be made because the target machine actively refused it. (localhost:10000)
---- System.Net.Sockets.SocketException : No connection could be made because the target machine actively refused it.
  Stack Trace:
     at System.Net.Http.HttpConnectionPool.ConnectToTcpHostAsync(String host, Int32 port, HttpRequestMessage initialRequest, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.ConnectAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.CreateHttp11ConnectionAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.AddHttp11ConnectionAsync(QueueItem queueItem)
   at System.Threading.Tasks.TaskCompletionSourceWithCancellation`1.WaitWithCancellationAsync(CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.SendWithVersionDetectionAndRetryAsync(HttpRequestMessage request, Boolean async, Boolean doRequestAuth, CancellationToken cancellationToken)
   at System.Net.Http.RedirectHandler.SendAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpClient.<SendAsync>g__Core|83_0(HttpRequestMessage request, HttpCompletionOption completionOption, CancellationTokenSource cts, Boolean disposeCts, CancellationTokenSource pendingRequestsCts, CancellationToken originalCancellationToken)
   at LankaConnect.IntegrationTests.Infrastructure.DockerConnectivityTests.Azurite_Container_IsAccessible() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Infrastructure\DockerConnectivityTests.cs:line 91
--- End of stack trace from previous location ---
----- Inner Stack Trace -----
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.ConnectToTcpHostAsync(String host, Int32 port, HttpRequestMessage initialRequest, Boolean async, CancellationToken cancellationToken)
  Failed LankaConnect.IntegrationTests.Email.EmailApiTests.SendEmailVerification_WithInvalidEmail_ShouldReturnBadRequest [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
[xUnit.net 00:01:57.41]     LankaConnect.IntegrationTests.Repositories.EventRepositoryLocationTests.GetEventsByRadiusAsync_Should_Return_Events_Within_25_Miles [FAIL]
[xUnit.net 00:01:57.41]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:01:57.41]       Stack Trace:
[xUnit.net 00:01:57.41]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:01:57.41]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:01:57.41]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:01:57.41]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:01:57.41]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
  Failed LankaConnect.IntegrationTests.Repositories.EventRepositoryLocationTests.GetEventsByRadiusAsync_Should_Return_Events_Within_25_Miles [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
2026-01-18 19:59:53.504 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:59:53.563 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:59:53.563 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:59:53.563 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:59:53.563 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:59:53.563 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:59:53.564 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:59:53.564 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 19:59:53.711 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:01:57.64]     LankaConnect.IntegrationTests.Email.EmailIntegrationTests.ProcessEmailQueueAsync_WithQueuedEmails_ShouldProcessThem [FAIL]
[xUnit.net 00:01:57.64]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:01:57.64]       Stack Trace:
[xUnit.net 00:01:57.64]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:01:57.64]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:01:57.64]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:01:57.64]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:01:57.64]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 19:59:53.733 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:59:53.742 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 19:59:53.745 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:01:57.96]     LankaConnect.IntegrationTests.Infrastructure.DockerConnectivityTests.PgAdmin_Container_IsAccessible [FAIL]
[xUnit.net 00:01:57.96]       System.Net.Http.HttpRequestException : No connection could be made because the target machine actively refused it. (localhost:8081)
[xUnit.net 00:01:57.99]       ---- System.Net.Sockets.SocketException : No connection could be made because the target machine actively refused it.
[xUnit.net 00:01:57.99]       Stack Trace:
[xUnit.net 00:01:57.99]            at System.Net.Http.HttpConnectionPool.ConnectToTcpHostAsync(String host, Int32 port, HttpRequestMessage initialRequest, Boolean async, CancellationToken cancellationToken)
[xUnit.net 00:01:57.99]            at System.Net.Http.HttpConnectionPool.ConnectAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
[xUnit.net 00:01:57.99]            at System.Net.Http.HttpConnectionPool.CreateHttp11ConnectionAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
[xUnit.net 00:01:57.99]            at System.Net.Http.HttpConnectionPool.AddHttp11ConnectionAsync(QueueItem queueItem)
[xUnit.net 00:01:57.99]            at System.Threading.Tasks.TaskCompletionSourceWithCancellation`1.WaitWithCancellationAsync(CancellationToken cancellationToken)
[xUnit.net 00:01:57.99]            at System.Net.Http.HttpConnectionPool.SendWithVersionDetectionAndRetryAsync(HttpRequestMessage request, Boolean async, Boolean doRequestAuth, CancellationToken cancellationToken)
[xUnit.net 00:01:57.99]            at System.Net.Http.RedirectHandler.SendAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
[xUnit.net 00:01:57.99]            at System.Net.Http.HttpClient.<SendAsync>g__Core|83_0(HttpRequestMessage request, HttpCompletionOption completionOption, CancellationTokenSource cts, Boolean disposeCts, CancellationTokenSource pendingRequestsCts, CancellationToken originalCancellationToken)
[xUnit.net 00:01:57.99]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Infrastructure\DockerConnectivityTests.cs(118,0): at LankaConnect.IntegrationTests.Infrastructure.DockerConnectivityTests.PgAdmin_Container_IsAccessible()
[xUnit.net 00:01:58.00]         --- End of stack trace from previous location ---
[xUnit.net 00:01:58.00]         ----- Inner Stack Trace -----
[xUnit.net 00:01:58.00]            at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
[xUnit.net 00:01:58.00]            at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
[xUnit.net 00:01:58.00]            at System.Net.Http.HttpConnectionPool.ConnectToTcpHostAsync(String host, Int32 port, HttpRequestMessage initialRequest, Boolean async, CancellationToken cancellationToken)
2026-01-18 19:59:54.808 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:01:58.73]     LankaConnect.IntegrationTests.Email.EmailApiTests.EmailApi_ShouldHandleContentNegotiation [FAIL]
[xUnit.net 00:01:58.74]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:01:58.74]       Stack Trace:
[xUnit.net 00:01:58.74]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:01:58.74]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:01:58.74]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:01:58.74]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:01:58.74]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
  Failed LankaConnect.IntegrationTests.Email.EmailIntegrationTests.ProcessEmailQueueAsync_WithQueuedEmails_ShouldProcessThem [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
  Failed LankaConnect.IntegrationTests.Infrastructure.DockerConnectivityTests.PgAdmin_Container_IsAccessible [4 s]
  Error Message:
   System.Net.Http.HttpRequestException : No connection could be made because the target machine actively refused it. (localhost:8081)
---- System.Net.Sockets.SocketException : No connection could be made because the target machine actively refused it.
  Stack Trace:
     at System.Net.Http.HttpConnectionPool.ConnectToTcpHostAsync(String host, Int32 port, HttpRequestMessage initialRequest, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.ConnectAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.CreateHttp11ConnectionAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.AddHttp11ConnectionAsync(QueueItem queueItem)
   at System.Threading.Tasks.TaskCompletionSourceWithCancellation`1.WaitWithCancellationAsync(CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.SendWithVersionDetectionAndRetryAsync(HttpRequestMessage request, Boolean async, Boolean doRequestAuth, CancellationToken cancellationToken)
   at System.Net.Http.RedirectHandler.SendAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpClient.<SendAsync>g__Core|83_0(HttpRequestMessage request, HttpCompletionOption completionOption, CancellationTokenSource cts, Boolean disposeCts, CancellationTokenSource pendingRequestsCts, CancellationToken originalCancellationToken)
   at LankaConnect.IntegrationTests.Infrastructure.DockerConnectivityTests.PgAdmin_Container_IsAccessible() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Infrastructure\DockerConnectivityTests.cs:line 118
--- End of stack trace from previous location ---
----- Inner Stack Trace -----
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.ConnectToTcpHostAsync(String host, Int32 port, HttpRequestMessage initialRequest, Boolean async, CancellationToken cancellationToken)
  Failed LankaConnect.IntegrationTests.Email.EmailApiTests.EmailApi_ShouldHandleContentNegotiation [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
2026-01-18 19:59:57.654 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:02:01.57]     LankaConnect.IntegrationTests.Repositories.EventRepositoryLocationTests.GetEventsByCityAsync_Should_Return_Empty_For_Invalid_City [FAIL]
[xUnit.net 00:02:01.57]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:02:01.57]       Stack Trace:
[xUnit.net 00:02:01.57]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:02:01.57]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:02:01.57]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:02:01.57]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:02:01.58]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
  Failed LankaConnect.IntegrationTests.Repositories.EventRepositoryLocationTests.GetEventsByCityAsync_Should_Return_Empty_For_Invalid_City [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
[xUnit.net 00:02:01.60]     LankaConnect.IntegrationTests.Controllers.ExternalProviderManagementTests.GetLinkedProviders_WithLinkedProviders_ShouldReturn200AndProviderList [FAIL]
[xUnit.net 00:02:01.60]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:02:01.60]       Stack Trace:
[xUnit.net 00:02:01.60]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:02:01.60]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:02:01.60]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:02:01.60]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:02:01.60]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 19:59:57.690 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:59:57.815 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 19:59:57.816 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 19:59:57.816 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 19:59:57.816 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 19:59:57.816 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 19:59:57.816 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 19:59:57.817 -05:00 [INF]  Program: Applying database migrations...
[xUnit.net 00:02:01.75]     LankaConnect.IntegrationTests.Email.EmailPerformanceTests.EmailRetry_ShouldHandleFailuresEfficiently [FAIL]
[xUnit.net 00:02:01.75]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:02:01.75]       Stack Trace:
[xUnit.net 00:02:01.75]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:02:01.75]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:02:01.75]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:02:01.75]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:02:01.75]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 19:59:57.853 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 19:59:57.865 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:02:02.08]     LankaConnect.IntegrationTests.Infrastructure.DockerConnectivityTests.Seq_Container_IsAccessible [FAIL]
[xUnit.net 00:02:02.08]       System.Net.Http.HttpRequestException : No connection could be made because the target machine actively refused it. (localhost:8080)
[xUnit.net 00:02:02.08]       ---- System.Net.Sockets.SocketException : No connection could be made because the target machine actively refused it.
[xUnit.net 00:02:02.08]       Stack Trace:
[xUnit.net 00:02:02.08]            at System.Net.Http.HttpConnectionPool.ConnectToTcpHostAsync(String host, Int32 port, HttpRequestMessage initialRequest, Boolean async, CancellationToken cancellationToken)
[xUnit.net 00:02:02.08]            at System.Net.Http.HttpConnectionPool.ConnectAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
[xUnit.net 00:02:02.08]            at System.Net.Http.HttpConnectionPool.CreateHttp11ConnectionAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
[xUnit.net 00:02:02.08]            at System.Net.Http.HttpConnectionPool.AddHttp11ConnectionAsync(QueueItem queueItem)
[xUnit.net 00:02:02.08]            at System.Threading.Tasks.TaskCompletionSourceWithCancellation`1.WaitWithCancellationAsync(CancellationToken cancellationToken)
[xUnit.net 00:02:02.08]            at System.Net.Http.HttpConnectionPool.SendWithVersionDetectionAndRetryAsync(HttpRequestMessage request, Boolean async, Boolean doRequestAuth, CancellationToken cancellationToken)
[xUnit.net 00:02:02.08]            at System.Net.Http.RedirectHandler.SendAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
[xUnit.net 00:02:02.08]            at System.Net.Http.HttpClient.<SendAsync>g__Core|83_0(HttpRequestMessage request, HttpCompletionOption completionOption, CancellationTokenSource cts, Boolean disposeCts, CancellationTokenSource pendingRequestsCts, CancellationToken originalCancellationToken)
[xUnit.net 00:02:02.08]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Infrastructure\DockerConnectivityTests.cs(107,0): at LankaConnect.IntegrationTests.Infrastructure.DockerConnectivityTests.Seq_Container_IsAccessible()
[xUnit.net 00:02:02.08]         --- End of stack trace from previous location ---
[xUnit.net 00:02:02.08]         ----- Inner Stack Trace -----
[xUnit.net 00:02:02.08]            at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
[xUnit.net 00:02:02.08]            at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
[xUnit.net 00:02:02.08]            at System.Net.Http.HttpConnectionPool.ConnectToTcpHostAsync(String host, Int32 port, HttpRequestMessage initialRequest, Boolean async, CancellationToken cancellationToken)
  Failed LankaConnect.IntegrationTests.Controllers.ExternalProviderManagementTests.GetLinkedProviders_WithLinkedProviders_ShouldReturn200AndProviderList [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
  Failed LankaConnect.IntegrationTests.Email.EmailPerformanceTests.EmailRetry_ShouldHandleFailuresEfficiently [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
  Failed LankaConnect.IntegrationTests.Infrastructure.DockerConnectivityTests.Seq_Container_IsAccessible [4 s]
  Error Message:
   System.Net.Http.HttpRequestException : No connection could be made because the target machine actively refused it. (localhost:8080)
---- System.Net.Sockets.SocketException : No connection could be made because the target machine actively refused it.
  Stack Trace:
     at System.Net.Http.HttpConnectionPool.ConnectToTcpHostAsync(String host, Int32 port, HttpRequestMessage initialRequest, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.ConnectAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.CreateHttp11ConnectionAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.AddHttp11ConnectionAsync(QueueItem queueItem)
   at System.Threading.Tasks.TaskCompletionSourceWithCancellation`1.WaitWithCancellationAsync(CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.SendWithVersionDetectionAndRetryAsync(HttpRequestMessage request, Boolean async, Boolean doRequestAuth, CancellationToken cancellationToken)
   at System.Net.Http.RedirectHandler.SendAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpClient.<SendAsync>g__Core|83_0(HttpRequestMessage request, HttpCompletionOption completionOption, CancellationTokenSource cts, Boolean disposeCts, CancellationTokenSource pendingRequestsCts, CancellationToken originalCancellationToken)
   at LankaConnect.IntegrationTests.Infrastructure.DockerConnectivityTests.Seq_Container_IsAccessible() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Infrastructure\DockerConnectivityTests.cs:line 107
--- End of stack trace from previous location ---
----- Inner Stack Trace -----
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.ConnectToTcpHostAsync(String host, Int32 port, HttpRequestMessage initialRequest, Boolean async, CancellationToken cancellationToken)
[xUnit.net 00:02:05.58]     LankaConnect.IntegrationTests.Repositories.BusinessRepositoryTests.GetByOwnerIdAsync_Should_Return_Businesses_For_Owner [FAIL]
[xUnit.net 00:02:05.58]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:02:05.58]       Stack Trace:
[xUnit.net 00:02:05.58]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:02:05.58]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:02:05.58]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:02:05.58]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:02:05.58]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
  Failed LankaConnect.IntegrationTests.Repositories.BusinessRepositoryTests.GetByOwnerIdAsync_Should_Return_Businesses_For_Owner [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
2026-01-18 20:00:01.682 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 20:00:01.803 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 20:00:01.803 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 20:00:01.803 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 20:00:01.803 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 20:00:01.804 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 20:00:01.804 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 20:00:01.804 -05:00 [INF]  Program: Applying database migrations...
[xUnit.net 00:02:05.79]     LankaConnect.IntegrationTests.Controllers.AuthControllerTests.ForgotPassword_WithInvalidEmail_ShouldReturn400BadRequest [FAIL]
[xUnit.net 00:02:05.79]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:02:05.79]       Stack Trace:
[xUnit.net 00:02:05.79]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:02:05.79]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:02:05.79]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:02:05.79]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:02:05.79]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 20:00:01.899 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 20:00:01.896 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 20:00:01.905 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:02:05.94]     LankaConnect.IntegrationTests.Email.EmailPerformanceTests.MemoryUsage_ShouldRemainStable [FAIL]
[xUnit.net 00:02:05.94]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:02:05.94]       Stack Trace:
[xUnit.net 00:02:05.94]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:02:05.94]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:02:05.94]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:02:05.94]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:02:05.94]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 20:00:02.037 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 20:00:02.096 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 20:00:02.096 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 20:00:02.096 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 20:00:02.096 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 20:00:02.096 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 20:00:02.097 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 20:00:02.097 -05:00 [INF]  Program: Applying database migrations...
  Failed LankaConnect.IntegrationTests.Controllers.AuthControllerTests.ForgotPassword_WithInvalidEmail_ShouldReturn400BadRequest [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
  Failed LankaConnect.IntegrationTests.Email.EmailPerformanceTests.MemoryUsage_ShouldRemainStable [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
2026-01-18 20:00:05.877 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 20:00:05.897 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:02:09.91]     LankaConnect.IntegrationTests.Email.EmailIntegrationTests.SendEmailAsync_WithHtmlContent_ShouldSendMultipartEmail [FAIL]
[xUnit.net 00:02:09.91]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:02:09.91]       Stack Trace:
[xUnit.net 00:02:09.91]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:02:09.91]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:02:09.91]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:02:09.91]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:02:09.91]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
  Failed LankaConnect.IntegrationTests.Email.EmailIntegrationTests.SendEmailAsync_WithHtmlContent_ShouldSendMultipartEmail [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
2026-01-18 20:00:06.023 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 20:00:06.115 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 20:00:06.181 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:02:10.10]     LankaConnect.IntegrationTests.Email.EmailPerformanceTests.EmailQueueProcessing_ShouldMaintainThroughput [FAIL]
[xUnit.net 00:02:10.11]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:02:10.11]       Stack Trace:
[xUnit.net 00:02:10.11]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:02:10.11]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:02:10.11]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:02:10.11]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:02:10.11]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 20:00:06.232 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 20:00:06.379 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 20:00:06.380 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 20:00:06.380 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 20:00:06.380 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 20:00:06.380 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 20:00:06.382 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 20:00:06.382 -05:00 [INF]  Program: Applying database migrations...
  Failed LankaConnect.IntegrationTests.Email.EmailPerformanceTests.EmailQueueProcessing_ShouldMaintainThroughput [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
[xUnit.net 00:02:13.97]     LankaConnect.IntegrationTests.Repositories.EventRepositoryLocationTests.GetEventsByCityAsync_Should_Filter_By_State_When_Provided [FAIL]
[xUnit.net 00:02:13.97]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:02:13.97]       Stack Trace:
[xUnit.net 00:02:13.97]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:02:13.97]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:02:13.97]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:02:13.97]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:02:13.97]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
  Failed LankaConnect.IntegrationTests.Repositories.EventRepositoryLocationTests.GetEventsByCityAsync_Should_Filter_By_State_When_Provided [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
2026-01-18 20:00:10.080 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 20:00:10.138 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 20:00:10.138 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 20:00:10.139 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 20:00:10.139 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 20:00:10.139 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 20:00:10.139 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 20:00:10.139 -05:00 [INF]  Program: Applying database migrations...
[xUnit.net 00:02:14.12]     LankaConnect.IntegrationTests.Repositories.BusinessRepositoryTests.IsOwnerOfBusinessAsync_Should_Return_True_For_Owner [FAIL]
[xUnit.net 00:02:14.12]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:02:14.12]       Stack Trace:
[xUnit.net 00:02:14.12]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:02:14.12]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:02:14.12]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:02:14.12]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:02:14.12]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 20:00:10.214 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 20:00:10.227 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 20:00:10.270 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 20:00:10.270 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 20:00:10.270 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 20:00:10.270 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 20:00:10.270 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 20:00:10.270 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 20:00:10.271 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 20:00:10.459 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 20:00:10.482 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
  Failed LankaConnect.IntegrationTests.Repositories.BusinessRepositoryTests.IsOwnerOfBusinessAsync_Should_Return_True_For_Owner [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
[xUnit.net 00:02:18.14]     LankaConnect.IntegrationTests.Controllers.AuthControllerTests.ResetPassword_WithValidTokenAndPassword_ShouldReturn200OK [FAIL]
[xUnit.net 00:02:18.14]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:02:18.14]       Stack Trace:
[xUnit.net 00:02:18.14]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:02:18.14]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:02:18.14]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:02:18.14]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:02:18.14]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
  Failed LankaConnect.IntegrationTests.Controllers.AuthControllerTests.ResetPassword_WithValidTokenAndPassword_ShouldReturn200OK [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
2026-01-18 20:00:14.224 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:02:18.14]     LankaConnect.IntegrationTests.Repositories.EventRepositoryLocationTests.GetEventsByRadiusAsync_Should_Return_Empty_When_No_Events_In_Radius [FAIL]
[xUnit.net 00:02:18.14]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:02:18.15]       Stack Trace:
[xUnit.net 00:02:18.15]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:02:18.15]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:02:18.15]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:02:18.15]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:02:18.15]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 20:00:14.269 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 20:00:14.274 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 20:00:14.326 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 20:00:14.332 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
  Failed LankaConnect.IntegrationTests.Repositories.EventRepositoryLocationTests.GetEventsByRadiusAsync_Should_Return_Empty_When_No_Events_In_Radius [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
[xUnit.net 00:02:22.16]     LankaConnect.IntegrationTests.Email.EmailIntegrationTests.EmailMetrics_ShouldTrackEmailStatistics [FAIL]
[xUnit.net 00:02:22.16]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:02:22.16]       Stack Trace:
[xUnit.net 00:02:22.16]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:02:22.16]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:02:22.16]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:02:22.16]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:02:22.16]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
[xUnit.net 00:02:22.29]     LankaConnect.IntegrationTests.Email.EmailPerformanceTests.ConcurrentEmailSending_ShouldMaintainPerformance [FAIL]
[xUnit.net 00:02:22.29]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:02:22.29]       Stack Trace:
[xUnit.net 00:02:22.29]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:02:22.29]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:02:22.29]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:02:22.29]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:02:22.29]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
  Failed LankaConnect.IntegrationTests.Email.EmailIntegrationTests.EmailMetrics_ShouldTrackEmailStatistics [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
  Failed LankaConnect.IntegrationTests.Email.EmailPerformanceTests.ConcurrentEmailSending_ShouldMaintainPerformance [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
[xUnit.net 00:02:22.33]     LankaConnect.IntegrationTests.Controllers.AuthControllerTests.VerifyEmail_WithInvalidToken_ShouldReturn400BadRequest [FAIL]
[xUnit.net 00:02:22.33]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:02:22.33]       Stack Trace:
[xUnit.net 00:02:22.33]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:02:22.33]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:02:22.33]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:02:22.33]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:02:22.33]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
[xUnit.net 00:02:22.33]     LankaConnect.IntegrationTests.Repositories.EventRepositoryLocationTests.GetEventsByCityAsync_Should_Return_Empty_For_Empty_City_Name [FAIL]
[xUnit.net 00:02:22.33]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:02:22.33]       Stack Trace:
[xUnit.net 00:02:22.33]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:02:22.33]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:02:22.33]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:02:22.33]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:02:22.33]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 20:00:18.431 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 20:00:18.443 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 20:00:18.443 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 20:00:18.562 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 20:00:18.562 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 20:00:18.566 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 20:00:18.568 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 20:00:18.573 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 20:00:18.573 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 20:00:18.573 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 20:00:18.573 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 20:00:18.574 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 20:00:18.574 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 20:00:18.574 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 20:00:18.574 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 20:00:18.574 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 20:00:18.574 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 20:00:18.574 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 20:00:18.574 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 20:00:18.574 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 20:00:18.574 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 20:00:18.574 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 20:00:18.574 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 20:00:18.574 -05:00 [INF]  Program: Applying database migrations...
  Failed LankaConnect.IntegrationTests.Controllers.AuthControllerTests.VerifyEmail_WithInvalidToken_ShouldReturn400BadRequest [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
  Failed LankaConnect.IntegrationTests.Repositories.EventRepositoryLocationTests.GetEventsByCityAsync_Should_Return_Empty_For_Empty_City_Name [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
[xUnit.net 00:02:26.39]     LankaConnect.IntegrationTests.Repositories.BusinessRepositoryTests.SearchByLocationAsync_Should_Return_Businesses_In_City [FAIL]
[xUnit.net 00:02:26.39]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:02:26.39]       Stack Trace:
[xUnit.net 00:02:26.39]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:02:26.39]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:02:26.39]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:02:26.39]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:02:26.39]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
  Failed LankaConnect.IntegrationTests.Repositories.BusinessRepositoryTests.SearchByLocationAsync_Should_Return_Businesses_In_City [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
2026-01-18 20:00:22.481 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 20:00:22.531 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 20:00:22.531 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 20:00:22.532 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 20:00:22.532 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 20:00:22.532 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 20:00:22.533 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 20:00:22.533 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 20:00:22.644 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 20:00:22.644 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 20:00:22.643 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 20:00:22.656 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 20:00:22.664 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 20:00:22.670 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
[xUnit.net 00:02:26.59]     LankaConnect.IntegrationTests.Repositories.EventRepositoryLocationTests.GetEventsByCityAsync_Should_Return_Events_In_Specified_City [FAIL]
[xUnit.net 00:02:26.59]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:02:26.59]       Stack Trace:
[xUnit.net 00:02:26.59]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:02:26.59]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:02:26.59]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:02:26.59]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:02:26.59]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:02:26.60]     LankaConnect.IntegrationTests.Controllers.AuthControllerTests.RefreshToken_WithoutCookie_ShouldReturn400BadRequest [FAIL]
[xUnit.net 00:02:26.60]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:02:26.60]       Stack Trace:
[xUnit.net 00:02:26.60]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:02:26.60]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:02:26.60]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:02:26.60]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:02:26.60]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 20:00:22.708 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 20:00:22.708 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 20:00:22.835 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 20:00:22.835 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 20:00:22.836 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 20:00:22.836 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 20:00:22.836 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 20:00:22.837 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 20:00:22.837 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 20:00:22.837 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 20:00:22.837 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 20:00:22.837 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 20:00:22.837 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 20:00:22.837 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 20:00:22.837 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 20:00:22.837 -05:00 [INF]  Program: Applying database migrations...
  Failed LankaConnect.IntegrationTests.Repositories.EventRepositoryLocationTests.GetEventsByCityAsync_Should_Return_Events_In_Specified_City [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
  Failed LankaConnect.IntegrationTests.Controllers.AuthControllerTests.RefreshToken_WithoutCookie_ShouldReturn400BadRequest [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
2026-01-18 20:00:26.612 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 20:00:26.621 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 20:00:26.917 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:02:30.83]     LankaConnect.IntegrationTests.Repositories.EventRepositoryLocationTests.GetEventsByRadiusAsync_Should_Only_Return_Published_Upcoming_Events [FAIL]
[xUnit.net 00:02:30.83]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:02:30.83]       Stack Trace:
[xUnit.net 00:02:30.83]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:02:30.83]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:02:30.83]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:02:30.83]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:02:30.83]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
  Failed LankaConnect.IntegrationTests.Repositories.EventRepositoryLocationTests.GetEventsByRadiusAsync_Should_Only_Return_Published_Upcoming_Events [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
2026-01-18 20:00:26.917 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:02:30.84]     LankaConnect.IntegrationTests.Controllers.AuthControllerTests.GetProfile_WithoutAuthentication_ShouldReturn401Unauthorized [FAIL]
[xUnit.net 00:02:30.84]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:02:30.84]       Stack Trace:
[xUnit.net 00:02:30.84]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:02:30.84]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:02:30.84]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:02:30.84]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:02:30.84]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 20:00:26.938 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 20:00:26.938 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 20:00:27.016 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 20:00:27.016 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 20:00:27.017 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 20:00:27.017 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 20:00:27.017 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 20:00:27.017 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 20:00:27.017 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 20:00:27.019 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 20:00:27.019 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 20:00:27.019 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 20:00:27.019 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 20:00:27.019 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 20:00:27.019 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 20:00:27.019 -05:00 [INF]  Program: Applying database migrations...
  Failed LankaConnect.IntegrationTests.Controllers.AuthControllerTests.GetProfile_WithoutAuthentication_ShouldReturn401Unauthorized [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
[xUnit.net 00:02:34.59]     LankaConnect.IntegrationTests.Email.EmailPerformanceTests.StressTest_ShouldHandleHighLoad [FAIL]
[xUnit.net 00:02:34.59]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:02:34.59]       Stack Trace:
[xUnit.net 00:02:34.59]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:02:34.59]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:02:34.59]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:02:34.59]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:02:34.59]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
[xUnit.net 00:02:34.82]     LankaConnect.IntegrationTests.Repositories.BusinessRepositoryTests.AddAsync_Should_Add_Business_Successfully [FAIL]
[xUnit.net 00:02:34.82]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:02:34.82]       Stack Trace:
[xUnit.net 00:02:34.82]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:02:34.82]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:02:34.82]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:02:34.82]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:02:34.82]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
  Failed LankaConnect.IntegrationTests.Email.EmailPerformanceTests.StressTest_ShouldHandleHighLoad [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
  Failed LankaConnect.IntegrationTests.Repositories.BusinessRepositoryTests.AddAsync_Should_Add_Business_Successfully [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
2026-01-18 20:00:30.933 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 20:00:31.076 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 20:00:31.096 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 20:00:31.108 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 20:00:31.121 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 20:00:31.117 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 20:00:31.127 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 20:00:31.128 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 20:00:31.128 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 20:00:31.128 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 20:00:31.128 -05:00 [INF]  Program: Applying database migrations...
[xUnit.net 00:02:35.05]     LankaConnect.IntegrationTests.Controllers.AuthControllerTests.Login_WithUnverifiedEmail_ShouldReturn401Unauthorized [FAIL]
[xUnit.net 00:02:35.05]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:02:35.05]       Stack Trace:
[xUnit.net 00:02:35.05]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:02:35.05]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:02:35.05]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:02:35.05]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:02:35.05]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 20:00:31.149 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 20:00:31.202 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 20:00:31.202 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 20:00:31.202 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 20:00:31.202 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 20:00:31.202 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 20:00:31.203 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 20:00:31.203 -05:00 [INF]  Program: Applying database migrations...
  Failed LankaConnect.IntegrationTests.Controllers.AuthControllerTests.Login_WithUnverifiedEmail_ShouldReturn401Unauthorized [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
2026-01-18 20:00:35.209 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 20:00:35.231 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 20:00:35.259 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:02:39.18]     LankaConnect.IntegrationTests.Controllers.AuthControllerTests.Register_WithInvalidEmail_ShouldReturn400BadRequest [FAIL]
[xUnit.net 00:02:39.18]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:02:39.18]       Stack Trace:
[xUnit.net 00:02:39.18]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:02:39.18]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:02:39.18]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:02:39.18]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:02:39.18]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
  Failed LankaConnect.IntegrationTests.Controllers.AuthControllerTests.Register_WithInvalidEmail_ShouldReturn400BadRequest [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
2026-01-18 20:00:35.289 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 20:00:35.439 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 20:00:35.440 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 20:00:35.440 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 20:00:35.440 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 20:00:35.440 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 20:00:35.441 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 20:00:35.441 -05:00 [INF]  Program: Applying database migrations...
[xUnit.net 00:02:43.05]     LankaConnect.IntegrationTests.Repositories.EventRepositoryLocationTests.GetEventsByRadiusAsync_Should_Exclude_Events_Without_Location [FAIL]
[xUnit.net 00:02:43.05]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:02:43.05]       Stack Trace:
[xUnit.net 00:02:43.05]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:02:43.05]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:02:43.05]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:02:43.05]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:02:43.06]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
  Failed LankaConnect.IntegrationTests.Repositories.EventRepositoryLocationTests.GetEventsByRadiusAsync_Should_Exclude_Events_Without_Location [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
2026-01-18 20:00:39.152 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 20:00:39.202 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 20:00:39.202 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 20:00:39.213 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 20:00:39.213 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 20:00:39.213 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 20:00:39.214 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 20:00:39.214 -05:00 [INF]  Program: Applying database migrations...
[xUnit.net 00:02:43.26]     LankaConnect.IntegrationTests.Repositories.BusinessRepositoryTests.IsOwnerOfBusinessAsync_Should_Return_False_For_Non_Owner [FAIL]
[xUnit.net 00:02:43.26]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:02:43.26]       Stack Trace:
[xUnit.net 00:02:43.26]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:02:43.26]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:02:43.26]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:02:43.26]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:02:43.26]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 20:00:39.366 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 20:00:39.509 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 20:00:39.540 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 20:00:39.541 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 20:00:39.535 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 20:00:39.552 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 20:00:39.561 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 20:00:39.561 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 20:00:39.562 -05:00 [INF]  Program: Applying database migrations...
  Failed LankaConnect.IntegrationTests.Repositories.BusinessRepositoryTests.IsOwnerOfBusinessAsync_Should_Return_False_For_Non_Owner [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
2026-01-18 20:00:43.291 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:02:47.22]     LankaConnect.IntegrationTests.Repositories.EventRepositoryLocationTests.GetEventsByRadiusAsync_Should_Return_Events_Within_50_Miles [FAIL]
[xUnit.net 00:02:47.22]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:02:47.22]       Stack Trace:
[xUnit.net 00:02:47.22]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:02:47.22]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:02:47.22]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:02:47.22]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:02:47.22]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
  Failed LankaConnect.IntegrationTests.Repositories.EventRepositoryLocationTests.GetEventsByRadiusAsync_Should_Return_Events_Within_50_Miles [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
2026-01-18 20:00:43.340 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 20:00:43.479 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 20:00:43.479 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 20:00:43.480 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 20:00:43.480 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 20:00:43.480 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 20:00:43.480 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 20:00:43.481 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 20:00:43.624 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 20:00:43.630 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 20:00:47.525 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:02:51.44]     LankaConnect.IntegrationTests.Repositories.EventRepositoryLocationTests.GetEventsByCityAsync_Should_Be_Case_Insensitive [FAIL]
[xUnit.net 00:02:51.44]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:02:51.44]       Stack Trace:
[xUnit.net 00:02:51.44]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:02:51.44]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:02:51.44]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:02:51.44]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:02:51.44]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
  Failed LankaConnect.IntegrationTests.Repositories.EventRepositoryLocationTests.GetEventsByCityAsync_Should_Be_Case_Insensitive [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
2026-01-18 20:00:47.568 -05:00 [INF]  : Starting LankaConnect API
[xUnit.net 00:02:51.52]     LankaConnect.IntegrationTests.Controllers.AuthControllerTests.ResetPassword_WithExpiredToken_ShouldReturn400BadRequest [FAIL]
[xUnit.net 00:02:51.52]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:02:51.52]       Stack Trace:
[xUnit.net 00:02:51.52]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:02:51.52]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:02:51.52]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:02:51.52]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:02:51.52]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 20:00:47.631 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 20:00:47.745 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 20:00:47.745 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 20:00:47.747 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 20:00:47.747 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 20:00:47.747 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 20:00:47.748 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 20:00:47.748 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 20:00:47.804 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 20:00:47.804 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 20:00:47.804 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 20:00:47.804 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 20:00:47.804 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 20:00:47.804 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 20:00:47.804 -05:00 [INF]  Program: Applying database migrations...
  Failed LankaConnect.IntegrationTests.Controllers.AuthControllerTests.ResetPassword_WithExpiredToken_ShouldReturn400BadRequest [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
[xUnit.net 00:02:55.42]     LankaConnect.IntegrationTests.Repositories.BusinessRepositoryTests.GetWithServicesAsync_Should_Include_Active_Services [FAIL]
[xUnit.net 00:02:55.42]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:02:55.42]       Stack Trace:
[xUnit.net 00:02:55.42]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:02:55.42]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:02:55.42]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:02:55.42]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:02:55.42]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
  Failed LankaConnect.IntegrationTests.Repositories.BusinessRepositoryTests.GetWithServicesAsync_Should_Include_Active_Services [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
2026-01-18 20:00:51.530 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 20:00:51.615 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 20:00:51.615 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 20:00:51.615 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 20:00:51.615 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 20:00:51.615 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 20:00:51.616 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 20:00:51.616 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 20:00:51.825 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 20:00:51.829 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 20:00:51.884 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:02:55.80]     LankaConnect.IntegrationTests.Controllers.AuthControllerTests.Register_WithDuplicateEmail_ShouldReturn400BadRequest [FAIL]
[xUnit.net 00:02:55.80]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:02:55.80]       Stack Trace:
[xUnit.net 00:02:55.80]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:02:55.80]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:02:55.80]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:02:55.80]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:02:55.80]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 20:00:51.896 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 20:00:51.944 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 20:00:51.944 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 20:00:51.944 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 20:00:51.944 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 20:00:51.944 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 20:00:51.944 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 20:00:51.944 -05:00 [INF]  Program: Applying database migrations...
  Failed LankaConnect.IntegrationTests.Controllers.AuthControllerTests.Register_WithDuplicateEmail_ShouldReturn400BadRequest [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
2026-01-18 20:00:55.674 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 20:00:55.679 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 20:00:55.984 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:02:59.90]     LankaConnect.IntegrationTests.Controllers.AuthControllerTests.Register_WithWeakPassword_ShouldReturn400BadRequest [FAIL]
[xUnit.net 00:02:59.90]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:02:59.90]       Stack Trace:
[xUnit.net 00:02:59.90]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:02:59.90]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:02:59.90]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:02:59.90]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:02:59.90]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
  Failed LankaConnect.IntegrationTests.Controllers.AuthControllerTests.Register_WithWeakPassword_ShouldReturn400BadRequest [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
2026-01-18 20:00:56.006 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 20:00:56.071 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 20:00:56.071 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 20:00:56.071 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 20:00:56.071 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 20:00:56.071 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 20:00:56.071 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 20:00:56.071 -05:00 [INF]  Program: Applying database migrations...
[xUnit.net 00:03:03.58]     LankaConnect.IntegrationTests.Repositories.EventRepositoryLocationTests.GetNearestEventsAsync_Should_Return_Events_Ordered_By_Distance [FAIL]
[xUnit.net 00:03:03.58]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:03:03.58]       Stack Trace:
[xUnit.net 00:03:03.58]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:03:03.59]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:03:03.59]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:03:03.59]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:03:03.59]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
  Failed LankaConnect.IntegrationTests.Repositories.EventRepositoryLocationTests.GetNearestEventsAsync_Should_Return_Events_Ordered_By_Distance [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
2026-01-18 20:00:59.693 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 20:00:59.827 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 20:00:59.827 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 20:00:59.827 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 20:00:59.827 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 20:00:59.827 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 20:00:59.828 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 20:00:59.828 -05:00 [INF]  Program: Applying database migrations...
[xUnit.net 00:03:03.94]     LankaConnect.IntegrationTests.Repositories.BusinessRepositoryTests.GetBusinessesWithFiltersAsync_Should_Apply_Multiple_Filters [FAIL]
[xUnit.net 00:03:03.94]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:03:03.94]       Stack Trace:
[xUnit.net 00:03:03.94]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:03:03.94]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:03:03.94]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:03:03.94]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:03:03.94]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
2026-01-18 20:01:00.151 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 20:01:00.158 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
  Failed LankaConnect.IntegrationTests.Repositories.BusinessRepositoryTests.GetBusinessesWithFiltersAsync_Should_Apply_Multiple_Filters [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
2026-01-18 20:01:03.895 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:03:07.81]     LankaConnect.IntegrationTests.Repositories.EventRepositoryLocationTests.GetNearestEventsAsync_Should_Exclude_Events_Without_Coordinates [FAIL]
[xUnit.net 00:03:07.81]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:03:07.81]       Stack Trace:
[xUnit.net 00:03:07.81]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:03:07.81]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:03:07.81]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:03:07.81]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:03:07.81]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
  Failed LankaConnect.IntegrationTests.Repositories.EventRepositoryLocationTests.GetNearestEventsAsync_Should_Exclude_Events_Without_Coordinates [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
[xUnit.net 00:03:11.75]     LankaConnect.IntegrationTests.Controllers.AuthControllerTests.Logout_WithValidToken_ShouldReturn200OK [FAIL]
[xUnit.net 00:03:11.75]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:03:11.75]       Stack Trace:
[xUnit.net 00:03:11.75]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:03:11.75]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:03:11.75]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:03:11.75]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:03:11.75]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
  Failed LankaConnect.IntegrationTests.Controllers.AuthControllerTests.Logout_WithValidToken_ShouldReturn200OK [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
2026-01-18 20:01:07.847 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 20:01:07.911 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 20:01:07.911 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 20:01:07.911 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 20:01:07.911 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 20:01:07.911 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 20:01:07.911 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 20:01:07.911 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 20:01:11.974 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 20:01:11.991 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:03:20.04]     LankaConnect.IntegrationTests.Controllers.AuthControllerTests.ForgotPassword_WithNonExistentUser_ShouldReturn200OK [FAIL]
[xUnit.net 00:03:20.04]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:03:20.04]       Stack Trace:
[xUnit.net 00:03:20.04]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:03:20.04]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:03:20.05]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:03:20.05]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:03:20.05]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
  Failed LankaConnect.IntegrationTests.Controllers.AuthControllerTests.ForgotPassword_WithNonExistentUser_ShouldReturn200OK [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
2026-01-18 20:01:16.160 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 20:01:16.325 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 20:01:16.325 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 20:01:16.326 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 20:01:16.326 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 20:01:16.326 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 20:01:16.326 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 20:01:16.326 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 20:01:20.370 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 20:01:20.384 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:03:28.37]     LankaConnect.IntegrationTests.Controllers.AuthControllerTests.Login_WithInvalidCredentials_ShouldReturn400BadRequest [FAIL]
[xUnit.net 00:03:28.37]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:03:28.37]       Stack Trace:
[xUnit.net 00:03:28.37]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:03:28.37]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:03:28.37]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:03:28.37]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:03:28.37]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
  Failed LankaConnect.IntegrationTests.Controllers.AuthControllerTests.Login_WithInvalidCredentials_ShouldReturn400BadRequest [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
2026-01-18 20:01:24.486 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 20:01:24.556 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 20:01:24.556 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 20:01:24.556 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 20:01:24.556 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 20:01:24.556 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 20:01:24.556 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 20:01:24.556 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 20:01:28.618 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 20:01:28.630 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:03:36.67]     LankaConnect.IntegrationTests.Controllers.AuthControllerTests.VerifyEmail_WithValidToken_ShouldReturn200OK [FAIL]
[xUnit.net 00:03:36.68]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:03:36.68]       Stack Trace:
[xUnit.net 00:03:36.68]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:03:36.68]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:03:36.68]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:03:36.68]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:03:36.68]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
  Failed LankaConnect.IntegrationTests.Controllers.AuthControllerTests.VerifyEmail_WithValidToken_ShouldReturn200OK [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
2026-01-18 20:01:32.787 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 20:01:32.942 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 20:01:32.942 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 20:01:32.942 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 20:01:32.942 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 20:01:32.942 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 20:01:32.943 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 20:01:32.943 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 20:01:37.000 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 20:01:37.014 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:03:44.99]     LankaConnect.IntegrationTests.Controllers.AuthControllerTests.GetProfile_WithValidToken_ShouldReturn200OK [FAIL]
[xUnit.net 00:03:44.99]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:03:44.99]       Stack Trace:
[xUnit.net 00:03:44.99]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:03:44.99]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:03:44.99]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:03:44.99]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:03:44.99]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
  Failed LankaConnect.IntegrationTests.Controllers.AuthControllerTests.GetProfile_WithValidToken_ShouldReturn200OK [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86
2026-01-18 20:01:41.107 -05:00 [INF]  : Starting LankaConnect API
2026-01-18 20:01:41.220 -05:00 [INF]  Program: Phase 6A.X: Validating configuration settings at startup
2026-01-18 20:01:41.221 -05:00 [WRN]  Program: Configuration validation: Missing optional setting AzureStorage:ConnectionString - feature may be disabled
2026-01-18 20:01:41.221 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:SecretKey - feature may be disabled
2026-01-18 20:01:41.221 -05:00 [WRN]  Program: Configuration validation: Missing optional setting Stripe:PublishableKey - feature may be disabled
2026-01-18 20:01:41.221 -05:00 [WRN]  Program: Configuration validation completed with 3 warnings:
Missing optional configuration: AzureStorage:ConnectionString (feature may be disabled)
Missing optional configuration: Stripe:SecretKey (feature may be disabled)
Missing optional configuration: Stripe:PublishableKey (feature may be disabled)
2026-01-18 20:01:41.221 -05:00 [INF]  LankaConnect.Infrastructure.Data.AppDbContext: AppDbContext initialized with IPublisher: MediatR.Mediator
2026-01-18 20:01:41.221 -05:00 [INF]  Program: Applying database migrations...
2026-01-18 20:01:45.285 -05:00 [ERR]  Program: An error occurred while migrating the database
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
2026-01-18 20:01:45.289 -05:00 [FTL]  : Application terminated unexpectedly
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.UnpooledDataSource.Get(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlDatabaseCreator.Exists(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.ExistsAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Migrations.HistoryRepository.GetAppliedMigrationsAsync(CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Migrations.Internal.NpgsqlMigrator.MigrateAsync(String targetMigration, CancellationToken cancellationToken)
   at Program.<Main>$(String[] args) in c:\Work\LankaConnect\src\LankaConnect.API\Program.cs:line 217
[xUnit.net 00:03:53.27]     LankaConnect.IntegrationTests.Controllers.AuthControllerTests.ResetPassword_WithWeakPassword_ShouldReturn400BadRequest [FAIL]
[xUnit.net 00:03:53.27]       System.InvalidOperationException : The server has not been started or no web application was configured.
[xUnit.net 00:03:53.27]       Stack Trace:
[xUnit.net 00:03:53.27]            at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
[xUnit.net 00:03:53.27]            at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
[xUnit.net 00:03:53.27]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
[xUnit.net 00:03:53.27]            at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
[xUnit.net 00:03:53.27]         c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs(86,0): at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync()
[xUnit.net 00:03:53.28]   Finished:    LankaConnect.IntegrationTests
  Failed LankaConnect.IntegrationTests.Controllers.AuthControllerTests.ResetPassword_WithWeakPassword_ShouldReturn400BadRequest [1 ms]
  Error Message:
   System.InvalidOperationException : The server has not been started or no web application was configured.
  Stack Trace:
     at Microsoft.AspNetCore.TestHost.TestServer.get_Application()
   at Microsoft.AspNetCore.TestHost.TestServer.CreateHandler()
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateDefaultClient(DelegatingHandler[] handlers)
   at Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory`1.CreateClient(WebApplicationFactoryClientOptions options)
   at LankaConnect.IntegrationTests.Common.DockerComposeWebApiTestBase.InitializeAsync() in c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\Common\DockerComposeWebApiTestBase.cs:line 86

Test Run Failed.
Total tests: 209
     Passed: 18
     Failed: 182
    Skipped: 9
 Total time: 3.9153 Minutes
     1>Project "c:\Work\LankaConnect\LankaConnect.sln" (1) is building "c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\LankaConnect.IntegrationTests.csproj" (5) on node 2 (VSTest target(s)).
     5>_VSTestConsole:
         MSB4181: The "VSTestTask" task returned false but did not log an error.
     5>Done Building Project "c:\Work\LankaConnect\tests\LankaConnect.IntegrationTests\LankaConnect.IntegrationTests.csproj" (VSTest target(s)) -- FAILED.
     1>Done Building Project "c:\Work\LankaConnect\LankaConnect.sln" (VSTest target(s)) -- FAILED.

Build FAILED.
    0 Warning(s)
    0 Error(s)

Time Elapsed 00:03:59.60
